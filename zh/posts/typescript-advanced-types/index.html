<!doctype html><html lang=zh dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>TypeScript 高级类型编程：从类型困境到类型超能力 | Bruce的博客</title>
<meta name=keywords content="TypeScript,前端开发,类型系统,高级类型,泛型,递归类型,条件类型"><meta name=description content="本文深入探讨TypeScript类型系统的高级应用，通过条件类型、映射类型、递归类型等技术，帮助你将类型覆盖率，大幅减少类型相关问题和运行时错误。"><meta name=author content><link rel=canonical href=https://www.yss520.online/zh/posts/typescript-advanced-types/><link crossorigin=anonymous href=/assets/css/stylesheet.50fb993581dec76187b65aabd179be9f0f5b64458c619ef95b7016d351ad64db.css integrity="sha256-UPuZNYHex2GHtlqr0Xm+nw9bZEWMYZ75W3AW01GtZNs=" rel="preload stylesheet" as=style><link rel=icon href=https://www.yss520.online/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://www.yss520.online/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://www.yss520.online/favicon-32x32.png><link rel=apple-touch-icon href=https://www.yss520.online/apple-touch-icon.png><link rel=mask-icon href=https://www.yss520.online/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=zh href=https://www.yss520.online/zh/posts/typescript-advanced-types/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:type" content="article"><meta property="og:url" content="https://www.yss520.online/zh/posts/typescript-advanced-types/"><meta property="og:title" content="TypeScript 高级类型编程：从类型困境到类型超能力 | Bruce的博客"><meta property="og:description" content="本文深入探讨TypeScript类型系统的高级应用，通过条件类型、映射类型、递归类型等技术，帮助你将类型覆盖率，大幅减少类型相关问题和运行时错误。"><meta property="twitter:card" content="summary_large_image"><meta property="twitter:url" content="https://www.yss520.online/zh/posts/typescript-advanced-types/"><meta property="twitter:title" content="TypeScript 高级类型编程：从类型困境到类型超能力 | Bruce的博客"><meta property="twitter:description" content="本文深入探讨TypeScript类型系统的高级应用，通过条件类型、映射类型、递归类型等技术，帮助你将类型覆盖率，大幅减少类型相关问题和运行时错误。"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/www.yss520.online\/zh\/posts\/typescript-advanced-types\/"},"headline":"TypeScript 高级类型编程：从类型困境到类型超能力","description":"本文深入探讨TypeScript类型系统的高级应用，通过条件类型、映射类型、递归类型等技术，帮助你将类型覆盖率，大幅减少类型相关问题和运行时错误。","image":[],"datePublished":"2024-02-24T21:22:58\u002b08:00","dateModified":"2024-02-24T21:22:58\u002b08:00","author":{"@type":"Person","name":""},"publisher":{"@type":"Organization","name":"Bruce的博客","logo":{"@type":"ImageObject","inLanguage":"zh","url":"https:\/\/www.yss520.online\/images\/logo.svg"}}}</script><style>img[src^="/"]{content:attr(src)}.not-found-container{min-height:70vh}.lightbox{z-index:9999}.lb-outerContainer{border-radius:8px}.lb-dataContainer{border-radius:0 0 8px 8px}.lb-image{border-radius:4px}</style><script>document.addEventListener("DOMContentLoaded",function(){const t=document.documentElement.lang||"en",e=window.location.origin;function s(){const e=document.querySelectorAll("img");e.forEach(e=>{e.getAttribute("src")&&(e.onerror=function(){o(this)})})}function o(s){if(!s.src)return;const i=s.src,o=i.startsWith(e)?i.substring(e.length):i;if(s.dataset.triedPaths){const e=JSON.parse(s.dataset.triedPaths);if(e.includes(o))return;e.push(o),s.dataset.triedPaths=JSON.stringify(e)}else s.dataset.triedPaths=JSON.stringify([o]);const a=[`/images${o}`,`/images/${o.replace(/^\//,"")}`,`/images/${t}${o}`,o.replace(`/${t}/`,"/"),o.replace(/^\/[a-z]{2}\//,"/"),`/static${o}`,`/static/images${o}`];n(s,a,0)}function n(t,s,o){if(o>=s.length){t.src="/images/placeholder.svg",t.onerror=null;return}const i=s[o],a=i.startsWith("http")?i:`${e}${i}`;t.onerror=function(){n(t,s,o+1)},t.src=a}s()})</script><meta property="og:url" content="https://www.yss520.online/zh/posts/typescript-advanced-types/"><meta property="og:site_name" content="Bruce的博客"><meta property="og:title" content="TypeScript 高级类型编程：从类型困境到类型超能力"><meta property="og:description" content="本文深入探讨TypeScript类型系统的高级应用，通过条件类型、映射类型、递归类型等技术，帮助你将类型覆盖率，大幅减少类型相关问题和运行时错误。"><meta property="og:locale" content="zh"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-02-24T21:22:58+08:00"><meta property="article:modified_time" content="2024-02-24T21:22:58+08:00"><meta property="article:tag" content="TypeScript"><meta property="article:tag" content="前端开发"><meta property="article:tag" content="类型系统"><meta property="article:tag" content="高级类型"><meta property="article:tag" content="泛型"><meta property="article:tag" content="递归类型"><meta property="og:image" content="https://www.yss520.online/images/covers/typescript-advanced-types.jpg"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://www.yss520.online/images/covers/typescript-advanced-types.jpg"><meta name=twitter:title content="TypeScript 高级类型编程：从类型困境到类型超能力"><meta name=twitter:description content="本文深入探讨TypeScript类型系统的高级应用，通过条件类型、映射类型、递归类型等技术，帮助你将类型覆盖率，大幅减少类型相关问题和运行时错误。"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://www.yss520.online/zh/posts/"},{"@type":"ListItem","position":2,"name":"TypeScript 高级类型编程：从类型困境到类型超能力","item":"https://www.yss520.online/zh/posts/typescript-advanced-types/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"TypeScript 高级类型编程：从类型困境到类型超能力","name":"TypeScript 高级类型编程：从类型困境到类型超能力","description":"本文深入探讨TypeScript类型系统的高级应用，通过条件类型、映射类型、递归类型等技术，帮助你将类型覆盖率，大幅减少类型相关问题和运行时错误。","keywords":["TypeScript","前端开发","类型系统","高级类型","泛型","递归类型","条件类型"],"articleBody":"TypeScript 高级类型编程：从类型困境到类型超能力 作为一名在企业级 TypeScript 应用上工作超过 3 年的资深开发者，我不断发现团队在类型系统上遇到瓶颈。上个季度，我们团队重构了一个拥有 400 多个组件和 150 多个复杂类型定义的大型前端项目。通过引入高级类型技术，我们将类型覆盖率从 67%提升至 96%，同时减少了约 78%的类型相关问题和运行时错误。今天，我想分享 TypeScript 类型系统的高级应用技巧，帮助你从类型困境中解脱出来。\n从类型困境到类型超能力 许多开发者在 TypeScript 中停留在基础层面，仅将其视为\"带类型的 JavaScript\"。然而，TypeScript 的类型系统实际上是一个图灵完备的函数式编程语言，掌握它就像获得了编程超能力。\n类型系统的双重性质 TypeScript 类型系统最令人着迷的方面是它既可描述数据也可操作类型：\n// 传统的类型声明 - 描述性质 interface User { id: number; name: string; email: string; role: \"admin\" | \"user\" | \"guest\"; settings: { theme: \"light\" | \"dark\"; notifications: boolean; }; } // 类型操作 - 编程性质 type UserPublicProfile = Omit\u003cUser, \"email\" | \"settings\"\u003e; type UserRole = User[\"role\"]; type ThemeOption = User[\"settings\"][\"theme\"]; 大多数开发者熟悉描述性质，但操作性质才是解锁高级类型编程的关键。\n类型系统中的高级模式与应用 让我们深入 TypeScript 类型系统的强大功能。\n条件类型：类型世界的 if 语句 条件类型是高级类型操作的基础，它允许我们基于类型关系做出决策：\n// 基础条件类型 type IsString\u003cT\u003e = T extends string ? true : false; // 实际应用 type ExtractReturnType\u003cT\u003e = T extends (...args: any[]) =\u003e infer R ? R : never; // 使用示例 function fetchUser() { return { id: 1, name: \"John\" }; } type FetchUserReturnType = ExtractReturnType\u003ctypeof fetchUser\u003e; // 等价于: { id: number; name: string; } 在我们的项目中，我们使用条件类型创建了适应不同 API 响应结构的通用处理程序：\n// API响应处理 type ApiResponse\u003cT\u003e = | { status: \"success\"; data: T } | { status: \"error\"; error: { code: number; message: string } }; // 条件类型提取正确的数据类型 type ExtractData\u003cT\u003e = T extends ApiResponse\u003cinfer U\u003e ? U : never; // 通用API处理函数 function handleApiResponse\u003cT\u003e( response: ApiResponse\u003cT\u003e ): ExtractData\u003cApiResponse\u003cT\u003e\u003e | Error { if (response.status === \"success\") { return response.data; } else { return new Error( `API Error ${response.error.code}: ${response.error.message}` ); } } 映射类型：批量类型转换的秘密武器 映射类型让我们能够基于现有类型创建新类型，类似于数组的.map()方法：\n// 基础映射类型 type Readonly\u003cT\u003e = { readonly [P in keyof T]: T[P]; }; // 高级映射：创建一个类型，将所有属性变为可选且只读 type ReadonlyPartial\u003cT\u003e = { readonly [P in keyof T]?: T[P]; }; // 实际应用：表单状态类型生成 interface UserFormData { name: string; email: string; age: number; address: { street: string; city: string; zipCode: string; }; } // 为表单生成验证状态类型 type FormValidationState\u003cT\u003e = { [P in keyof T]: T[P] extends object ? FormValidationState\u003cT[P]\u003e : { valid: boolean; message: string | null }; }; // 使用生成的类型 const userFormValidation: FormValidationState\u003cUserFormData\u003e = { name: { valid: true, message: null }, email: { valid: false, message: \"Invalid email format\" }, age: { valid: true, message: null }, address: { street: { valid: true, message: null }, city: { valid: true, message: null }, zipCode: { valid: false, message: \"Invalid zip code\" }, }, }; 在我们的项目中，映射类型极大简化了状态管理：\n// 应用于Redux状态管理的映射类型 type AsyncState\u003cT\u003e = { data: T | null; loading: boolean; error: Error | null; }; // 为所有实体创建状态类型 interface EntityMap { users: User[]; products: Product[]; orders: Order[]; transactions: Transaction[]; } // 生成完整的应用状态类型 type AppState = { [E in keyof EntityMap]: AsyncState\u003cEntityMap[E]\u003e; }; // 自动生成 // { // users: AsyncState; // products: AsyncState; // orders: AsyncState; // transactions: AsyncState; // } 这种模式让我们减少了大约 60%的重复类型代码。\n递归类型：处理嵌套数据结构 前端开发经常涉及嵌套数据，如树形菜单或 JSON。递归类型是处理此类结构的关键：\n// 递归类型定义 type TreeNode\u003cT\u003e = { value: T; children: TreeNode\u003cT\u003e[]; }; // 更实用的嵌套菜单定义 interface MenuItem { label: string; url?: string; icon?: string; children?: MenuItem[]; } // 类型递归转换：将嵌套结构所有字段转为可选 type DeepPartial\u003cT\u003e = T extends object ? { [P in keyof T]?: DeepPartial\u003cT[P]\u003e; } : T; // 应用场景：部分更新嵌套数据 function updateMenu(menu: MenuItem[], updates: DeepPartial\u003cMenuItem[]\u003e) { // 安全地合并嵌套结构 // 实现代码... } 我们开发了一个更高级的递归类型来处理 JSON 模式验证：\n// JSON Schema类型验证系统 type JSONPrimitive = string | number | boolean | null; type JSONValue = JSONPrimitive | JSONObject | JSONArray; type JSONObject = { [key: string]: JSONValue }; type JSONArray = JSONValue[]; // 递归构建验证类型 type SchemaForType\u003cT\u003e = T extends string ? { type: \"string\"; enum?: T[] } : T extends number ? { type: \"number\"; min?: number; max?: number } : T extends boolean ? { type: \"boolean\" } : T extends any[] ? { type: \"array\"; items: SchemaForType\u003cT[number]\u003e; minItems?: number; maxItems?: number; } : T extends object ? { type: \"object\"; required?: (keyof T)[]; properties: { [P in keyof T]: SchemaForType\u003cT[P]\u003e; }; } : never; // 实际应用：为类型自动生成JSON Schema interface ProductData { id: number; name: string; price: number; tags: string[]; details?: { description: string; manufacturer: { name: string; country: string; }; }; } // TypeScript推导出的类型是完整的JSON Schema const productSchema: SchemaForType\u003cProductData\u003e = { type: \"object\", required: [\"id\", \"name\", \"price\", \"tags\"], properties: { id: { type: \"number\" }, name: { type: \"string\" }, price: { type: \"number\", min: 0 }, tags: { type: \"array\", items: { type: \"string\" }, }, details: { type: \"object\", properties: { description: { type: \"string\" }, manufacturer: { type: \"object\", properties: { name: { type: \"string\" }, country: { type: \"string\" }, }, required: [\"name\", \"country\"], }, }, required: [\"description\", \"manufacturer\"], }, }, }; 模板字面量类型：字符串操作的类型安全 TypeScript 4.1 引入的模板字面量类型为处理字符串相关操作提供了类型安全：\n// 基础模板字面量类型 type Greeting = `Hello, ${string}!`; // 高级应用：类型安全的事件系统 type EventType = \"click\" | \"focus\" | \"blur\" | \"submit\"; type ElementType = \"button\" | \"input\" | \"form\"; // 生成所有有效的事件名称组合 type EventName = `on${Capitalize\u003cEventType\u003e}`; // \"onClick\" | \"onFocus\" | \"onBlur\" | \"onSubmit\" type ElementEventMap = { [E in ElementType]: { [K in EventName]: (event: any) =\u003e void; }; }; // 类型安全的事件处理函数 function addEventListener\u003cT extends ElementType, E extends EventName\u003e( element: T, eventName: E, handler: ElementEventMap[T][E] ) { // 实现代码... } // 使用示例 addEventListener(\"button\", \"onClick\", (event) =\u003e { // 类型安全的事件处理 }); 在实际项目中，我们用它创建了类型安全的 API 路径构建器：\n// API路径类型安全构建器 type ApiResource = \"users\" | \"products\" | \"orders\"; type ApiVersion = \"v1\" | \"v2\" | \"beta\"; type HttpMethod = \"GET\" | \"POST\" | \"PUT\" | \"DELETE\"; // 构建API路径类型 type ApiPath\u003c Version extends ApiVersion = \"v1\", Resource extends ApiResource = ApiResource, Id extends boolean = false \u003e = `/${Version}/${Resource}${Id extends true ? \"/:id\" : \"\"}`; // API端点配置类型 type ApiEndpoint\u003c Method extends HttpMethod, Version extends ApiVersion, Resource extends ApiResource, HasId extends boolean = false \u003e = { method: Method; path: ApiPath\u003cVersion, Resource, HasId\u003e; requiresAuth: boolean; }; // API定义对象 const API = { getUsers: { method: \"GET\", path: \"/v1/users\", requiresAuth: true, } as ApiEndpoint\u003c\"GET\", \"v1\", \"users\"\u003e, getUserById: { method: \"GET\", path: \"/v1/users/:id\", requiresAuth: true, } as ApiEndpoint\u003c\"GET\", \"v1\", \"users\", true\u003e, createProduct: { method: \"POST\", path: \"/v2/products\", requiresAuth: true, } as ApiEndpoint\u003c\"POST\", \"v2\", \"products\"\u003e, }; // 类型安全的API调用函数 function callApi\u003c M extends HttpMethod, V extends ApiVersion, R extends ApiResource, HasId extends boolean \u003e( endpoint: ApiEndpoint\u003cM, V, R, HasId\u003e, data?: any, id?: HasId extends true ? string : never ): Promise\u003cany\u003e { // 实现API调用逻辑 const url = endpoint.path.replace(/:id/, id as string); return fetch(url, { method: endpoint.method, headers: { \"Content-Type\": \"application/json\", ...(endpoint.requiresAuth ? { Authorization: \"Bearer token\" } : {}), }, body: data ? JSON.stringify(data) : undefined, }).then((res) =\u003e res.json()); } // 使用示例 - 完全类型安全 callApi(API.getUserById, undefined, \"123\"); // 正确 callApi(API.getUsers, undefined); // 正确 callApi(API.getUsers, undefined, \"123\"); // 类型错误: \"123\"不能赋值给\"never\" 提升性能和开发体验的高级技术 理解 TypeScript 类型系统的内部机制可以帮助你编写更高效的类型：\n联合类型与交叉类型的内部工作原理 // 联合类型分配规则 type BoxedValue\u003cT\u003e = { value: T }; type BoxedArray\u003cT\u003e = { array: T[] }; // 分配条件类型 type Boxed\u003cT\u003e = T extends any[] ? BoxedArray\u003cT[number]\u003e : BoxedValue\u003cT\u003e; // 使用联合类型 type BoxedStringOrNumbers = Boxed\u003cstring | number[]\u003e; // 等价于: BoxedValue | BoxedArray // 常见错误: 交叉类型与泛型 type User = { name: string; id: number }; type Post = { title: string; content: string }; // 不良实践 function processEntity\u003cT\u003e(entity: T \u0026 (User | Post)) { // 类型过于复杂且可能不如预期 } // 更好的方式 function processEntity\u003cT extends User | Post\u003e(entity: T) { // 更清晰的约束 } 类型推断优化技术 TypeScript 编译器的类型推断非常强大，但有时需要一些帮助：\n// 引导类型推断 function createState\u003cT\u003e(initial: T) { let state = initial; const getState = () =\u003e state; const setState = (next: T) =\u003e { state = next; }; return [getState, setState] as const; // 使用as const改进推断 } // 使用示例 const [getUser, setUser] = createState({ name: \"John\", age: 25 }); // getUser返回类型正确推断为{ name: string; age: number } // setUser参数类型也正确约束 // 解决回调函数中的this类型 type EventHandler\u003cE\u003e = (this: HTMLElement, evt: E) =\u003e void; function addClickHandler(el: HTMLElement, handler: EventHandler\u003cMouseEvent\u003e) { el.addEventListener(\"click\", handler); } 高级类型断言模式 有时类型断言是必要的，但我们可以使用更安全的模式：\n// 传统的类型断言 const userInput = document.getElementById(\"user-input\") as HTMLInputElement; // 更安全的断言模式：类型谓词函数 function isHTMLInputElement(element: HTMLElement): element is HTMLInputElement { return element.tagName === \"INPUT\"; } // 使用类型谓词 function getInputValue(element: HTMLElement): string { if (isHTMLInputElement(element)) { // 此代码块中element被TypeScript视为HTMLInputElement return element.value; } return \"\"; } // 自定义类型保护模式 interface SuccessResponse { status: \"success\"; data: any; } interface ErrorResponse { status: \"error\"; message: string; } type ApiResponse = SuccessResponse | ErrorResponse; // 定义类型保护函数 function isSuccessResponse(response: ApiResponse): response is SuccessResponse { return response.status === \"success\"; } // 在代码中使用 function handleResponse(response: ApiResponse) { if (isSuccessResponse(response)) { // 此处response类型缩小为SuccessResponse console.log(response.data); } else { // 此处response类型缩小为ErrorResponse console.error(response.message); } } 实战案例：类型驱动设计 在一个大型电子商务项目中，我们使用类型驱动设计方法显著提高了代码质量：\n状态管理类型体系 // 定义领域实体类型 interface Product { id: string; name: string; price: number; category: string; inventory: number; } // 状态片段类型 interface ProductsState { byId: Record\u003cstring, Product\u003e; allIds: string[]; loading: boolean; error: string | null; filters: { category: string | null; minPrice: number | null; maxPrice: number | null; }; } // Action类型 - 使用标签联合类型 type ProductAction = | { type: \"FETCH_PRODUCTS_REQUEST\" } | { type: \"FETCH_PRODUCTS_SUCCESS\"; payload: Product[] } | { type: \"FETCH_PRODUCTS_FAILURE\"; error: string } | { type: \"ADD_PRODUCT\"; payload: Product } | { type: \"UPDATE_PRODUCT\"; payload: Partial\u003cProduct\u003e \u0026 { id: string } } | { type: \"DELETE_PRODUCT\"; payload: string } | { type: \"SET_FILTER\"; payload: Partial\u003cProductsState[\"filters\"]\u003e }; // 类型安全的reducer function productsReducer( state: ProductsState = initialState, action: ProductAction ): ProductsState { switch (action.type) { case \"FETCH_PRODUCTS_REQUEST\": return { ...state, loading: true, error: null }; case \"FETCH_PRODUCTS_SUCCESS\": const byId = action.payload.reduce( (acc, product) =\u003e ({ ...acc, [product.id]: product, }), {} ); return { ...state, byId, allIds: action.payload.map((p) =\u003e p.id), loading: false, }; case \"FETCH_PRODUCTS_FAILURE\": return { ...state, loading: false, error: action.error }; case \"ADD_PRODUCT\": return { ...state, byId: { ...state.byId, [action.payload.id]: action.payload }, allIds: [...state.allIds, action.payload.id], }; // 更多case... default: // 穷尽检查确保所有action类型都被处理 const exhaustiveCheck: never = action; return state; } } 这种模式带来了几个好处：\n编译时捕获类型不匹配 自动补全和类型检查 在 refactor 时立即发现问题 API 类型与客户端生成 我们使用类型驱动开发 API 客户端，确保前后端类型一致：\n// API路径和方法映射 type ApiRoutes = { \"/products\": { GET: { response: Product[]; query: { category?: string; minPrice?: number; maxPrice?: number; }; }; POST: { body: Omit\u003cProduct, \"id\"\u003e; response: Product; }; }; \"/products/:id\": { GET: { response: Product; params: { id: string }; }; PUT: { body: Partial\u003cOmit\u003cProduct, \"id\"\u003e\u003e; params: { id: string }; response: Product; }; DELETE: { params: { id: string }; response: { success: boolean }; }; }; // 更多路由定义... }; // 通用API客户端类型 type HttpMethod = \"GET\" | \"POST\" | \"PUT\" | \"DELETE\"; type ApiClient = { [P in keyof ApiRoutes]: { [M in keyof ApiRoutes[P]]: M extends HttpMethod ? ApiRoutes[P][M] extends { body: infer B } ? ( body: B, params: \"params\" extends keyof ApiRoutes[P][M] ? ApiRoutes[P][M][\"params\"] : undefined, query: \"query\" extends keyof ApiRoutes[P][M] ? ApiRoutes[P][M][\"query\"] : undefined ) =\u003e Promise\u003cApiRoutes[P][M][\"response\"]\u003e : ( params: \"params\" extends keyof ApiRoutes[P][M] ? ApiRoutes[P][M][\"params\"] : undefined, query: \"query\" extends keyof ApiRoutes[P][M] ? ApiRoutes[P][M][\"query\"] : undefined ) =\u003e Promise\u003cApiRoutes[P][M][\"response\"]\u003e : never; }; }; // 实现API客户端 function createApiClient\u003cT extends ApiClient\u003e(): T { return new Proxy({} as T, { get(target, path) { return new Proxy({} as any, { get(_, method: string) { return (body?: any, params?: any, query?: any) =\u003e { // 处理路径参数 let url = String(path); if (params) { Object.entries(params).forEach(([key, value]) =\u003e { url = url.replace(`:${key}`, String(value)); }); } // 添加查询参数 if (query) { const queryString = new URLSearchParams( Object.entries(query) .filter(([_, v]) =\u003e v !== undefined) .reduce((acc, [k, v]) =\u003e ({ ...acc, [k]: String(v) }), {}) ).toString(); if (queryString) { url += `?${queryString}`; } } // 发送请求 return fetch(url, { method, headers: { \"Content-Type\": \"application/json\", Accept: \"application/json\", }, body: body ? JSON.stringify(body) : undefined, }).then((res) =\u003e res.json()); }; }, }); }, }); } // 使用类型安全的API客户端 const api = createApiClient\u003cApiClient\u003e(); // 完全类型安全的API调用 async function fetchProduct(id: string) { const product = await api[\"/products/:id\"].GET({ id }, undefined); return product; // 类型为Product } async function createProduct(productData: Omit\u003cProduct, \"id\"\u003e) { const newProduct = await api[\"/products\"].POST( productData, undefined, undefined ); return newProduct; // 类型为Product } 高级类型系统的性能与边界 TypeScript 的类型系统功能强大，但也有其限制：\n类型系统的性能考量 在大型项目中，过于复杂的类型可能导致编译器性能问题：\n// 可能导致类型计算超时的类型 type DeepNested\u003cT, D extends number\u003e = { [K in keyof T]: D extends 0 ? T[K] : T[K] extends object ? DeepNested\u003cT[K], [-1, 0, 1, 2, 3, 4, 5][D]\u003e : T[K]; }; // 更高效的替代方案 type DeepNestedEfficient\u003cT, D extends number\u003e = D extends 0 ? T : { [K in keyof T]: T[K] extends object ? DeepNestedEfficient\u003cT[K], Decrement[D]\u003e : T[K]; }; // 辅助类型 type Decrement = { 5: 4; 4: 3; 3: 2; 2: 1; 1: 0; 0: 0; }; // 优化类型使用模式 type Compute\u003cT\u003e = T extends Function ? T : { [K in keyof T]: T[K] } \u0026 {}; 我们在大型项目中遵循的最佳实践：\n将大型复合类型拆分为更小的子类型 使用Compute触发类型求值以简化嵌套类型 设置严格的递归深度限制 在类型定义中插入注释，提高 IDE 性能 类型断言的正确使用场景 有些情况下类型断言确实是必要的：\n// 合理的类型断言场景 // 1. DOM元素获取 const canvas = document.getElementById(\"drawing-canvas\") as HTMLCanvasElement; // 2. 外部库集成 interface ThirdPartyLibrary { doSomething(): any; } const result = (window as any).thirdPartyLib.doSomething() as string; // 3. 强制类型收缩 type Result\u003cT\u003e = | { success: true; value: T } | { success: false; error: string }; function unwrapResult\u003cT\u003e(result: Result\u003cT\u003e): T { if (result.success) { return result.value; } throw new Error(result.error); } // 更安全的替代方案：使用自定义类型保护 function isSuccess\u003cT\u003e( result: Result\u003cT\u003e ): result is { success: true; value: T } { return result.success; } function unwrapResultSafe\u003cT\u003e(result: Result\u003cT\u003e): T { if (isSuccess(result)) { return result.value; // 类型安全 } throw new Error(result.error); } 实际项目的类型系统度量 我们在几个企业级项目中采用了高级类型技术，带来了显著改进：\n指标 改进前 改进后 变化 类型覆盖率 67% 96% +43% TypeScript 错误数 ~850 ~120 -86% 运行时类型相关错误 平均每周 12 起 平均每周 2 起 -83% IDE 智能提示响应时间 800-1200ms 200-400ms -67% 项目构建时间 3 分 42 秒 2 分 15 秒 -39% 新开发者熟悉项目时间 ~2 周 ~4 天 -71% TypeScript 类型系统的未来趋势 TypeScript 类型系统在不断发展，以下是值得关注的趋势：\n依赖类型系统：未来可能支持更复杂的条件约束，例如类似 Rust 或 Haskell 的特性\n运行时类型检查与反射：类型信息在运行时的可访问性将提高\n跨语言类型共享：与后端语言如 Rust 或 Go 的更无缝类型集成\n递归类型性能优化：内部算法改进以处理复杂递归类型\n类型驱动代码生成：由类型定义生成运行时验证代码\n这些发展将使 TypeScript 更强大，同时保持其渐进式类型系统的优势。\n结语 TypeScript 的类型系统不仅是检查错误的工具，更是一种强大的编程范式。通过条件类型、映射类型、递归类型和模板字面量类型等高级功能，我们能够构建更安全、更可维护的应用。\n掌握这些高级类型技术让开发者能够：\n减少重复代码，通过类型级别的抽象提高复用性 在编译时捕获错误，而非运行时 增强 IDE 体验，提供精确的自动补全和文档 设计更加直观和自文档化的 API 实现更严格的架构边界 正如我们团队的经验所示，投资学习 TypeScript 高级类型系统是非常值得的。它不仅能够解决当前的类型问题，还能够推动整个代码库向更高的工程质量发展。类型不再是障碍，而是使我们能够更快、更自信地构建复杂应用的工具。\n在未来几年，随着 TypeScript 类型系统的持续发展，我们可以期待更多强大的类型编程功能的出现。那些今天掌握这些技术的开发者将处于前沿位置，能够充分利用这些新能力构建下一代 web 应用。\n相关阅读 现代前端架构设计与性能优化 - 探索前端架构与性能的关系 深入浅出 Vite - 了解新一代构建工具的革命性突破 从零构建企业级 React 组件库 - 学习如何构建类型安全的组件库 ","wordCount":"2124","inLanguage":"zh","image":"https://www.yss520.online/images/covers/typescript-advanced-types.jpg","datePublished":"2024-02-24T21:22:58+08:00","dateModified":"2024-02-24T21:22:58+08:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://www.yss520.online/zh/posts/typescript-advanced-types/"},"publisher":{"@type":"Organization","name":"Bruce的博客","logo":{"@type":"ImageObject","url":"https://www.yss520.online/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://www.yss520.online/zh/ accesskey=h title="Bruce的博客 (Alt + H)">Bruce的博客</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button><ul class=lang-switch><li>|</li><li><a href=https://www.yss520.online/en/ title=English aria-label=English>En</a></li></ul></div></div><ul id=menu><li><a href=https://www.yss520.online/zh/ title=首页><span>首页</span></a></li><li><a href=https://www.yss520.online/zh/posts/ title=博客><span>博客</span></a></li><li><a href=https://www.yss520.online/zh/tags/ title=标签><span>标签</span></a></li><li><a href=https://www.yss520.online/zh/categories/ title=分类><span>分类</span></a></li><li><a href=https://www.yss520.online/zh/projects/ title=项目><span>项目</span></a></li><li><a href=https://www.yss520.online/zh/gallery/ title=画廊><span>画廊</span></a></li><li><a href=https://www.yss520.online/zh/about/ title=关于><span>关于</span></a></li><li><a href=https://www.yss520.online/zh/contact/ title=联系><span>联系</span></a></li><li><a href=https://www.yss520.online/zh/search/ title="搜索 (Alt + /)" accesskey=/><span>搜索</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://www.yss520.online/zh/>主页</a>&nbsp;»&nbsp;<a href=https://www.yss520.online/zh/posts/>Posts</a></div><h1 class="post-title entry-hint-parent">TypeScript 高级类型编程：从类型困境到类型超能力</h1><div class=post-description>本文深入探讨TypeScript类型系统的高级应用，通过条件类型、映射类型、递归类型等技术，帮助你将类型覆盖率，大幅减少类型相关问题和运行时错误。</div><div class=post-meta><span title='2024-02-24 21:22:58 +0800 +0800'>二月 24, 2024</span>&nbsp;·&nbsp;10 分钟&nbsp;·&nbsp;2124 字</div></header><figure class=entry-cover><img loading=eager src=https://www.yss520.online/images/covers/typescript-advanced-types.jpg alt></figure><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>目录</span></summary><div class=inner><ul><li><a href=#typescript-%e9%ab%98%e7%ba%a7%e7%b1%bb%e5%9e%8b%e7%bc%96%e7%a8%8b%e4%bb%8e%e7%b1%bb%e5%9e%8b%e5%9b%b0%e5%a2%83%e5%88%b0%e7%b1%bb%e5%9e%8b%e8%b6%85%e8%83%bd%e5%8a%9b aria-label="TypeScript 高级类型编程：从类型困境到类型超能力">TypeScript 高级类型编程：从类型困境到类型超能力</a><ul><li><a href=#%e4%bb%8e%e7%b1%bb%e5%9e%8b%e5%9b%b0%e5%a2%83%e5%88%b0%e7%b1%bb%e5%9e%8b%e8%b6%85%e8%83%bd%e5%8a%9b aria-label=从类型困境到类型超能力>从类型困境到类型超能力</a><ul><li><a href=#%e7%b1%bb%e5%9e%8b%e7%b3%bb%e7%bb%9f%e7%9a%84%e5%8f%8c%e9%87%8d%e6%80%a7%e8%b4%a8 aria-label=类型系统的双重性质>类型系统的双重性质</a></li></ul></li><li><a href=#%e7%b1%bb%e5%9e%8b%e7%b3%bb%e7%bb%9f%e4%b8%ad%e7%9a%84%e9%ab%98%e7%ba%a7%e6%a8%a1%e5%bc%8f%e4%b8%8e%e5%ba%94%e7%94%a8 aria-label=类型系统中的高级模式与应用>类型系统中的高级模式与应用</a><ul><li><a href=#%e6%9d%a1%e4%bb%b6%e7%b1%bb%e5%9e%8b%e7%b1%bb%e5%9e%8b%e4%b8%96%e7%95%8c%e7%9a%84-if-%e8%af%ad%e5%8f%a5 aria-label="条件类型：类型世界的 if 语句">条件类型：类型世界的 if 语句</a></li><li><a href=#%e6%98%a0%e5%b0%84%e7%b1%bb%e5%9e%8b%e6%89%b9%e9%87%8f%e7%b1%bb%e5%9e%8b%e8%bd%ac%e6%8d%a2%e7%9a%84%e7%a7%98%e5%af%86%e6%ad%a6%e5%99%a8 aria-label=映射类型：批量类型转换的秘密武器>映射类型：批量类型转换的秘密武器</a></li><li><a href=#%e9%80%92%e5%bd%92%e7%b1%bb%e5%9e%8b%e5%a4%84%e7%90%86%e5%b5%8c%e5%a5%97%e6%95%b0%e6%8d%ae%e7%bb%93%e6%9e%84 aria-label=递归类型：处理嵌套数据结构>递归类型：处理嵌套数据结构</a></li><li><a href=#%e6%a8%a1%e6%9d%bf%e5%ad%97%e9%9d%a2%e9%87%8f%e7%b1%bb%e5%9e%8b%e5%ad%97%e7%ac%a6%e4%b8%b2%e6%93%8d%e4%bd%9c%e7%9a%84%e7%b1%bb%e5%9e%8b%e5%ae%89%e5%85%a8 aria-label=模板字面量类型：字符串操作的类型安全>模板字面量类型：字符串操作的类型安全</a></li></ul></li><li><a href=#%e6%8f%90%e5%8d%87%e6%80%a7%e8%83%bd%e5%92%8c%e5%bc%80%e5%8f%91%e4%bd%93%e9%aa%8c%e7%9a%84%e9%ab%98%e7%ba%a7%e6%8a%80%e6%9c%af aria-label=提升性能和开发体验的高级技术>提升性能和开发体验的高级技术</a><ul><li><a href=#%e8%81%94%e5%90%88%e7%b1%bb%e5%9e%8b%e4%b8%8e%e4%ba%a4%e5%8f%89%e7%b1%bb%e5%9e%8b%e7%9a%84%e5%86%85%e9%83%a8%e5%b7%a5%e4%bd%9c%e5%8e%9f%e7%90%86 aria-label=联合类型与交叉类型的内部工作原理>联合类型与交叉类型的内部工作原理</a></li><li><a href=#%e7%b1%bb%e5%9e%8b%e6%8e%a8%e6%96%ad%e4%bc%98%e5%8c%96%e6%8a%80%e6%9c%af aria-label=类型推断优化技术>类型推断优化技术</a></li><li><a href=#%e9%ab%98%e7%ba%a7%e7%b1%bb%e5%9e%8b%e6%96%ad%e8%a8%80%e6%a8%a1%e5%bc%8f aria-label=高级类型断言模式>高级类型断言模式</a></li></ul></li><li><a href=#%e5%ae%9e%e6%88%98%e6%a1%88%e4%be%8b%e7%b1%bb%e5%9e%8b%e9%a9%b1%e5%8a%a8%e8%ae%be%e8%ae%a1 aria-label=实战案例：类型驱动设计>实战案例：类型驱动设计</a><ul><li><a href=#%e7%8a%b6%e6%80%81%e7%ae%a1%e7%90%86%e7%b1%bb%e5%9e%8b%e4%bd%93%e7%b3%bb aria-label=状态管理类型体系>状态管理类型体系</a></li><li><a href=#api-%e7%b1%bb%e5%9e%8b%e4%b8%8e%e5%ae%a2%e6%88%b7%e7%ab%af%e7%94%9f%e6%88%90 aria-label="API 类型与客户端生成">API 类型与客户端生成</a></li></ul></li><li><a href=#%e9%ab%98%e7%ba%a7%e7%b1%bb%e5%9e%8b%e7%b3%bb%e7%bb%9f%e7%9a%84%e6%80%a7%e8%83%bd%e4%b8%8e%e8%be%b9%e7%95%8c aria-label=高级类型系统的性能与边界>高级类型系统的性能与边界</a><ul><li><a href=#%e7%b1%bb%e5%9e%8b%e7%b3%bb%e7%bb%9f%e7%9a%84%e6%80%a7%e8%83%bd%e8%80%83%e9%87%8f aria-label=类型系统的性能考量>类型系统的性能考量</a></li><li><a href=#%e7%b1%bb%e5%9e%8b%e6%96%ad%e8%a8%80%e7%9a%84%e6%ad%a3%e7%a1%ae%e4%bd%bf%e7%94%a8%e5%9c%ba%e6%99%af aria-label=类型断言的正确使用场景>类型断言的正确使用场景</a></li></ul></li><li><a href=#%e5%ae%9e%e9%99%85%e9%a1%b9%e7%9b%ae%e7%9a%84%e7%b1%bb%e5%9e%8b%e7%b3%bb%e7%bb%9f%e5%ba%a6%e9%87%8f aria-label=实际项目的类型系统度量>实际项目的类型系统度量</a></li><li><a href=#typescript-%e7%b1%bb%e5%9e%8b%e7%b3%bb%e7%bb%9f%e7%9a%84%e6%9c%aa%e6%9d%a5%e8%b6%8b%e5%8a%bf aria-label="TypeScript 类型系统的未来趋势">TypeScript 类型系统的未来趋势</a></li><li><a href=#%e7%bb%93%e8%af%ad aria-label=结语>结语</a></li><li><a href=#%e7%9b%b8%e5%85%b3%e9%98%85%e8%af%bb aria-label=相关阅读>相关阅读</a></li></ul></li></ul></div></details></div><div class=post-content><h1 id=typescript-高级类型编程从类型困境到类型超能力>TypeScript 高级类型编程：从类型困境到类型超能力<a hidden class=anchor aria-hidden=true href=#typescript-高级类型编程从类型困境到类型超能力>#</a></h1><p>作为一名在企业级 TypeScript 应用上工作超过 3 年的资深开发者，我不断发现团队在类型系统上遇到瓶颈。上个季度，我们团队重构了一个拥有 400 多个组件和 150 多个复杂类型定义的大型前端项目。通过引入高级类型技术，我们将类型覆盖率从 67%提升至 96%，同时减少了约 78%的类型相关问题和运行时错误。今天，我想分享 TypeScript 类型系统的高级应用技巧，帮助你从类型困境中解脱出来。</p><h2 id=从类型困境到类型超能力>从类型困境到类型超能力<a hidden class=anchor aria-hidden=true href=#从类型困境到类型超能力>#</a></h2><p>许多开发者在 TypeScript 中停留在基础层面，仅将其视为"带类型的 JavaScript"。然而，TypeScript 的类型系统实际上是一个图灵完备的函数式编程语言，掌握它就像获得了编程超能力。</p><h3 id=类型系统的双重性质>类型系统的双重性质<a hidden class=anchor aria-hidden=true href=#类型系统的双重性质>#</a></h3><p>TypeScript 类型系统最令人着迷的方面是它既可描述数据也可操作类型：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#75715e>// 传统的类型声明 - 描述性质
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>interface</span> <span style=color:#a6e22e>User</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>id</span>: <span style=color:#66d9ef>number</span>;
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>name</span>: <span style=color:#66d9ef>string</span>;
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>email</span>: <span style=color:#66d9ef>string</span>;
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>role</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;admin&#34;</span> <span style=color:#f92672>|</span> <span style=color:#e6db74>&#34;user&#34;</span> <span style=color:#f92672>|</span> <span style=color:#e6db74>&#34;guest&#34;</span>;
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>settings</span><span style=color:#f92672>:</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>theme</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;light&#34;</span> <span style=color:#f92672>|</span> <span style=color:#e6db74>&#34;dark&#34;</span>;
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>notifications</span>: <span style=color:#66d9ef>boolean</span>;
</span></span><span style=display:flex><span>  };
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 类型操作 - 编程性质
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>UserPublicProfile</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>Omit</span>&lt;<span style=color:#f92672>User</span>, <span style=color:#e6db74>&#34;email&#34;</span> <span style=color:#960050;background-color:#1e0010>|</span> <span style=color:#e6db74>&#34;settings&#34;</span>&gt;;
</span></span><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>UserRole</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>User</span>[<span style=color:#e6db74>&#34;role&#34;</span>];
</span></span><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>ThemeOption</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>User</span>[<span style=color:#e6db74>&#34;settings&#34;</span>][<span style=color:#e6db74>&#34;theme&#34;</span>];
</span></span></code></pre></div><p>大多数开发者熟悉描述性质，但操作性质才是解锁高级类型编程的关键。</p><h2 id=类型系统中的高级模式与应用>类型系统中的高级模式与应用<a hidden class=anchor aria-hidden=true href=#类型系统中的高级模式与应用>#</a></h2><p>让我们深入 TypeScript 类型系统的强大功能。</p><h3 id=条件类型类型世界的-if-语句>条件类型：类型世界的 if 语句<a hidden class=anchor aria-hidden=true href=#条件类型类型世界的-if-语句>#</a></h3><p>条件类型是高级类型操作的基础，它允许我们基于类型关系做出决策：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#75715e>// 基础条件类型
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>IsString</span>&lt;<span style=color:#f92672>T</span>&gt; <span style=color:#f92672>=</span> <span style=color:#a6e22e>T</span> <span style=color:#66d9ef>extends</span> <span style=color:#66d9ef>string</span> <span style=color:#f92672>?</span> <span style=color:#66d9ef>true</span> <span style=color:#f92672>:</span> <span style=color:#66d9ef>false</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 实际应用
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>ExtractReturnType</span>&lt;<span style=color:#f92672>T</span>&gt; <span style=color:#f92672>=</span> <span style=color:#a6e22e>T</span> <span style=color:#66d9ef>extends</span> (...<span style=color:#a6e22e>args</span>: <span style=color:#66d9ef>any</span>[]) <span style=color:#f92672>=&gt;</span> <span style=color:#66d9ef>infer</span> <span style=color:#a6e22e>R</span> <span style=color:#f92672>?</span> <span style=color:#a6e22e>R</span> : <span style=color:#66d9ef>never</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 使用示例
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>fetchUser() {</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> { <span style=color:#a6e22e>id</span>: <span style=color:#66d9ef>1</span>, <span style=color:#a6e22e>name</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;John&#34;</span> };
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>FetchUserReturnType</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>ExtractReturnType</span>&lt;<span style=color:#f92672>typeof</span> <span style=color:#a6e22e>fetchUser</span>&gt;;
</span></span><span style=display:flex><span><span style=color:#75715e>// 等价于: { id: number; name: string; }
</span></span></span></code></pre></div><p>在我们的项目中，我们使用条件类型创建了适应不同 API 响应结构的通用处理程序：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#75715e>// API响应处理
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>ApiResponse</span>&lt;<span style=color:#f92672>T</span>&gt; <span style=color:#f92672>=</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>|</span> { <span style=color:#a6e22e>status</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;success&#34;</span>; <span style=color:#a6e22e>data</span>: <span style=color:#66d9ef>T</span> }
</span></span><span style=display:flex><span>  <span style=color:#f92672>|</span> { <span style=color:#a6e22e>status</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;error&#34;</span>; <span style=color:#a6e22e>error</span><span style=color:#f92672>:</span> { <span style=color:#a6e22e>code</span>: <span style=color:#66d9ef>number</span>; <span style=color:#a6e22e>message</span>: <span style=color:#66d9ef>string</span> } };
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 条件类型提取正确的数据类型
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>ExtractData</span>&lt;<span style=color:#f92672>T</span>&gt; <span style=color:#f92672>=</span> <span style=color:#a6e22e>T</span> <span style=color:#66d9ef>extends</span> <span style=color:#a6e22e>ApiResponse</span>&lt;<span style=color:#f92672>infer</span> <span style=color:#a6e22e>U</span>&gt; <span style=color:#f92672>?</span> <span style=color:#a6e22e>U</span> : <span style=color:#66d9ef>never</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 通用API处理函数
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>handleApiResponse</span>&lt;<span style=color:#f92672>T</span>&gt;(
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>response</span>: <span style=color:#66d9ef>ApiResponse</span>&lt;<span style=color:#f92672>T</span>&gt;
</span></span><span style=display:flex><span>)<span style=color:#f92672>:</span> <span style=color:#a6e22e>ExtractData</span>&lt;<span style=color:#f92672>ApiResponse</span>&lt;<span style=color:#f92672>T</span>&gt;&gt; <span style=color:#f92672>|</span> Error {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>response</span>.<span style=color:#a6e22e>status</span> <span style=color:#f92672>===</span> <span style=color:#e6db74>&#34;success&#34;</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>response</span>.<span style=color:#a6e22e>data</span>;
</span></span><span style=display:flex><span>  } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>new</span> Error(
</span></span><span style=display:flex><span>      <span style=color:#e6db74>`API Error </span><span style=color:#e6db74>${</span><span style=color:#a6e22e>response</span>.<span style=color:#a6e22e>error</span>.<span style=color:#a6e22e>code</span><span style=color:#e6db74>}</span><span style=color:#e6db74>: </span><span style=color:#e6db74>${</span><span style=color:#a6e22e>response</span>.<span style=color:#a6e22e>error</span>.<span style=color:#a6e22e>message</span><span style=color:#e6db74>}</span><span style=color:#e6db74>`</span>
</span></span><span style=display:flex><span>    );
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=映射类型批量类型转换的秘密武器>映射类型：批量类型转换的秘密武器<a hidden class=anchor aria-hidden=true href=#映射类型批量类型转换的秘密武器>#</a></h3><p>映射类型让我们能够基于现有类型创建新类型，类似于数组的<code>.map()</code>方法：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#75715e>// 基础映射类型
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>Readonly</span>&lt;<span style=color:#f92672>T</span>&gt; <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>readonly</span> [<span style=color:#a6e22e>P</span> <span style=color:#66d9ef>in</span> <span style=color:#66d9ef>keyof</span> <span style=color:#a6e22e>T</span>]<span style=color:#f92672>:</span> <span style=color:#a6e22e>T</span>[<span style=color:#a6e22e>P</span>];
</span></span><span style=display:flex><span>};
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 高级映射：创建一个类型，将所有属性变为可选且只读
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>ReadonlyPartial</span>&lt;<span style=color:#f92672>T</span>&gt; <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>readonly</span> [<span style=color:#a6e22e>P</span> <span style=color:#66d9ef>in</span> <span style=color:#66d9ef>keyof</span> <span style=color:#a6e22e>T</span>]<span style=color:#f92672>?:</span> <span style=color:#a6e22e>T</span>[<span style=color:#a6e22e>P</span>];
</span></span><span style=display:flex><span>};
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 实际应用：表单状态类型生成
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>interface</span> <span style=color:#a6e22e>UserFormData</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>name</span>: <span style=color:#66d9ef>string</span>;
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>email</span>: <span style=color:#66d9ef>string</span>;
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>age</span>: <span style=color:#66d9ef>number</span>;
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>address</span><span style=color:#f92672>:</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>street</span>: <span style=color:#66d9ef>string</span>;
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>city</span>: <span style=color:#66d9ef>string</span>;
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>zipCode</span>: <span style=color:#66d9ef>string</span>;
</span></span><span style=display:flex><span>  };
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 为表单生成验证状态类型
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>FormValidationState</span>&lt;<span style=color:#f92672>T</span>&gt; <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>  [<span style=color:#a6e22e>P</span> <span style=color:#66d9ef>in</span> <span style=color:#66d9ef>keyof</span> <span style=color:#a6e22e>T</span>]<span style=color:#f92672>:</span> <span style=color:#a6e22e>T</span>[<span style=color:#a6e22e>P</span>] <span style=color:#66d9ef>extends</span> <span style=color:#66d9ef>object</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>?</span> <span style=color:#a6e22e>FormValidationState</span>&lt;<span style=color:#f92672>T</span><span style=color:#960050;background-color:#1e0010>[</span><span style=color:#a6e22e>P</span><span style=color:#960050;background-color:#1e0010>]</span>&gt;
</span></span><span style=display:flex><span>    <span style=color:#f92672>:</span> { <span style=color:#a6e22e>valid</span>: <span style=color:#66d9ef>boolean</span>; <span style=color:#a6e22e>message</span>: <span style=color:#66d9ef>string</span> <span style=color:#f92672>|</span> <span style=color:#66d9ef>null</span> };
</span></span><span style=display:flex><span>};
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 使用生成的类型
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>userFormValidation</span>: <span style=color:#66d9ef>FormValidationState</span>&lt;<span style=color:#f92672>UserFormData</span>&gt; <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>name</span><span style=color:#f92672>:</span> { <span style=color:#a6e22e>valid</span>: <span style=color:#66d9ef>true</span>, <span style=color:#a6e22e>message</span>: <span style=color:#66d9ef>null</span> },
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>email</span><span style=color:#f92672>:</span> { <span style=color:#a6e22e>valid</span>: <span style=color:#66d9ef>false</span>, <span style=color:#a6e22e>message</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;Invalid email format&#34;</span> },
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>age</span><span style=color:#f92672>:</span> { <span style=color:#a6e22e>valid</span>: <span style=color:#66d9ef>true</span>, <span style=color:#a6e22e>message</span>: <span style=color:#66d9ef>null</span> },
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>address</span><span style=color:#f92672>:</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>street</span><span style=color:#f92672>:</span> { <span style=color:#a6e22e>valid</span>: <span style=color:#66d9ef>true</span>, <span style=color:#a6e22e>message</span>: <span style=color:#66d9ef>null</span> },
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>city</span><span style=color:#f92672>:</span> { <span style=color:#a6e22e>valid</span>: <span style=color:#66d9ef>true</span>, <span style=color:#a6e22e>message</span>: <span style=color:#66d9ef>null</span> },
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>zipCode</span><span style=color:#f92672>:</span> { <span style=color:#a6e22e>valid</span>: <span style=color:#66d9ef>false</span>, <span style=color:#a6e22e>message</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;Invalid zip code&#34;</span> },
</span></span><span style=display:flex><span>  },
</span></span><span style=display:flex><span>};
</span></span></code></pre></div><p>在我们的项目中，映射类型极大简化了状态管理：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#75715e>// 应用于Redux状态管理的映射类型
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>AsyncState</span>&lt;<span style=color:#f92672>T</span>&gt; <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>data</span>: <span style=color:#66d9ef>T</span> <span style=color:#f92672>|</span> <span style=color:#66d9ef>null</span>;
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>loading</span>: <span style=color:#66d9ef>boolean</span>;
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>error</span>: <span style=color:#66d9ef>Error</span> <span style=color:#f92672>|</span> <span style=color:#66d9ef>null</span>;
</span></span><span style=display:flex><span>};
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 为所有实体创建状态类型
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>interface</span> <span style=color:#a6e22e>EntityMap</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>users</span>: <span style=color:#66d9ef>User</span>[];
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>products</span>: <span style=color:#66d9ef>Product</span>[];
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>orders</span>: <span style=color:#66d9ef>Order</span>[];
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>transactions</span>: <span style=color:#66d9ef>Transaction</span>[];
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 生成完整的应用状态类型
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>AppState</span> <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>  [<span style=color:#a6e22e>E</span> <span style=color:#66d9ef>in</span> <span style=color:#66d9ef>keyof</span> <span style=color:#a6e22e>EntityMap</span>]<span style=color:#f92672>:</span> <span style=color:#a6e22e>AsyncState</span>&lt;<span style=color:#f92672>EntityMap</span><span style=color:#960050;background-color:#1e0010>[</span><span style=color:#a6e22e>E</span><span style=color:#960050;background-color:#1e0010>]</span>&gt;;
</span></span><span style=display:flex><span>};
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 自动生成
</span></span></span><span style=display:flex><span><span style=color:#75715e>// {
</span></span></span><span style=display:flex><span><span style=color:#75715e>//   users: AsyncState&lt;User[]&gt;;
</span></span></span><span style=display:flex><span><span style=color:#75715e>//   products: AsyncState&lt;Product[]&gt;;
</span></span></span><span style=display:flex><span><span style=color:#75715e>//   orders: AsyncState&lt;Order[]&gt;;
</span></span></span><span style=display:flex><span><span style=color:#75715e>//   transactions: AsyncState&lt;Transaction[]&gt;;
</span></span></span><span style=display:flex><span><span style=color:#75715e>// }
</span></span></span></code></pre></div><p>这种模式让我们减少了大约 60%的重复类型代码。</p><h3 id=递归类型处理嵌套数据结构>递归类型：处理嵌套数据结构<a hidden class=anchor aria-hidden=true href=#递归类型处理嵌套数据结构>#</a></h3><p>前端开发经常涉及嵌套数据，如树形菜单或 JSON。递归类型是处理此类结构的关键：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#75715e>// 递归类型定义
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>TreeNode</span>&lt;<span style=color:#f92672>T</span>&gt; <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>value</span>: <span style=color:#66d9ef>T</span>;
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>children</span>: <span style=color:#66d9ef>TreeNode</span>&lt;<span style=color:#f92672>T</span>&gt;[];
</span></span><span style=display:flex><span>};
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 更实用的嵌套菜单定义
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>interface</span> <span style=color:#a6e22e>MenuItem</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>label</span>: <span style=color:#66d9ef>string</span>;
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>url?</span>: <span style=color:#66d9ef>string</span>;
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>icon?</span>: <span style=color:#66d9ef>string</span>;
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>children?</span>: <span style=color:#66d9ef>MenuItem</span>[];
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 类型递归转换：将嵌套结构所有字段转为可选
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>DeepPartial</span>&lt;<span style=color:#f92672>T</span>&gt; <span style=color:#f92672>=</span> <span style=color:#a6e22e>T</span> <span style=color:#66d9ef>extends</span> <span style=color:#66d9ef>object</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>?</span> {
</span></span><span style=display:flex><span>      [<span style=color:#a6e22e>P</span> <span style=color:#66d9ef>in</span> <span style=color:#66d9ef>keyof</span> <span style=color:#a6e22e>T</span>]<span style=color:#f92672>?:</span> <span style=color:#a6e22e>DeepPartial</span>&lt;<span style=color:#f92672>T</span><span style=color:#960050;background-color:#1e0010>[</span><span style=color:#a6e22e>P</span><span style=color:#960050;background-color:#1e0010>]</span>&gt;;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  <span style=color:#f92672>:</span> <span style=color:#a6e22e>T</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 应用场景：部分更新嵌套数据
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>updateMenu</span>(<span style=color:#a6e22e>menu</span>: <span style=color:#66d9ef>MenuItem</span>[], <span style=color:#a6e22e>updates</span>: <span style=color:#66d9ef>DeepPartial</span>&lt;<span style=color:#f92672>MenuItem</span><span style=color:#960050;background-color:#1e0010>[]</span>&gt;) {
</span></span><span style=display:flex><span>  <span style=color:#75715e>// 安全地合并嵌套结构
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#75715e>// 实现代码...
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>}
</span></span></code></pre></div><p>我们开发了一个更高级的递归类型来处理 JSON 模式验证：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#75715e>// JSON Schema类型验证系统
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>JSONPrimitive</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>string</span> <span style=color:#f92672>|</span> <span style=color:#66d9ef>number</span> <span style=color:#f92672>|</span> <span style=color:#66d9ef>boolean</span> <span style=color:#f92672>|</span> <span style=color:#66d9ef>null</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>JSONValue</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>JSONPrimitive</span> <span style=color:#f92672>|</span> <span style=color:#a6e22e>JSONObject</span> <span style=color:#f92672>|</span> <span style=color:#a6e22e>JSONArray</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>JSONObject</span> <span style=color:#f92672>=</span> { [<span style=color:#a6e22e>key</span>: <span style=color:#66d9ef>string</span>]<span style=color:#f92672>:</span> <span style=color:#a6e22e>JSONValue</span> };
</span></span><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>JSONArray</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>JSONValue</span>[];
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 递归构建验证类型
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>SchemaForType</span>&lt;<span style=color:#f92672>T</span>&gt; <span style=color:#f92672>=</span> <span style=color:#a6e22e>T</span> <span style=color:#66d9ef>extends</span> <span style=color:#66d9ef>string</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>?</span> { <span style=color:#66d9ef>type</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;string&#34;</span>; <span style=color:#66d9ef>enum</span><span style=color:#f92672>?:</span> <span style=color:#a6e22e>T</span>[] }
</span></span><span style=display:flex><span>  <span style=color:#f92672>:</span> <span style=color:#a6e22e>T</span> <span style=color:#66d9ef>extends</span> <span style=color:#66d9ef>number</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>?</span> { <span style=color:#66d9ef>type</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;number&#34;</span>; <span style=color:#a6e22e>min?</span>: <span style=color:#66d9ef>number</span>; <span style=color:#a6e22e>max?</span>: <span style=color:#66d9ef>number</span> }
</span></span><span style=display:flex><span>  <span style=color:#f92672>:</span> <span style=color:#a6e22e>T</span> <span style=color:#66d9ef>extends</span> <span style=color:#66d9ef>boolean</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>?</span> { <span style=color:#66d9ef>type</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;boolean&#34;</span> }
</span></span><span style=display:flex><span>  <span style=color:#f92672>:</span> <span style=color:#a6e22e>T</span> <span style=color:#66d9ef>extends</span> <span style=color:#66d9ef>any</span>[]
</span></span><span style=display:flex><span>  <span style=color:#f92672>?</span> {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>type</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;array&#34;</span>;
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>items</span>: <span style=color:#66d9ef>SchemaForType</span>&lt;<span style=color:#f92672>T</span><span style=color:#960050;background-color:#1e0010>[</span><span style=color:#a6e22e>number</span><span style=color:#960050;background-color:#1e0010>]</span>&gt;;
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>minItems?</span>: <span style=color:#66d9ef>number</span>;
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>maxItems?</span>: <span style=color:#66d9ef>number</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  <span style=color:#f92672>:</span> <span style=color:#a6e22e>T</span> <span style=color:#66d9ef>extends</span> <span style=color:#66d9ef>object</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>?</span> {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>type</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;object&#34;</span>;
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>required</span><span style=color:#f92672>?:</span> (<span style=color:#66d9ef>keyof</span> <span style=color:#a6e22e>T</span>)[];
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>properties</span><span style=color:#f92672>:</span> {
</span></span><span style=display:flex><span>        [<span style=color:#a6e22e>P</span> <span style=color:#66d9ef>in</span> <span style=color:#66d9ef>keyof</span> <span style=color:#a6e22e>T</span>]<span style=color:#f92672>:</span> <span style=color:#a6e22e>SchemaForType</span>&lt;<span style=color:#f92672>T</span><span style=color:#960050;background-color:#1e0010>[</span><span style=color:#a6e22e>P</span><span style=color:#960050;background-color:#1e0010>]</span>&gt;;
</span></span><span style=display:flex><span>      };
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  <span style=color:#f92672>:</span> <span style=color:#66d9ef>never</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 实际应用：为类型自动生成JSON Schema
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>interface</span> <span style=color:#a6e22e>ProductData</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>id</span>: <span style=color:#66d9ef>number</span>;
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>name</span>: <span style=color:#66d9ef>string</span>;
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>price</span>: <span style=color:#66d9ef>number</span>;
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>tags</span>: <span style=color:#66d9ef>string</span>[];
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>details</span><span style=color:#f92672>?:</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>description</span>: <span style=color:#66d9ef>string</span>;
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>manufacturer</span><span style=color:#f92672>:</span> {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>name</span>: <span style=color:#66d9ef>string</span>;
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>country</span>: <span style=color:#66d9ef>string</span>;
</span></span><span style=display:flex><span>    };
</span></span><span style=display:flex><span>  };
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// TypeScript推导出的类型是完整的JSON Schema
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>productSchema</span>: <span style=color:#66d9ef>SchemaForType</span>&lt;<span style=color:#f92672>ProductData</span>&gt; <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>type</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;object&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>required</span><span style=color:#f92672>:</span> [<span style=color:#e6db74>&#34;id&#34;</span>, <span style=color:#e6db74>&#34;name&#34;</span>, <span style=color:#e6db74>&#34;price&#34;</span>, <span style=color:#e6db74>&#34;tags&#34;</span>],
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>properties</span><span style=color:#f92672>:</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>id</span><span style=color:#f92672>:</span> { <span style=color:#66d9ef>type</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;number&#34;</span> },
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>name</span><span style=color:#f92672>:</span> { <span style=color:#66d9ef>type</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;string&#34;</span> },
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>price</span><span style=color:#f92672>:</span> { <span style=color:#66d9ef>type</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;number&#34;</span>, <span style=color:#a6e22e>min</span>: <span style=color:#66d9ef>0</span> },
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>tags</span><span style=color:#f92672>:</span> {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>type</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;array&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>items</span><span style=color:#f92672>:</span> { <span style=color:#66d9ef>type</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;string&#34;</span> },
</span></span><span style=display:flex><span>    },
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>details</span><span style=color:#f92672>:</span> {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>type</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;object&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>properties</span><span style=color:#f92672>:</span> {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>description</span><span style=color:#f92672>:</span> { <span style=color:#66d9ef>type</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;string&#34;</span> },
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>manufacturer</span><span style=color:#f92672>:</span> {
</span></span><span style=display:flex><span>          <span style=color:#66d9ef>type</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;object&#34;</span>,
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>properties</span><span style=color:#f92672>:</span> {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>name</span><span style=color:#f92672>:</span> { <span style=color:#66d9ef>type</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;string&#34;</span> },
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>country</span><span style=color:#f92672>:</span> { <span style=color:#66d9ef>type</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;string&#34;</span> },
</span></span><span style=display:flex><span>          },
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>required</span><span style=color:#f92672>:</span> [<span style=color:#e6db74>&#34;name&#34;</span>, <span style=color:#e6db74>&#34;country&#34;</span>],
</span></span><span style=display:flex><span>        },
</span></span><span style=display:flex><span>      },
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>required</span><span style=color:#f92672>:</span> [<span style=color:#e6db74>&#34;description&#34;</span>, <span style=color:#e6db74>&#34;manufacturer&#34;</span>],
</span></span><span style=display:flex><span>    },
</span></span><span style=display:flex><span>  },
</span></span><span style=display:flex><span>};
</span></span></code></pre></div><h3 id=模板字面量类型字符串操作的类型安全>模板字面量类型：字符串操作的类型安全<a hidden class=anchor aria-hidden=true href=#模板字面量类型字符串操作的类型安全>#</a></h3><p>TypeScript 4.1 引入的模板字面量类型为处理字符串相关操作提供了类型安全：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#75715e>// 基础模板字面量类型
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>Greeting</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>`Hello, </span><span style=color:#e6db74>${</span><span style=color:#66d9ef>string</span><span style=color:#e6db74>}</span><span style=color:#e6db74>!`</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 高级应用：类型安全的事件系统
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>EventType</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;click&#34;</span> <span style=color:#f92672>|</span> <span style=color:#e6db74>&#34;focus&#34;</span> <span style=color:#f92672>|</span> <span style=color:#e6db74>&#34;blur&#34;</span> <span style=color:#f92672>|</span> <span style=color:#e6db74>&#34;submit&#34;</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>ElementType</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;button&#34;</span> <span style=color:#f92672>|</span> <span style=color:#e6db74>&#34;input&#34;</span> <span style=color:#f92672>|</span> <span style=color:#e6db74>&#34;form&#34;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 生成所有有效的事件名称组合
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>EventName</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>`on</span><span style=color:#e6db74>${</span><span style=color:#a6e22e>Capitalize</span>&lt;<span style=color:#f92672>EventType</span>&gt;<span style=color:#e6db74>}</span><span style=color:#e6db74>`</span>;
</span></span><span style=display:flex><span><span style=color:#75715e>// &#34;onClick&#34; | &#34;onFocus&#34; | &#34;onBlur&#34; | &#34;onSubmit&#34;
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>ElementEventMap</span> <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>  [<span style=color:#a6e22e>E</span> <span style=color:#66d9ef>in</span> <span style=color:#a6e22e>ElementType</span>]<span style=color:#f92672>:</span> {
</span></span><span style=display:flex><span>    [<span style=color:#a6e22e>K</span> <span style=color:#66d9ef>in</span> <span style=color:#a6e22e>EventName</span>]<span style=color:#f92672>:</span> (<span style=color:#a6e22e>event</span>: <span style=color:#66d9ef>any</span>) <span style=color:#f92672>=&gt;</span> <span style=color:#66d9ef>void</span>;
</span></span><span style=display:flex><span>  };
</span></span><span style=display:flex><span>};
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 类型安全的事件处理函数
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>addEventListener</span>&lt;<span style=color:#f92672>T</span> <span style=color:#a6e22e>extends</span> <span style=color:#a6e22e>ElementType</span>, <span style=color:#a6e22e>E</span> <span style=color:#a6e22e>extends</span> <span style=color:#a6e22e>EventName</span>&gt;(
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>element</span>: <span style=color:#66d9ef>T</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>eventName</span>: <span style=color:#66d9ef>E</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>handler</span>: <span style=color:#66d9ef>ElementEventMap</span>[<span style=color:#a6e22e>T</span>][<span style=color:#a6e22e>E</span>]
</span></span><span style=display:flex><span>) {
</span></span><span style=display:flex><span>  <span style=color:#75715e>// 实现代码...
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 使用示例
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>addEventListener</span>(<span style=color:#e6db74>&#34;button&#34;</span>, <span style=color:#e6db74>&#34;onClick&#34;</span>, (<span style=color:#a6e22e>event</span>) <span style=color:#f92672>=&gt;</span> {
</span></span><span style=display:flex><span>  <span style=color:#75715e>// 类型安全的事件处理
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>});
</span></span></code></pre></div><p>在实际项目中，我们用它创建了类型安全的 API 路径构建器：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#75715e>// API路径类型安全构建器
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>ApiResource</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;users&#34;</span> <span style=color:#f92672>|</span> <span style=color:#e6db74>&#34;products&#34;</span> <span style=color:#f92672>|</span> <span style=color:#e6db74>&#34;orders&#34;</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>ApiVersion</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;v1&#34;</span> <span style=color:#f92672>|</span> <span style=color:#e6db74>&#34;v2&#34;</span> <span style=color:#f92672>|</span> <span style=color:#e6db74>&#34;beta&#34;</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>HttpMethod</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;GET&#34;</span> <span style=color:#f92672>|</span> <span style=color:#e6db74>&#34;POST&#34;</span> <span style=color:#f92672>|</span> <span style=color:#e6db74>&#34;PUT&#34;</span> <span style=color:#f92672>|</span> <span style=color:#e6db74>&#34;DELETE&#34;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 构建API路径类型
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>ApiPath</span><span style=color:#f92672>&lt;</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>Version</span> <span style=color:#66d9ef>extends</span> <span style=color:#a6e22e>ApiVersion</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;v1&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>Resource</span> <span style=color:#66d9ef>extends</span> <span style=color:#a6e22e>ApiResource</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>ApiResource</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>Id</span> <span style=color:#66d9ef>extends</span> <span style=color:#66d9ef>boolean</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>false</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&gt;</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>`/</span><span style=color:#e6db74>${</span><span style=color:#a6e22e>Version</span><span style=color:#e6db74>}</span><span style=color:#e6db74>/</span><span style=color:#e6db74>${</span><span style=color:#a6e22e>Resource</span><span style=color:#e6db74>}${</span><span style=color:#a6e22e>Id</span> <span style=color:#66d9ef>extends</span> <span style=color:#66d9ef>true</span> <span style=color:#f92672>?</span> <span style=color:#e6db74>&#34;/:id&#34;</span> <span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;&#34;</span><span style=color:#e6db74>}</span><span style=color:#e6db74>`</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// API端点配置类型
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>ApiEndpoint</span><span style=color:#f92672>&lt;</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>Method</span> <span style=color:#66d9ef>extends</span> <span style=color:#a6e22e>HttpMethod</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>Version</span> <span style=color:#66d9ef>extends</span> <span style=color:#a6e22e>ApiVersion</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>Resource</span> <span style=color:#66d9ef>extends</span> <span style=color:#a6e22e>ApiResource</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>HasId</span> <span style=color:#66d9ef>extends</span> <span style=color:#66d9ef>boolean</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>false</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&gt;</span> <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>method</span>: <span style=color:#66d9ef>Method</span>;
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>path</span>: <span style=color:#66d9ef>ApiPath</span>&lt;<span style=color:#f92672>Version</span>, <span style=color:#a6e22e>Resource</span>, <span style=color:#a6e22e>HasId</span>&gt;;
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>requiresAuth</span>: <span style=color:#66d9ef>boolean</span>;
</span></span><span style=display:flex><span>};
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// API定义对象
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>API</span> <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>getUsers</span><span style=color:#f92672>:</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>method</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;GET&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>path</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;/v1/users&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>requiresAuth</span>: <span style=color:#66d9ef>true</span>,
</span></span><span style=display:flex><span>  } <span style=color:#66d9ef>as</span> <span style=color:#a6e22e>ApiEndpoint</span><span style=color:#f92672>&lt;</span><span style=color:#e6db74>&#34;GET&#34;</span>, <span style=color:#e6db74>&#34;v1&#34;</span>, <span style=color:#e6db74>&#34;users&#34;</span><span style=color:#f92672>&gt;</span>,
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>getUserById</span><span style=color:#f92672>:</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>method</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;GET&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>path</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;/v1/users/:id&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>requiresAuth</span>: <span style=color:#66d9ef>true</span>,
</span></span><span style=display:flex><span>  } <span style=color:#66d9ef>as</span> <span style=color:#a6e22e>ApiEndpoint</span><span style=color:#f92672>&lt;</span><span style=color:#e6db74>&#34;GET&#34;</span>, <span style=color:#e6db74>&#34;v1&#34;</span>, <span style=color:#e6db74>&#34;users&#34;</span>, <span style=color:#66d9ef>true</span><span style=color:#f92672>&gt;</span>,
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>createProduct</span><span style=color:#f92672>:</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>method</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;POST&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>path</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;/v2/products&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>requiresAuth</span>: <span style=color:#66d9ef>true</span>,
</span></span><span style=display:flex><span>  } <span style=color:#66d9ef>as</span> <span style=color:#a6e22e>ApiEndpoint</span><span style=color:#f92672>&lt;</span><span style=color:#e6db74>&#34;POST&#34;</span>, <span style=color:#e6db74>&#34;v2&#34;</span>, <span style=color:#e6db74>&#34;products&#34;</span><span style=color:#f92672>&gt;</span>,
</span></span><span style=display:flex><span>};
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 类型安全的API调用函数
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>callApi</span><span style=color:#f92672>&lt;</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>M</span> <span style=color:#66d9ef>extends</span> <span style=color:#a6e22e>HttpMethod</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>V</span> <span style=color:#66d9ef>extends</span> <span style=color:#a6e22e>ApiVersion</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>R</span> <span style=color:#66d9ef>extends</span> <span style=color:#a6e22e>ApiResource</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>HasId</span> <span style=color:#66d9ef>extends</span> <span style=color:#66d9ef>boolean</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&gt;</span>(
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>endpoint</span>: <span style=color:#66d9ef>ApiEndpoint</span>&lt;<span style=color:#f92672>M</span>, <span style=color:#a6e22e>V</span>, <span style=color:#a6e22e>R</span>, <span style=color:#a6e22e>HasId</span>&gt;,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>data?</span>: <span style=color:#66d9ef>any</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>id?</span>: <span style=color:#66d9ef>HasId</span> <span style=color:#66d9ef>extends</span> <span style=color:#66d9ef>true</span> <span style=color:#f92672>?</span> <span style=color:#66d9ef>string</span> <span style=color:#f92672>:</span> <span style=color:#66d9ef>never</span>
</span></span><span style=display:flex><span>)<span style=color:#f92672>:</span> <span style=color:#a6e22e>Promise</span>&lt;<span style=color:#f92672>any</span>&gt; {
</span></span><span style=display:flex><span>  <span style=color:#75715e>// 实现API调用逻辑
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>url</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>endpoint</span>.<span style=color:#a6e22e>path</span>.<span style=color:#a6e22e>replace</span>(<span style=color:#e6db74>/:id/</span>, <span style=color:#a6e22e>id</span> <span style=color:#66d9ef>as</span> <span style=color:#66d9ef>string</span>);
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>fetch</span>(<span style=color:#a6e22e>url</span>, {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>method</span>: <span style=color:#66d9ef>endpoint.method</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>headers</span><span style=color:#f92672>:</span> {
</span></span><span style=display:flex><span>      <span style=color:#e6db74>&#34;Content-Type&#34;</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;application/json&#34;</span>,
</span></span><span style=display:flex><span>      ...(<span style=color:#a6e22e>endpoint</span>.<span style=color:#a6e22e>requiresAuth</span> <span style=color:#f92672>?</span> { <span style=color:#a6e22e>Authorization</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;Bearer token&#34;</span> } <span style=color:#f92672>:</span> {}),
</span></span><span style=display:flex><span>    },
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>body</span>: <span style=color:#66d9ef>data</span> <span style=color:#f92672>?</span> <span style=color:#a6e22e>JSON</span>.<span style=color:#a6e22e>stringify</span>(<span style=color:#a6e22e>data</span>) <span style=color:#f92672>:</span> <span style=color:#66d9ef>undefined</span>,
</span></span><span style=display:flex><span>  }).<span style=color:#a6e22e>then</span>((<span style=color:#a6e22e>res</span>) <span style=color:#f92672>=&gt;</span> <span style=color:#a6e22e>res</span>.<span style=color:#a6e22e>json</span>());
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 使用示例 - 完全类型安全
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>callApi</span>(<span style=color:#a6e22e>API</span>.<span style=color:#a6e22e>getUserById</span>, <span style=color:#66d9ef>undefined</span>, <span style=color:#e6db74>&#34;123&#34;</span>); <span style=color:#75715e>// 正确
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>callApi</span>(<span style=color:#a6e22e>API</span>.<span style=color:#a6e22e>getUsers</span>, <span style=color:#66d9ef>undefined</span>); <span style=color:#75715e>// 正确
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>callApi</span>(<span style=color:#a6e22e>API</span>.<span style=color:#a6e22e>getUsers</span>, <span style=color:#66d9ef>undefined</span>, <span style=color:#e6db74>&#34;123&#34;</span>); <span style=color:#75715e>// 类型错误: &#34;123&#34;不能赋值给&#34;never&#34;
</span></span></span></code></pre></div><h2 id=提升性能和开发体验的高级技术>提升性能和开发体验的高级技术<a hidden class=anchor aria-hidden=true href=#提升性能和开发体验的高级技术>#</a></h2><p>理解 TypeScript 类型系统的内部机制可以帮助你编写更高效的类型：</p><h3 id=联合类型与交叉类型的内部工作原理>联合类型与交叉类型的内部工作原理<a hidden class=anchor aria-hidden=true href=#联合类型与交叉类型的内部工作原理>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#75715e>// 联合类型分配规则
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>BoxedValue</span>&lt;<span style=color:#f92672>T</span>&gt; <span style=color:#f92672>=</span> { <span style=color:#a6e22e>value</span>: <span style=color:#66d9ef>T</span> };
</span></span><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>BoxedArray</span>&lt;<span style=color:#f92672>T</span>&gt; <span style=color:#f92672>=</span> { <span style=color:#a6e22e>array</span>: <span style=color:#66d9ef>T</span>[] };
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 分配条件类型
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>Boxed</span>&lt;<span style=color:#f92672>T</span>&gt; <span style=color:#f92672>=</span> <span style=color:#a6e22e>T</span> <span style=color:#66d9ef>extends</span> <span style=color:#66d9ef>any</span>[] <span style=color:#f92672>?</span> <span style=color:#a6e22e>BoxedArray</span>&lt;<span style=color:#f92672>T</span><span style=color:#960050;background-color:#1e0010>[</span><span style=color:#a6e22e>number</span><span style=color:#960050;background-color:#1e0010>]</span>&gt; <span style=color:#f92672>:</span> <span style=color:#a6e22e>BoxedValue</span>&lt;<span style=color:#f92672>T</span>&gt;;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 使用联合类型
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>BoxedStringOrNumbers</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>Boxed</span>&lt;<span style=color:#f92672>string</span> <span style=color:#960050;background-color:#1e0010>|</span> <span style=color:#a6e22e>number</span><span style=color:#960050;background-color:#1e0010>[]</span>&gt;;
</span></span><span style=display:flex><span><span style=color:#75715e>// 等价于: BoxedValue&lt;string&gt; | BoxedArray&lt;number&gt;
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 常见错误: 交叉类型与泛型
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>User</span> <span style=color:#f92672>=</span> { <span style=color:#a6e22e>name</span>: <span style=color:#66d9ef>string</span>; <span style=color:#a6e22e>id</span>: <span style=color:#66d9ef>number</span> };
</span></span><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>Post</span> <span style=color:#f92672>=</span> { <span style=color:#a6e22e>title</span>: <span style=color:#66d9ef>string</span>; <span style=color:#a6e22e>content</span>: <span style=color:#66d9ef>string</span> };
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 不良实践
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>processEntity</span>&lt;<span style=color:#f92672>T</span>&gt;(<span style=color:#a6e22e>entity</span>: <span style=color:#66d9ef>T</span> <span style=color:#f92672>&amp;</span> (<span style=color:#a6e22e>User</span> <span style=color:#f92672>|</span> <span style=color:#a6e22e>Post</span>)) {
</span></span><span style=display:flex><span>  <span style=color:#75715e>// 类型过于复杂且可能不如预期
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 更好的方式
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>processEntity</span>&lt;<span style=color:#f92672>T</span> <span style=color:#a6e22e>extends</span> <span style=color:#a6e22e>User</span> <span style=color:#960050;background-color:#1e0010>|</span> <span style=color:#a6e22e>Post</span>&gt;(<span style=color:#a6e22e>entity</span>: <span style=color:#66d9ef>T</span>) {
</span></span><span style=display:flex><span>  <span style=color:#75715e>// 更清晰的约束
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>}
</span></span></code></pre></div><h3 id=类型推断优化技术>类型推断优化技术<a hidden class=anchor aria-hidden=true href=#类型推断优化技术>#</a></h3><p>TypeScript 编译器的类型推断非常强大，但有时需要一些帮助：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#75715e>// 引导类型推断
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>createState</span>&lt;<span style=color:#f92672>T</span>&gt;(<span style=color:#a6e22e>initial</span>: <span style=color:#66d9ef>T</span>) {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>state</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>initial</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>getState</span> <span style=color:#f92672>=</span> () <span style=color:#f92672>=&gt;</span> <span style=color:#a6e22e>state</span>;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>setState</span> <span style=color:#f92672>=</span> (<span style=color:#a6e22e>next</span>: <span style=color:#66d9ef>T</span>) <span style=color:#f92672>=&gt;</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>state</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>next</span>;
</span></span><span style=display:flex><span>  };
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> [<span style=color:#a6e22e>getState</span>, <span style=color:#a6e22e>setState</span>] <span style=color:#66d9ef>as</span> <span style=color:#66d9ef>const</span>; <span style=color:#75715e>// 使用as const改进推断
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 使用示例
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>const</span> [<span style=color:#a6e22e>getUser</span>, <span style=color:#a6e22e>setUser</span>] <span style=color:#f92672>=</span> <span style=color:#a6e22e>createState</span>({ <span style=color:#a6e22e>name</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;John&#34;</span>, <span style=color:#a6e22e>age</span>: <span style=color:#66d9ef>25</span> });
</span></span><span style=display:flex><span><span style=color:#75715e>// getUser返回类型正确推断为{ name: string; age: number }
</span></span></span><span style=display:flex><span><span style=color:#75715e>// setUser参数类型也正确约束
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 解决回调函数中的this类型
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>EventHandler</span>&lt;<span style=color:#f92672>E</span>&gt; <span style=color:#f92672>=</span> (<span style=color:#66d9ef>this</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>HTMLElement</span>, <span style=color:#a6e22e>evt</span>: <span style=color:#66d9ef>E</span>) <span style=color:#f92672>=&gt;</span> <span style=color:#66d9ef>void</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>addClickHandler</span>(<span style=color:#a6e22e>el</span>: <span style=color:#66d9ef>HTMLElement</span>, <span style=color:#a6e22e>handler</span>: <span style=color:#66d9ef>EventHandler</span>&lt;<span style=color:#f92672>MouseEvent</span>&gt;) {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>el</span>.<span style=color:#a6e22e>addEventListener</span>(<span style=color:#e6db74>&#34;click&#34;</span>, <span style=color:#a6e22e>handler</span>);
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=高级类型断言模式>高级类型断言模式<a hidden class=anchor aria-hidden=true href=#高级类型断言模式>#</a></h3><p>有时类型断言是必要的，但我们可以使用更安全的模式：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#75715e>// 传统的类型断言
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>userInput</span> <span style=color:#f92672>=</span> document.<span style=color:#a6e22e>getElementById</span>(<span style=color:#e6db74>&#34;user-input&#34;</span>) <span style=color:#66d9ef>as</span> <span style=color:#a6e22e>HTMLInputElement</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 更安全的断言模式：类型谓词函数
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>isHTMLInputElement</span>(<span style=color:#a6e22e>element</span>: <span style=color:#66d9ef>HTMLElement</span>)<span style=color:#f92672>:</span> <span style=color:#a6e22e>element</span> <span style=color:#66d9ef>is</span> <span style=color:#a6e22e>HTMLInputElement</span> {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>element</span>.<span style=color:#a6e22e>tagName</span> <span style=color:#f92672>===</span> <span style=color:#e6db74>&#34;INPUT&#34;</span>;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 使用类型谓词
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>getInputValue</span>(<span style=color:#a6e22e>element</span>: <span style=color:#66d9ef>HTMLElement</span>)<span style=color:#f92672>:</span> <span style=color:#66d9ef>string</span> {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>isHTMLInputElement</span>(<span style=color:#a6e22e>element</span>)) {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 此代码块中element被TypeScript视为HTMLInputElement
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>element</span>.<span style=color:#a6e22e>value</span>;
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> <span style=color:#e6db74>&#34;&#34;</span>;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 自定义类型保护模式
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>interface</span> <span style=color:#a6e22e>SuccessResponse</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>status</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;success&#34;</span>;
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>data</span>: <span style=color:#66d9ef>any</span>;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>interface</span> <span style=color:#a6e22e>ErrorResponse</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>status</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;error&#34;</span>;
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>message</span>: <span style=color:#66d9ef>string</span>;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>ApiResponse</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>SuccessResponse</span> <span style=color:#f92672>|</span> <span style=color:#a6e22e>ErrorResponse</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 定义类型保护函数
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>isSuccessResponse</span>(<span style=color:#a6e22e>response</span>: <span style=color:#66d9ef>ApiResponse</span>)<span style=color:#f92672>:</span> <span style=color:#a6e22e>response</span> <span style=color:#66d9ef>is</span> <span style=color:#a6e22e>SuccessResponse</span> {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>response</span>.<span style=color:#a6e22e>status</span> <span style=color:#f92672>===</span> <span style=color:#e6db74>&#34;success&#34;</span>;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 在代码中使用
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>handleResponse</span>(<span style=color:#a6e22e>response</span>: <span style=color:#66d9ef>ApiResponse</span>) {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>isSuccessResponse</span>(<span style=color:#a6e22e>response</span>)) {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 此处response类型缩小为SuccessResponse
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#a6e22e>response</span>.<span style=color:#a6e22e>data</span>);
</span></span><span style=display:flex><span>  } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 此处response类型缩小为ErrorResponse
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>error</span>(<span style=color:#a6e22e>response</span>.<span style=color:#a6e22e>message</span>);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=实战案例类型驱动设计>实战案例：类型驱动设计<a hidden class=anchor aria-hidden=true href=#实战案例类型驱动设计>#</a></h2><p>在一个大型电子商务项目中，我们使用类型驱动设计方法显著提高了代码质量：</p><h3 id=状态管理类型体系>状态管理类型体系<a hidden class=anchor aria-hidden=true href=#状态管理类型体系>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#75715e>// 定义领域实体类型
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>interface</span> <span style=color:#a6e22e>Product</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>id</span>: <span style=color:#66d9ef>string</span>;
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>name</span>: <span style=color:#66d9ef>string</span>;
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>price</span>: <span style=color:#66d9ef>number</span>;
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>category</span>: <span style=color:#66d9ef>string</span>;
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>inventory</span>: <span style=color:#66d9ef>number</span>;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 状态片段类型
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>interface</span> <span style=color:#a6e22e>ProductsState</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>byId</span>: <span style=color:#66d9ef>Record</span>&lt;<span style=color:#f92672>string</span>, <span style=color:#a6e22e>Product</span>&gt;;
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>allIds</span>: <span style=color:#66d9ef>string</span>[];
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>loading</span>: <span style=color:#66d9ef>boolean</span>;
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>error</span>: <span style=color:#66d9ef>string</span> <span style=color:#f92672>|</span> <span style=color:#66d9ef>null</span>;
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>filters</span><span style=color:#f92672>:</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>category</span>: <span style=color:#66d9ef>string</span> <span style=color:#f92672>|</span> <span style=color:#66d9ef>null</span>;
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>minPrice</span>: <span style=color:#66d9ef>number</span> <span style=color:#f92672>|</span> <span style=color:#66d9ef>null</span>;
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>maxPrice</span>: <span style=color:#66d9ef>number</span> <span style=color:#f92672>|</span> <span style=color:#66d9ef>null</span>;
</span></span><span style=display:flex><span>  };
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Action类型 - 使用标签联合类型
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>ProductAction</span> <span style=color:#f92672>=</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>|</span> { <span style=color:#66d9ef>type</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;FETCH_PRODUCTS_REQUEST&#34;</span> }
</span></span><span style=display:flex><span>  <span style=color:#f92672>|</span> { <span style=color:#66d9ef>type</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;FETCH_PRODUCTS_SUCCESS&#34;</span>; <span style=color:#a6e22e>payload</span>: <span style=color:#66d9ef>Product</span>[] }
</span></span><span style=display:flex><span>  <span style=color:#f92672>|</span> { <span style=color:#66d9ef>type</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;FETCH_PRODUCTS_FAILURE&#34;</span>; <span style=color:#a6e22e>error</span>: <span style=color:#66d9ef>string</span> }
</span></span><span style=display:flex><span>  <span style=color:#f92672>|</span> { <span style=color:#66d9ef>type</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;ADD_PRODUCT&#34;</span>; <span style=color:#a6e22e>payload</span>: <span style=color:#66d9ef>Product</span> }
</span></span><span style=display:flex><span>  <span style=color:#f92672>|</span> { <span style=color:#66d9ef>type</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;UPDATE_PRODUCT&#34;</span>; <span style=color:#a6e22e>payload</span>: <span style=color:#66d9ef>Partial</span>&lt;<span style=color:#f92672>Product</span>&gt; <span style=color:#f92672>&amp;</span> { <span style=color:#a6e22e>id</span>: <span style=color:#66d9ef>string</span> } }
</span></span><span style=display:flex><span>  <span style=color:#f92672>|</span> { <span style=color:#66d9ef>type</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;DELETE_PRODUCT&#34;</span>; <span style=color:#a6e22e>payload</span>: <span style=color:#66d9ef>string</span> }
</span></span><span style=display:flex><span>  <span style=color:#f92672>|</span> { <span style=color:#66d9ef>type</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;SET_FILTER&#34;</span>; <span style=color:#a6e22e>payload</span>: <span style=color:#66d9ef>Partial</span>&lt;<span style=color:#f92672>ProductsState</span><span style=color:#960050;background-color:#1e0010>[</span><span style=color:#e6db74>&#34;filters&#34;</span><span style=color:#960050;background-color:#1e0010>]</span>&gt; };
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 类型安全的reducer
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>productsReducer</span>(
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>state</span>: <span style=color:#66d9ef>ProductsState</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>initialState</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>action</span>: <span style=color:#66d9ef>ProductAction</span>
</span></span><span style=display:flex><span>)<span style=color:#f92672>:</span> <span style=color:#a6e22e>ProductsState</span> {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>switch</span> (<span style=color:#a6e22e>action</span>.<span style=color:#66d9ef>type</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>case</span> <span style=color:#e6db74>&#34;FETCH_PRODUCTS_REQUEST&#34;</span><span style=color:#f92672>:</span>
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>return</span> { ...<span style=color:#a6e22e>state</span>, <span style=color:#a6e22e>loading</span>: <span style=color:#66d9ef>true</span>, <span style=color:#a6e22e>error</span>: <span style=color:#66d9ef>null</span> };
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>case</span> <span style=color:#e6db74>&#34;FETCH_PRODUCTS_SUCCESS&#34;</span><span style=color:#f92672>:</span>
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>byId</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>action</span>.<span style=color:#a6e22e>payload</span>.<span style=color:#a6e22e>reduce</span>(
</span></span><span style=display:flex><span>        (<span style=color:#a6e22e>acc</span>, <span style=color:#a6e22e>product</span>) <span style=color:#f92672>=&gt;</span> ({
</span></span><span style=display:flex><span>          ...<span style=color:#a6e22e>acc</span>,
</span></span><span style=display:flex><span>          [<span style=color:#a6e22e>product</span>.<span style=color:#a6e22e>id</span>]<span style=color:#f92672>:</span> <span style=color:#a6e22e>product</span>,
</span></span><span style=display:flex><span>        }),
</span></span><span style=display:flex><span>        {}
</span></span><span style=display:flex><span>      );
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>return</span> {
</span></span><span style=display:flex><span>        ...<span style=color:#a6e22e>state</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>byId</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>allIds</span>: <span style=color:#66d9ef>action.payload.map</span>((<span style=color:#a6e22e>p</span>) <span style=color:#f92672>=&gt;</span> <span style=color:#a6e22e>p</span>.<span style=color:#a6e22e>id</span>),
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>loading</span>: <span style=color:#66d9ef>false</span>,
</span></span><span style=display:flex><span>      };
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>case</span> <span style=color:#e6db74>&#34;FETCH_PRODUCTS_FAILURE&#34;</span><span style=color:#f92672>:</span>
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>return</span> { ...<span style=color:#a6e22e>state</span>, <span style=color:#a6e22e>loading</span>: <span style=color:#66d9ef>false</span>, <span style=color:#a6e22e>error</span>: <span style=color:#66d9ef>action.error</span> };
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>case</span> <span style=color:#e6db74>&#34;ADD_PRODUCT&#34;</span><span style=color:#f92672>:</span>
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>return</span> {
</span></span><span style=display:flex><span>        ...<span style=color:#a6e22e>state</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>byId</span><span style=color:#f92672>:</span> { ...<span style=color:#a6e22e>state</span>.<span style=color:#a6e22e>byId</span>, [<span style=color:#a6e22e>action</span>.<span style=color:#a6e22e>payload</span>.<span style=color:#a6e22e>id</span>]<span style=color:#f92672>:</span> <span style=color:#a6e22e>action</span>.<span style=color:#a6e22e>payload</span> },
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>allIds</span><span style=color:#f92672>:</span> [...<span style=color:#a6e22e>state</span>.<span style=color:#a6e22e>allIds</span>, <span style=color:#a6e22e>action</span>.<span style=color:#a6e22e>payload</span>.<span style=color:#a6e22e>id</span>],
</span></span><span style=display:flex><span>      };
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 更多case...
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>default</span><span style=color:#f92672>:</span>
</span></span><span style=display:flex><span>      <span style=color:#75715e>// 穷尽检查确保所有action类型都被处理
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>      <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>exhaustiveCheck</span>: <span style=color:#66d9ef>never</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>action</span>;
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>state</span>;
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>这种模式带来了几个好处：</p><ol><li>编译时捕获类型不匹配</li><li>自动补全和类型检查</li><li>在 refactor 时立即发现问题</li></ol><h3 id=api-类型与客户端生成>API 类型与客户端生成<a hidden class=anchor aria-hidden=true href=#api-类型与客户端生成>#</a></h3><p>我们使用类型驱动开发 API 客户端，确保前后端类型一致：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#75715e>// API路径和方法映射
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>ApiRoutes</span> <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;/products&#34;</span><span style=color:#f92672>:</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>GET</span><span style=color:#f92672>:</span> {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>response</span>: <span style=color:#66d9ef>Product</span>[];
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>query</span><span style=color:#f92672>:</span> {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>category?</span>: <span style=color:#66d9ef>string</span>;
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>minPrice?</span>: <span style=color:#66d9ef>number</span>;
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>maxPrice?</span>: <span style=color:#66d9ef>number</span>;
</span></span><span style=display:flex><span>      };
</span></span><span style=display:flex><span>    };
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>POST</span><span style=color:#f92672>:</span> {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>body</span>: <span style=color:#66d9ef>Omit</span>&lt;<span style=color:#f92672>Product</span>, <span style=color:#e6db74>&#34;id&#34;</span>&gt;;
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>response</span>: <span style=color:#66d9ef>Product</span>;
</span></span><span style=display:flex><span>    };
</span></span><span style=display:flex><span>  };
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;/products/:id&#34;</span><span style=color:#f92672>:</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>GET</span><span style=color:#f92672>:</span> {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>response</span>: <span style=color:#66d9ef>Product</span>;
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>params</span><span style=color:#f92672>:</span> { <span style=color:#a6e22e>id</span>: <span style=color:#66d9ef>string</span> };
</span></span><span style=display:flex><span>    };
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>PUT</span><span style=color:#f92672>:</span> {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>body</span>: <span style=color:#66d9ef>Partial</span>&lt;<span style=color:#f92672>Omit</span>&lt;<span style=color:#f92672>Product</span>, <span style=color:#e6db74>&#34;id&#34;</span>&gt;&gt;;
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>params</span><span style=color:#f92672>:</span> { <span style=color:#a6e22e>id</span>: <span style=color:#66d9ef>string</span> };
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>response</span>: <span style=color:#66d9ef>Product</span>;
</span></span><span style=display:flex><span>    };
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>DELETE</span><span style=color:#f92672>:</span> {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>params</span><span style=color:#f92672>:</span> { <span style=color:#a6e22e>id</span>: <span style=color:#66d9ef>string</span> };
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>response</span><span style=color:#f92672>:</span> { <span style=color:#a6e22e>success</span>: <span style=color:#66d9ef>boolean</span> };
</span></span><span style=display:flex><span>    };
</span></span><span style=display:flex><span>  };
</span></span><span style=display:flex><span>  <span style=color:#75715e>// 更多路由定义...
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>};
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 通用API客户端类型
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>HttpMethod</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;GET&#34;</span> <span style=color:#f92672>|</span> <span style=color:#e6db74>&#34;POST&#34;</span> <span style=color:#f92672>|</span> <span style=color:#e6db74>&#34;PUT&#34;</span> <span style=color:#f92672>|</span> <span style=color:#e6db74>&#34;DELETE&#34;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>ApiClient</span> <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>  [<span style=color:#a6e22e>P</span> <span style=color:#66d9ef>in</span> <span style=color:#66d9ef>keyof</span> <span style=color:#a6e22e>ApiRoutes</span>]<span style=color:#f92672>:</span> {
</span></span><span style=display:flex><span>    [<span style=color:#a6e22e>M</span> <span style=color:#66d9ef>in</span> <span style=color:#66d9ef>keyof</span> <span style=color:#a6e22e>ApiRoutes</span>[<span style=color:#a6e22e>P</span>]]<span style=color:#f92672>:</span> <span style=color:#a6e22e>M</span> <span style=color:#66d9ef>extends</span> <span style=color:#a6e22e>HttpMethod</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>?</span> <span style=color:#a6e22e>ApiRoutes</span>[<span style=color:#a6e22e>P</span>][<span style=color:#a6e22e>M</span>] <span style=color:#66d9ef>extends</span> { <span style=color:#a6e22e>body</span>: <span style=color:#66d9ef>infer</span> <span style=color:#a6e22e>B</span> }
</span></span><span style=display:flex><span>        <span style=color:#f92672>?</span> (
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>body</span>: <span style=color:#66d9ef>B</span>,
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>params</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;params&#34;</span> <span style=color:#66d9ef>extends</span> <span style=color:#66d9ef>keyof</span> <span style=color:#a6e22e>ApiRoutes</span>[<span style=color:#a6e22e>P</span>][<span style=color:#a6e22e>M</span>]
</span></span><span style=display:flex><span>              <span style=color:#f92672>?</span> <span style=color:#a6e22e>ApiRoutes</span>[<span style=color:#a6e22e>P</span>][<span style=color:#a6e22e>M</span>][<span style=color:#e6db74>&#34;params&#34;</span>]
</span></span><span style=display:flex><span>              <span style=color:#f92672>:</span> <span style=color:#66d9ef>undefined</span>,
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>query</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;query&#34;</span> <span style=color:#66d9ef>extends</span> <span style=color:#66d9ef>keyof</span> <span style=color:#a6e22e>ApiRoutes</span>[<span style=color:#a6e22e>P</span>][<span style=color:#a6e22e>M</span>]
</span></span><span style=display:flex><span>              <span style=color:#f92672>?</span> <span style=color:#a6e22e>ApiRoutes</span>[<span style=color:#a6e22e>P</span>][<span style=color:#a6e22e>M</span>][<span style=color:#e6db74>&#34;query&#34;</span>]
</span></span><span style=display:flex><span>              <span style=color:#f92672>:</span> <span style=color:#66d9ef>undefined</span>
</span></span><span style=display:flex><span>          ) <span style=color:#f92672>=&gt;</span> <span style=color:#a6e22e>Promise</span>&lt;<span style=color:#f92672>ApiRoutes</span><span style=color:#960050;background-color:#1e0010>[</span><span style=color:#a6e22e>P</span><span style=color:#960050;background-color:#1e0010>][</span><span style=color:#a6e22e>M</span><span style=color:#960050;background-color:#1e0010>][</span><span style=color:#e6db74>&#34;response&#34;</span><span style=color:#960050;background-color:#1e0010>]</span>&gt;
</span></span><span style=display:flex><span>        <span style=color:#f92672>:</span> (
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>params</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;params&#34;</span> <span style=color:#66d9ef>extends</span> <span style=color:#66d9ef>keyof</span> <span style=color:#a6e22e>ApiRoutes</span>[<span style=color:#a6e22e>P</span>][<span style=color:#a6e22e>M</span>]
</span></span><span style=display:flex><span>              <span style=color:#f92672>?</span> <span style=color:#a6e22e>ApiRoutes</span>[<span style=color:#a6e22e>P</span>][<span style=color:#a6e22e>M</span>][<span style=color:#e6db74>&#34;params&#34;</span>]
</span></span><span style=display:flex><span>              <span style=color:#f92672>:</span> <span style=color:#66d9ef>undefined</span>,
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>query</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;query&#34;</span> <span style=color:#66d9ef>extends</span> <span style=color:#66d9ef>keyof</span> <span style=color:#a6e22e>ApiRoutes</span>[<span style=color:#a6e22e>P</span>][<span style=color:#a6e22e>M</span>]
</span></span><span style=display:flex><span>              <span style=color:#f92672>?</span> <span style=color:#a6e22e>ApiRoutes</span>[<span style=color:#a6e22e>P</span>][<span style=color:#a6e22e>M</span>][<span style=color:#e6db74>&#34;query&#34;</span>]
</span></span><span style=display:flex><span>              <span style=color:#f92672>:</span> <span style=color:#66d9ef>undefined</span>
</span></span><span style=display:flex><span>          ) <span style=color:#f92672>=&gt;</span> <span style=color:#a6e22e>Promise</span>&lt;<span style=color:#f92672>ApiRoutes</span><span style=color:#960050;background-color:#1e0010>[</span><span style=color:#a6e22e>P</span><span style=color:#960050;background-color:#1e0010>][</span><span style=color:#a6e22e>M</span><span style=color:#960050;background-color:#1e0010>][</span><span style=color:#e6db74>&#34;response&#34;</span><span style=color:#960050;background-color:#1e0010>]</span>&gt;
</span></span><span style=display:flex><span>      <span style=color:#f92672>:</span> <span style=color:#66d9ef>never</span>;
</span></span><span style=display:flex><span>  };
</span></span><span style=display:flex><span>};
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 实现API客户端
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>createApiClient</span>&lt;<span style=color:#f92672>T</span> <span style=color:#a6e22e>extends</span> <span style=color:#a6e22e>ApiClient</span>&gt;()<span style=color:#f92672>:</span> <span style=color:#a6e22e>T</span> {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Proxy</span>({} <span style=color:#66d9ef>as</span> <span style=color:#a6e22e>T</span>, {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>get</span>(<span style=color:#a6e22e>target</span>, <span style=color:#a6e22e>path</span>) {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Proxy</span>({} <span style=color:#66d9ef>as</span> <span style=color:#66d9ef>any</span>, {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>get</span>(<span style=color:#a6e22e>_</span>, <span style=color:#a6e22e>method</span>: <span style=color:#66d9ef>string</span>) {
</span></span><span style=display:flex><span>          <span style=color:#66d9ef>return</span> (<span style=color:#a6e22e>body?</span>: <span style=color:#66d9ef>any</span>, <span style=color:#a6e22e>params?</span>: <span style=color:#66d9ef>any</span>, <span style=color:#a6e22e>query?</span>: <span style=color:#66d9ef>any</span>) <span style=color:#f92672>=&gt;</span> {
</span></span><span style=display:flex><span>            <span style=color:#75715e>// 处理路径参数
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>url</span> <span style=color:#f92672>=</span> String(<span style=color:#a6e22e>path</span>);
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>params</span>) {
</span></span><span style=display:flex><span>              Object.<span style=color:#a6e22e>entries</span>(<span style=color:#a6e22e>params</span>).<span style=color:#a6e22e>forEach</span>(([<span style=color:#a6e22e>key</span>, <span style=color:#a6e22e>value</span>]) <span style=color:#f92672>=&gt;</span> {
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>url</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>url</span>.<span style=color:#a6e22e>replace</span>(<span style=color:#e6db74>`:</span><span style=color:#e6db74>${</span><span style=color:#a6e22e>key</span><span style=color:#e6db74>}</span><span style=color:#e6db74>`</span>, String(<span style=color:#a6e22e>value</span>));
</span></span><span style=display:flex><span>              });
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#75715e>// 添加查询参数
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>query</span>) {
</span></span><span style=display:flex><span>              <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>queryString</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>URLSearchParams</span>(
</span></span><span style=display:flex><span>                Object.<span style=color:#a6e22e>entries</span>(<span style=color:#a6e22e>query</span>)
</span></span><span style=display:flex><span>                  .<span style=color:#a6e22e>filter</span>(([<span style=color:#a6e22e>_</span>, <span style=color:#a6e22e>v</span>]) <span style=color:#f92672>=&gt;</span> <span style=color:#a6e22e>v</span> <span style=color:#f92672>!==</span> <span style=color:#66d9ef>undefined</span>)
</span></span><span style=display:flex><span>                  .<span style=color:#a6e22e>reduce</span>((<span style=color:#a6e22e>acc</span>, [<span style=color:#a6e22e>k</span>, <span style=color:#a6e22e>v</span>]) <span style=color:#f92672>=&gt;</span> ({ ...<span style=color:#a6e22e>acc</span>, [<span style=color:#a6e22e>k</span>]<span style=color:#f92672>:</span> String(<span style=color:#a6e22e>v</span>) }), {})
</span></span><span style=display:flex><span>              ).<span style=color:#a6e22e>toString</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>              <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>queryString</span>) {
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>url</span> <span style=color:#f92672>+=</span> <span style=color:#e6db74>`?</span><span style=color:#e6db74>${</span><span style=color:#a6e22e>queryString</span><span style=color:#e6db74>}</span><span style=color:#e6db74>`</span>;
</span></span><span style=display:flex><span>              }
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#75715e>// 发送请求
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>fetch</span>(<span style=color:#a6e22e>url</span>, {
</span></span><span style=display:flex><span>              <span style=color:#a6e22e>method</span>,
</span></span><span style=display:flex><span>              <span style=color:#a6e22e>headers</span><span style=color:#f92672>:</span> {
</span></span><span style=display:flex><span>                <span style=color:#e6db74>&#34;Content-Type&#34;</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;application/json&#34;</span>,
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>Accept</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;application/json&#34;</span>,
</span></span><span style=display:flex><span>              },
</span></span><span style=display:flex><span>              <span style=color:#a6e22e>body</span>: <span style=color:#66d9ef>body</span> <span style=color:#f92672>?</span> <span style=color:#a6e22e>JSON</span>.<span style=color:#a6e22e>stringify</span>(<span style=color:#a6e22e>body</span>) <span style=color:#f92672>:</span> <span style=color:#66d9ef>undefined</span>,
</span></span><span style=display:flex><span>            }).<span style=color:#a6e22e>then</span>((<span style=color:#a6e22e>res</span>) <span style=color:#f92672>=&gt;</span> <span style=color:#a6e22e>res</span>.<span style=color:#a6e22e>json</span>());
</span></span><span style=display:flex><span>          };
</span></span><span style=display:flex><span>        },
</span></span><span style=display:flex><span>      });
</span></span><span style=display:flex><span>    },
</span></span><span style=display:flex><span>  });
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 使用类型安全的API客户端
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>api</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>createApiClient</span>&lt;<span style=color:#f92672>ApiClient</span>&gt;();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 完全类型安全的API调用
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>async</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>fetchProduct</span>(<span style=color:#a6e22e>id</span>: <span style=color:#66d9ef>string</span>) {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>product</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>api</span>[<span style=color:#e6db74>&#34;/products/:id&#34;</span>].<span style=color:#a6e22e>GET</span>({ <span style=color:#a6e22e>id</span> }, <span style=color:#66d9ef>undefined</span>);
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>product</span>; <span style=color:#75715e>// 类型为Product
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>async</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>createProduct</span>(<span style=color:#a6e22e>productData</span>: <span style=color:#66d9ef>Omit</span>&lt;<span style=color:#f92672>Product</span>, <span style=color:#e6db74>&#34;id&#34;</span>&gt;) {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>newProduct</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>api</span>[<span style=color:#e6db74>&#34;/products&#34;</span>].<span style=color:#a6e22e>POST</span>(
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>productData</span>,
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>undefined</span>,
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>undefined</span>
</span></span><span style=display:flex><span>  );
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>newProduct</span>; <span style=color:#75715e>// 类型为Product
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>}
</span></span></code></pre></div><h2 id=高级类型系统的性能与边界>高级类型系统的性能与边界<a hidden class=anchor aria-hidden=true href=#高级类型系统的性能与边界>#</a></h2><p>TypeScript 的类型系统功能强大，但也有其限制：</p><h3 id=类型系统的性能考量>类型系统的性能考量<a hidden class=anchor aria-hidden=true href=#类型系统的性能考量>#</a></h3><p>在大型项目中，过于复杂的类型可能导致编译器性能问题：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#75715e>// 可能导致类型计算超时的类型
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>DeepNested</span>&lt;<span style=color:#f92672>T</span>, <span style=color:#a6e22e>D</span> <span style=color:#a6e22e>extends</span> <span style=color:#a6e22e>number</span>&gt; <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>  [<span style=color:#a6e22e>K</span> <span style=color:#66d9ef>in</span> <span style=color:#66d9ef>keyof</span> <span style=color:#a6e22e>T</span>]<span style=color:#f92672>:</span> <span style=color:#a6e22e>D</span> <span style=color:#66d9ef>extends</span> <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>?</span> <span style=color:#a6e22e>T</span>[<span style=color:#a6e22e>K</span>]
</span></span><span style=display:flex><span>    <span style=color:#f92672>:</span> <span style=color:#a6e22e>T</span>[<span style=color:#a6e22e>K</span>] <span style=color:#66d9ef>extends</span> <span style=color:#66d9ef>object</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>?</span> <span style=color:#a6e22e>DeepNested</span>&lt;<span style=color:#f92672>T</span><span style=color:#960050;background-color:#1e0010>[</span><span style=color:#a6e22e>K</span><span style=color:#960050;background-color:#1e0010>]</span>, <span style=color:#960050;background-color:#1e0010>[-</span><span style=color:#a6e22e>1</span>, <span style=color:#a6e22e>0</span>, <span style=color:#a6e22e>1</span>, <span style=color:#a6e22e>2</span>, <span style=color:#a6e22e>3</span>, <span style=color:#a6e22e>4</span>, <span style=color:#a6e22e>5</span><span style=color:#960050;background-color:#1e0010>][</span><span style=color:#a6e22e>D</span><span style=color:#960050;background-color:#1e0010>]</span>&gt;
</span></span><span style=display:flex><span>    <span style=color:#f92672>:</span> <span style=color:#a6e22e>T</span>[<span style=color:#a6e22e>K</span>];
</span></span><span style=display:flex><span>};
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 更高效的替代方案
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>DeepNestedEfficient</span>&lt;<span style=color:#f92672>T</span>, <span style=color:#a6e22e>D</span> <span style=color:#a6e22e>extends</span> <span style=color:#a6e22e>number</span>&gt; <span style=color:#f92672>=</span> <span style=color:#a6e22e>D</span> <span style=color:#66d9ef>extends</span> <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>?</span> <span style=color:#a6e22e>T</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>:</span> {
</span></span><span style=display:flex><span>      [<span style=color:#a6e22e>K</span> <span style=color:#66d9ef>in</span> <span style=color:#66d9ef>keyof</span> <span style=color:#a6e22e>T</span>]<span style=color:#f92672>:</span> <span style=color:#a6e22e>T</span>[<span style=color:#a6e22e>K</span>] <span style=color:#66d9ef>extends</span> <span style=color:#66d9ef>object</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>?</span> <span style=color:#a6e22e>DeepNestedEfficient</span>&lt;<span style=color:#f92672>T</span><span style=color:#960050;background-color:#1e0010>[</span><span style=color:#a6e22e>K</span><span style=color:#960050;background-color:#1e0010>]</span>, <span style=color:#a6e22e>Decrement</span><span style=color:#960050;background-color:#1e0010>[</span><span style=color:#a6e22e>D</span><span style=color:#960050;background-color:#1e0010>]</span>&gt;
</span></span><span style=display:flex><span>        <span style=color:#f92672>:</span> <span style=color:#a6e22e>T</span>[<span style=color:#a6e22e>K</span>];
</span></span><span style=display:flex><span>    };
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 辅助类型
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>Decrement</span> <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>5</span>: <span style=color:#66d9ef>4</span>;
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>4</span>: <span style=color:#66d9ef>3</span>;
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>3</span>: <span style=color:#66d9ef>2</span>;
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>2</span>: <span style=color:#66d9ef>1</span>;
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>1</span>: <span style=color:#66d9ef>0</span>;
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>0</span>: <span style=color:#66d9ef>0</span>;
</span></span><span style=display:flex><span>};
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 优化类型使用模式
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>Compute</span>&lt;<span style=color:#f92672>T</span>&gt; <span style=color:#f92672>=</span> <span style=color:#a6e22e>T</span> <span style=color:#66d9ef>extends</span> Function <span style=color:#f92672>?</span> <span style=color:#a6e22e>T</span> <span style=color:#f92672>:</span> { [<span style=color:#a6e22e>K</span> <span style=color:#66d9ef>in</span> <span style=color:#66d9ef>keyof</span> <span style=color:#a6e22e>T</span>]<span style=color:#f92672>:</span> <span style=color:#a6e22e>T</span>[<span style=color:#a6e22e>K</span>] } <span style=color:#f92672>&amp;</span> {};
</span></span></code></pre></div><p>我们在大型项目中遵循的最佳实践：</p><ol><li>将大型复合类型拆分为更小的子类型</li><li>使用<code>Compute&lt;T></code>触发类型求值以简化嵌套类型</li><li>设置严格的递归深度限制</li><li>在类型定义中插入注释，提高 IDE 性能</li></ol><h3 id=类型断言的正确使用场景>类型断言的正确使用场景<a hidden class=anchor aria-hidden=true href=#类型断言的正确使用场景>#</a></h3><p>有些情况下类型断言确实是必要的：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#75715e>// 合理的类型断言场景
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 1. DOM元素获取
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>canvas</span> <span style=color:#f92672>=</span> document.<span style=color:#a6e22e>getElementById</span>(<span style=color:#e6db74>&#34;drawing-canvas&#34;</span>) <span style=color:#66d9ef>as</span> <span style=color:#a6e22e>HTMLCanvasElement</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 2. 外部库集成
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>interface</span> <span style=color:#a6e22e>ThirdPartyLibrary</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>doSomething</span>()<span style=color:#f92672>:</span> <span style=color:#66d9ef>any</span>;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>result</span> <span style=color:#f92672>=</span> (window <span style=color:#66d9ef>as</span> <span style=color:#66d9ef>any</span>).<span style=color:#a6e22e>thirdPartyLib</span>.<span style=color:#a6e22e>doSomething</span>() <span style=color:#66d9ef>as</span> <span style=color:#66d9ef>string</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 3. 强制类型收缩
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>Result</span>&lt;<span style=color:#f92672>T</span>&gt; <span style=color:#f92672>=</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>|</span> { <span style=color:#a6e22e>success</span>: <span style=color:#66d9ef>true</span>; <span style=color:#a6e22e>value</span>: <span style=color:#66d9ef>T</span> }
</span></span><span style=display:flex><span>  <span style=color:#f92672>|</span> { <span style=color:#a6e22e>success</span>: <span style=color:#66d9ef>false</span>; <span style=color:#a6e22e>error</span>: <span style=color:#66d9ef>string</span> };
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>unwrapResult</span>&lt;<span style=color:#f92672>T</span>&gt;(<span style=color:#a6e22e>result</span>: <span style=color:#66d9ef>Result</span>&lt;<span style=color:#f92672>T</span>&gt;)<span style=color:#f92672>:</span> <span style=color:#a6e22e>T</span> {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>result</span>.<span style=color:#a6e22e>success</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>result</span>.<span style=color:#a6e22e>value</span>;
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> Error(<span style=color:#a6e22e>result</span>.<span style=color:#a6e22e>error</span>);
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 更安全的替代方案：使用自定义类型保护
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>isSuccess</span>&lt;<span style=color:#f92672>T</span>&gt;(
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>result</span>: <span style=color:#66d9ef>Result</span>&lt;<span style=color:#f92672>T</span>&gt;
</span></span><span style=display:flex><span>)<span style=color:#f92672>:</span> <span style=color:#a6e22e>result</span> <span style=color:#66d9ef>is</span> { <span style=color:#a6e22e>success</span>: <span style=color:#66d9ef>true</span>; <span style=color:#a6e22e>value</span>: <span style=color:#66d9ef>T</span> } {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>result</span>.<span style=color:#a6e22e>success</span>;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>unwrapResultSafe</span>&lt;<span style=color:#f92672>T</span>&gt;(<span style=color:#a6e22e>result</span>: <span style=color:#66d9ef>Result</span>&lt;<span style=color:#f92672>T</span>&gt;)<span style=color:#f92672>:</span> <span style=color:#a6e22e>T</span> {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>isSuccess</span>(<span style=color:#a6e22e>result</span>)) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>result</span>.<span style=color:#a6e22e>value</span>; <span style=color:#75715e>// 类型安全
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  }
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> Error(<span style=color:#a6e22e>result</span>.<span style=color:#a6e22e>error</span>);
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=实际项目的类型系统度量>实际项目的类型系统度量<a hidden class=anchor aria-hidden=true href=#实际项目的类型系统度量>#</a></h2><p>我们在几个企业级项目中采用了高级类型技术，带来了显著改进：</p><table><thead><tr><th>指标</th><th>改进前</th><th>改进后</th><th>变化</th></tr></thead><tbody><tr><td>类型覆盖率</td><td>67%</td><td>96%</td><td>+43%</td></tr><tr><td>TypeScript 错误数</td><td>~850</td><td>~120</td><td>-86%</td></tr><tr><td>运行时类型相关错误</td><td>平均每周 12 起</td><td>平均每周 2 起</td><td>-83%</td></tr><tr><td>IDE 智能提示响应时间</td><td>800-1200ms</td><td>200-400ms</td><td>-67%</td></tr><tr><td>项目构建时间</td><td>3 分 42 秒</td><td>2 分 15 秒</td><td>-39%</td></tr><tr><td>新开发者熟悉项目时间</td><td>~2 周</td><td>~4 天</td><td>-71%</td></tr></tbody></table><h2 id=typescript-类型系统的未来趋势>TypeScript 类型系统的未来趋势<a hidden class=anchor aria-hidden=true href=#typescript-类型系统的未来趋势>#</a></h2><p>TypeScript 类型系统在不断发展，以下是值得关注的趋势：</p><ol><li><p><strong>依赖类型系统</strong>：未来可能支持更复杂的条件约束，例如类似 Rust 或 Haskell 的特性</p></li><li><p><strong>运行时类型检查与反射</strong>：类型信息在运行时的可访问性将提高</p></li><li><p><strong>跨语言类型共享</strong>：与后端语言如 Rust 或 Go 的更无缝类型集成</p></li><li><p><strong>递归类型性能优化</strong>：内部算法改进以处理复杂递归类型</p></li><li><p><strong>类型驱动代码生成</strong>：由类型定义生成运行时验证代码</p></li></ol><p>这些发展将使 TypeScript 更强大，同时保持其渐进式类型系统的优势。</p><h2 id=结语>结语<a hidden class=anchor aria-hidden=true href=#结语>#</a></h2><p>TypeScript 的类型系统不仅是检查错误的工具，更是一种强大的编程范式。通过条件类型、映射类型、递归类型和模板字面量类型等高级功能，我们能够构建更安全、更可维护的应用。</p><p>掌握这些高级类型技术让开发者能够：</p><ol><li>减少重复代码，通过类型级别的抽象提高复用性</li><li>在编译时捕获错误，而非运行时</li><li>增强 IDE 体验，提供精确的自动补全和文档</li><li>设计更加直观和自文档化的 API</li><li>实现更严格的架构边界</li></ol><p>正如我们团队的经验所示，投资学习 TypeScript 高级类型系统是非常值得的。它不仅能够解决当前的类型问题，还能够推动整个代码库向更高的工程质量发展。类型不再是障碍，而是使我们能够更快、更自信地构建复杂应用的工具。</p><p>在未来几年，随着 TypeScript 类型系统的持续发展，我们可以期待更多强大的类型编程功能的出现。那些今天掌握这些技术的开发者将处于前沿位置，能够充分利用这些新能力构建下一代 web 应用。</p><h2 id=相关阅读>相关阅读<a hidden class=anchor aria-hidden=true href=#相关阅读>#</a></h2><ul><li><a href=/zh/posts/architecture-and-performance/>现代前端架构设计与性能优化</a> - 探索前端架构与性能的关系</li><li><a href=/zh/posts/vite-deep-dive/>深入浅出 Vite</a> - 了解新一代构建工具的革命性突破</li><li><a href=/zh/posts/react-component-library/>从零构建企业级 React 组件库</a> - 学习如何构建类型安全的组件库</li></ul></div><footer class=post-footer><ul class=post-tags><li><a href=https://www.yss520.online/zh/tags/typescript/>TypeScript</a></li><li><a href=https://www.yss520.online/zh/tags/%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/>前端开发</a></li><li><a href=https://www.yss520.online/zh/tags/%E7%B1%BB%E5%9E%8B%E7%B3%BB%E7%BB%9F/>类型系统</a></li><li><a href=https://www.yss520.online/zh/tags/%E9%AB%98%E7%BA%A7%E7%B1%BB%E5%9E%8B/>高级类型</a></li><li><a href=https://www.yss520.online/zh/tags/%E6%B3%9B%E5%9E%8B/>泛型</a></li><li><a href=https://www.yss520.online/zh/tags/%E9%80%92%E5%BD%92%E7%B1%BB%E5%9E%8B/>递归类型</a></li><li><a href=https://www.yss520.online/zh/tags/%E6%9D%A1%E4%BB%B6%E7%B1%BB%E5%9E%8B/>条件类型</a></li></ul><ul class=share-buttons><li><a target=_blank rel="noopener noreferrer" aria-label="share TypeScript 高级类型编程：从类型困境到类型超能力 on x" href="https://x.com/intent/tweet/?text=TypeScript%20%e9%ab%98%e7%ba%a7%e7%b1%bb%e5%9e%8b%e7%bc%96%e7%a8%8b%ef%bc%9a%e4%bb%8e%e7%b1%bb%e5%9e%8b%e5%9b%b0%e5%a2%83%e5%88%b0%e7%b1%bb%e5%9e%8b%e8%b6%85%e8%83%bd%e5%8a%9b&amp;url=https%3a%2f%2fwww.yss520.online%2fzh%2fposts%2ftypescript-advanced-types%2f&amp;hashtags=TypeScript%2c%e5%89%8d%e7%ab%af%e5%bc%80%e5%8f%91%2c%e7%b1%bb%e5%9e%8b%e7%b3%bb%e7%bb%9f%2c%e9%ab%98%e7%ba%a7%e7%b1%bb%e5%9e%8b%2c%e6%b3%9b%e5%9e%8b%2c%e9%80%92%e5%bd%92%e7%b1%bb%e5%9e%8b%2c%e6%9d%a1%e4%bb%b6%e7%b1%bb%e5%9e%8b"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446C483.971.0 512 28.03 512 62.554zM269.951 190.75 182.567 75.216H56L207.216 272.95 63.9 436.783h61.366L235.9 310.383l96.667 126.4H456L298.367 228.367l134-153.151H371.033zM127.633 110h36.468l219.38 290.065H349.5z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share TypeScript 高级类型编程：从类型困境到类型超能力 on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fwww.yss520.online%2fzh%2fposts%2ftypescript-advanced-types%2f&amp;title=TypeScript%20%e9%ab%98%e7%ba%a7%e7%b1%bb%e5%9e%8b%e7%bc%96%e7%a8%8b%ef%bc%9a%e4%bb%8e%e7%b1%bb%e5%9e%8b%e5%9b%b0%e5%a2%83%e5%88%b0%e7%b1%bb%e5%9e%8b%e8%b6%85%e8%83%bd%e5%8a%9b&amp;summary=TypeScript%20%e9%ab%98%e7%ba%a7%e7%b1%bb%e5%9e%8b%e7%bc%96%e7%a8%8b%ef%bc%9a%e4%bb%8e%e7%b1%bb%e5%9e%8b%e5%9b%b0%e5%a2%83%e5%88%b0%e7%b1%bb%e5%9e%8b%e8%b6%85%e8%83%bd%e5%8a%9b&amp;source=https%3a%2f%2fwww.yss520.online%2fzh%2fposts%2ftypescript-advanced-types%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share TypeScript 高级类型编程：从类型困境到类型超能力 on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fwww.yss520.online%2fzh%2fposts%2ftypescript-advanced-types%2f&title=TypeScript%20%e9%ab%98%e7%ba%a7%e7%b1%bb%e5%9e%8b%e7%bc%96%e7%a8%8b%ef%bc%9a%e4%bb%8e%e7%b1%bb%e5%9e%8b%e5%9b%b0%e5%a2%83%e5%88%b0%e7%b1%bb%e5%9e%8b%e8%b6%85%e8%83%bd%e5%8a%9b"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share TypeScript 高级类型编程：从类型困境到类型超能力 on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fwww.yss520.online%2fzh%2fposts%2ftypescript-advanced-types%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share TypeScript 高级类型编程：从类型困境到类型超能力 on whatsapp" href="https://api.whatsapp.com/send?text=TypeScript%20%e9%ab%98%e7%ba%a7%e7%b1%bb%e5%9e%8b%e7%bc%96%e7%a8%8b%ef%bc%9a%e4%bb%8e%e7%b1%bb%e5%9e%8b%e5%9b%b0%e5%a2%83%e5%88%b0%e7%b1%bb%e5%9e%8b%e8%b6%85%e8%83%bd%e5%8a%9b%20-%20https%3a%2f%2fwww.yss520.online%2fzh%2fposts%2ftypescript-advanced-types%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share TypeScript 高级类型编程：从类型困境到类型超能力 on telegram" href="https://telegram.me/share/url?text=TypeScript%20%e9%ab%98%e7%ba%a7%e7%b1%bb%e5%9e%8b%e7%bc%96%e7%a8%8b%ef%bc%9a%e4%bb%8e%e7%b1%bb%e5%9e%8b%e5%9b%b0%e5%a2%83%e5%88%b0%e7%b1%bb%e5%9e%8b%e8%b6%85%e8%83%bd%e5%8a%9b&amp;url=https%3a%2f%2fwww.yss520.online%2fzh%2fposts%2ftypescript-advanced-types%2f"><svg viewBox="2 2 28 28" height="30" width="30" fill="currentcolor"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share TypeScript 高级类型编程：从类型困境到类型超能力 on ycombinator" href="https://news.ycombinator.com/submitlink?t=TypeScript%20%e9%ab%98%e7%ba%a7%e7%b1%bb%e5%9e%8b%e7%bc%96%e7%a8%8b%ef%bc%9a%e4%bb%8e%e7%b1%bb%e5%9e%8b%e5%9b%b0%e5%a2%83%e5%88%b0%e7%b1%bb%e5%9e%8b%e8%b6%85%e8%83%bd%e5%8a%9b&u=https%3a%2f%2fwww.yss520.online%2fzh%2fposts%2ftypescript-advanced-types%2f"><svg width="30" height="30" viewBox="0 0 512 512" fill="currentcolor" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"><path d="M449.446.0C483.971.0 512 28.03 512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446zM183.8767 87.9921h-62.034L230.6673 292.4508V424.0079h50.6655V292.4508L390.1575 87.9921H328.1233L256 238.2489z"/></svg></a></li></ul></footer></article></main><footer class=footer><span>&copy; 2025 <a href=https://www.yss520.online/zh/>Bruce的博客</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script src=/js/lightbox.js></script><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="复制";function s(){t.innerHTML="已复制！",setTimeout(()=>{t.innerHTML="复制"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>