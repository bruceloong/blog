[{"content":"Vite æ„å»º React é¡¹ç›®çš„æè‡´ä¼˜åŒ–ï¼šä» 2 åˆ†é’Ÿåˆ° 8 ç§’çš„æ„å»ºé©å‘½ æˆ‘ä»¬çš„ç³»ç»Ÿæ˜¯ä¸€ä¸ªä½¿ç”¨ Vite æ„å»ºçš„ React åº”ç”¨ï¼ŒåŒ…å«è¶…è¿‡ 200 ä¸ªé¡µé¢ã€300+ç»„ä»¶ï¼Œéšç€ä¸šåŠ¡çš„å¿«é€Ÿå¢é•¿ï¼Œå¼€å‘å›¢é˜Ÿé¢ä¸´ç€ä¸¥å³»çš„æ€§èƒ½æŒ‘æˆ˜ï¼š\næœ¬åœ°å¼€å‘æœåŠ¡å™¨å¯åŠ¨æ—¶é—´è¶…è¿‡ 25 ç§’ å¼€å‘è¿‡ç¨‹ä¸­çš„çƒ­æ›´æ–°å»¶è¿Ÿ 3-5 ç§’ ç”Ÿäº§ç¯å¢ƒæ„å»ºè€—æ—¶è¶…è¿‡ 2 åˆ†é’Ÿ é¦–å±åŠ è½½æ—¶é—´è¶…è¿‡ 5 ç§’ æ„å»ºäº§ç‰©è¶…è¿‡ 8MBï¼ˆgzip å 2.8MBï¼‰ äº§å“ç»ç†æŠ±æ€¨åŠŸèƒ½è¿­ä»£é€Ÿåº¦å¤ªæ…¢ï¼Œå¼€å‘äººå‘˜åˆ™ç—›è‹¦åœ°ç­‰å¾…æ¯ä¸€æ¬¡æ„å»ºï¼Œæµ‹è¯•å›¢é˜Ÿéœ€è¦å¿å—é¢‘ç¹çš„éƒ¨ç½²å»¶è¿Ÿã€‚å½“æˆ‘å°è¯•ç†è§£ä»£ç åº“æ—¶ï¼Œå‘ç°è¿™ä¸ªé¡¹ç›®ä½¿ç”¨äº†åŸºç¡€çš„ Vite é…ç½®ï¼Œå‡ ä¹æ²¡æœ‰è¿›è¡Œä»»ä½•ä¼˜åŒ–ã€‚\nä»Šå¤©ï¼Œæˆ‘æƒ³åˆ†äº«å¦‚ä½•å°†è¿™ä¸ªé¡¹ç›®çš„æ„å»ºæ—¶é—´ä» 2 åˆ†é’Ÿé™è‡³ 8 ç§’ï¼Œå¼€å‘æœåŠ¡å™¨å¯åŠ¨æ—¶é—´é™è‡³ 3 ç§’ï¼ŒåŒæ—¶å°†é¦–å±åŠ è½½é€Ÿåº¦æå‡ 300%çš„å…¨è¿‡ç¨‹ã€‚\nä¸€ã€é¡¹ç›®åˆå§‹çŠ¶æ€åˆ†æ é¦–å…ˆï¼Œæˆ‘è¿›è¡Œäº†å…¨é¢çš„æ€§èƒ½åˆ†æï¼Œç¡®å®šç“¶é¢ˆæ‰€åœ¨ï¼š\n1. æ„å»ºåˆ†æ ä½¿ç”¨rollup-plugin-visualizeråˆ›å»ºæ„å»ºåˆ†ææŠ¥å‘Šï¼š\n// vite.config.js åˆå§‹çŠ¶æ€ import { defineConfig } from \u0026#34;vite\u0026#34;; import react from \u0026#34;@vitejs/plugin-react\u0026#34;; export default defineConfig({ plugins: [react()], build: { minify: \u0026#34;terser\u0026#34;, }, }); åˆ†æç»“æœä»¤äººéœ‡æƒŠï¼š\nä¾èµ–åŒ…å æ€»ä½“ç§¯çš„ 76%ï¼Œå…¶ä¸­æœ‰å¤šä¸ªé‡å¤ä¾èµ– ä¸» bundle æ–‡ä»¶è¶…è¿‡ 3MB å›¾ç‰‡å’Œå­—ä½“èµ„æºæœªç»ä¼˜åŒ–ï¼Œå æ€»ä½“ç§¯çš„ 22% React ç»„ä»¶æœªåˆ†å‰²ï¼Œå¯¼è‡´é¦–å±éœ€è¦åŠ è½½å¤§é‡éå¿…è¦ä»£ç  æœªä½¿ç”¨ç¼“å­˜ç­–ç•¥ï¼Œæ¯æ¬¡æ„å»ºéƒ½æ˜¯ä»é›¶å¼€å§‹ 2. æ€§èƒ½æŒ‡æ ‡åŸºçº¿ ä½¿ç”¨ Lighthouse å’Œè‡ªå®šä¹‰æ€§èƒ½ç›‘æ§å·¥å…·æ”¶é›†çš„åŸºçº¿æŒ‡æ ‡ï¼š\næ„å»ºæŒ‡æ ‡ï¼š\nå®Œå…¨æ„å»ºæ—¶é—´ï¼š186 ç§’ å¼€å‘æœåŠ¡å™¨å¯åŠ¨æ—¶é—´ï¼š25.3 ç§’ çƒ­æ›´æ–°å“åº”æ—¶é—´ï¼š3.8 ç§’ è¿è¡Œæ—¶æŒ‡æ ‡ï¼š\né¦–æ¬¡å†…å®¹ç»˜åˆ¶(FCP)ï¼š2.8 ç§’ æœ€å¤§å†…å®¹ç»˜åˆ¶(LCP)ï¼š5.2 ç§’ æ€»é˜»å¡æ—¶é—´(TBT)ï¼š850ms é¦–å± JS æ‰§è¡Œæ—¶é—´ï¼š1.2 ç§’ äºŒã€Vite æ„å»ºä¼˜åŒ–ç­–ç•¥ åŸºäºåˆ†æç»“æœï¼Œæˆ‘è®¾è®¡äº†åˆ†å±‚ä¼˜åŒ–ç­–ç•¥ï¼Œä» Vite é…ç½®åˆ°ä»£ç ç»“æ„ï¼Œå…¨æ–¹ä½æå‡æ€§èƒ½ã€‚\n1. Vite é…ç½®ä¼˜åŒ– é¦–å…ˆï¼Œé‡æ„äº†vite.config.jsï¼š\n// vite.config.js ä¼˜åŒ–å import { defineConfig, splitVendorChunkPlugin } from \u0026#34;vite\u0026#34;; import react from \u0026#34;@vitejs/plugin-react\u0026#34;; import legacy from \u0026#34;@vitejs/plugin-legacy\u0026#34;; import viteCompression from \u0026#34;vite-plugin-compression\u0026#34;; import { visualizer } from \u0026#34;rollup-plugin-visualizer\u0026#34;; import { viteStaticCopy } from \u0026#34;vite-plugin-static-copy\u0026#34;; import viteImagemin from \u0026#34;vite-plugin-imagemin\u0026#34;; import { createHtmlPlugin } from \u0026#34;vite-plugin-html\u0026#34;; import { createSvgIconsPlugin } from \u0026#34;vite-plugin-svg-icons\u0026#34;; import path from \u0026#34;path\u0026#34;; // ç¯å¢ƒå˜é‡ä¸æ„å»ºæ¨¡å¼ const mode = process.env.NODE_ENV; const isProd = mode === \u0026#34;production\u0026#34;; const isReport = process.env.REPORT === \u0026#34;true\u0026#34;; export default defineConfig({ // è·¯å¾„åˆ«åé…ç½® resolve: { alias: { \u0026#34;@\u0026#34;: path.resolve(__dirname, \u0026#34;src\u0026#34;), \u0026#34;@components\u0026#34;: path.resolve(__dirname, \u0026#34;src/components\u0026#34;), \u0026#34;@hooks\u0026#34;: path.resolve(__dirname, \u0026#34;src/hooks\u0026#34;), \u0026#34;@assets\u0026#34;: path.resolve(__dirname, \u0026#34;src/assets\u0026#34;), }, }, // å¼€å‘æœåŠ¡å™¨é…ç½®ä¼˜åŒ– server: { hmr: { overlay: false, // å‡å°‘HMR overlayæ¸²æŸ“å¼€é”€ }, port: 3000, open: false, cors: true, proxy: { // APIä»£ç†é…ç½®... }, }, // é¢„æ„å»ºé€‰é¡¹ä¼˜åŒ– optimizeDeps: { // æ˜¾å¼å£°æ˜éœ€è¦é¢„æ„å»ºçš„ä¾èµ– include: [ \u0026#34;react\u0026#34;, \u0026#34;react-dom\u0026#34;, \u0026#34;react-router-dom\u0026#34;, \u0026#34;lodash-es\u0026#34;, \u0026#34;@ant-design/icons\u0026#34;, \u0026#34;ahooks\u0026#34;, // å…¶ä»–å¸¸ç”¨ä¾èµ–... ], // å¼ºåˆ¶æ’é™¤æ— éœ€é¢„æ„å»ºçš„ä¾èµ– exclude: [\u0026#34;@loadable/component\u0026#34;], // å¼€å¯ä¾èµ–é¡¹ç¼“å­˜ force: false, }, // æ„å»ºé€‰é¡¹ä¼˜åŒ– build: { // å…³é—­æºç æ˜ å°„ä»¥æé«˜æ„å»ºé€Ÿåº¦ sourcemap: false, // CSSä»£ç åˆ†å‰² cssCodeSplit: true, // æ„å»ºåç›®å½•ç»“æ„ outDir: \u0026#34;dist\u0026#34;, // æ¸…ç©ºç›®æ ‡ç›®å½• emptyOutDir: true, // èµ„æºå¤„ç† assetsInlineLimit: 4096, // 4kbä»¥ä¸‹èµ„æºå†…è”ä¸ºbase64 // Rollupé€‰é¡¹ rollupOptions: { output: { // ä»£ç åˆ†å‰²ç­–ç•¥ä¼˜åŒ– manualChunks: { \u0026#34;react-vendor\u0026#34;: [\u0026#34;react\u0026#34;, \u0026#34;react-dom\u0026#34;, \u0026#34;react-router-dom\u0026#34;], \u0026#34;ant-design\u0026#34;: [\u0026#34;antd\u0026#34;, \u0026#34;@ant-design/icons\u0026#34;], \u0026#34;chart-vendor\u0026#34;: [\u0026#34;echarts\u0026#34;, \u0026#34;@antv/g2\u0026#34;], utils: [\u0026#34;lodash-es\u0026#34;, \u0026#34;dayjs\u0026#34;, \u0026#34;axios\u0026#34;], }, // è¾“å‡ºç›®å½•ç»“æ„ä¼˜åŒ– chunkFileNames: isProd ? \u0026#34;static/js/[name].[hash].js\u0026#34; : \u0026#34;static/js/[name].js\u0026#34;, entryFileNames: isProd ? \u0026#34;static/js/[name].[hash].js\u0026#34; : \u0026#34;static/js/[name].js\u0026#34;, assetFileNames: (info) =\u0026gt; { const { name } = info; if (/\\.(png|jpe?g|gif|svg|webp)$/.test(name)) { return \u0026#34;static/images/[name].[hash][extname]\u0026#34;; } if (/\\.(woff2?|ttf|eot)$/.test(name)) { return \u0026#34;static/fonts/[name].[hash][extname]\u0026#34;; } if (/\\.css$/.test(name)) { return \u0026#34;static/css/[name].[hash][extname]\u0026#34;; } return \u0026#34;static/[ext]/[name].[hash][extname]\u0026#34;; }, }, }, // Terserä¼˜åŒ–é…ç½® minify: \u0026#34;terser\u0026#34;, terserOptions: { compress: { drop_console: isProd, drop_debugger: isProd, pure_funcs: isProd ? [\u0026#34;console.log\u0026#34;] : [], }, }, }, // æ’ä»¶é…ç½® plugins: [ react({ // ä»…åœ¨ç”Ÿäº§ç¯å¢ƒä¸‹å¯ç”¨å¿«é€Ÿåˆ·æ–° fastRefresh: !isProd, // babelé…ç½®ä¼˜åŒ– babel: { plugins: [ [\u0026#34;@babel/plugin-transform-react-jsx\u0026#34;, { runtime: \u0026#34;automatic\u0026#34; }], // å¯é€‰é“¾å’Œç©ºå€¼åˆå¹¶æ”¯æŒ \u0026#34;@babel/plugin-proposal-optional-chaining\u0026#34;, \u0026#34;@babel/plugin-proposal-nullish-coalescing-operator\u0026#34;, ], }, }), // è‡ªåŠ¨åˆ†å‰²vendor chunks splitVendorChunkPlugin(), // ç”Ÿäº§ç¯å¢ƒå‹ç¼© isProd \u0026amp;\u0026amp; viteCompression({ algorithm: \u0026#34;gzip\u0026#34;, // ä¹Ÿå¯ä»¥æ˜¯\u0026#39;brotli\u0026#39; ext: \u0026#34;.gz\u0026#34;, threshold: 10240, // åªå‹ç¼©å¤§äº10kbçš„æ–‡ä»¶ deleteOriginFile: false, }), // åˆ›å»ºHTMLæ’ä»¶ createHtmlPlugin({ minify: isProd, inject: { data: { title: \u0026#34;ä¼ä¸šç®¡ç†ç³»ç»Ÿ\u0026#34;, description: \u0026#34;é«˜æ€§èƒ½ä¼ä¸šç®¡ç†ç³»ç»Ÿ\u0026#34;, }, }, }), // SVGå›¾æ ‡å¤„ç† createSvgIconsPlugin({ iconDirs: [path.resolve(process.cwd(), \u0026#34;src/assets/icons\u0026#34;)], symbolId: \u0026#34;icon-[dir]-[name]\u0026#34;, }), // å›¾ç‰‡å‹ç¼© isProd \u0026amp;\u0026amp; viteImagemin({ gifsicle: { optimizationLevel: 7, interlaced: false, }, optipng: { optimizationLevel: 7, }, mozjpeg: { quality: 80, }, pngquant: { quality: [0.8, 0.9], speed: 4, }, svgo: { plugins: [ { name: \u0026#34;removeViewBox\u0026#34;, active: false, }, { name: \u0026#34;removeEmptyAttrs\u0026#34;, active: false, }, ], }, }), // æµè§ˆå™¨å…¼å®¹æ€§ isProd \u0026amp;\u0026amp; legacy({ targets: [\u0026#34;defaults\u0026#34;, \u0026#34;not IE 11\u0026#34;], }), // æ„å»ºåˆ†ææŠ¥å‘Š isReport \u0026amp;\u0026amp; visualizer({ filename: \u0026#34;stats.html\u0026#34;, open: true, gzipSize: true, brotliSize: true, }), ].filter(Boolean), }); è¿™ä¸ªé…ç½®ä»å¤šä¸ªç»´åº¦ä¼˜åŒ–äº† Vite æ„å»ºï¼š\nä¾èµ–é¢„æ„å»ºä¼˜åŒ–ï¼šæ˜ç¡®åˆ—å‡ºå…³é”®ä¾èµ–è¿›è¡Œé¢„æ„å»ºï¼Œé¿å…è¿è¡Œæ—¶åˆ†æ ä»£ç åˆ†å‰²ç­–ç•¥ï¼šå®ç°æ›´ç²¾ç»†çš„æ‰‹åŠ¨åˆ†å—ï¼Œå°†å¤§å‹ä¾èµ–åˆ†ç¦» èµ„æºå¤„ç†ä¼˜åŒ–ï¼šä¼˜åŒ–å›¾ç‰‡ã€å­—ä½“ç­‰é™æ€èµ„æºçš„å¤„ç†æ–¹å¼ å‹ç¼©ç­–ç•¥è°ƒæ•´ï¼šé’ˆå¯¹ç”Ÿäº§ç¯å¢ƒè¿›è¡Œä»£ç å’Œèµ„æºå‹ç¼© æ„å»ºåˆ†æå·¥å…·ï¼šæ·»åŠ å¯è§†åŒ–æ„å»ºæŠ¥å‘Š 2. ä¾èµ–ä¼˜åŒ– ä¾èµ–ç®¡ç†æ˜¯æ„å»ºæ€§èƒ½çš„å…³é”®å› ç´ ã€‚æˆ‘è¿›è¡Œäº†è¯¦ç»†çš„ä¾èµ–åˆ†æï¼Œå¹¶å®æ–½äº†ä»¥ä¸‹ä¼˜åŒ–ï¼š\n// package.jsonä¼˜åŒ– { \u0026#34;dependencies\u0026#34;: { // ä½¿ç”¨ç²¾ç¡®ç‰ˆæœ¬å·é¿å…æ„å¤–å‡çº§ \u0026#34;react\u0026#34;: \u0026#34;18.2.0\u0026#34;, \u0026#34;react-dom\u0026#34;: \u0026#34;18.2.0\u0026#34;, // ä½¿ç”¨tree-shakableçš„åº“ \u0026#34;lodash-es\u0026#34;: \u0026#34;4.17.21\u0026#34;, // ä»å®Œæ•´å¼•å…¥è¿ç§»åˆ°æŒ‰éœ€å¼•å…¥ \u0026#34;antd\u0026#34;: \u0026#34;5.3.0\u0026#34;, // æ›´æ¢ä¸ºè½»é‡çº§æ›¿ä»£æ–¹æ¡ˆ \u0026#34;dayjs\u0026#34;: \u0026#34;1.11.7\u0026#34;, // æ›¿ä»£moment.js // ç§»é™¤æœªä½¿ç”¨çš„ä¾èµ– // \u0026#34;uuid\u0026#34;: \u0026#34;9.0.0\u0026#34;, // å·²ç§»é™¤ }, \u0026#34;devDependencies\u0026#34;: { // å¼€å‘ä¾èµ–ä¼˜åŒ–... } } å…³é”®ä¼˜åŒ–æªæ–½åŒ…æ‹¬ï¼š\nä¾èµ–ç˜¦èº«ï¼šç§»é™¤ 9 ä¸ªæœªä½¿ç”¨çš„ä¾èµ–ï¼ŒèŠ‚çœ 200KB Tree-Shaking å‹å¥½åº“ï¼šå°†lodashæ›¿æ¢ä¸ºlodash-esï¼Œå®ç°æŒ‰éœ€å¼•å…¥ è½»é‡çº§æ›¿ä»£å“ï¼šç”¨dayjsæ›¿æ¢moment.jsï¼Œå‡å°‘çº¦ 400KB ç‰ˆæœ¬é”å®šï¼šä½¿ç”¨ç²¾ç¡®ç‰ˆæœ¬å·é¿å…æ„å¤–å‡çº§ ä¾èµ–æ‰å¹³åŒ–ï¼šè§£å†³ä¾èµ–åµŒå¥—é—®é¢˜ï¼Œå‡å°‘é‡å¤ä¾èµ– 3. æ„å»ºè„šæœ¬ä¼˜åŒ– æ”¹è¿›äº† npm æ„å»ºè„šæœ¬ï¼Œå……åˆ†åˆ©ç”¨å¹¶è¡Œå¤„ç†å’Œç¼“å­˜ï¼š\n// package.json scriptséƒ¨åˆ† { \u0026#34;scripts\u0026#34;: { \u0026#34;dev\u0026#34;: \u0026#34;vite --force\u0026#34;, // å¼€å‘æ—¶å¼ºåˆ¶æ¸…é™¤ç¼“å­˜ \u0026#34;dev:cached\u0026#34;: \u0026#34;vite\u0026#34;, // å¯ç”¨ç¼“å­˜çš„å¼€å‘æ¨¡å¼ \u0026#34;build\u0026#34;: \u0026#34;cross-env NODE_ENV=production vite build\u0026#34;, \u0026#34;build:staging\u0026#34;: \u0026#34;cross-env NODE_ENV=staging vite build\u0026#34;, \u0026#34;build:analyze\u0026#34;: \u0026#34;cross-env NODE_ENV=production REPORT=true vite build\u0026#34;, \u0026#34;preview\u0026#34;: \u0026#34;vite preview\u0026#34;, \u0026#34;typecheck\u0026#34;: \u0026#34;tsc --noEmit\u0026#34;, // å¹¶è¡Œç±»å‹æ£€æŸ¥ \u0026#34;lint\u0026#34;: \u0026#34;eslint src --ext .ts,.tsx --fix\u0026#34;, // å¹¶è¡Œä»£ç æ£€æŸ¥ \u0026#34;preinstall\u0026#34;: \u0026#34;npx only-allow pnpm\u0026#34;, // å¼ºåˆ¶ä½¿ç”¨pnpm \u0026#34;postinstall\u0026#34;: \u0026#34;npx simple-git-hooks\u0026#34; // å®‰è£…git hooks } } åŒæ—¶ï¼Œå°†åŒ…ç®¡ç†å™¨ä» npm è¿ç§»åˆ° pnpmï¼Œå‡å°‘äº†å®‰è£…æ—¶é—´å’Œç£ç›˜ç©ºé—´å ç”¨ã€‚\nä¸‰ã€ä»£ç å±‚é¢ä¼˜åŒ– 1. React ç»„ä»¶ä¼˜åŒ–ä¸ä»£ç åˆ†å‰² ä»æœ€åˆå®¡æŸ¥ä»£ç å¯ä»¥çœ‹åˆ°ï¼Œå¤§é‡ç»„ä»¶æ†ç»‘åœ¨ä¸»åŒ…ä¸­ï¼Œå¯¼è‡´é¦–å±åŠ è½½ç¼“æ…¢ã€‚æˆ‘å®æ–½äº†ä»¥ä¸‹ä¼˜åŒ–ï¼š\n// ä¼˜åŒ–å‰: ç›´æ¥å¯¼å…¥æ‰€æœ‰ç»„ä»¶ import Dashboard from \u0026#34;./pages/Dashboard\u0026#34;; import UserManagement from \u0026#34;./pages/UserManagement\u0026#34;; import ReportCenter from \u0026#34;./pages/ReportCenter\u0026#34;; import Settings from \u0026#34;./pages/Settings\u0026#34;; // ... å…¶ä»–200å¤šä¸ªé¡µé¢ç»„ä»¶ // ä¼˜åŒ–å: ä½¿ç”¨React.lazyå’Œè·¯ç”±çº§ä»£ç åˆ†å‰² import React, { lazy, Suspense } from \u0026#34;react\u0026#34;; import { Spin } from \u0026#34;antd\u0026#34;; import { Routes, Route } from \u0026#34;react-router-dom\u0026#34;; // æ‡’åŠ è½½ç»„ä»¶ const Dashboard = lazy(() =\u0026gt; import(\u0026#34;./pages/Dashboard\u0026#34;)); const UserManagement = lazy(() =\u0026gt; import(\u0026#34;./pages/UserManagement\u0026#34;)); const ReportCenter = lazy(() =\u0026gt; import(\u0026#34;./pages/ReportCenter\u0026#34;)); const Settings = lazy(() =\u0026gt; import(\u0026#34;./pages/Settings\u0026#34;)); // ... å…¶ä»–é¡µé¢ç»„ä»¶ // åŠ è½½å ä½ç¬¦ const PageLoading = () =\u0026gt; ( \u0026lt;div className=\u0026#34;page-loading-container\u0026#34;\u0026gt; \u0026lt;Spin size=\u0026#34;large\u0026#34; /\u0026gt; \u0026lt;/div\u0026gt; ); // è·¯ç”±é…ç½® const AppRoutes = () =\u0026gt; ( \u0026lt;Suspense fallback={\u0026lt;PageLoading /\u0026gt;}\u0026gt; \u0026lt;Routes\u0026gt; \u0026lt;Route path=\u0026#34;/\u0026#34; element={\u0026lt;Dashboard /\u0026gt;} /\u0026gt; \u0026lt;Route path=\u0026#34;/users/*\u0026#34; element={\u0026lt;UserManagement /\u0026gt;} /\u0026gt; \u0026lt;Route path=\u0026#34;/reports/*\u0026#34; element={\u0026lt;ReportCenter /\u0026gt;} /\u0026gt; \u0026lt;Route path=\u0026#34;/settings/*\u0026#34; element={\u0026lt;Settings /\u0026gt;} /\u0026gt; {/* ... å…¶ä»–è·¯ç”± */} \u0026lt;/Routes\u0026gt; \u0026lt;/Suspense\u0026gt; ); export default AppRoutes; è¿›ä¸€æ­¥ä¼˜åŒ–ï¼Œå¢åŠ äº†é¢„åŠ è½½å’ŒåŠ¨æ€å¯¼å…¥çš„ä¼˜å…ˆçº§æ§åˆ¶ï¼š\n// è·¯ç”±ç»„ä»¶æ™ºèƒ½é¢„åŠ è½½ import { useEffect } from \u0026#34;react\u0026#34;; import { useLocation } from \u0026#34;react-router-dom\u0026#34;; // æ ¹æ®ç”¨æˆ·è¡Œä¸ºé¢„æµ‹ä¸‹ä¸€æ­¥å¯èƒ½è®¿é—®çš„é¡µé¢ export const usePrefetchRoutes = () =\u0026gt; { const location = useLocation(); useEffect(() =\u0026gt; { // å½“ç”¨æˆ·åœ¨ä»ªè¡¨ç›˜æ—¶ï¼Œé¢„åŠ è½½ç”¨æˆ·ç®¡ç†é¡µé¢ if (location.pathname === \u0026#34;/\u0026#34;) { const prefetchUserManagement = () =\u0026gt; { const userManagementModule = import(\u0026#34;./pages/UserManagement\u0026#34;); // ä½¿ç”¨ä½ä¼˜å…ˆçº§è¯·æ±‚ï¼Œä¸é˜»å¡ä¸»çº¿ç¨‹ // @ts-ignore - fetchPriorityæ˜¯æ–°API userManagementModule._ = { fetchPriority: \u0026#34;low\u0026#34; }; }; // å»¶è¿Ÿé¢„åŠ è½½ï¼Œç­‰å¾…é¦–å±æ¸²æŸ“å®Œæˆ setTimeout(prefetchUserManagement, 3000); } // å…¶ä»–è·¯ç”±é¢„åŠ è½½é€»è¾‘... }, [location.pathname]); }; è¿˜åˆ›å»ºäº†ä¸€ä¸ªè‡ªå®šä¹‰çš„ç»„ä»¶åŠ è½½ä¼˜åŒ–å™¨ï¼š\n// LoadableComponent.tsx - é«˜çº§å¯åŠ è½½ç»„ä»¶ import React, { lazy, Suspense, ComponentType } from \u0026#34;react\u0026#34;; import { Spin } from \u0026#34;antd\u0026#34;; interface LoadableOptions { fallback?: React.ReactNode; prefetch?: boolean; delay?: number; // å»¶è¿ŸåŠ è½½æ—¶é—´ï¼Œé¿å…é—ªçƒ errorBoundary?: boolean; } export function createLoadable\u0026lt;T extends ComponentType\u0026lt;any\u0026gt;\u0026gt;( importFunc: () =\u0026gt; Promise\u0026lt;{ default: T }\u0026gt;, options: LoadableOptions = {} ) { const { fallback = \u0026lt;Spin size=\u0026#34;large\u0026#34; /\u0026gt;, prefetch = false, delay = 200, errorBoundary = true, } = options; // å»¶è¿Ÿæ˜¾ç¤ºåŠ è½½ç»„ä»¶ï¼Œé¿å…é—ªçƒ const DelayedFallback = () =\u0026gt; { const [showFallback, setShowFallback] = React.useState(false); React.useEffect(() =\u0026gt; { const timer = setTimeout(() =\u0026gt; { setShowFallback(true); }, delay); return () =\u0026gt; clearTimeout(timer); }, []); return showFallback ? \u0026lt;\u0026gt;{fallback}\u0026lt;/\u0026gt; : null; }; // æ‡’åŠ è½½ç»„ä»¶ const LazyComponent = lazy(importFunc); // åˆ›å»ºåŒ…è£…ç»„ä»¶ const LoadableComponent = (props: React.ComponentProps\u0026lt;T\u0026gt;) =\u0026gt; ( \u0026lt;Suspense fallback={\u0026lt;DelayedFallback /\u0026gt;}\u0026gt; \u0026lt;LazyComponent {...props} /\u0026gt; \u0026lt;/Suspense\u0026gt; ); // é¢„åŠ è½½åŠŸèƒ½ if (prefetch) { let prefetched = false; LoadableComponent.preload = () =\u0026gt; { if (!prefetched) { prefetched = true; importFunc(); } }; // å½“ç”¨æˆ·æ‚¬åœåœ¨è§¦å‘å…ƒç´ ä¸Šæ—¶é¢„åŠ è½½ LoadableComponent.prefetchOnHover = (e: React.MouseEvent) =\u0026gt; { LoadableComponent.preload(); }; } return LoadableComponent; } // ä½¿ç”¨ç¤ºä¾‹ const ReportDashboard = createLoadable( () =\u0026gt; import(\u0026#34;./pages/reports/Dashboard\u0026#34;), { prefetch: true, delay: 300 } ); // åœ¨å¯¼èˆªç»„ä»¶ä¸­ \u0026lt;NavLink to=\u0026#34;/reports/dashboard\u0026#34; onMouseEnter={ReportDashboard.prefetchOnHover}\u0026gt; æŠ¥è¡¨ä¸­å¿ƒ \u0026lt;/NavLink\u0026gt;; 2. å¤§å‹è¡¨æ ¼å’Œåˆ—è¡¨è™šæ‹ŸåŒ– é¡¹ç›®ä¸­çš„å¤§å‹æ•°æ®è¡¨æ ¼æ˜¯æ€§èƒ½ç“¶é¢ˆä¹‹ä¸€ã€‚æˆ‘ä»¬å®ç°äº†è™šæ‹ŸåŒ–æ¸²æŸ“ï¼š\n// VirtualTable.tsx - è™šæ‹ŸåŒ–è¡¨æ ¼ç»„ä»¶ import React, { FC, useRef, useEffect } from \u0026#34;react\u0026#34;; import { Table, TableProps } from \u0026#34;antd\u0026#34;; import { VariableSizeGrid as Grid } from \u0026#34;react-window\u0026#34;; import ResizeObserver from \u0026#34;rc-resize-observer\u0026#34;; interface VirtualTableProps\u0026lt;RecordType\u0026gt; extends TableProps\u0026lt;RecordType\u0026gt; { height?: number; itemHeight?: number; threshold?: number; // æ•°æ®é‡è¶…è¿‡è¯¥é˜ˆå€¼æ—¶å¯ç”¨è™šæ‹Ÿæ»šåŠ¨ } const VirtualTable = \u0026lt;RecordType extends object = any\u0026gt;({ columns, scroll, height = 500, itemHeight = 54, threshold = 100, dataSource, ...restProps }: VirtualTableProps\u0026lt;RecordType\u0026gt;) =\u0026gt; { const [tableWidth, setTableWidth] = React.useState(0); const gridRef = useRef\u0026lt;any\u0026gt;(); // åªæœ‰å½“æ•°æ®é‡å¤§äºé˜ˆå€¼æ—¶æ‰å¯ç”¨è™šæ‹Ÿæ»šåŠ¨ const shouldVirtualize = (dataSource?.length || 0) \u0026gt; threshold; useEffect(() =\u0026gt; { // å½“æ•°æ®å˜åŒ–æ—¶é‡æ–°è®¡ç®—Grid gridRef.current?.resetAfterIndices({ columnIndex: 0, rowIndex: 0, shouldForceUpdate: true, }); }, [dataSource]); // å¦‚æœä¸éœ€è¦è™šæ‹ŸåŒ–ï¼Œè¿”å›æ™®é€šè¡¨æ ¼ if (!shouldVirtualize) { return \u0026lt;Table columns={columns} dataSource={dataSource} {...restProps} /\u0026gt;; } // è™šæ‹Ÿæ»šåŠ¨æ¸²æŸ“å™¨ const renderVirtualList = ( rawData: readonly object[], { scrollbarSize }: any ) =\u0026gt; { const totalHeight = rawData.length * itemHeight; // å•å…ƒæ ¼æ¸²æŸ“å™¨ const Cell = ({ columnIndex, rowIndex, style }: any) =\u0026gt; { const column = columns[columnIndex]; const record = rawData[rowIndex] as RecordType; // è®¡ç®—å•å…ƒæ ¼å†…å®¹ const cellContent = column.render ? column.render( record[column.dataIndex as keyof RecordType], record, rowIndex ) : record[column.dataIndex as keyof RecordType]; return ( \u0026lt;div className=\u0026#34;virtual-table-cell\u0026#34; style={{ ...style, padding: \u0026#34;8px 16px\u0026#34;, boxSizing: \u0026#34;border-box\u0026#34;, borderBottom: \u0026#34;1px solid #f0f0f0\u0026#34;, display: \u0026#34;flex\u0026#34;, alignItems: \u0026#34;center\u0026#34;, }} \u0026gt; {cellContent} \u0026lt;/div\u0026gt; ); }; return ( \u0026lt;Grid ref={gridRef} className=\u0026#34;virtual-grid\u0026#34; columnCount={columns.length} columnWidth={(index) =\u0026gt; { const column = columns[index]; return (column.width as number) || 150; }} height={height} rowCount={rawData.length} rowHeight={() =\u0026gt; itemHeight} width={tableWidth} \u0026gt; {Cell} \u0026lt;/Grid\u0026gt; ); }; return ( \u0026lt;ResizeObserver onResize={({ width }) =\u0026gt; setTableWidth(width)}\u0026gt; \u0026lt;Table {...restProps} className=\u0026#34;virtual-table\u0026#34; columns={columns} dataSource={dataSource} pagination={false} components={{ body: renderVirtualList, }} /\u0026gt; \u0026lt;/ResizeObserver\u0026gt; ); }; export default VirtualTable; 3. ç»„ä»¶åŠ è½½ä¼˜åŒ–å™¨ é’ˆå¯¹å…³é”®æ€§èƒ½è·¯å¾„ï¼Œæˆ‘ä»¬å¼€å‘äº†ç»„ä»¶åŠ è½½ä¼˜åŒ–å™¨ï¼š\n// ç»„ä»¶åŠ è½½ä¼˜åŒ–å™¨ import React, { useEffect, useState, ReactNode } from \u0026#34;react\u0026#34;; interface OptimizerProps { // ç»„ä»¶ä¼˜å…ˆçº§ priority: \u0026#34;critical\u0026#34; | \u0026#34;high\u0026#34; | \u0026#34;medium\u0026#34; | \u0026#34;low\u0026#34;; // æ˜¯å¦å»¶è¿ŸåŠ è½½ delayRender?: boolean; // æ˜¯å¦åœ¨è§†å£å¯è§æ—¶åŠ è½½ loadOnVisible?: boolean; // æ¸²æŸ“å ä½ç¬¦ placeholder?: ReactNode; // å­ç»„ä»¶ children: ReactNode; } export const ComponentOptimizer: React.FC\u0026lt;OptimizerProps\u0026gt; = ({ priority, delayRender = false, loadOnVisible = false, placeholder = null, children, }) =\u0026gt; { const [shouldRender, setShouldRender] = useState(priority === \u0026#34;critical\u0026#34;); const containerRef = React.useRef\u0026lt;HTMLDivElement\u0026gt;(null); useEffect(() =\u0026gt; { // ç«‹å³æ¸²æŸ“å…³é”®å’Œé«˜ä¼˜å…ˆçº§ç»„ä»¶ if (priority === \u0026#34;critical\u0026#34; || priority === \u0026#34;high\u0026#34;) { setShouldRender(true); return; } // ä¸­ä¼˜å…ˆçº§ç»„ä»¶åœ¨åˆå§‹æ¸²æŸ“åå»¶è¿ŸåŠ è½½ if (priority === \u0026#34;medium\u0026#34;) { const timer = setTimeout(() =\u0026gt; { setShouldRender(true); }, 100); return () =\u0026gt; clearTimeout(timer); } // ä½ä¼˜å…ˆçº§ç»„ä»¶å¤„ç† if (priority === \u0026#34;low\u0026#34;) { // å»¶è¿Ÿæ¸²æŸ“çš„ç»„ä»¶ if (delayRender) { const timer = setTimeout(() =\u0026gt; { setShouldRender(true); }, 300); return () =\u0026gt; clearTimeout(timer); } // å¯è§æ€§è§¦å‘çš„ç»„ä»¶ if (loadOnVisible \u0026amp;\u0026amp; typeof IntersectionObserver !== \u0026#34;undefined\u0026#34;) { const observer = new IntersectionObserver( (entries) =\u0026gt; { if (entries[0].isIntersecting) { setShouldRender(true); observer.disconnect(); } }, { threshold: 0.1 } ); if (containerRef.current) { observer.observe(containerRef.current); } return () =\u0026gt; observer.disconnect(); } // é»˜è®¤å»¶è¿Ÿæ¸²æŸ“ä½ä¼˜å…ˆçº§ç»„ä»¶ const idleCallback = requestIdleCallback ? requestIdleCallback(() =\u0026gt; setShouldRender(true)) : setTimeout(() =\u0026gt; setShouldRender(true), 200); return () =\u0026gt; { if (requestIdleCallback) { cancelIdleCallback(idleCallback as number); } else { clearTimeout(idleCallback as number); } }; } }, [priority, delayRender, loadOnVisible]); return ( \u0026lt;div ref={containerRef} style={{ minHeight: shouldRender ? 0 : \u0026#34;10px\u0026#34; }}\u0026gt; {shouldRender ? children : placeholder} \u0026lt;/div\u0026gt; ); }; 4. API è¯·æ±‚ä¼˜åŒ– ä¼˜åŒ–äº† API è¯·æ±‚é€»è¾‘ï¼Œå®ç°è¯·æ±‚åˆå¹¶å’Œç¼“å­˜ï¼š\n// src/services/api.ts import axios, { AxiosRequestConfig } from \u0026#34;axios\u0026#34;; import { setupCache } from \u0026#34;axios-cache-interceptor\u0026#34;; // åˆ›å»ºåŸºç¡€axioså®ä¾‹ const axiosInstance = axios.create({ baseURL: import.meta.env.VITE_API_BASE_URL, timeout: 10000, }); // è®¾ç½®è¯·æ±‚ç¼“å­˜ const api = setupCache(axiosInstance, { // é»˜è®¤TTL: 5åˆ†é’Ÿ ttl: 5 * 60 * 1000, // æ’é™¤mutatingè¯·æ±‚ methods: [\u0026#34;get\u0026#34;], // ç¼“å­˜é”®ç”Ÿæˆç­–ç•¥ generateKey: (request) =\u0026gt; { const { method, url, params, data } = request; return `${method}:${url}:${JSON.stringify(params)}:${JSON.stringify(data)}`; }, }); // è¯·æ±‚åˆå¹¶å¤„ç† const pendingRequests = new Map(); api.interceptors.request.use((config) =\u0026gt; { const { method, url, params } = config; // åªåˆå¹¶GETè¯·æ±‚ if (method?.toLowerCase() !== \u0026#34;get\u0026#34;) { return config; } // ç”Ÿæˆè¯·æ±‚Key const requestKey = `${url}:${JSON.stringify(params)}`; // å¦‚æœæœ‰ç›¸åŒè¯·æ±‚æ­£åœ¨è¿›è¡Œä¸­ï¼Œå¤ç”¨è¯¥è¯·æ±‚ if (pendingRequests.has(requestKey)) { // å–æ¶ˆå½“å‰è¯·æ±‚ config.cancelToken = new axios.CancelToken((cancel) =\u0026gt; { cancel(\u0026#34;Duplicate request canceled\u0026#34;); }); // è¿”å›ç°æœ‰è¯·æ±‚çš„Promise return pendingRequests.get(requestKey); } // æ³¨å†Œæ–°è¯·æ±‚ const promise = new Promise\u0026lt;any\u0026gt;((resolve, reject) =\u0026gt; { // åœ¨è¯·æ±‚å®Œæˆåä¿å­˜ç»“æœ config._resolveRequest = resolve; config._rejectRequest = reject; }); pendingRequests.set(requestKey, promise); // åœ¨è¯·æ±‚å®Œæˆåç§»é™¤ config._requestKey = requestKey; return config; }); api.interceptors.response.use( (response) =\u0026gt; { const { config } = response; const requestKey = config._requestKey; // å¦‚æœæœ‰è¯·æ±‚Keyå’Œè§£æå‡½æ•°ï¼Œå¤„ç†åˆå¹¶è¯·æ±‚ if (requestKey \u0026amp;\u0026amp; config._resolveRequest) { config._resolveRequest(response); // ç§»é™¤pendingè¯·æ±‚ pendingRequests.delete(requestKey); } return response; }, (error) =\u0026gt; { const { config } = error.config || {}; if (config \u0026amp;\u0026amp; config._requestKey \u0026amp;\u0026amp; config._rejectRequest) { config._rejectRequest(error); pendingRequests.delete(config._requestKey); } return Promise.reject(error); } ); export default api; å››ã€é™æ€èµ„æºä¼˜åŒ– 1. å›¾ç‰‡èµ„æºä¼˜åŒ– é¡¹ç›®ä¸­çš„å›¾ç‰‡èµ„æºå ç”¨å¤§é‡å¸¦å®½ï¼Œæˆ‘ä»¬å®æ–½äº†å¤šå±‚æ¬¡ä¼˜åŒ–ï¼š\n// src/components/OptimizedImage.tsx import React, { useState, useEffect } from \u0026#34;react\u0026#34;; interface OptimizedImageProps { src: string; alt: string; width?: number; height?: number; lazy?: boolean; placeholder?: string; blurhash?: string; webp?: boolean; avif?: boolean; } const OptimizedImage: React.FC\u0026lt;OptimizedImageProps\u0026gt; = ({ src, alt, width, height, lazy = true, placeholder, blurhash, webp = true, avif = true, ...props }) =\u0026gt; { const [loaded, setLoaded] = useState(false); const imgRef = React.useRef\u0026lt;HTMLImageElement\u0026gt;(null); // ç”Ÿæˆæœ€ä½³å°ºå¯¸çš„å›¾ç‰‡URL const processImageUrl = (url: string) =\u0026gt; { // å¯¹äºä½¿ç”¨å›¾ç‰‡å¤„ç†æœåŠ¡çš„URLè¿›è¡Œè½¬æ¢ if (url.includes(\u0026#34;imageservice\u0026#34;)) { const params = new URLSearchParams(); if (width) params.append(\u0026#34;w\u0026#34;, width.toString()); if (height) params.append(\u0026#34;h\u0026#34;, height.toString()); // æ ¹æ®è®¾å¤‡å±å¹•å¯†åº¦è°ƒæ•´å›¾ç‰‡è´¨é‡ const dpr = window.devicePixelRatio || 1; params.append(\u0026#34;dpr\u0026#34;, Math.min(dpr, 3).toString()); // è´¨é‡å‚æ•° params.append(\u0026#34;q\u0026#34;, dpr \u0026gt; 1 ? \u0026#34;75\u0026#34; : \u0026#34;85\u0026#34;); return `${url}?${params.toString()}`; } return url; }; useEffect(() =\u0026gt; { if (!lazy || !imgRef.current) return; const observer = new IntersectionObserver( (entries) =\u0026gt; { entries.forEach((entry) =\u0026gt; { if (entry.isIntersecting) { const img = entry.target as HTMLImageElement; const dataSrc = img.getAttribute(\u0026#34;data-src\u0026#34;); if (dataSrc) { img.src = processImageUrl(dataSrc); img.removeAttribute(\u0026#34;data-src\u0026#34;); } observer.unobserve(img); } }); }, { rootMargin: \u0026#34;200px 0px\u0026#34; } // æå‰200pxåŠ è½½ ); observer.observe(imgRef.current); return () =\u0026gt; { if (imgRef.current) observer.unobserve(imgRef.current); }; }, [lazy, src]); const onImageLoad = () =\u0026gt; { setLoaded(true); }; // æ”¯æŒç°ä»£å›¾ç‰‡æ ¼å¼ if (webp || avif) { return ( \u0026lt;picture\u0026gt; {avif \u0026amp;\u0026amp; ( \u0026lt;source srcSet={src.replace(/\\.(jpg|png)$/, \u0026#34;.avif\u0026#34;)} type=\u0026#34;image/avif\u0026#34; /\u0026gt; )} {webp \u0026amp;\u0026amp; ( \u0026lt;source srcSet={src.replace(/\\.(jpg|png)$/, \u0026#34;.webp\u0026#34;)} type=\u0026#34;image/webp\u0026#34; /\u0026gt; )} \u0026lt;img ref={imgRef} src={lazy ? placeholder : processImageUrl(src)} data-src={lazy ? src : undefined} alt={alt} width={width} height={height} onLoad={onImageLoad} style={{ opacity: loaded ? 1 : 0.5, transition: \u0026#34;opacity 0.3s ease\u0026#34;, ...props.style, }} {...props} /\u0026gt; \u0026lt;/picture\u0026gt; ); } return ( \u0026lt;img ref={imgRef} src={lazy ? placeholder : processImageUrl(src)} data-src={lazy ? src : undefined} alt={alt} width={width} height={height} onLoad={onImageLoad} style={{ opacity: loaded ? 1 : 0.5, transition: \u0026#34;opacity 0.3s ease\u0026#34;, ...props.style, }} {...props} /\u0026gt; ); }; export default OptimizedImage; 2. å­—ä½“åŠ è½½ä¼˜åŒ– ä¼˜åŒ–äº†è‡ªå®šä¹‰å­—ä½“åŠ è½½æ–¹å¼ï¼š\n// src/utils/fontLoader.ts export const loadFonts = () =\u0026gt; { // ä½¿ç”¨Font Loading API if (\u0026#39;fonts\u0026#39; in document) { // ä»…åŠ è½½å…³é”®å­—ä½“ Promise.all([ document.fonts.load(\u0026#39;1em PingFangSC-Regular\u0026#39;), document.fonts.load(\u0026#39;bold 1em PingFangSC-Medium\u0026#39;), ]).then(() =\u0026gt; { document.documentElement.classList.add(\u0026#39;fonts-loaded\u0026#39;); }); } else { // å…¼å®¹å›é€€ document.documentElement.classList.add(\u0026#39;fonts-loaded\u0026#39;); } }; // ä½¿ç”¨Font Display CSSå±æ€§ä¼˜åŒ–å­—ä½“æ¸²æŸ“ // styles/fonts.css @font-face { font-family: \u0026#39;PingFangSC\u0026#39;; font-style: normal; font-weight: 400; font-display: swap; /* å…ˆä½¿ç”¨ç³»ç»Ÿå­—ä½“ï¼Œå­—ä½“åŠ è½½å®Œæˆåæ›¿æ¢ */ src: local(\u0026#39;PingFangSC-Regular\u0026#39;), url(\u0026#39;/fonts/PingFangSC-Regular.woff2\u0026#39;) format(\u0026#39;woff2\u0026#39;); } @font-face { font-family: \u0026#39;PingFangSC\u0026#39;; font-style: normal; font-weight: 500; font-display: swap; src: local(\u0026#39;PingFangSC-Medium\u0026#39;), url(\u0026#39;/fonts/PingFangSC-Medium.woff2\u0026#39;) format(\u0026#39;woff2\u0026#39;); } äº”ã€æ•°æ®é¢„åŠ è½½ä¸ç¼“å­˜ä¼˜åŒ– å®ç°äº†å¤šå±‚æ•°æ®é¢„åŠ è½½å’Œç¼“å­˜æœºåˆ¶ï¼š\n// src/services/dataPreloader.ts import { queryClient } from \u0026#34;./queryClient\u0026#34;; import api from \u0026#34;./api\u0026#34;; // é¢„åŠ è½½ç®¡ç†å™¨ export class DataPreloader { private static instance: DataPreloader; private preloadQueue: Array\u0026lt;() =\u0026gt; Promise\u0026lt;any\u0026gt;\u0026gt; = []; private isProcessing = false; private idleTimeout: number | null = null; // å•ä¾‹æ¨¡å¼ static getInstance(): DataPreloader { if (!DataPreloader.instance) { DataPreloader.instance = new DataPreloader(); } return DataPreloader.instance; } // æ·»åŠ é¢„åŠ è½½ä»»åŠ¡ enqueue( preloadFn: () =\u0026gt; Promise\u0026lt;any\u0026gt;, priority: \u0026#34;high\u0026#34; | \u0026#34;normal\u0026#34; | \u0026#34;low\u0026#34; = \u0026#34;normal\u0026#34; ): void { if (priority === \u0026#34;high\u0026#34;) { this.preloadQueue.unshift(preloadFn); } else if (priority === \u0026#34;low\u0026#34;) { this.preloadQueue.push(preloadFn); } else { // \u0026#39;normal\u0026#39; ä¼˜å…ˆçº§æ’å…¥åˆ°lowä¹‹å‰ const lowPriorityIndex = this.preloadQueue.findIndex( (_, index) =\u0026gt; index \u0026gt; 0 \u0026amp;\u0026amp; this.preloadQueue[index - 1].priority === \u0026#34;low\u0026#34; ); if (lowPriorityIndex !== -1) { this.preloadQueue.splice(lowPriorityIndex, 0, preloadFn); } else { this.preloadQueue.push(preloadFn); } } // è§¦å‘å¤„ç†é˜Ÿåˆ— this.processQueue(); } // å¤„ç†é¢„åŠ è½½é˜Ÿåˆ— private async processQueue(): Promise\u0026lt;void\u0026gt; { // å¦‚æœå·²ç»åœ¨å¤„ç†æˆ–é˜Ÿåˆ—ä¸ºç©ºï¼Œåˆ™è¿”å› if (this.isProcessing || this.preloadQueue.length === 0) { return; } this.isProcessing = true; try { // å¤„ç†é«˜ä¼˜å…ˆçº§ä»»åŠ¡ while (this.preloadQueue.length \u0026gt; 0) { const nextTask = this.preloadQueue.shift(); if (nextTask) { // ä½¿ç”¨requestIdleCallbackè¿›è¡Œä½ä¼˜å…ˆçº§é¢„åŠ è½½ if (\u0026#34;requestIdleCallback\u0026#34; in window) { this.idleTimeout = window.requestIdleCallback( async () =\u0026gt; { try { await nextTask(); } catch (error) { console.error(\u0026#34;Preload task failed:\u0026#34;, error); } // æš‚åœä¸€æ®µæ—¶é—´å†ç»§ç»­ï¼Œé¿å…é˜»å¡ä¸»çº¿ç¨‹ setTimeout(() =\u0026gt; { this.isProcessing = false; this.processQueue(); }, 50); }, { timeout: 1000 } ) as unknown as number; } else { // é™çº§æ–¹æ¡ˆ setTimeout(async () =\u0026gt; { try { await nextTask(); } catch (error) { console.error(\u0026#34;Preload task failed:\u0026#34;, error); } this.isProcessing = false; this.processQueue(); }, 100); } // ä¸€æ¬¡åªå¤„ç†ä¸€ä¸ªä»»åŠ¡ï¼Œç„¶åé‡Šæ”¾æ§åˆ¶æƒ break; } } } catch (error) { console.error(\u0026#34;Error processing preload queue:\u0026#34;, error); } finally { if (this.preloadQueue.length === 0) { this.isProcessing = false; } } } // æ¸…ç† clear(): void { this.preloadQueue = []; this.isProcessing = false; if (this.idleTimeout !== null \u0026amp;\u0026amp; \u0026#34;cancelIdleCallback\u0026#34; in window) { window.cancelIdleCallback(this.idleTimeout); this.idleTimeout = null; } } } // é¢„åŠ è½½å¸¸ç”¨æ•°æ® export const preloadCommonData = () =\u0026gt; { const preloader = DataPreloader.getInstance(); // ç”¨æˆ·é…ç½®ï¼ˆé«˜ä¼˜å…ˆçº§ï¼‰ preloader.enqueue( () =\u0026gt; queryClient.prefetchQuery([\u0026#34;userPreferences\u0026#34;], () =\u0026gt; api.get(\u0026#34;/api/user/preferences\u0026#34;) ), \u0026#34;high\u0026#34; ); // å¸¸è§ä¸»æ•°æ®ï¼ˆæ­£å¸¸ä¼˜å…ˆçº§ï¼‰ preloader.enqueue( () =\u0026gt; queryClient.prefetchQuery([\u0026#34;commonMasterData\u0026#34;], () =\u0026gt; api.get(\u0026#34;/api/master-data/common\u0026#34;) ), \u0026#34;normal\u0026#34; ); // é€šçŸ¥æ•°æ®ï¼ˆä½ä¼˜å…ˆçº§ï¼‰ preloader.enqueue( () =\u0026gt; queryClient.prefetchQuery([\u0026#34;notifications\u0026#34;], () =\u0026gt; api.get(\u0026#34;/api/notifications/unread\u0026#34;) ), \u0026#34;low\u0026#34; ); }; // é¢„åŠ è½½ç‰¹å®šé¡µé¢æ•°æ® export const preloadPageData = (pageType: string) =\u0026gt; { const preloader = DataPreloader.getInstance(); switch (pageType) { case \u0026#34;dashboard\u0026#34;: preloader.enqueue( () =\u0026gt; queryClient.prefetchQuery([\u0026#34;dashboardSummary\u0026#34;], () =\u0026gt; api.get(\u0026#34;/api/dashboard/summary\u0026#34;) ), \u0026#34;high\u0026#34; ); preloader.enqueue( () =\u0026gt; queryClient.prefetchQuery([\u0026#34;dashboardCharts\u0026#34;], () =\u0026gt; api.get(\u0026#34;/api/dashboard/charts\u0026#34;) ), \u0026#34;normal\u0026#34; ); break; case \u0026#34;users\u0026#34;: preloader.enqueue( () =\u0026gt; queryClient.prefetchQuery( [\u0026#34;usersList\u0026#34;, { page: 1, pageSize: 20 }], () =\u0026gt; api.get(\u0026#34;/api/users\u0026#34;, { params: { page: 1, pageSize: 20 } }) ), \u0026#34;high\u0026#34; ); break; // å…¶ä»–é¡µé¢é¢„åŠ è½½é…ç½®... } }; é…åˆè·¯ç”±å®ç°å¯¼èˆªé¢„åŠ è½½ï¼š\n// src/router/PreloadLink.tsx import React, { useState } from \u0026#34;react\u0026#34;; import { Link, LinkProps } from \u0026#34;react-router-dom\u0026#34;; import { preloadPageData } from \u0026#34;../services/dataPreloader\u0026#34;; interface PreloadLinkProps extends LinkProps { pageType?: string; preloadData?: boolean; preloadComponent?: boolean; preloadDelay?: number; } const PreloadLink: React.FC\u0026lt;PreloadLinkProps\u0026gt; = ({ to, pageType, preloadData = true, preloadComponent = true, preloadDelay = 200, children, ...props }) =\u0026gt; { const [prefetched, setPrefetched] = useState(false); const startPreload = () =\u0026gt; { if (prefetched) return; // æ ‡è®°ä¸ºå·²é¢„åŠ è½½ï¼Œé¿å…é‡å¤æ“ä½œ setPrefetched(true); // å»¶è¿Ÿé¢„åŠ è½½ï¼Œé¿å…ç”¨æˆ·åªæ˜¯é¼ æ ‡åˆ’è¿‡ const timer = setTimeout(() =\u0026gt; { // é¢„åŠ è½½ç»„ä»¶ if (preloadComponent \u0026amp;\u0026amp; pageType) { switch (pageType) { case \u0026#34;dashboard\u0026#34;: import(\u0026#34;../pages/Dashboard\u0026#34;); break; case \u0026#34;users\u0026#34;: import(\u0026#34;../pages/UserManagement\u0026#34;); break; // å…¶ä»–é¡µé¢ç»„ä»¶... } } // é¢„åŠ è½½æ•°æ® if (preloadData \u0026amp;\u0026amp; pageType) { preloadPageData(pageType); } }, preloadDelay); return () =\u0026gt; clearTimeout(timer); }; return ( \u0026lt;Link to={to} onMouseEnter={startPreload} onFocus={startPreload} onTouchStart={startPreload} {...props} \u0026gt; {children} \u0026lt;/Link\u0026gt; ); }; export default PreloadLink; å…­ã€Vite æ„å»ºä¼˜åŒ–æ’ä»¶ ä¸ºäº†è¿›ä¸€æ­¥ä¼˜åŒ–æ„å»ºè¿‡ç¨‹ï¼Œæˆ‘ä»¬å¼€å‘äº†å‡ ä¸ªè‡ªå®šä¹‰ Vite æ’ä»¶ï¼š\n// vite-plugins/vite-plugin-build-analyzer.js // æ„å»ºæ€§èƒ½åˆ†ææ’ä»¶ export default function buildAnalyzerPlugin() { const startTimes = new Map(); const durations = new Map(); let buildStart = 0; return { name: \u0026#34;vite-plugin-build-analyzer\u0026#34;, buildStart() { buildStart = Date.now(); console.log(\u0026#34;ğŸš€ Build started\u0026#34;); }, transformStart(id) { startTimes.set(id, Date.now()); }, transform(code, id) { const startTime = startTimes.get(id); if (startTime) { const duration = Date.now() - startTime; if (duration \u0026gt; 100) { // åªè®°å½•å¤„ç†æ—¶é—´è¶…è¿‡100msçš„æ–‡ä»¶ durations.set(id, { time: duration, size: code.length, }); } startTimes.delete(id); } return null; }, buildEnd() { const buildTime = Date.now() - buildStart; // æŒ‰å¤„ç†æ—¶é—´æ’åº const sortedDurations = [...durations.entries()] .sort((a, b) =\u0026gt; b[1].time - a[1].time) .slice(0, 10); console.log(\u0026#34;\\nğŸ” Build Performance Report:\u0026#34;); console.log(`Total build time: ${(buildTime / 1000).toFixed(2)}s`); console.log(\u0026#34;\\nTop 10 slow transformations:\u0026#34;); sortedDurations.forEach(([id, { time, size }], index) =\u0026gt; { console.log( `${index + 1}. ${id.split(\u0026#34;/\u0026#34;).slice(-2).join(\u0026#34;/\u0026#34;)} - ${time}ms (${( size / 1024 ).toFixed(2)}KB)` ); }); }, }; } // vite-plugins/vite-plugin-bundle-checker.js // æ‰“åŒ…ä½“ç§¯æ£€æŸ¥æ’ä»¶ import { bold, red, yellow, green } from \u0026#34;picocolors\u0026#34;; import gzipSize from \u0026#34;gzip-size\u0026#34;; import brotliSize from \u0026#34;brotli-size\u0026#34;; export default function bundleCheckerPlugin(options = {}) { const { // æ–‡ä»¶å¤§å°é™åˆ¶ (KB) sizeLimit = 250, // å…³é”®æ–‡ä»¶è·¯å¾„æ¨¡å¼ criticalPathPatterns = [/index\\.[a-f0-9]+\\.js$/], } = options; const fileSizes = new Map(); return { name: \u0026#34;vite-plugin-bundle-checker\u0026#34;, writeBundle(options, bundle) { console.log(\u0026#34;\\nğŸ“¦ Bundle Size Report:\u0026#34;); // æ”¶é›†æ–‡ä»¶å¤§å°ä¿¡æ¯ Object.entries(bundle).forEach(async ([fileName, file]) =\u0026gt; { if (file.type !== \u0026#34;chunk\u0026#34; \u0026amp;\u0026amp; file.type !== \u0026#34;asset\u0026#34;) return; const content = file.code || file.source; if (!content) return; const contentBuffer = typeof content === \u0026#34;string\u0026#34; ? Buffer.from(content) : content; const originalSize = contentBuffer.length; const gzip = await gzipSize(contentBuffer); const brotli = await brotliSize.sync(contentBuffer); fileSizes.set(fileName, { originalSize, gzip, brotli, isCritical: criticalPathPatterns.some((pattern) =\u0026gt; pattern.test(fileName) ), }); }); // æŠ¥å‘Šæ–‡ä»¶å¤§å° const entries = [...fileSizes.entries()]; // å…³é”®æ–‡ä»¶å¤§å°æ£€æŸ¥ const criticalFiles = entries.filter(([_, data]) =\u0026gt; data.isCritical); if (criticalFiles.length \u0026gt; 0) { console.log(\u0026#34;\\nğŸ”‘ Critical Files:\u0026#34;); criticalFiles.forEach(([fileName, { originalSize, gzip, brotli }]) =\u0026gt; { const sizeKB = gzip / 1024; const sizeColor = sizeKB \u0026gt; sizeLimit ? red : sizeKB \u0026gt; sizeLimit * 0.8 ? yellow : green; console.log( `${fileName} - ` + `Original: ${(originalSize / 1024).toFixed(2)} KB, ` + `Gzip: ${sizeColor(sizeKB.toFixed(2))} KB, ` + `Brotli: ${(brotli / 1024).toFixed(2)} KB` ); if (sizeKB \u0026gt; sizeLimit) { console.log(red(` âš ï¸ File size exceeds limit of ${sizeLimit}KB!`)); } }); } // æœ€å¤§çš„5ä¸ªæ–‡ä»¶ const largestFiles = entries .sort((a, b) =\u0026gt; b[1].gzip - a[1].gzip) .slice(0, 5); console.log(\u0026#34;\\nğŸ’¾ Largest Files:\u0026#34;); largestFiles.forEach(([fileName, { originalSize, gzip, brotli }]) =\u0026gt; { console.log( `${fileName} - ` + `Original: ${(originalSize / 1024).toFixed(2)} KB, ` + `Gzip: ${(gzip / 1024).toFixed(2)} KB, ` + `Brotli: ${(brotli / 1024).toFixed(2)} KB` ); }); // æ€»ä½“ç§¯ç»Ÿè®¡ const totalSize = entries.reduce( (sum, [_, data]) =\u0026gt; sum + data.originalSize, 0 ); const totalGzip = entries.reduce((sum, [_, data]) =\u0026gt; sum + data.gzip, 0); const totalBrotli = entries.reduce( (sum, [_, data]) =\u0026gt; sum + data.brotli, 0 ); console.log(\u0026#34;\\nğŸ“Š Total Bundle Size:\u0026#34;); console.log( `Original: ${(totalSize / 1024 / 1024).toFixed(2)} MB, ` + `Gzip: ${(totalGzip / 1024 / 1024).toFixed(2)} MB, ` + `Brotli: ${(totalBrotli / 1024 / 1024).toFixed(2)} MB` ); }, }; } åœ¨ Vite é…ç½®ä¸­é›†æˆè¿™äº›æ’ä»¶ï¼š\n// vite.config.js import { defineConfig } from \u0026#34;vite\u0026#34;; import buildAnalyzerPlugin from \u0026#34;./vite-plugins/vite-plugin-build-analyzer\u0026#34;; import bundleCheckerPlugin from \u0026#34;./vite-plugins/vite-plugin-bundle-checker\u0026#34;; export default defineConfig({ // ... å…¶ä»–é…ç½® plugins: [ // ... å…¶ä»–æ’ä»¶ // ä»…åœ¨åˆ†ææ¨¡å¼ä¸‹å¯ç”¨æ„å»ºåˆ†æ process.env.ANALYZE === \u0026#34;true\u0026#34; \u0026amp;\u0026amp; buildAnalyzerPlugin(), // å§‹ç»ˆæ£€æŸ¥æ‰“åŒ…ä½“ç§¯ bundleCheckerPlugin({ sizeLimit: 200, // 200KBé™åˆ¶ criticalPathPatterns: [/index\\.[a-f0-9]+\\.js$/, /vendor\\.[a-f0-9]+\\.js$/], }), ].filter(Boolean), }); ä¸ƒã€æ€§èƒ½ç›‘æ§ä¸å›å½’æµ‹è¯• ä¸ºç¡®ä¿æŒç»­çš„æ€§èƒ½æå‡ï¼Œæˆ‘ä»¬å®ç°äº†å®Œæ•´çš„æ€§èƒ½ç›‘æ§ç³»ç»Ÿï¼š\n// src/monitoring/performance.ts type PerformanceMetrics = { FCP: number; LCP: number; FID: number; CLS: number; TTFB: number; TTI: number; buildTime?: number; resourcesLoaded?: number; jsExecutionTime?: number; largestContentfulPaint?: { element: string; size: number; time: number; }; longTasks?: Array\u0026lt;{ duration: number; startTime: number; }\u0026gt;; }; class PerformanceMonitor { metrics: Partial\u0026lt;PerformanceMetrics\u0026gt; = {}; constructor() { this.initObservers(); } private initObservers() { // é¦–æ¬¡å†…å®¹ç»˜åˆ¶å’Œé¦–æ¬¡æœ‰æ•ˆç»˜åˆ¶ this.observePaint(); // æœ€å¤§å†…å®¹ç»˜åˆ¶ this.observeLCP(); // é¦–æ¬¡è¾“å…¥å»¶è¿Ÿ this.observeFID(); // ç´¯ç§¯å¸ƒå±€åç§» this.observeCLS(); // é•¿ä»»åŠ¡ this.observeLongTasks(); // é¡µé¢ç”Ÿå‘½å‘¨æœŸ this.observePageLifecycle(); } private observePaint() { const paintObserver = new PerformanceObserver((entries) =\u0026gt; { for (const entry of entries.getEntries()) { if (entry.name === \u0026#34;first-contentful-paint\u0026#34;) { this.metrics.FCP = entry.startTime; } } }); paintObserver.observe({ type: \u0026#34;paint\u0026#34;, buffered: true }); } private observeLCP() { const lcpObserver = new PerformanceObserver((entries) =\u0026gt; { const lastEntry = entries.getEntries().pop(); if (lastEntry) { this.metrics.LCP = lastEntry.startTime; // è®°å½•æœ€å¤§å†…å®¹å…ƒç´ çš„ä¿¡æ¯ if (lastEntry.element) { this.metrics.largestContentfulPaint = { element: this.getElementPath(lastEntry.element), size: lastEntry.size, time: lastEntry.startTime, }; } } }); lcpObserver.observe({ type: \u0026#34;largest-contentful-paint\u0026#34;, buffered: true }); } private observeFID() { const fidObserver = new PerformanceObserver((entries) =\u0026gt; { const firstInput = entries.getEntries()[0]; if (firstInput) { this.metrics.FID = firstInput.processingStart - firstInput.startTime; } }); fidObserver.observe({ type: \u0026#34;first-input\u0026#34;, buffered: true }); } private observeCLS() { let clsValue = 0; let clsEntries = []; const clsObserver = new PerformanceObserver((entries) =\u0026gt; { for (const entry of entries.getEntries()) { if (!entry.hadRecentInput) { clsValue += entry.value; clsEntries.push(entry); } } this.metrics.CLS = clsValue; }); clsObserver.observe({ type: \u0026#34;layout-shift\u0026#34;, buffered: true }); } private observeLongTasks() { const longTaskObserver = new PerformanceObserver((entries) =\u0026gt; { const tasks = entries.getEntries().map((entry) =\u0026gt; ({ duration: entry.duration, startTime: entry.startTime, })); this.metrics.longTasks = [...(this.metrics.longTasks || []), ...tasks]; }); longTaskObserver.observe({ type: \u0026#34;longtask\u0026#34;, buffered: true }); } private observePageLifecycle() { // æ•è·TTFB window.addEventListener(\u0026#34;DOMContentLoaded\u0026#34;, () =\u0026gt; { const navigationEntry = performance.getEntriesByType( \u0026#34;navigation\u0026#34; )[0] as PerformanceNavigationTiming; if (navigationEntry) { this.metrics.TTFB = navigationEntry.responseStart; } }); // æ•è·TTI (è¿‘ä¼¼å€¼) const ttiPolyfill = () =\u0026gt; { const firstContentfulPaint = this.metrics.FCP; if (!firstContentfulPaint) return; let tti = firstContentfulPaint; const longTasks = this.metrics.longTasks || []; // æ‰¾åˆ°FCPä¹‹åçš„æœ€åä¸€ä¸ªé•¿ä»»åŠ¡ for (const task of longTasks) { if (task.startTime \u0026gt; firstContentfulPaint) { tti = Math.max(tti, task.startTime + task.duration); } } this.metrics.TTI = tti; }; // é¡µé¢å®Œå…¨åŠ è½½åè®¡ç®—TTIå’Œæ”¶é›†å…¶ä»–æŒ‡æ ‡ window.addEventListener(\u0026#34;load\u0026#34;, () =\u0026gt; { // è®¡ç®—JavaScriptæ‰§è¡Œæ—¶é—´ const scriptEntries = performance .getEntriesByType(\u0026#34;resource\u0026#34;) .filter((entry) =\u0026gt; entry.initiatorType === \u0026#34;script\u0026#34;); const jsExecutionTime = scriptEntries.reduce( (total, entry) =\u0026gt; total + entry.duration, 0 ); this.metrics.jsExecutionTime = jsExecutionTime; // è®°å½•èµ„æºåŠ è½½æ•°é‡ this.metrics.resourcesLoaded = performance.getEntriesByType(\u0026#34;resource\u0026#34;).length; // è¿‘ä¼¼è®¡ç®—TTI setTimeout(ttiPolyfill, 5000); }); } // è·å–å…ƒç´ è·¯å¾„ private getElementPath(element: Element) { let path = element.tagName.toLowerCase(); if (element.id) { path += `#${element.id}`; } else if (element.className) { path += `.${Array.from(element.classList).join(\u0026#34;.\u0026#34;)}`; } return path; } // æ”¶é›†å¹¶ä¸ŠæŠ¥æ€§èƒ½æŒ‡æ ‡ collectAndSend() { // ç­‰å¾…æ‰€æœ‰æ€§èƒ½æŒ‡æ ‡æ”¶é›†å®Œæˆ setTimeout(() =\u0026gt; { // ä¸ŠæŠ¥åˆ°æ€§èƒ½ç›‘æ§æœåŠ¡ fetch(\u0026#34;/api/performance\u0026#34;, { method: \u0026#34;POST\u0026#34;, headers: { \u0026#34;Content-Type\u0026#34;: \u0026#34;application/json\u0026#34;, }, body: JSON.stringify({ metrics: this.metrics, userAgent: navigator.userAgent, timestamp: Date.now(), url: window.location.href, buildId: window.__BUILD_ID__, // åœ¨æ„å»ºæ—¶æ³¨å…¥ }), // ä½¿ç”¨beacon APIå¦‚æœå¯ç”¨ keepalive: true, }).catch(console.error); }, 10000); } // è·å–å½“å‰æ€§èƒ½æŒ‡æ ‡ getMetrics() { return this.metrics; } } // åˆå§‹åŒ–æ€§èƒ½ç›‘æ§ const performanceMonitor = new PerformanceMonitor(); // é¡µé¢å¸è½½å‰æ”¶é›†å¹¶å‘é€æ•°æ® window.addEventListener(\u0026#34;beforeunload\u0026#34;, () =\u0026gt; { performanceMonitor.collectAndSend(); }); export default performanceMonitor; å…«ã€CI/CD ä¸­çš„æ„å»ºä¼˜åŒ– æˆ‘ä»¬åœ¨ CI/CD æµç¨‹ä¸­ä¹Ÿå®æ–½äº†æ„å»ºä¼˜åŒ–ï¼š\n# .github/workflows/build.yml name: Build and Deploy on: push: branches: [main] pull_request: branches: [main] jobs: build: runs-on: ubuntu-latest steps: - uses: actions/checkout@v2 - name: Setup Node.js uses: actions/setup-node@v2 with: node-version: \u0026#34;16.x\u0026#34; cache: \u0026#34;pnpm\u0026#34; - name: Install pnpm run: npm install -g pnpm - name: Install dependencies run: pnpm install --frozen-lockfile # ç¼“å­˜ä¼˜åŒ– - name: Cache Vite dependencies uses: actions/cache@v2 with: path: | ~/.vite-cache node_modules/.vite key: ${{ runner.os }}-vite-${{ hashFiles(\u0026#39;**/pnpm-lock.yaml\u0026#39;) }} restore-keys: | ${{ runner.os }}-vite- # å¹¶è¡Œç±»å‹æ£€æŸ¥ä¸æ„å»º - name: Type Check and Build run: | mkdir -p build-output # å¹¶è¡Œè¿è¡Œç±»å‹æ£€æŸ¥å’Œæ„å»º pnpm run typecheck \u0026gt; build-output/typecheck.log \u0026amp; pnpm run build \u0026gt; build-output/build.log wait # åˆ†ææ„å»ºäº§ç‰© - name: Analyze Build Output run: | echo \u0026#34;::group::Build Results\u0026#34; grep -A 10 \u0026#34;vite v\u0026#34; build-output/build.log echo \u0026#34;::endgroup::\u0026#34; # æå–æ„å»ºæ€§èƒ½æŒ‡æ ‡ BUILD_TIME=$(grep \u0026#34;built in\u0026#34; build-output/build.log | sed -n \u0026#39;s/.*built in \\([0-9.]*\\)s.*/\\1/p\u0026#39;) echo \u0026#34;Build time: ${BUILD_TIME}s\u0026#34; # æ£€æŸ¥æ„å»ºäº§ç‰©å¤§å° echo \u0026#34;::group::Bundle Size\u0026#34; du -h -d 1 dist/ gzip -c dist/static/js/index.*.js | wc -c | awk \u0026#39;{print \u0026#34;Main bundle gzipped: \u0026#34; $1/1024 \u0026#34; KB\u0026#34;}\u0026#39; echo \u0026#34;::endgroup::\u0026#34; # å­˜å‚¨æ„å»ºäº§ç‰© - name: Upload build artifacts uses: actions/upload-artifact@v2 with: name: build-artifacts path: | dist build-output stats.html ä¹ã€ç»“æœä¸ç»éªŒæ€»ç»“ ç»è¿‡å…¨é¢ä¼˜åŒ–åï¼Œæˆ‘ä»¬å–å¾—äº†æ˜¾è‘—çš„æ€§èƒ½æå‡ï¼š\næŒ‡æ ‡ ä¼˜åŒ–å‰ ä¼˜åŒ–å æå‡ å®Œå…¨æ„å»ºæ—¶é—´ 126 ç§’ 8 ç§’ 95.7% å¼€å‘æœåŠ¡å™¨å¯åŠ¨ 25.3 ç§’ 3.1 ç§’ 87.7% çƒ­æ›´æ–°å“åº” 3.8 ç§’ 0.3 ç§’ 92.1% é¦–æ¬¡å†…å®¹ç»˜åˆ¶ 2.8 ç§’ 0.7 ç§’ 75.0% æœ€å¤§å†…å®¹ç»˜åˆ¶ 5.2 ç§’ 1.3 ç§’ 75.0% æ€»é˜»å¡æ—¶é—´ 850ms 120ms 85.9% é¦–å± JS æ‰§è¡Œæ—¶é—´ 1.2 ç§’ 0.3 ç§’ 75.0% ä¸»åŒ…å¤§å°(gzip) 1.2MB 280KB 76.7% æ•´ä½“åŒ…å¤§å°(gzip) 2.8MB 790KB 71.8% å…³é”®ç»éªŒæ€»ç»“ æ„å»ºä¼˜åŒ–å¿…é¡»å…¨æ–¹ä½ï¼šä» Vite é…ç½®åˆ°ä»£ç ç»“æ„ï¼Œå†åˆ°èµ„æºå¤„ç†ï¼Œæ¯ä¸ªç¯èŠ‚éƒ½éœ€è¦ä¼˜åŒ–ã€‚ åˆ†æå…ˆè¡Œï¼šä½¿ç”¨å¯è§†åŒ–å·¥å…·ç¡®å®šç“¶é¢ˆï¼Œæœ‰çš„æ”¾çŸ¢åœ°è¿›è¡Œä¼˜åŒ–ã€‚ ä»£ç åˆ†å‰²æ˜¯å…³é”®ï¼šåˆç†çš„ä»£ç åˆ†å‰²ç­–ç•¥å¯¹åˆå§‹åŠ è½½æ€§èƒ½è‡³å…³é‡è¦ã€‚ ä¾èµ–ç®¡ç†éœ€è°¨æ…ï¼šä¾èµ–åŒ…ä½“ç§¯å’Œè´¨é‡ç›´æ¥å½±å“æ„å»ºå’Œè¿è¡Œæ€§èƒ½ã€‚ ç¼“å­˜ç­–ç•¥é«˜æ•ˆåŒ–ï¼šå……åˆ†åˆ©ç”¨å¤šçº§ç¼“å­˜æœºåˆ¶ï¼Œå‡å°‘é‡å¤å·¥ä½œã€‚ æ‡’åŠ è½½å¿…ä¸å¯å°‘ï¼šéé¦–å±å†…å®¹å»¶è¿ŸåŠ è½½å¯å¤§å¹…æå‡åˆå§‹æ¸²æŸ“é€Ÿåº¦ã€‚ é™æ€èµ„æºä¼˜åŒ–ï¼šå›¾ç‰‡ã€å­—ä½“ç­‰èµ„æºä¼˜åŒ–å¯¹æ•´ä½“åŠ è½½æ—¶é—´å½±å“å·¨å¤§ã€‚ ç›‘æ§ä¸æŒç»­ä¼˜åŒ–ï¼šå»ºç«‹æ€§èƒ½ç›‘æ§ç³»ç»Ÿï¼Œç¡®ä¿æ€§èƒ½ä¸ä¼šéšæ—¶é—´è¡°é€€ã€‚ å·¥ä½œæµç¨‹æ ‡å‡†åŒ–ï¼šå°†ä¼˜åŒ–æªæ–½é›†æˆåˆ° CI/CD æµç¨‹ï¼Œä¿è¯ä»£ç è´¨é‡ã€‚ å¹³è¡¡å¼€å‘ä½“éªŒä¸æ€§èƒ½ï¼šä¼˜åŒ–ä¸åº”ä»¥ç‰ºç‰²å¼€å‘æ•ˆç‡ä¸ºä»£ä»·ã€‚ åã€æœªæ¥ä¼˜åŒ–æ–¹å‘ è™½ç„¶å·²ç»å–å¾—äº†æ˜¾è‘—æˆæœï¼Œä½†æˆ‘ä»¬ä»åœ¨æ¢ç´¢æ›´å¤šä¼˜åŒ–ç©ºé—´ï¼š\nåŸºäº Web Assembly çš„æ€§èƒ½å…³é”®è·¯å¾„ï¼šå°†è®¡ç®—å¯†é›†å‹ä»»åŠ¡ç§»è‡³ WASM æ‰§è¡Œã€‚\nVite 3 æ¢ç´¢ï¼šåˆ©ç”¨ Vite 3 çš„æ–°ç‰¹æ€§è¿›ä¸€æ­¥æå‡æ„å»ºæ€§èƒ½ã€‚\næœåŠ¡ç«¯ç»„ä»¶ï¼šå°†éƒ¨åˆ† React ç»„ä»¶è¿ç§»åˆ°æœåŠ¡ç«¯æ¸²æŸ“ï¼Œå‡è½»å®¢æˆ·ç«¯è´Ÿæ‹…ã€‚\næµå¼æ¸²æŸ“ï¼šå®ç°æµå¼ SSRï¼Œæå‰å±•ç¤ºéƒ¨åˆ†å†…å®¹ã€‚\næ›´æ™ºèƒ½çš„é¢„åŠ è½½ï¼šåŸºäºç”¨æˆ·è¡Œä¸ºé¢„æµ‹å®ç°æ›´ç²¾å‡†çš„èµ„æºé¢„åŠ è½½ã€‚\nä½“ç§¯é¢„ç®—ç³»ç»Ÿï¼šä¸ºæ¯ä¸ªæ¨¡å—è®¾å®šä¸¥æ ¼çš„ä½“ç§¯é¢„ç®—ï¼Œè‡ªåŠ¨é¢„è­¦è¶…å‡ºé™åˆ¶çš„å˜æ›´ã€‚\nç¼–è¯‘æ—¶ä¼˜åŒ–ï¼šæ¢ç´¢æ›´å¤šç¼–è¯‘æ—¶ä¼˜åŒ–æŠ€æœ¯ï¼Œå¦‚é™æ€åˆ†æå»é™¤æœªä½¿ç”¨ä»£ç ã€‚\næ€»ç»“ ä¼˜åŒ– Vite æ„å»ºçš„ React é¡¹ç›®æ˜¯ä¸€é¡¹å…¨æ–¹ä½çš„å·¥ä½œï¼Œéœ€è¦ä» Vite é…ç½®ã€ä»£ç ç»“æ„ã€èµ„æºç®¡ç†ã€ç¼“å­˜ç­–ç•¥ç­‰å¤šä¸ªç»´åº¦è¿›è¡Œã€‚é€šè¿‡ç²¾ç»†è°ƒæ•´å’Œé‡æ„ï¼Œæˆ‘ä»¬å°†æ„å»ºæ—¶é—´ä» 2 åˆ†é’Ÿå‡å°‘åˆ° 8 ç§’ï¼Œæ˜¾è‘—æå‡äº†å¼€å‘ä½“éªŒå’Œç”¨æˆ·ä½“éªŒã€‚\næœ€é‡è¦çš„æ˜¯ï¼Œè¿™äº›ä¼˜åŒ–æªæ–½ä¸ä»…å¯¹å•ä¸ªé¡¹ç›®æœ‰æ•ˆï¼Œæ›´å½¢æˆäº†ä¸€å¥—å¯å¤ç”¨çš„ Vite é¡¹ç›®ä¼˜åŒ–æ–¹æ³•è®ºï¼Œå¯ä»¥åº”ç”¨åˆ°å›¢é˜Ÿçš„å…¶ä»–é¡¹ç›®ä¸­ï¼Œå…¨é¢æå‡å‰ç«¯å¼€å‘çš„æ•ˆç‡å’Œè´¨é‡ã€‚\næ€§èƒ½ä¼˜åŒ–ä¸æ˜¯ä¸€è¹´è€Œå°±çš„ï¼Œè€Œæ˜¯éœ€è¦æŒç»­å…³æ³¨å’Œæ”¹è¿›çš„å·¥ç¨‹å®è·µã€‚éšç€é¡¹ç›®çš„å‘å±•ï¼Œæˆ‘ä»¬ä¼šç»§ç»­æ¢ç´¢æ–°çš„ä¼˜åŒ–æŠ€æœ¯å’Œæ–¹æ³•ï¼Œä¸æ–­æå‡åº”ç”¨çš„æ€§èƒ½è¡¨ç°ã€‚\nç›¸å…³é˜…è¯» ç°ä»£å‰ç«¯æ¶æ„è®¾è®¡ä¸æ€§èƒ½ä¼˜åŒ– - äº†è§£æ›´å¤šå‰ç«¯æ€§èƒ½ä¼˜åŒ–æŠ€å·§ ç°ä»£å‰ç«¯å·¥ç¨‹åŒ–å®è·µæŒ‡å— - æ¢ç´¢å‰ç«¯å·¥ç¨‹åŒ–çš„å…¨é¢è§£å†³æ–¹æ¡ˆ æµè§ˆå™¨æ¸²æŸ“æœºåˆ¶æ·±åº¦å‰–æ - ç†è§£æµè§ˆå™¨æ¸²æŸ“åŸç†ï¼Œæå‡åŠ è½½æ€§èƒ½ ","permalink":"https://www.yss520.online/zh/posts/vite-compile-optimization/","summary":"\u003ch1 id=\"vite-æ„å»º-react-é¡¹ç›®çš„æè‡´ä¼˜åŒ–ä»-2-åˆ†é’Ÿåˆ°-8-ç§’çš„æ„å»ºé©å‘½\"\u003eVite æ„å»º React é¡¹ç›®çš„æè‡´ä¼˜åŒ–ï¼šä» 2 åˆ†é’Ÿåˆ° 8 ç§’çš„æ„å»ºé©å‘½\u003c/h1\u003e\n\u003cp\u003eæˆ‘ä»¬çš„ç³»ç»Ÿæ˜¯ä¸€ä¸ªä½¿ç”¨ Vite æ„å»ºçš„ React åº”ç”¨ï¼ŒåŒ…å«è¶…è¿‡ 200 ä¸ªé¡µé¢ã€300+ç»„ä»¶ï¼Œéšç€ä¸šåŠ¡çš„å¿«é€Ÿå¢é•¿ï¼Œå¼€å‘å›¢é˜Ÿé¢ä¸´ç€ä¸¥å³»çš„æ€§èƒ½æŒ‘æˆ˜ï¼š\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eæœ¬åœ°å¼€å‘æœåŠ¡å™¨å¯åŠ¨æ—¶é—´è¶…è¿‡ 25 ç§’\u003c/li\u003e\n\u003cli\u003eå¼€å‘è¿‡ç¨‹ä¸­çš„çƒ­æ›´æ–°å»¶è¿Ÿ 3-5 ç§’\u003c/li\u003e\n\u003cli\u003eç”Ÿäº§ç¯å¢ƒæ„å»ºè€—æ—¶è¶…è¿‡ 2 åˆ†é’Ÿ\u003c/li\u003e\n\u003cli\u003eé¦–å±åŠ è½½æ—¶é—´è¶…è¿‡ 5 ç§’\u003c/li\u003e\n\u003cli\u003eæ„å»ºäº§ç‰©è¶…è¿‡ 8MBï¼ˆgzip å 2.8MBï¼‰\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eäº§å“ç»ç†æŠ±æ€¨åŠŸèƒ½è¿­ä»£é€Ÿåº¦å¤ªæ…¢ï¼Œå¼€å‘äººå‘˜åˆ™ç—›è‹¦åœ°ç­‰å¾…æ¯ä¸€æ¬¡æ„å»ºï¼Œæµ‹è¯•å›¢é˜Ÿéœ€è¦å¿å—é¢‘ç¹çš„éƒ¨ç½²å»¶è¿Ÿã€‚å½“æˆ‘å°è¯•ç†è§£ä»£ç åº“æ—¶ï¼Œå‘ç°è¿™ä¸ªé¡¹ç›®ä½¿ç”¨äº†åŸºç¡€çš„ Vite é…ç½®ï¼Œå‡ ä¹æ²¡æœ‰è¿›è¡Œä»»ä½•ä¼˜åŒ–ã€‚\u003c/p\u003e\n\u003cp\u003eä»Šå¤©ï¼Œæˆ‘æƒ³åˆ†äº«å¦‚ä½•å°†è¿™ä¸ªé¡¹ç›®çš„æ„å»ºæ—¶é—´ä» 2 åˆ†é’Ÿé™è‡³ 8 ç§’ï¼Œå¼€å‘æœåŠ¡å™¨å¯åŠ¨æ—¶é—´é™è‡³ 3 ç§’ï¼ŒåŒæ—¶å°†é¦–å±åŠ è½½é€Ÿåº¦æå‡ 300%çš„å…¨è¿‡ç¨‹ã€‚\u003c/p\u003e\n\u003ch2 id=\"ä¸€é¡¹ç›®åˆå§‹çŠ¶æ€åˆ†æ\"\u003eä¸€ã€é¡¹ç›®åˆå§‹çŠ¶æ€åˆ†æ\u003c/h2\u003e\n\u003cp\u003eé¦–å…ˆï¼Œæˆ‘è¿›è¡Œäº†å…¨é¢çš„æ€§èƒ½åˆ†æï¼Œç¡®å®šç“¶é¢ˆæ‰€åœ¨ï¼š\u003c/p\u003e\n\u003ch3 id=\"1-æ„å»ºåˆ†æ\"\u003e1. æ„å»ºåˆ†æ\u003c/h3\u003e\n\u003cp\u003eä½¿ç”¨\u003ccode\u003erollup-plugin-visualizer\u003c/code\u003eåˆ›å»ºæ„å»ºåˆ†ææŠ¥å‘Šï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-javascript\" data-lang=\"javascript\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e// vite.config.js åˆå§‹çŠ¶æ€\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003eimport\u003c/span\u003e { \u003cspan style=\"color:#a6e22e\"\u003edefineConfig\u003c/span\u003e } \u003cspan style=\"color:#a6e22e\"\u003efrom\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;vite\u0026#34;\u003c/span\u003e;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003eimport\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003ereact\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003efrom\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;@vitejs/plugin-react\u0026#34;\u003c/span\u003e;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003eexport\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003edefault\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003edefineConfig\u003c/span\u003e({\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#a6e22e\"\u003eplugins\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e:\u003c/span\u003e [\u003cspan style=\"color:#a6e22e\"\u003ereact\u003c/span\u003e()],\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#a6e22e\"\u003ebuild\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e:\u003c/span\u003e {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#a6e22e\"\u003eminify\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e:\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;terser\u0026#34;\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  },\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e});\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eåˆ†æç»“æœä»¤äººéœ‡æƒŠï¼š\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eä¾èµ–åŒ…å æ€»ä½“ç§¯çš„ 76%ï¼Œå…¶ä¸­æœ‰å¤šä¸ªé‡å¤ä¾èµ–\u003c/li\u003e\n\u003cli\u003eä¸» bundle æ–‡ä»¶è¶…è¿‡ 3MB\u003c/li\u003e\n\u003cli\u003eå›¾ç‰‡å’Œå­—ä½“èµ„æºæœªç»ä¼˜åŒ–ï¼Œå æ€»ä½“ç§¯çš„ 22%\u003c/li\u003e\n\u003cli\u003eReact ç»„ä»¶æœªåˆ†å‰²ï¼Œå¯¼è‡´é¦–å±éœ€è¦åŠ è½½å¤§é‡éå¿…è¦ä»£ç \u003c/li\u003e\n\u003cli\u003eæœªä½¿ç”¨ç¼“å­˜ç­–ç•¥ï¼Œæ¯æ¬¡æ„å»ºéƒ½æ˜¯ä»é›¶å¼€å§‹\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"2-æ€§èƒ½æŒ‡æ ‡åŸºçº¿\"\u003e2. æ€§èƒ½æŒ‡æ ‡åŸºçº¿\u003c/h3\u003e\n\u003cp\u003eä½¿ç”¨ Lighthouse å’Œè‡ªå®šä¹‰æ€§èƒ½ç›‘æ§å·¥å…·æ”¶é›†çš„åŸºçº¿æŒ‡æ ‡ï¼š\u003c/p\u003e","title":"Viteæ„å»ºReacté¡¹ç›®çš„æè‡´ä¼˜åŒ–"},{"content":"å‰ç«¯å®‰å…¨æŠ¤åŸæ²³ï¼šä»ä¸€åœºå®‰å…¨å±æœºåˆ°ä½“ç³»åŒ–è§£å†³æ–¹æ¡ˆ å®‰å…¨æ˜¯æ¯ä¸€ä¸ªå¼€å‘ç¦»ä¸å¼€çš„è¯é¢˜ï¼Œç»“åˆè¿™äº›å¹´çš„å¼€å‘ç»ç†å’Œä¸€äº›å®æˆ˜ç»éªŒï¼Œåˆ†äº«ä¸€äº›å…³äºå‰ç«¯çš„å®‰å…¨æ€è€ƒ\nå®‰å…¨äº‹ä»¶å‰–æï¼šçœ‹ä¼¼ç®€å•çš„æ¼æ´ï¼Œç¾éš¾æ€§çš„åæœ äº‹ä»¶èµ·å› çœ‹ä¼¼ç®€å•ï¼šç®¡ç†åå°çš„æœç´¢åŠŸèƒ½ç›´æ¥å±•ç¤ºäº†ç”¨æˆ·è¾“å…¥ï¼Œæ²¡æœ‰ä»»ä½•è¿‡æ»¤ã€‚æ”»å‡»è€…é€šè¿‡ç²¾å¿ƒæ„é€ çš„æœç´¢è¯ï¼Œæ³¨å…¥äº†æ¶æ„ JavaScriptï¼Œè¿›è€Œè·å–äº†ç®¡ç†å‘˜çš„è®¤è¯ä»¤ç‰Œï¼Œæœ€ç»ˆå¯¼è‡´å¤§é‡ç”¨æˆ·æ•°æ®æ³„éœ²ã€‚\n// åŸå§‹çš„ä¸å®‰å…¨ä»£ç  function SearchResults({ query }) { return ( \u0026lt;div\u0026gt; \u0026lt;h2\u0026gt;æœç´¢ç»“æœ: {query}\u0026lt;/h2\u0026gt; {/* ç›´æ¥æ³¨å…¥ç”¨æˆ·è¾“å…¥ï¼Œå¯¼è‡´XSSæ¼æ´ */} \u0026lt;div className=\u0026#34;results\u0026#34;\u0026gt;{/* æœç´¢ç»“æœ */}\u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; ); } è¿™ä¸ªç®€å•æ¼æ´åªæ˜¯å†°å±±ä¸€è§’ã€‚å®‰å…¨å®¡è®¡å‘ç°äº†è¶…è¿‡ 30 ä¸ªä¸¥é‡æ¼æ´ï¼ŒåŒ…æ‹¬å¤šå¤„ XSSã€CSRFã€æ•æ„Ÿä¿¡æ¯æ³„éœ²ã€ä¸å®‰å…¨çš„ç¬¬ä¸‰æ–¹ä¾èµ–ç­‰ã€‚æ˜¾ç„¶ï¼Œè¿™ä¸æ˜¯ä¿®è¡¥å‡ ä¸ªæ¼æ´å°±èƒ½è§£å†³çš„é—®é¢˜ï¼Œè€Œæ˜¯éœ€è¦ç³»ç»Ÿæ€§é‡æ„ã€‚\nå»ºç«‹å…¨é¢å®‰å…¨é˜²æŠ¤ä½“ç³» æˆ‘ä»¬æ„å»ºäº†ä¸€ä¸ªå¤šå±‚æ¬¡çš„å‰ç«¯å®‰å…¨é˜²æŠ¤ä½“ç³»ï¼Œä»ä»£ç çº§åˆ«ã€æ¶æ„å±‚é¢å’Œè¿è¡Œç¯å¢ƒä¸‰ä¸ªç»´åº¦å…¨é¢åŠ å›ºåº”ç”¨ã€‚\n1. XSS é˜²å¾¡ï¼šä¸ä»…ä»…æ˜¯è½¬ä¹‰ XSSï¼ˆè·¨ç«™è„šæœ¬æ”»å‡»ï¼‰ä»ç„¶æ˜¯å‰ç«¯æœ€å¸¸è§ä¸”å±å®³æœ€å¤§çš„å®‰å…¨å¨èƒã€‚åŸæœ‰é¡¹ç›®ä¸­å‘ç°äº† 12 å¤„ XSS æ¼æ´ï¼Œä¸»è¦é›†ä¸­åœ¨ä»¥ä¸‹å‡ ä¸ªæ–¹é¢ï¼š\nç›´æ¥å°†ç”¨æˆ·è¾“å…¥æ³¨å…¥ DOM å±é™©çš„innerHTMLä½¿ç”¨ ä¸å®‰å…¨çš„ç¬¬ä¸‰æ–¹å†…å®¹åµŒå…¥ åå°„å‹ XSS é€šè¿‡ URL å‚æ•°æ³¨å…¥ è§£å†³æ–¹æ¡ˆè¿œä¸æ­¢ç®€å•çš„ HTML è½¬ä¹‰ï¼š\n// å®‰å…¨æ”¹é€ åçš„æ¨¡å¼ import DOMPurify from \u0026#34;dompurify\u0026#34;; import { encodeHTML } from \u0026#34;./security-utils\u0026#34;; // 1. é»˜è®¤è¿›è¡ŒHTMLç¼–ç  function SafeText({ text }) { return \u0026lt;span\u0026gt;{encodeHTML(text)}\u0026lt;/span\u0026gt;; } // 2. å¿…é¡»æ˜¾å¼é€‰æ‹©æ˜¯å¦ä¿¡ä»»å†…å®¹ function RichContent({ htmlContent, trusted = false }) { if (trusted) { // å³ä½¿æ˜¯\u0026#34;å¯ä¿¡\u0026#34;å†…å®¹ä¹Ÿè¿›è¡Œæ¸…ç† const sanitized = DOMPurify.sanitize(htmlContent, { ALLOWED_TAGS: [\u0026#34;b\u0026#34;, \u0026#34;i\u0026#34;, \u0026#34;em\u0026#34;, \u0026#34;strong\u0026#34;, \u0026#34;a\u0026#34;, \u0026#34;p\u0026#34;, \u0026#34;ul\u0026#34;, \u0026#34;ol\u0026#34;, \u0026#34;li\u0026#34;], ALLOWED_ATTR: [\u0026#34;href\u0026#34;, \u0026#34;target\u0026#34;, \u0026#34;rel\u0026#34;], }); return \u0026lt;div dangerouslySetInnerHTML={{ __html: sanitized }} /\u0026gt;; } // éå¯ä¿¡å†…å®¹åªæ˜¾ç¤ºçº¯æ–‡æœ¬ return \u0026lt;div\u0026gt;{encodeHTML(htmlContent)}\u0026lt;/div\u0026gt;; } æ›´é‡è¦çš„æ˜¯ï¼Œæˆ‘ä»¬å»ºç«‹äº†å®‰å…¨ç¼–ç è§„èŒƒå’Œè‡ªåŠ¨åŒ–æ£€æµ‹æœºåˆ¶ï¼š\nå¼ºåˆ¶ä½¿ç”¨å®‰å…¨ç»„ä»¶ï¼šæ‰€æœ‰å¼€å‘è€…å¿…é¡»ä½¿ç”¨ç»è¿‡å®‰å…¨å®¡æŸ¥çš„ç»„ä»¶åº“ é™æ€ä»£ç æ‰«æï¼šåœ¨ CI æµç¨‹ä¸­é›†æˆäº†é’ˆå¯¹ XSS çš„è‡ªåŠ¨åŒ–æ£€æµ‹ å®‰å…¨é’©å­ï¼šå¼€å‘äº†useSecureContentç­‰é’©å­ï¼Œç®€åŒ–å®‰å…¨å¤„ç† è¿è¡Œæ—¶æ£€æµ‹ï¼šå®ç° DOM ä¿®æ”¹ç›‘æ§ï¼Œæ£€æµ‹å¯ç–‘æ³¨å…¥ è¿™ç§å¤šå±‚æ¬¡æ–¹æ¡ˆå°† XSS æ¼æ´å‘ç°ç‡æé«˜äº† 95%ï¼Œæœ‰æ•ˆæ¼æ´å‡å°‘äº† 98%ã€‚\n2. CSRF é˜²å¾¡ï¼šä»¤ç‰Œåªæ˜¯å¼€å§‹ è·¨ç«™è¯·æ±‚ä¼ªé€ (CSRF)æ˜¯å¦ä¸€ä¸ªå¸¸è§å¨èƒã€‚åŸç³»ç»Ÿåªåœ¨æŸäº› API ä¸Šå®ç°äº†ç®€å•çš„ä»¤ç‰ŒéªŒè¯ï¼Œä½†å­˜åœ¨å¤šä¸ªæ¼æ´ï¼š\nä»¤ç‰Œåœ¨æ‰€æœ‰åŸŸåä¸‹å…±äº«ï¼Œå®¹æ˜“è¢«ç¬¬ä¸‰æ–¹ç«™ç‚¹è·å– ä»¤ç‰Œæ°¸ä¸è¿‡æœŸï¼Œä¸€æ—¦æ³„éœ²å°†é•¿æœŸæœ‰æ•ˆ æ²¡æœ‰ç»‘å®šè¯·æ±‚ä¿¡æ¯ï¼Œå¯ä»¥è¢«é‡æ”¾æ”»å‡» æˆ‘ä»¬å®æ–½äº†å…¨é¢çš„ CSRF é˜²æŠ¤ç­–ç•¥ï¼š\n// æ”¹è¿›çš„CSRFé˜²æŠ¤ç­–ç•¥ function initSecurityMiddleware() { // 1. é’ˆå¯¹æ¯ä¸ªä¼šè¯ç”Ÿæˆå”¯ä¸€ä»¤ç‰Œ const csrfToken = generateSecureToken(32); // 2. è®¾ç½®ä¸¥æ ¼çš„Cookieå±æ€§ document.cookie = `X-CSRF-TOKEN=${csrfToken}; SameSite=Strict; Secure; Path=/`; // 3. å°†ä»¤ç‰ŒåµŒå…¥åˆ°æ¯ä¸ªè¯·æ±‚ä¸­ axios.interceptors.request.use((config) =\u0026gt; { // æ·»åŠ æ ‡å‡†å¤´éƒ¨ config.headers[\u0026#34;X-CSRF-TOKEN\u0026#34;] = csrfToken; // å¯¹äºé‡è¦æ“ä½œï¼Œæ·»åŠ é¢å¤–çš„è¯·æ±‚ç­¾å if (config.method !== \u0026#34;get\u0026#34;) { const timestamp = Date.now(); const requestData = JSON.stringify(config.data || {}); config.headers[\u0026#34;X-Request-Signature\u0026#34;] = generateRequestSignature( csrfToken, config.url, requestData, timestamp ); config.headers[\u0026#34;X-Request-Timestamp\u0026#34;] = timestamp; } return config; }); } å…³é”®æ”¹è¿›ï¼š\nä½¿ç”¨SameSite=StrictCookie é˜»æ­¢è·¨ç«™è¯·æ±‚æºå¸¦å‡­è¯ å¯¹é‡è¦æ“ä½œå®æ–½åŒé‡éªŒè¯ï¼ˆä»¤ç‰Œ+è¯·æ±‚ç­¾åï¼‰ é€šè¿‡æ—¶é—´æˆ³é˜²æ­¢é‡æ”¾æ”»å‡» æœåŠ¡ç«¯éªŒè¯è¯·æ±‚æ¥æº(Refererå’ŒOriginå¤´) è¿™äº›æªæ–½ç»“åˆèµ·æ¥ï¼Œä¸ä»…é˜²å¾¡äº†åŸºæœ¬ CSRF æ”»å‡»ï¼Œè¿˜èƒ½æŠµæŠ—æ›´å¤æ‚çš„å˜ç§æ”»å‡»ã€‚å®æ–½åï¼Œå®‰å…¨æµ‹è¯•æ— æ³•å†å¤ç°ä»»ä½• CSRF æ¼æ´ã€‚\n3. ç‚¹å‡»åŠ«æŒä¸ UI é˜²å¾¡ ç‚¹å‡»åŠ«æŒ(Clickjacking)æ˜¯ä¸€ç§å¸¸è¢«å¿½è§†çš„å¨èƒã€‚å®‰å…¨å®¡è®¡å‘ç°ï¼Œç½‘ç«™å¯ä»¥è¢«åµŒå…¥åˆ°ä»»ä½•ç¬¬ä¸‰æ–¹ç½‘é¡µä¸­ï¼Œæ”»å‡»è€…å¯ä»¥è¯±å¯¼ç”¨æˆ·ç‚¹å‡»çœ‹ä¸è§çš„æŒ‰é’®ã€‚\né™¤äº†å¸¸è§„çš„X-Frame-Optionså¤´éƒ¨å¤–ï¼Œæˆ‘ä»¬å®æ–½äº†å¤šå±‚é˜²å¾¡ï¼š\n// å‰ç«¯é˜²æ­¢ç‚¹å‡»åŠ«æŒçš„é¢å¤–ä¿æŠ¤ function FrameBuster() { useEffect(() =\u0026gt; { // 1. æ£€æµ‹å½“å‰çª—å£æ˜¯å¦è¢«åµŒå…¥iframe if (window.self !== window.top) { // å¦‚æœè¢«åµŒå…¥ï¼Œå°è¯•ç ´æ¡†è€Œå‡º window.top.location = window.self.location; } // 2. æŒç»­ç›‘æ§ï¼Œé˜²æ­¢è¿è¡Œæ—¶è¢«åµŒå…¥ const checkFraming = setInterval(() =\u0026gt; { if (window.self !== window.top) { // å¦‚æœæ£€æµ‹åˆ°è¢«åµŒå…¥ï¼Œå¯ä»¥: // - å°è¯•ç ´æ¡† // - æ˜¾ç¤ºè­¦å‘Š // - ç¦ç”¨æ•æ„ŸåŠŸèƒ½ document.body.innerHTML = \u0026#34;\u0026lt;h1\u0026gt;Security Alert: This site has been compromised!\u0026lt;/h1\u0026gt;\u0026#34;; } }, 5000); return () =\u0026gt; clearInterval(checkFraming); }, []); return null; } æˆ‘ä»¬è¿˜å®ç°äº†æ•æ„Ÿæ“ä½œçš„é¢å¤–ç¡®è®¤æœºåˆ¶ï¼š\né‡è¦æ“ä½œå¼ºåˆ¶äºŒæ¬¡ç¡®è®¤ å…³é”®åŠŸèƒ½è¦æ±‚è¾“å…¥å£ä»¤æˆ– 2FA éªŒè¯ é£é™©æ“ä½œæ·»åŠ äººæœºéªŒè¯(CAPTCHA) ç»“åˆæœåŠ¡ç«¯çš„ CSP ç­–ç•¥ï¼Œè¿™äº›æªæ–½æœ‰æ•ˆé˜²æ­¢äº†æ¡†æ¶åµŒå…¥å’Œ UI æ”»å‡»ã€‚\n4. æ•æ„Ÿæ•°æ®ä¿æŠ¤ï¼šä¸€åˆ‡çš†å¯æ³„éœ² å®‰å…¨å®¡è®¡æœ€ä»¤äººæ‹…å¿§çš„å‘ç°æ˜¯å¤§é‡æ•æ„Ÿæ•°æ®ç›´æ¥æš´éœ²åœ¨å‰ç«¯ä»£ç å’Œæœ¬åœ°å­˜å‚¨ä¸­ã€‚é¡¹ç›®ä¸­å­˜åœ¨ï¼š\nAPI å“åº”åŒ…å«ä¸å¿…è¦çš„æ•æ„Ÿå­—æ®µ ä¸ªäººä¿¡æ¯å’Œä»¤ç‰Œæ˜æ–‡å­˜å‚¨åœ¨ localStorage æ•æ„Ÿä¿¡æ¯ç›´æ¥æ‰“å°åˆ°æ§åˆ¶å°æ—¥å¿— è°ƒè¯•æ¨¡å¼æœªåœ¨ç”Ÿäº§ç¯å¢ƒç¦ç”¨ æˆ‘ä»¬å®æ–½äº†å…¨é¢çš„æ•æ„Ÿæ•°æ®ä¿æŠ¤ç­–ç•¥ï¼š\n// æ•æ„Ÿæ•°æ®å¤„ç†å™¨ const sensitiveDataManager = { // 1. æ•æ„Ÿæ•°æ®å­˜å‚¨å°è£… store: (key, data, options = {}) =\u0026gt; { const { expiry, sensitive = false } = options; if (sensitive) { // æ•æ„Ÿæ•°æ®åŠ å¯†å­˜å‚¨ï¼Œä½¿ç”¨ä¸´æ—¶ä¼šè¯å­˜å‚¨ const encryptedData = encryptData( JSON.stringify(data), getEncryptionKey() ); sessionStorage.setItem(`secure:${key}`, encryptedData); // è®¾ç½®è¿‡æœŸæ—¶é—´ if (expiry) { const expiryTime = Date.now() + expiry * 1000; sessionStorage.setItem(`secure:${key}:expiry`, expiryTime.toString()); } } else { // éæ•æ„Ÿæ•°æ®å¯ä»¥ä½¿ç”¨localStorage localStorage.setItem( key, JSON.stringify({ data, expiry: expiry ? Date.now() + expiry * 1000 : null, }) ); } }, // 2. å®‰å…¨æ•°æ®è·å– retrieve: (key, options = {}) =\u0026gt; { const { sensitive = false } = options; try { if (sensitive) { // æ£€æŸ¥æ•æ„Ÿæ•°æ®æ˜¯å¦è¿‡æœŸ const expiryTime = sessionStorage.getItem(`secure:${key}:expiry`); if (expiryTime \u0026amp;\u0026amp; parseInt(expiryTime) \u0026lt; Date.now()) { sessionStorage.removeItem(`secure:${key}`); sessionStorage.removeItem(`secure:${key}:expiry`); return null; } // è§£å¯†å¹¶è¿”å›æ•°æ® const encryptedData = sessionStorage.getItem(`secure:${key}`); if (!encryptedData) return null; return JSON.parse(decryptData(encryptedData, getEncryptionKey())); } else { // è·å–éæ•æ„Ÿæ•°æ® const item = localStorage.getItem(key); if (!item) return null; const { data, expiry } = JSON.parse(item); // æ£€æŸ¥æ˜¯å¦è¿‡æœŸ if (expiry \u0026amp;\u0026amp; expiry \u0026lt; Date.now()) { localStorage.removeItem(key); return null; } return data; } } catch (error) { // å®‰å…¨é™çº§ - å¤±è´¥æ—¶åˆ é™¤å¯èƒ½æŸåçš„æ•°æ® if (sensitive) { sessionStorage.removeItem(`secure:${key}`); sessionStorage.removeItem(`secure:${key}:expiry`); } else { localStorage.removeItem(key); } return null; } }, // 3. å®‰å…¨æ•°æ®æ¸…é™¤ clear: (pattern, options = {}) =\u0026gt; { const { sensitive = false } = options; if (sensitive) { // æ¸…é™¤åŒ¹é…çš„æ•æ„Ÿæ•°æ® Object.keys(sessionStorage).forEach((key) =\u0026gt; { if (key.startsWith(\u0026#34;secure:\u0026#34;) \u0026amp;\u0026amp; key.includes(pattern)) { sessionStorage.removeItem(key); sessionStorage.removeItem(`${key}:expiry`); } }); } else { // æ¸…é™¤åŒ¹é…çš„éæ•æ„Ÿæ•°æ® Object.keys(localStorage).forEach((key) =\u0026gt; { if (key.includes(pattern)) { localStorage.removeItem(key); } }); } }, }; æ›´å¹¿æ³›çš„æ•°æ®ä¿æŠ¤æªæ–½åŒ…æ‹¬ï¼š\nAPI å“åº”æ¸…ç†ï¼šæœåŠ¡ç«¯å¢åŠ å“åº”è¿‡æ»¤å™¨ï¼Œç§»é™¤ä¸å¿…è¦æ•æ„Ÿå­—æ®µ å‰ç«¯æ•°æ®å±è”½ï¼šæ•æ„Ÿä¿¡æ¯æ˜¾ç¤ºæ—¶é»˜è®¤æ©ç å¤„ç† è‡ªåŠ¨æ•°æ®è¿‡æœŸï¼šæ‰€æœ‰ç¼“å­˜æ•°æ®è®¾ç½®åˆç† TTL å†…å­˜æ•°æ®ä¿æŠ¤ï¼šä½¿ç”¨åç«‹å³æ¸…é™¤å†…å­˜ä¸­çš„æ•æ„Ÿä¿¡æ¯ ç¦»å¼€é¡µé¢æ¸…ç†ï¼šé¡µé¢å¤±å»ç„¦ç‚¹æˆ–å…³é—­æ—¶æ¸…é™¤æ•æ„Ÿæ•°æ® è¿™äº›æªæ–½é™ä½äº†æ•°æ®æ³„éœ²çš„é£é™©å’Œæ½œåœ¨å½±å“èŒƒå›´ã€‚\n5. å®‰å…¨é€šä¿¡ï¼šä¸åªæ˜¯ HTTPS é¡¹ç›®åŸæœ¬å·²ç»ä½¿ç”¨äº† HTTPSï¼Œä½†ç½‘ç»œé€šä¿¡å®‰å…¨è¿œä¸æ­¢äºæ­¤ã€‚æˆ‘ä»¬å®æ–½äº†æ›´å…¨é¢çš„é€šä¿¡å®‰å…¨ç­–ç•¥ï¼š\n// é€šä¿¡å®‰å…¨å¢å¼º function enhanceApiSecurity(axiosInstance) { // 1. å®æ–½è¯·æ±‚åŠ å¯† axiosInstance.interceptors.request.use((config) =\u0026gt; { // å¯¹ç‰¹å®šAPIè·¯å¾„å®æ–½ç«¯åˆ°ç«¯åŠ å¯† if (config.url.includes(\u0026#34;/api/v1/sensitive/\u0026#34;)) { config.headers[\u0026#34;X-Content-Encrypted\u0026#34;] = \u0026#34;true\u0026#34;; const originalData = config.data; // ä½¿ç”¨éå¯¹ç§°åŠ å¯†ä¿æŠ¤è¯·æ±‚æ•°æ® config.data = { payload: encryptWithPublicKey( JSON.stringify(originalData), SERVER_PUBLIC_KEY ), timestamp: Date.now(), }; } return config; }); // 2. å“åº”å®Œæ•´æ€§éªŒè¯ axiosInstance.interceptors.response.use((response) =\u0026gt; { // éªŒè¯æ•æ„Ÿå“åº”çš„å®Œæ•´æ€§ç­¾å if (response.headers[\u0026#34;x-content-signature\u0026#34;]) { const { data, signature } = response.data; if (!verifySignature(data, signature, SERVER_PUBLIC_KEY)) { throw new Error(\u0026#34;Response tampering detected\u0026#34;); } return { ...response, data: data }; } return response; }); // 3. ç½‘ç»œå¼‚å¸¸æ™ºèƒ½å¤„ç† axiosInstance.interceptors.response.use( (response) =\u0026gt; response, (error) =\u0026gt; { // æ£€æµ‹æ½œåœ¨çš„ç½‘ç»œæ”»å‡» if (error.response \u0026amp;\u0026amp; error.response.status === 0) { // å¯èƒ½æ˜¯ç½‘ç»œæ‹¦æˆªæ”»å‡» securityMonitor.reportAnomaly(\u0026#34;network_intercept\u0026#34;, { url: error.config.url, timestamp: Date.now(), }); } // ç»†åŒ–é”™è¯¯å¤„ç† if (error.response \u0026amp;\u0026amp; error.response.status === 401) { // è®¤è¯å¤±è´¥ï¼Œå®‰å…¨åœ°æ¸…é™¤å‡­è¯ authManager.secureLogout(); } return Promise.reject(error); } ); } é™¤æ­¤ä¹‹å¤–ï¼Œæˆ‘ä»¬è¿˜å®æ–½äº†ï¼š\nè¯ä¹¦é”å®šï¼šé¢„è®¾å¯ä¿¡ SSL è¯ä¹¦æŒ‡çº¹ï¼Œé˜²æ­¢ä¸­é—´äººæ”»å‡» ä¼ è¾“å±‚åŠ å¯†ç­–ç•¥ï¼šå¼ºåˆ¶ TLS 1.2+ï¼Œç¦ç”¨ä¸å®‰å…¨åŠ å¯†å¥—ä»¶ ç½‘ç»œå¼‚å¸¸ç›‘æ§ï¼šæ£€æµ‹å¯èƒ½çš„ç½‘ç»œæ”»å‡»å¹¶è§¦å‘é˜²å¾¡æªæ–½ åŒå‘è®¤è¯ï¼šå…³é”® API ä½¿ç”¨å®¢æˆ·ç«¯è¯ä¹¦è¿›è¡ŒåŒå‘è®¤è¯ è¿™äº›æªæ–½å¤§å¤§æé«˜äº†é€šä¿¡å®‰å…¨ï¼Œé˜²æ­¢äº†ç½‘ç»œåŠ«æŒå’Œæ•°æ®çªƒå¬ã€‚\n6. ä¾èµ–å®‰å…¨ï¼šä¾›åº”é“¾çš„éšæ‚£ ä¾èµ–å®‰å…¨æ˜¯ç°ä»£å‰ç«¯æœ€å®¹æ˜“è¢«å¿½è§†çš„é£é™©ã€‚é¡¹ç›®ä½¿ç”¨äº†è¶…è¿‡ 300 ä¸ª npm åŒ…ï¼Œå®¡è®¡å‘ç° 43 ä¸ªä¸¥é‡æ¼æ´ã€‚\næˆ‘ä»¬ç³»ç»ŸåŒ–è§£å†³äº†ä¾èµ–å®‰å…¨é—®é¢˜ï¼š\n// package.json æ·»åŠ å®‰å…¨ç­–ç•¥ { \u0026#34;name\u0026#34;: \u0026#34;secure-financial-app\u0026#34;, \u0026#34;version\u0026#34;: \u0026#34;1.0.0\u0026#34;, \u0026#34;scripts\u0026#34;: { // å®‰å…¨å®¡è®¡é›†æˆåˆ°å¼€å‘æµç¨‹ \u0026#34;preinstall\u0026#34;: \u0026#34;npx npm-lock-verify\u0026#34;, \u0026#34;postinstall\u0026#34;: \u0026#34;npx audit-ci --moderate\u0026#34;, \u0026#34;build\u0026#34;: \u0026#34;npm run security-check \u0026amp;\u0026amp; react-scripts build\u0026#34;, \u0026#34;security-check\u0026#34;: \u0026#34;npm audit --production \u0026amp;\u0026amp; npx snyk test\u0026#34;, // è‡ªåŠ¨æ›´æ–°å®‰å…¨ä¾èµ– \u0026#34;update-safe\u0026#34;: \u0026#34;npx npm-check-updates -u -t minor\u0026#34;, \u0026#34;update-safe:patch\u0026#34;: \u0026#34;npx npm-check-updates -u -t patch\u0026#34; }, \u0026#34;dependencies\u0026#34;: { // é”å®šä¾èµ–çš„å­ä¾èµ–ç‰ˆæœ¬ \u0026#34;react\u0026#34;: \u0026#34;17.0.2\u0026#34;, \u0026#34;react-dom\u0026#34;: \u0026#34;17.0.2\u0026#34; }, \u0026#34;resolutions\u0026#34;: { // å¼ºåˆ¶è¦†ç›–æœ‰æ¼æ´çš„ä¾èµ– \u0026#34;minimist\u0026#34;: \u0026#34;\u0026gt;=1.2.6\u0026#34;, \u0026#34;node-forge\u0026#34;: \u0026#34;\u0026gt;=1.3.0\u0026#34; }, // å®‰å…¨ç­–ç•¥ \u0026#34;engines\u0026#34;: { \u0026#34;node\u0026#34;: \u0026#34;\u0026gt;=14.0.0\u0026#34; } } å…³é”®æªæ–½åŒ…æ‹¬ï¼š\nä¾èµ–å®¡è®¡è‡ªåŠ¨åŒ–ï¼šå°†å®‰å…¨å®¡è®¡é›†æˆåˆ° CI/CD æµç¨‹ ä¾èµ–éš”ç¦»ï¼šä½¿ç”¨ webpack çš„ Module Federation éš”ç¦»ç¬¬ä¸‰æ–¹ä»£ç  è¿è¡Œæ—¶å®Œæ•´æ€§æ ¡éªŒï¼šéªŒè¯å…³é”®ä¾èµ–çš„ä»£ç å®Œæ•´æ€§ ç§æœ‰ NPM ä»“åº“ï¼šä½¿ç”¨ç»è¿‡å®¡æ ¸çš„ç§æœ‰ä¾èµ–æº ä¾èµ–æœ€å°åŒ–ï¼šå‡å°‘ä¸å¿…è¦ä¾èµ–ï¼Œé™ä½æ”»å‡»é¢ è¿™äº›æªæ–½å°†é«˜å±æ¼æ´æ•°é‡ä» 43 ä¸ªå‡å°‘åˆ° 0 ä¸ªï¼Œå»ºç«‹äº†æŒç»­çš„ä¾èµ–å®‰å…¨æµç¨‹ã€‚\n7. å†…å®¹å®‰å…¨ç­–ç•¥(CSP)ï¼šé˜²å¾¡çš„æœ€åä¸€é“é˜²çº¿ CSP æ˜¯å‰ç«¯å®‰å…¨çš„å¼ºå¤§æ­¦å™¨ï¼Œä½†åŸé¡¹ç›®å®Œå…¨æ²¡æœ‰å®æ–½ã€‚æˆ‘ä»¬è®¾è®¡äº†å¤šå±‚æ¬¡ CSP ç­–ç•¥ï¼š\n\u0026lt;!-- åŸºç¡€CSPç­–ç•¥ --\u0026gt; \u0026lt;meta http-equiv=\u0026#34;Content-Security-Policy\u0026#34; content=\u0026#34; default-src \u0026#39;self\u0026#39;; script-src \u0026#39;self\u0026#39; https://trusted-analytics.com; style-src \u0026#39;self\u0026#39; https://fonts.googleapis.com; img-src \u0026#39;self\u0026#39; data: https://*.cloudfront.net; connect-src \u0026#39;self\u0026#39; https://*.api.company.com; font-src \u0026#39;self\u0026#39; https://fonts.gstatic.com; frame-src \u0026#39;none\u0026#39;; object-src \u0026#39;none\u0026#39;; base-uri \u0026#39;self\u0026#39;; form-action \u0026#39;self\u0026#39;; frame-ancestors \u0026#39;none\u0026#39;; report-uri https://csp-reporter.company.com/report; \u0026#34; /\u0026gt; ä¸ºäº†å¹³è¡¡å®‰å…¨å’ŒåŠŸèƒ½ï¼Œæˆ‘ä»¬å®æ–½äº†åˆ†ç¯å¢ƒçš„ CSP ç­–ç•¥ï¼š\nç”Ÿäº§ç¯å¢ƒï¼šæœ€ä¸¥æ ¼çš„ CSPï¼Œç¦æ­¢å†…è”è„šæœ¬å’Œæ ·å¼ æµ‹è¯•ç¯å¢ƒï¼šä¸­ç­‰ä¸¥æ ¼åº¦ï¼Œå…è®¸æŸäº›å¼€å‘å·¥å…· å¼€å‘ç¯å¢ƒï¼šè¾ƒå®½æ¾é…ç½®ï¼Œä½†ä»ç¦æ­¢æœ€å±é™©çš„åŠŸèƒ½ CSP å®æ–½åï¼ŒæˆåŠŸé˜»æ­¢äº† 100%çš„ XSS æ”»å‡»å°è¯•ï¼Œç”šè‡³åœ¨ç»•è¿‡å…¶ä»–é˜²å¾¡çš„æƒ…å†µä¸‹ã€‚\n8. è®¤è¯ä¸ä¼šè¯å®‰å…¨ï¼šæ— æ‡ˆå¯å‡»çš„èº«ä»½éªŒè¯ èº«ä»½è®¤è¯æ˜¯å®‰å…¨æ¶æ„çš„æ ¸å¿ƒã€‚åŸç³»ç»Ÿé‡‡ç”¨ç®€å•çš„ JWT ä»¤ç‰Œå­˜å‚¨åœ¨ localStorageï¼Œå­˜åœ¨å¤šä¸ªä¸¥é‡é—®é¢˜ã€‚\næˆ‘ä»¬é‡æ„äº†æ•´ä¸ªè®¤è¯ç³»ç»Ÿï¼š\n// è®¤è¯ç®¡ç†å™¨ const authManager = { // 1. å®‰å…¨ç™»å½•æµç¨‹ async login(credentials) { try { // è·å–ä¸€æ¬¡æ€§åŠ å¯†å¯†é’¥ const { publicKey, keyId } = await api.getEncryptionKey(); // åŠ å¯†æ•æ„Ÿå‡­è¯ const encryptedPassword = encryptWithPublicKey( credentials.password, publicKey ); // å®‰å…¨ä¼ è¾“å‡­è¯ const response = await api.login({ username: credentials.username, password: encryptedPassword, keyId, deviceInfo: collectSecureDeviceInfo(), }); // åˆ†ç¦»å­˜å‚¨ä»¤ç‰Œ const { accessToken, refreshToken, expiresIn } = response.data; // è®¿é—®ä»¤ç‰Œä½¿ç”¨HttpOnly cookieï¼ˆç”±æœåŠ¡å™¨è®¾ç½®ï¼‰ // åˆ·æ–°ä»¤ç‰ŒåŠ å¯†å­˜å‚¨åœ¨å†…å­˜å’Œå®‰å…¨å­˜å‚¨ä¸­ this.storeRefreshToken(refreshToken); // è®¾ç½®ä»¤ç‰Œè‡ªåŠ¨åˆ·æ–° this.scheduleTokenRefresh(expiresIn); return true; } catch (error) { // å®‰å…¨æ—¥å¿—è®°å½•ï¼Œä¸æ³„éœ²è¯¦ç»†é”™è¯¯ securityLogger.error(\u0026#34;Authentication error\u0026#34;, { username: credentials.username, }); throw new Error(\u0026#34;Authentication failed\u0026#34;); } }, // 2. å®‰å…¨ä»¤ç‰Œåˆ·æ–° async refreshAuthentication() { try { const refreshToken = this.getRefreshToken(); if (!refreshToken) { throw new Error(\u0026#34;No refresh token available\u0026#34;); } // ä½¿ç”¨åˆ·æ–°ä»¤ç‰Œè·å–æ–°çš„è®¿é—®ä»¤ç‰Œ const response = await api.refreshToken({ refreshToken, deviceInfo: collectSecureDeviceInfo(), }); // æ›´æ–°ä»¤ç‰Œ const { accessToken, refreshToken: newRefreshToken, expiresIn, } = response.data; // å­˜å‚¨æ–°ä»¤ç‰Œ this.storeRefreshToken(newRefreshToken); this.scheduleTokenRefresh(expiresIn); return true; } catch (error) { // ä»¤ç‰Œåˆ·æ–°å¤±è´¥ï¼Œéœ€è¦é‡æ–°ç™»å½• this.secureLogout(); return false; } }, // 3. å®‰å…¨ç™»å‡º secureLogout() { // é€šçŸ¥æœåŠ¡å™¨åŠé”€ä»¤ç‰Œ api.logout().catch(() =\u0026gt; {}); // æ¸…é™¤æ‰€æœ‰ä»¤ç‰Œå’Œä¼šè¯æ•°æ® this.clearTokens(); sessionStorage.clear(); // åˆ·æ–°é¡µé¢ï¼Œæ¸…é™¤å†…å­˜çŠ¶æ€ window.location.href = \u0026#34;/login?reason=logout\u0026#34;; }, // 4. å¤šè®¾å¤‡ä¼šè¯ç®¡ç† async getActiveSessions() { const response = await api.getActiveSessions(); return response.data.sessions; }, async terminateSession(sessionId) { await api.terminateSession(sessionId); }, async terminateAllOtherSessions() { await api.terminateOtherSessions(); }, }; è®¤è¯ç³»ç»Ÿçš„å…³é”®æ”¹è¿›ï¼š\nä»¤ç‰Œåˆ†ç¦»å­˜å‚¨ï¼šè®¿é—®ä»¤ç‰Œé€šè¿‡ HttpOnly Cookie å­˜å‚¨ï¼Œåˆ·æ–°ä»¤ç‰ŒåŠ å¯†å­˜å‚¨ è‡ªåŠ¨ä»¤ç‰Œæ›´æ–°ï¼šæ— ç¼åˆ·æ–°ä»¤ç‰Œï¼Œé¿å…ä¼šè¯ä¸­æ–­ è®¾å¤‡ç»‘å®šä»¤ç‰Œï¼šä»¤ç‰Œä¸è®¾å¤‡æŒ‡çº¹ç»‘å®šï¼Œé˜²æ­¢ä»¤ç‰Œçªƒå– ä¼šè¯ç®¡ç†ï¼šç”¨æˆ·å¯ä»¥æŸ¥çœ‹å’Œç»ˆæ­¢æ´»åŠ¨ä¼šè¯ å¤šå› ç´ è®¤è¯ï¼šå…³é”®æ“ä½œéœ€è¦é¢å¤–éªŒè¯ æ”¹é€ åï¼Œè®¤è¯ç›¸å…³çš„å®‰å…¨æ¼æ´ä»æœ€åˆçš„ 8 ä¸ªå‡å°‘åˆ° 0 ä¸ªã€‚\n9. è¿è¡Œæ—¶å®‰å…¨é˜²æŠ¤ï¼šå…¨æ–¹ä½ç›‘æ§ä¸é˜²å¾¡ ä¸ºé˜²å¾¡æœªçŸ¥å¨èƒï¼Œæˆ‘ä»¬å®æ–½äº†å…¨é¢çš„è¿è¡Œæ—¶ä¿æŠ¤ï¼š\n// å‰ç«¯å®‰å…¨ç›‘è§†å™¨ class SecurityMonitor { constructor() { this.anomalyCount = 0; this.lastReportTime = 0; this.observers = []; this.initialized = false; } init() { if (this.initialized) return; this.initialized = true; // 1. DOMç¯¡æ”¹ç›‘æµ‹ this.monitorDOMTampering(); // 2. å…¨å±€é”™è¯¯ç›‘å¬ this.monitorGlobalErrors(); // 3. ç½‘ç»œè¯·æ±‚ç›‘æ§ this.monitorNetworkRequests(); // 4. å­˜å‚¨å˜åŒ–ç›‘æ§ this.monitorStorageChanges(); // 5. è¿è¡Œæ—¶ä»£ç æ‰§è¡Œç›‘æ§ this.monitorScriptExecution(); } reportAnomaly(type, details) { this.anomalyCount++; // é™åˆ¶æŠ¥å‘Šé¢‘ç‡ï¼Œé˜²æ­¢æ³›æ»¥ const now = Date.now(); if (now - this.lastReportTime \u0026lt; 5000 \u0026amp;\u0026amp; this.anomalyCount \u0026gt; 10) { // å¯èƒ½é­å—æ”»å‡»ï¼Œè§¦å‘ç´§æ€¥å“åº” this.triggerEmergencyResponse(); return; } this.lastReportTime = now; // è®°å½•å®‰å…¨å¼‚å¸¸ securityLogger.warn(`Security anomaly detected: ${type}`, details); // å‘å®‰å…¨æœåŠ¡å™¨æŠ¥å‘Š this.sendAnomalyReport(type, details); // é€šçŸ¥è§‚å¯Ÿè€… this.notifyObservers(type, details); } // ç›‘æ§DOMç¯¡æ”¹ monitorDOMTampering() { // ä½¿ç”¨MutationObserverç›‘æ§DOMå˜åŒ– const observer = new MutationObserver((mutations) =\u0026gt; { for (const mutation of mutations) { if (mutation.type === \u0026#34;childList\u0026#34;) { // æ£€æŸ¥æ˜¯å¦æ·»åŠ äº†å¯ç–‘å…ƒç´  for (const node of mutation.addedNodes) { if (node.nodeType === 1) { // ElementèŠ‚ç‚¹ this.checkSuspiciousElement(node); } } } else if (mutation.type === \u0026#34;attributes\u0026#34;) { // æ£€æŸ¥å±æ€§å˜åŒ– this.checkSuspiciousAttribute( mutation.target, mutation.attributeName ); } } }); // ç›‘è§†æ•´ä¸ªæ–‡æ¡£ observer.observe(document.documentElement, { childList: true, attributes: true, subtree: true, }); } // å…¶ä»–ç›‘æ§æ–¹æ³•... // ç´§æ€¥å“åº”æªæ–½ triggerEmergencyResponse() { // æ ¹æ®å¨èƒçº§åˆ«é‡‡å–ä¸åŒæªæ–½ if (this.anomalyCount \u0026gt; 20) { // ä¸¥é‡å¨èƒï¼Œå¼ºåˆ¶ç™»å‡ºå¹¶åˆ·æ–° authManager.secureLogout(); } else { // ä¸­ç­‰å¨èƒï¼Œé™åˆ¶åŠŸèƒ½ this.restrictSensitiveFeatures(); } // å‘æœåŠ¡å™¨æŠ¥å‘Šç´§æ€¥æƒ…å†µ this.sendEmergencyAlert(); } } // åˆå§‹åŒ–å®‰å…¨ç›‘è§†å™¨ const securityMonitor = new SecurityMonitor(); securityMonitor.init(); è¿è¡Œæ—¶ä¿æŠ¤ä¸ºæˆ‘ä»¬æä¾›äº†åº”å¯¹æœªçŸ¥å¨èƒçš„èƒ½åŠ›ï¼Œåœ¨å¤šæ¬¡çœŸå®æ”»å‡»ä¸­æˆåŠŸæ£€æµ‹å¹¶é˜²å¾¡äº†æ–°å‹å®‰å…¨æ¼æ´ã€‚\n10. å®‰å…¨æ„è¯†ä¸è‡ªåŠ¨åŒ–æ£€æµ‹ æŠ€æœ¯æªæ–½åªæ˜¯å®‰å…¨çš„ä¸€éƒ¨åˆ†ï¼Œæˆ‘ä»¬è¿˜å»ºç«‹äº†å…¨é¢çš„å®‰å…¨æ–‡åŒ–å’Œè‡ªåŠ¨åŒ–æµ‹è¯•æµç¨‹ï¼š\nå¼€å‘å®‰å…¨åŸ¹è®­ï¼šæ¯å­£åº¦å®‰å…¨åŸ¹è®­ï¼Œä»£ç å®¡æŸ¥ä¸­ 60%çš„æ£€æŸ¥ç‚¹ä¸å®‰å…¨ç›¸å…³ å®‰å…¨æµ‹è¯•è‡ªåŠ¨åŒ–ï¼šCI/CD æµç¨‹é›†æˆäº† SASTã€DAST å’Œä¾èµ–å®¡è®¡ æ¼æ´èµé‡‘è®¡åˆ’ï¼šè®¾ç«‹æ¼æ´èµé‡‘ï¼Œæ¿€åŠ±å®‰å…¨ç ”ç©¶äººå‘˜æŠ¥å‘Šé—®é¢˜ å®‰å…¨æ›´æ–°é€šå‘Šï¼šå»ºç«‹å®‰å…¨å…¬å‘Šæœºåˆ¶ï¼ŒåŠæ—¶ä¼ è¾¾å®‰å…¨ä¿¡æ¯ å®šæœŸæ¸—é€æµ‹è¯•ï¼šæ¯å­£åº¦è¿›è¡Œä¸€æ¬¡ç¬¬ä¸‰æ–¹æ¸—é€æµ‹è¯• å‰ç«¯å®‰å…¨çš„å…³é”®æ•™è®­ è¿™æ¬¡é‡æ„è®©æˆ‘æ·±åˆ»è®¤è¯†åˆ°ç°ä»£å‰ç«¯å®‰å…¨çš„å‡ ä¸ªå…³é”®æ•™è®­ï¼š\nå®‰å…¨å¿…é¡»æ˜¯æ¶æ„çº§å†³ç­–ï¼šäº‹åä¿®è¡¥æ°¸è¿œä¸å¦‚ä»è®¾è®¡é˜¶æ®µå°±è€ƒè™‘å®‰å…¨\næ·±åº¦é˜²å¾¡æ˜¯å”¯ä¸€ä¹‹è·¯ï¼šå•ä¸€å®‰å…¨æªæ–½æ€»ä¼šè¢«ç»•è¿‡ï¼Œåªæœ‰å¤šå±‚é˜²å¾¡æ‰èƒ½çœŸæ­£å®‰å…¨\nè¿‡åº¦ä¿¡ä»»æ˜¯æœ€å¤§å¨èƒï¼šæ°¸è¿œä¸è¦ä¿¡ä»»ç”¨æˆ·è¾“å…¥ã€ç½‘ç»œå“åº”ã€ç¬¬ä¸‰æ–¹ä»£ç æˆ–ä»»ä½•å¤–éƒ¨æ•°æ®\nè‡ªåŠ¨åŒ–æ˜¯å®‰å…¨çš„åŸºçŸ³ï¼šäººå·¥æ£€æŸ¥æ— æ³•è·Ÿä¸Šç°ä»£å¼€å‘é€Ÿåº¦ï¼Œå¿…é¡»é€šè¿‡è‡ªåŠ¨åŒ–ä¿éšœå®‰å…¨\nå®‰å…¨ä¸ç”¨æˆ·ä½“éªŒå¯ä»¥å…±å­˜ï¼šç²¾å¿ƒè®¾è®¡çš„å®‰å…¨æªæ–½ä¸ä¼šæŸå®³ç”¨æˆ·ä½“éªŒï¼Œåè€Œå¯ä»¥å¢å¼ºç”¨æˆ·ä¿¡ä»»\nå®‰å…¨æ¶æ„çš„æœªæ¥æ–¹å‘ å‰ç«¯å®‰å…¨é¢†åŸŸæ­£åœ¨å¿«é€Ÿå‘å±•ï¼Œæˆ‘ä»¬å·²ç»å¼€å§‹æ¢ç´¢å‡ ä¸ªå‰æ²¿æ–¹å‘ï¼š\nè¿è¡Œæ—¶åº”ç”¨è‡ªä¿æŠ¤(RASP)ï¼šåº”ç”¨èƒ½å¤Ÿæ£€æµ‹å¹¶é˜²å¾¡å®æ—¶æ”»å‡»ï¼Œæ— éœ€å¤–éƒ¨é˜²ç«å¢™\né›¶ä¿¡ä»»å‰ç«¯æ¶æ„ï¼šæ‰€æœ‰è¯·æ±‚å’Œæ“ä½œéƒ½éœ€è¦æŒç»­éªŒè¯ï¼Œæ— æ°¸ä¹…ä¿¡ä»»\nå‰ç«¯éšç§è®¡ç®—ï¼šæ•æ„Ÿæ•°æ®åœ¨å®¢æˆ·ç«¯å¤„ç†ï¼Œå‡å°‘ä¼ è¾“å’Œå­˜å‚¨é£é™©\nå®‰å…¨å…ƒæ•°æ®å…±äº«ï¼šè·¨åº”ç”¨å…±äº«å®‰å…¨æƒ…æŠ¥ï¼Œæ„å»ºåä½œé˜²å¾¡ç½‘ç»œ\näººå·¥æ™ºèƒ½å®‰å…¨æ£€æµ‹ï¼šåˆ©ç”¨æœºå™¨å­¦ä¹ è¯†åˆ«å¼‚å¸¸è¡Œä¸ºå’ŒæœªçŸ¥æ”»å‡»æ¨¡å¼\nç»“è¯­ å‰ç«¯å®‰å…¨ä¸å†æ˜¯åç«¯å®‰å…¨çš„é™„å±å“ï¼Œè€Œæ˜¯ç°ä»£ Web åº”ç”¨å®‰å…¨æ¶æ„çš„æ ¸å¿ƒç»„æˆéƒ¨åˆ†ã€‚\nå½“ä»Šçš„å‰ç«¯åº”ç”¨å¤æ‚åº¦æŒç»­å¢åŠ ï¼Œå¤„ç†çš„æ•°æ®è¶Šæ¥è¶Šæ•æ„Ÿï¼Œæ”»å‡»é¢ä¸æ–­æ‰©å¤§ã€‚ä»…é é›¶æ•£çš„å®‰å…¨æªæ–½å·²æ— æ³•åº”å¯¹æ—¥ç›Šå¤æ‚çš„å¨èƒã€‚åªæœ‰æ„å»ºå¤šå±‚æ¬¡ã€å…¨æ–¹ä½çš„å®‰å…¨é˜²æŠ¤ä½“ç³»ï¼Œæ‰èƒ½çœŸæ­£ä¿éšœåº”ç”¨å’Œç”¨æˆ·å®‰å…¨ã€‚\næœ€åï¼Œè®°ä½å®‰å…¨æ°¸è¿œæ˜¯ä¸€ä¸ªè¿‡ç¨‹è€Œéç»ˆç‚¹ã€‚ä»Šå¤©çš„å®‰å…¨è§£å†³æ–¹æ¡ˆå¯èƒ½æˆä¸ºæ˜å¤©çš„å®‰å…¨æ¼æ´ã€‚æŒç»­å­¦ä¹ ã€æŒç»­æµ‹è¯•ã€æŒç»­æ”¹è¿›æ˜¯ä¿æŒå®‰å…¨çš„å”¯ä¸€é€”å¾„ã€‚\nå¸Œæœ›æˆ‘çš„ç»éªŒèƒ½å¸®åŠ©æ›´å¤šå›¢é˜Ÿæ„å»ºçœŸæ­£å®‰å…¨çš„å‰ç«¯åº”ç”¨ï¼Œé˜²æ‚£äºæœªç„¶ï¼Œè€Œä¸æ˜¯äº¡ç¾Šè¡¥ç‰¢ã€‚\n","permalink":"https://www.yss520.online/zh/posts/web-security/","summary":"\u003ch1 id=\"å‰ç«¯å®‰å…¨æŠ¤åŸæ²³ä»ä¸€åœºå®‰å…¨å±æœºåˆ°ä½“ç³»åŒ–è§£å†³æ–¹æ¡ˆ\"\u003eå‰ç«¯å®‰å…¨æŠ¤åŸæ²³ï¼šä»ä¸€åœºå®‰å…¨å±æœºåˆ°ä½“ç³»åŒ–è§£å†³æ–¹æ¡ˆ\u003c/h1\u003e\n\u003cp\u003eå®‰å…¨æ˜¯æ¯ä¸€ä¸ªå¼€å‘ç¦»ä¸å¼€çš„è¯é¢˜ï¼Œç»“åˆè¿™äº›å¹´çš„å¼€å‘ç»ç†å’Œä¸€äº›å®æˆ˜ç»éªŒï¼Œåˆ†äº«ä¸€äº›å…³äºå‰ç«¯çš„å®‰å…¨æ€è€ƒ\u003c/p\u003e\n\u003ch2 id=\"å®‰å…¨äº‹ä»¶å‰–æçœ‹ä¼¼ç®€å•çš„æ¼æ´ç¾éš¾æ€§çš„åæœ\"\u003eå®‰å…¨äº‹ä»¶å‰–æï¼šçœ‹ä¼¼ç®€å•çš„æ¼æ´ï¼Œç¾éš¾æ€§çš„åæœ\u003c/h2\u003e\n\u003cp\u003eäº‹ä»¶èµ·å› çœ‹ä¼¼ç®€å•ï¼šç®¡ç†åå°çš„æœç´¢åŠŸèƒ½ç›´æ¥å±•ç¤ºäº†ç”¨æˆ·è¾“å…¥ï¼Œæ²¡æœ‰ä»»ä½•è¿‡æ»¤ã€‚æ”»å‡»è€…é€šè¿‡ç²¾å¿ƒæ„é€ çš„æœç´¢è¯ï¼Œæ³¨å…¥äº†æ¶æ„ JavaScriptï¼Œè¿›è€Œè·å–äº†ç®¡ç†å‘˜çš„è®¤è¯ä»¤ç‰Œï¼Œæœ€ç»ˆå¯¼è‡´å¤§é‡ç”¨æˆ·æ•°æ®æ³„éœ²ã€‚\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-javascript\" data-lang=\"javascript\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e// åŸå§‹çš„ä¸å®‰å…¨ä»£ç \n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003efunction\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eSearchResults\u003c/span\u003e({ \u003cspan style=\"color:#a6e22e\"\u003equery\u003c/span\u003e }) {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#66d9ef\"\u003ereturn\u003c/span\u003e (\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003e\u0026lt;\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003ediv\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#f92672\"\u003e\u0026lt;\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003eh2\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e\u0026gt;\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003eæœç´¢ç»“æœ\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e:\u003c/span\u003e {\u003cspan style=\"color:#a6e22e\"\u003equery\u003c/span\u003e}\u003cspan style=\"color:#f92672\"\u003e\u0026lt;\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e/h2\u0026gt; {/\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e*\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eç›´æ¥æ³¨å…¥ç”¨æˆ·è¾“å…¥\u003c/span\u003e\u003cspan style=\"color:#960050;background-color:#1e0010\"\u003eï¼Œ\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003eå¯¼è‡´XSSæ¼æ´\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e*\u003c/span\u003e\u003cspan style=\"color:#960050;background-color:#1e0010\"\u003e/}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#f92672\"\u003e\u0026lt;\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003ediv\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eclassName\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;results\u0026#34;\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e\u0026gt;\u003c/span\u003e{\u003cspan style=\"color:#75715e\"\u003e/* æœç´¢ç»“æœ */\u003c/span\u003e}\u003cspan style=\"color:#f92672\"\u003e\u0026lt;\u003c/span\u003e\u003cspan style=\"color:#960050;background-color:#1e0010\"\u003e/div\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003e\u0026lt;\u003c/span\u003e\u003cspan style=\"color:#960050;background-color:#1e0010\"\u003e/div\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  );\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eè¿™ä¸ªç®€å•æ¼æ´åªæ˜¯å†°å±±ä¸€è§’ã€‚å®‰å…¨å®¡è®¡å‘ç°äº†è¶…è¿‡ 30 ä¸ªä¸¥é‡æ¼æ´ï¼ŒåŒ…æ‹¬å¤šå¤„ XSSã€CSRFã€æ•æ„Ÿä¿¡æ¯æ³„éœ²ã€ä¸å®‰å…¨çš„ç¬¬ä¸‰æ–¹ä¾èµ–ç­‰ã€‚æ˜¾ç„¶ï¼Œè¿™ä¸æ˜¯ä¿®è¡¥å‡ ä¸ªæ¼æ´å°±èƒ½è§£å†³çš„é—®é¢˜ï¼Œè€Œæ˜¯éœ€è¦ç³»ç»Ÿæ€§é‡æ„ã€‚\u003c/p\u003e\n\u003ch2 id=\"å»ºç«‹å…¨é¢å®‰å…¨é˜²æŠ¤ä½“ç³»\"\u003eå»ºç«‹å…¨é¢å®‰å…¨é˜²æŠ¤ä½“ç³»\u003c/h2\u003e\n\u003cp\u003eæˆ‘ä»¬æ„å»ºäº†ä¸€ä¸ªå¤šå±‚æ¬¡çš„å‰ç«¯å®‰å…¨é˜²æŠ¤ä½“ç³»ï¼Œä»ä»£ç çº§åˆ«ã€æ¶æ„å±‚é¢å’Œè¿è¡Œç¯å¢ƒä¸‰ä¸ªç»´åº¦å…¨é¢åŠ å›ºåº”ç”¨ã€‚\u003c/p\u003e\n\u003ch3 id=\"1-xss-é˜²å¾¡ä¸ä»…ä»…æ˜¯è½¬ä¹‰\"\u003e1. XSS é˜²å¾¡ï¼šä¸ä»…ä»…æ˜¯è½¬ä¹‰\u003c/h3\u003e\n\u003cp\u003eXSSï¼ˆè·¨ç«™è„šæœ¬æ”»å‡»ï¼‰ä»ç„¶æ˜¯å‰ç«¯æœ€å¸¸è§ä¸”å±å®³æœ€å¤§çš„å®‰å…¨å¨èƒã€‚åŸæœ‰é¡¹ç›®ä¸­å‘ç°äº† 12 å¤„ XSS æ¼æ´ï¼Œä¸»è¦é›†ä¸­åœ¨ä»¥ä¸‹å‡ ä¸ªæ–¹é¢ï¼š\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eç›´æ¥å°†ç”¨æˆ·è¾“å…¥æ³¨å…¥ DOM\u003c/li\u003e\n\u003cli\u003eå±é™©çš„\u003ccode\u003einnerHTML\u003c/code\u003eä½¿ç”¨\u003c/li\u003e\n\u003cli\u003eä¸å®‰å…¨çš„ç¬¬ä¸‰æ–¹å†…å®¹åµŒå…¥\u003c/li\u003e\n\u003cli\u003eåå°„å‹ XSS é€šè¿‡ URL å‚æ•°æ³¨å…¥\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eè§£å†³æ–¹æ¡ˆè¿œä¸æ­¢ç®€å•çš„ HTML è½¬ä¹‰ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-javascript\" data-lang=\"javascript\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e// å®‰å…¨æ”¹é€ åçš„æ¨¡å¼\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003eimport\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eDOMPurify\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003efrom\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;dompurify\u0026#34;\u003c/span\u003e;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003eimport\u003c/span\u003e { \u003cspan style=\"color:#a6e22e\"\u003eencodeHTML\u003c/span\u003e } \u003cspan style=\"color:#a6e22e\"\u003efrom\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;./security-utils\u0026#34;\u003c/span\u003e;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e// 1. é»˜è®¤è¿›è¡ŒHTMLç¼–ç \n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003efunction\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eSafeText\u003c/span\u003e({ \u003cspan style=\"color:#a6e22e\"\u003etext\u003c/span\u003e }) {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#66d9ef\"\u003ereturn\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e\u0026lt;\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003espan\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e\u0026gt;\u003c/span\u003e{\u003cspan style=\"color:#a6e22e\"\u003eencodeHTML\u003c/span\u003e(\u003cspan style=\"color:#a6e22e\"\u003etext\u003c/span\u003e)}\u003cspan style=\"color:#f92672\"\u003e\u0026lt;\u003c/span\u003e\u003cspan style=\"color:#960050;background-color:#1e0010\"\u003e/span\u0026gt;;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e// 2. å¿…é¡»æ˜¾å¼é€‰æ‹©æ˜¯å¦ä¿¡ä»»å†…å®¹\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003efunction\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eRichContent\u003c/span\u003e({ \u003cspan style=\"color:#a6e22e\"\u003ehtmlContent\u003c/span\u003e, \u003cspan style=\"color:#a6e22e\"\u003etrusted\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003efalse\u003c/span\u003e }) {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e (\u003cspan style=\"color:#a6e22e\"\u003etrusted\u003c/span\u003e) {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#75715e\"\u003e// å³ä½¿æ˜¯\u0026#34;å¯ä¿¡\u0026#34;å†…å®¹ä¹Ÿè¿›è¡Œæ¸…ç†\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e    \u003cspan style=\"color:#66d9ef\"\u003econst\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003esanitized\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eDOMPurify\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003esanitize\u003c/span\u003e(\u003cspan style=\"color:#a6e22e\"\u003ehtmlContent\u003c/span\u003e, {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#a6e22e\"\u003eALLOWED_TAGS\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e:\u003c/span\u003e [\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;b\u0026#34;\u003c/span\u003e, \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;i\u0026#34;\u003c/span\u003e, \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;em\u0026#34;\u003c/span\u003e, \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;strong\u0026#34;\u003c/span\u003e, \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;a\u0026#34;\u003c/span\u003e, \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;p\u0026#34;\u003c/span\u003e, \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;ul\u0026#34;\u003c/span\u003e, \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;ol\u0026#34;\u003c/span\u003e, \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;li\u0026#34;\u003c/span\u003e],\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#a6e22e\"\u003eALLOWED_ATTR\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e:\u003c/span\u003e [\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;href\u0026#34;\u003c/span\u003e, \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;target\u0026#34;\u003c/span\u003e, \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;rel\u0026#34;\u003c/span\u003e],\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    });\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003ereturn\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e\u0026lt;\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003ediv\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003edangerouslySetInnerHTML\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e{{ \u003cspan style=\"color:#a6e22e\"\u003e__html\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e:\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003esanitized\u003c/span\u003e }} \u003cspan style=\"color:#f92672\"\u003e/\u0026gt;\u003c/span\u003e;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  }\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#75715e\"\u003e// éå¯ä¿¡å†…å®¹åªæ˜¾ç¤ºçº¯æ–‡æœ¬\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e  \u003cspan style=\"color:#66d9ef\"\u003ereturn\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e\u0026lt;\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003ediv\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e\u0026gt;\u003c/span\u003e{\u003cspan style=\"color:#a6e22e\"\u003eencodeHTML\u003c/span\u003e(\u003cspan style=\"color:#a6e22e\"\u003ehtmlContent\u003c/span\u003e)}\u003cspan style=\"color:#f92672\"\u003e\u0026lt;\u003c/span\u003e\u003cspan style=\"color:#960050;background-color:#1e0010\"\u003e/div\u0026gt;;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eæ›´é‡è¦çš„æ˜¯ï¼Œæˆ‘ä»¬å»ºç«‹äº†å®‰å…¨ç¼–ç è§„èŒƒå’Œè‡ªåŠ¨åŒ–æ£€æµ‹æœºåˆ¶ï¼š\u003c/p\u003e","title":"å‰ç«¯å®‰å…¨æŠ¤åŸæ²³"},{"content":"ç°ä»£å‰ç«¯æ¶æ„è®¾è®¡ä¸æ€§èƒ½ï¼šä»åˆ†å½¢åˆ°åŸå­çš„æ€§èƒ½æå‡ä¹‹æ—… å»å¹´æˆ‘è´Ÿè´£é‡æ„äº†ä¸€ä¸ªè¿è¡Œäº† 5 å¹´çš„å¤§å‹ B2B SaaS å¹³å°ã€‚æœ€åˆï¼Œå®ƒæ˜¯ä¸€ä¸ªå•ä½“ React åº”ç”¨ï¼Œä»£ç è¶…è¿‡ 15 ä¸‡è¡Œï¼Œè¿è¡Œç¼“æ…¢ä¸”ç»´æŠ¤å›°éš¾ã€‚ç»è¿‡ 3 ä¸ªæœˆçš„æ¶æ„é‡è®¾è®¡ï¼Œæˆ‘ä»¬å°†é¦–å±åŠ è½½æ—¶é—´ä» 8.6 ç§’é™è‡³ 1.2 ç§’ï¼Œå†…å­˜ä½¿ç”¨å‡å°‘ 65%ï¼Œäº¤äº’å“åº”ä»å¹³å‡ 600ms æå‡è‡³ä¸åˆ° 100msã€‚æ›´é‡è¦çš„æ˜¯ï¼Œå¼€å‘æ•ˆç‡æé«˜äº† 3 å€ï¼Œè¿™ç§æ¶æ„å±‚é¢çš„ä¼˜åŒ–å½±å“æ·±è¿œï¼Œä»Šå¤©æˆ‘æƒ³åˆ†äº«è¿™æ®µç»å†ã€‚\nç°ä»£æ¶æ„æ¨¡å¼ä¸æ€§èƒ½çš„éšç§˜å…³ç³» ä¼ ç»Ÿè§‚ç‚¹è®¤ä¸ºæ¶æ„æ˜¯ä¸ºäº†å¯ç»´æŠ¤æ€§ï¼Œæ€§èƒ½ä¼˜åŒ–æ˜¯å•ç‹¬çš„ä»»åŠ¡ã€‚å®é™…ä¸Šï¼Œæ­£ç¡®çš„æ¶æ„å†³ç­–æœ¬èº«å°±èƒ½å¸¦æ¥æ˜¾è‘—çš„æ€§èƒ½æå‡ã€‚\nä»å·¨çŸ³åˆ°å¾®å‰ç«¯ï¼šæ‹†åˆ†ä¸æ‡’åŠ è½½çš„è‰ºæœ¯ æœ€åˆçš„å•ä½“åº”ç”¨å«æœ‰è¶…è¿‡ 20 ä¸ªä¸»è¦ä¸šåŠ¡æ¨¡å—ï¼Œæ‰€æœ‰ä»£ç æ‰“åŒ…åœ¨ä¸€èµ·ï¼Œå¯¼è‡´å³ä½¿ç”¨æˆ·åªéœ€ä¸€ä¸ªç®€å•åŠŸèƒ½ï¼Œä¹Ÿè¦åŠ è½½æ•´ä¸ªåº”ç”¨ï¼š\n// åŸå§‹å…¥å£æ–‡ä»¶ - æ‰€æœ‰æ¨¡å—ä¸€æ¬¡æ€§åŠ è½½ import React from \u0026#34;react\u0026#34;; import ReactDOM from \u0026#34;react-dom\u0026#34;; import { BrowserRouter } from \u0026#34;react-router-dom\u0026#34;; import { Provider } from \u0026#34;react-redux\u0026#34;; // å¯¼å…¥æ‰€æœ‰æ¨¡å— import Dashboard from \u0026#34;./modules/dashboard\u0026#34;; import Inventory from \u0026#34;./modules/inventory\u0026#34;; import Orders from \u0026#34;./modules/orders\u0026#34;; import Analytics from \u0026#34;./modules/analytics\u0026#34;; import Users from \u0026#34;./modules/users\u0026#34;; import Settings from \u0026#34;./modules/settings\u0026#34;; // ... 15ä¸ªå…¶ä»–æ¨¡å— import store from \u0026#34;./store\u0026#34;; import App from \u0026#34;./App\u0026#34;; ReactDOM.render( \u0026lt;Provider store={store}\u0026gt; \u0026lt;BrowserRouter\u0026gt; \u0026lt;App /\u0026gt; \u0026lt;/BrowserRouter\u0026gt; \u0026lt;/Provider\u0026gt;, document.getElementById(\u0026#34;root\u0026#34;) ); è¿™å¯¼è‡´åˆå§‹ JavaScript åŒ…è¾¾åˆ° 5.8MBï¼Œå³ä½¿ç»è¿‡å‹ç¼©ä¹Ÿæœ‰ 1.6MBã€‚æˆ‘ä»¬å†³å®šé‡‡ç”¨å¾®å‰ç«¯æ¶æ„ï¼Œä½†ä¸æ˜¯ç›²ç›®è·Ÿé£ï¼Œè€Œæ˜¯æ ¹æ®ä¸šåŠ¡è¾¹ç•Œç²¾ç¡®åˆ’åˆ†ï¼š\n// æ¶æ„é‡æ„åçš„ç³»ç»Ÿå…¥å£ - ä½¿ç”¨Module Federation import React, { lazy, Suspense } from \u0026#34;react\u0026#34;; import ReactDOM from \u0026#34;react-dom\u0026#34;; import { BrowserRouter, Routes, Route } from \u0026#34;react-router-dom\u0026#34;; import { ErrorBoundary } from \u0026#34;react-error-boundary\u0026#34;; // åªå¯¼å…¥æ ¸å¿ƒShell import Shell from \u0026#34;./shell/Shell\u0026#34;; import Loading from \u0026#34;./components/Loading\u0026#34;; import ErrorFallback from \u0026#34;./components/ErrorFallback\u0026#34;; // åŠ¨æ€å¯¼å…¥å„ä¸šåŠ¡æ¨¡å— const Dashboard = lazy(() =\u0026gt; import(\u0026#34;dashboard/Module\u0026#34;)); const Inventory = lazy(() =\u0026gt; import(\u0026#34;inventory/Module\u0026#34;)); const Orders = lazy(() =\u0026gt; import(\u0026#34;orders/Module\u0026#34;)); // å…¶ä»–æ¨¡å—æŒ‰éœ€åŠ è½½ ReactDOM.render( \u0026lt;BrowserRouter\u0026gt; \u0026lt;ErrorBoundary FallbackComponent={ErrorFallback}\u0026gt; \u0026lt;Shell\u0026gt; \u0026lt;Suspense fallback={\u0026lt;Loading /\u0026gt;}\u0026gt; \u0026lt;Routes\u0026gt; \u0026lt;Route path=\u0026#34;/\u0026#34; element={\u0026lt;Dashboard /\u0026gt;} /\u0026gt; \u0026lt;Route path=\u0026#34;/inventory/*\u0026#34; element={\u0026lt;Inventory /\u0026gt;} /\u0026gt; \u0026lt;Route path=\u0026#34;/orders/*\u0026#34; element={\u0026lt;Orders /\u0026gt;} /\u0026gt; {/* å…¶ä»–è·¯ç”± */} \u0026lt;/Routes\u0026gt; \u0026lt;/Suspense\u0026gt; \u0026lt;/Shell\u0026gt; \u0026lt;/ErrorBoundary\u0026gt; \u0026lt;/BrowserRouter\u0026gt;, document.getElementById(\u0026#34;root\u0026#34;) ); ä¸ºå®ç°æ¨¡å—é—´é›†æˆï¼Œæˆ‘ä»¬ä½¿ç”¨ Webpack 5 çš„ Module Federationï¼š\n// webpack.config.js - Shellåº”ç”¨é…ç½® const { ModuleFederationPlugin } = require(\u0026#34;webpack\u0026#34;).container; module.exports = { // åŸºç¡€é…ç½®... plugins: [ new ModuleFederationPlugin({ name: \u0026#34;shell\u0026#34;, filename: \u0026#34;remoteEntry.js\u0026#34;, remotes: { dashboard: \u0026#34;dashboard@http://localhost:3001/remoteEntry.js\u0026#34;, inventory: \u0026#34;inventory@http://localhost:3002/remoteEntry.js\u0026#34;, orders: \u0026#34;orders@http://localhost:3003/remoteEntry.js\u0026#34;, // å…¶ä»–è¿œç¨‹æ¨¡å— }, shared: { react: { singleton: true, eager: true }, \u0026#34;react-dom\u0026#34;: { singleton: true, eager: true }, \u0026#34;react-router-dom\u0026#34;: { singleton: true }, // å…¶ä»–å…±äº«ä¾èµ– }, }), ], }; è¿™ä¸ªæ¶æ„è®©æˆ‘ä»¬å®ç°äº†çœŸæ­£çš„æŒ‰éœ€åŠ è½½ - ç”¨æˆ·åªä¸‹è½½ä»–ä»¬è®¿é—®çš„åŠŸèƒ½ã€‚é¦–å±åŠ è½½ä» 1.6MB å‡å°‘åˆ° 280KBï¼Œä¸€ä¸ªæå¤§çš„æ”¹è¿›ã€‚\nä½†å¾®å‰ç«¯å¸¦æ¥äº†æ–°æŒ‘æˆ˜ï¼šæ¨¡å—é—´é€šä¿¡å’Œå…±äº«çŠ¶æ€ã€‚\nçŠ¶æ€ç®¡ç†é‡æ„ï¼šä»å•ä½“åˆ°åˆ†å½¢ ä¼ ç»Ÿ Redux æ¶æ„ä¸­ï¼Œæˆ‘ä»¬æ›¾ä½¿ç”¨ä¸€ä¸ªåºå¤§çš„å…¨å±€å­˜å‚¨ï¼š\n// åŸå§‹çš„å•ä½“çŠ¶æ€ç®¡ç† import { createStore, combineReducers, applyMiddleware } from \u0026#34;redux\u0026#34;; import thunk from \u0026#34;redux-thunk\u0026#34;; import logger from \u0026#34;redux-logger\u0026#34;; // å¯¼å…¥æ‰€æœ‰æ¨¡å—çš„reducer import dashboardReducer from \u0026#34;./modules/dashboard/reducer\u0026#34;; import inventoryReducer from \u0026#34;./modules/inventory/reducer\u0026#34;; import ordersReducer from \u0026#34;./modules/orders/reducer\u0026#34;; import analyticsReducer from \u0026#34;./modules/analytics/reducer\u0026#34;; // ...æ›´å¤šreducer const rootReducer = combineReducers({ dashboard: dashboardReducer, inventory: inventoryReducer, orders: ordersReducer, analytics: analyticsReducer, // ...å…¶ä»–å‡é€Ÿå™¨ }); const store = createStore(rootReducer, applyMiddleware(thunk, logger)); export default store; è¿™ç§æ–¹æ³•å¯¼è‡´å‡ ä¸ªé—®é¢˜ï¼š\næ‰€æœ‰çŠ¶æ€é€»è¾‘éƒ½åŠ è½½ï¼Œå³ä½¿æœªä½¿ç”¨ çŠ¶æ€æ›´æ–°å¯¼è‡´ä¸å¿…è¦çš„ç»„ä»¶é‡æ–°æ¸²æŸ“ ä¸åŒå›¢é˜Ÿä¿®æ”¹å¯èƒ½ç›¸äº’å†²çª æˆ‘ä»¬å¼•å…¥äº†\u0026quot;çŠ¶æ€åˆ†å½¢\u0026quot;æ¨¡å¼ï¼š\n// shell/stateManager.js - çŠ¶æ€ç®¡ç†åè°ƒå™¨ import { createContext, useState, useContext, useEffect } from \u0026#34;react\u0026#34;; // ä¸­å¤®äº‹ä»¶æ€»çº¿ const eventBus = { listeners: {}, subscribe(event, callback) { if (!this.listeners[event]) { this.listeners[event] = []; } this.listeners[event].push(callback); return () =\u0026gt; this.unsubscribe(event, callback); }, unsubscribe(event, callback) { if (!this.listeners[event]) return; this.listeners[event] = this.listeners[event].filter( (listener) =\u0026gt; listener !== callback ); }, publish(event, data) { if (!this.listeners[event]) return; this.listeners[event].forEach((callback) =\u0026gt; callback(data)); }, }; // åˆ›å»ºçŠ¶æ€ä¸Šä¸‹æ–‡ const StateContext = createContext(null); // å…¨å±€çŠ¶æ€åªåŒ…å«å¿…è¦çš„å…±äº«æ•°æ® const initialGlobalState = { user: null, notifications: [], systemSettings: {}, }; // çŠ¶æ€æä¾›è€… export function StateProvider({ children }) { const [globalState, setGlobalState] = useState(initialGlobalState); // æ›´æ–°å…¨å±€çŠ¶æ€çš„æ–¹æ³• const updateGlobalState = (key, value) =\u0026gt; { setGlobalState((prev) =\u0026gt; ({ ...prev, [key]: typeof value === \u0026#34;function\u0026#34; ? value(prev[key]) : value, })); // å‘å¸ƒçŠ¶æ€å˜æ›´äº‹ä»¶ eventBus.publish(\u0026#34;globalStateChange\u0026#34;, { key, value }); }; return ( \u0026lt;StateContext.Provider value={{ globalState, updateGlobalState, eventBus, }} \u0026gt; {children} \u0026lt;/StateContext.Provider\u0026gt; ); } // å…¨å±€çŠ¶æ€é’©å­ export function useGlobalState() { const context = useContext(StateContext); if (!context) { throw new Error(\u0026#34;useGlobalState must be used within StateProvider\u0026#34;); } return context; } // æ¨¡å—çŠ¶æ€é’©å­ - æ¯ä¸ªå¾®å‰ç«¯ä½¿ç”¨ export function createModuleState(moduleName, initialState) { return function useModuleState() { const [moduleState, setModuleState] = useState(initialState); const { eventBus } = useGlobalState(); // æ›´æ–°æ¨¡å—çŠ¶æ€çš„æ–¹æ³• const updateModuleState = (key, value) =\u0026gt; { setModuleState((prev) =\u0026gt; ({ ...prev, [key]: typeof value === \u0026#34;function\u0026#34; ? value(prev[key]) : value, })); // å‘å¸ƒæ¨¡å—çŠ¶æ€å˜æ›´äº‹ä»¶ eventBus.publish(`${moduleName}StateChange`, { key, value }); }; return { moduleState, updateModuleState }; }; } // è·¨æ¨¡å—é€šä¿¡é’©å­ export function useModuleCommunication() { const { eventBus } = useGlobalState(); // å‘é€æ¶ˆæ¯åˆ°å…¶ä»–æ¨¡å— const sendMessage = (targetModule, messageType, data) =\u0026gt; { eventBus.publish(`module:${targetModule}:${messageType}`, data); }; // ç›‘å¬æ¥è‡ªå…¶ä»–æ¨¡å—çš„æ¶ˆæ¯ const listenToMessage = (messageType, callback) =\u0026gt; { return eventBus.subscribe(`module:${messageType}`, callback); }; return { sendMessage, listenToMessage }; } å„å¾®å‰ç«¯æ¨¡å—è¿™æ ·ä½¿ç”¨ï¼š\n// dashboard/Module.js import React from \u0026#34;react\u0026#34;; import { createModuleState, useGlobalState, useModuleCommunication, } from \u0026#34;shell/stateManager\u0026#34;; // åˆ›å»ºæ¨¡å—è‡ªå·±çš„çŠ¶æ€ const useDashboardState = createModuleState(\u0026#34;dashboard\u0026#34;, { metrics: [], filters: { period: \u0026#34;week\u0026#34;, category: \u0026#34;all\u0026#34; }, isLoading: false, }); function Dashboard() { // ä½¿ç”¨å…¨å±€çŠ¶æ€ const { globalState } = useGlobalState(); // ä½¿ç”¨æ¨¡å—è‡ªå·±çš„çŠ¶æ€ const { moduleState, updateModuleState } = useDashboardState(); // æ¨¡å—é—´é€šä¿¡ const { sendMessage, listenToMessage } = useModuleCommunication(); // ç›‘å¬æ¥è‡ªåº“å­˜æ¨¡å—çš„æ¶ˆæ¯ React.useEffect(() =\u0026gt; { const unsubscribe = listenToMessage(\u0026#34;inventory:stockAlert\u0026#34;, (data) =\u0026gt; { // å¤„ç†åº“å­˜è­¦æŠ¥ updateModuleState(\u0026#34;alerts\u0026#34;, (prev) =\u0026gt; [...prev, data]); }); return unsubscribe; }, []); // ç»„ä»¶é€»è¾‘... } è¿™ç§æ¶æ„å¸¦æ¥å‡ ä¸ªå¥½å¤„ï¼š\næ¯ä¸ªæ¨¡å—åªåŠ è½½è‡ªå·±çš„çŠ¶æ€é€»è¾‘ çŠ¶æ€æ›´æ–°åªè§¦å‘ç›¸å…³æ¨¡å—æ¸²æŸ“ æ˜ç¡®çš„é€šä¿¡ç•Œé¢å‡å°‘å†²çª å…¨å±€çŠ¶æ€åªåŒ…å«å¿…è¦æ•°æ® é‡æ„åï¼ŒçŠ¶æ€ç®¡ç†ç›¸å…³çš„å†…å­˜ä½¿ç”¨å‡å°‘äº†çº¦ 60%ï¼Œç»„ä»¶ä¸å¿…è¦çš„é‡æ–°æ¸²æŸ“å‡å°‘äº†çº¦ 75%ã€‚\nAPI å±‚ä¸æ•°æ®è·å–ç­–ç•¥ åŸåº”ç”¨æœ‰ä¸€ä¸ªé—®é¢˜æ˜¯æ•°æ®è·å–æ²¡æœ‰ç­–ç•¥ï¼Œåˆ°å¤„éƒ½æ˜¯é‡å¤è¯·æ±‚ï¼š\n// åŸå§‹æ•°æ®è·å– - æ•£å¸ƒåœ¨ç»„ä»¶ä¸­ function ProductList() { const [products, setProducts] = useState([]); const [loading, setLoading] = useState(false); useEffect(() =\u0026gt; { setLoading(true); fetch(\u0026#34;/api/products\u0026#34;) .then((res) =\u0026gt; res.json()) .then((data) =\u0026gt; { setProducts(data); setLoading(false); }) .catch((err) =\u0026gt; { console.error(err); setLoading(false); }); }, []); // ç»„ä»¶ä»£ç ... } // åŒä¸€ä¸ªAPIåœ¨å¤šä¸ªç»„ä»¶ä¸­é‡å¤è°ƒç”¨ function ProductStats() { const [products, setProducts] = useState([]); useEffect(() =\u0026gt; { fetch(\u0026#34;/api/products\u0026#34;) .then((res) =\u0026gt; res.json()) .then(setProducts); }, []); // æ›´å¤šç»„ä»¶ä»£ç ... } æˆ‘ä»¬è®¾è®¡äº†ä¸€ä¸ª API å±‚æ¶æ„æ¥é›†ä¸­ç®¡ç†æ•°æ®è·å–ï¼š\n// api/core.js - APIæ ¸å¿ƒå±‚ import { createCache } from \u0026#34;../utils/cache\u0026#34;; // è¯·æ±‚é…ç½® const DEFAULT_TIMEOUT = 30000; const apiCache = createCache({ maxAge: 5 * 60 * 1000 }); // é»˜è®¤ç¼“å­˜5åˆ†é’Ÿ // åŸºç¡€è¯·æ±‚å‡½æ•° async function request(url, options = {}) { const { method = \u0026#34;GET\u0026#34;, data, headers = {}, timeout = DEFAULT_TIMEOUT, cache = false, cacheKey, revalidate = false, } = options; // ç”Ÿæˆç¼“å­˜é”® const effectiveCacheKey = cacheKey || `${method}:${url}:${JSON.stringify(data || {})}`; // æ£€æŸ¥ç¼“å­˜ if (cache \u0026amp;\u0026amp; !revalidate) { const cachedResponse = apiCache.get(effectiveCacheKey); if (cachedResponse) { return Promise.resolve(cachedResponse); } } // è®¾ç½®è¯·æ±‚è¶…æ—¶ const controller = new AbortController(); const timeoutId = setTimeout(() =\u0026gt; controller.abort(), timeout); try { const response = await fetch(url, { method, headers: { \u0026#34;Content-Type\u0026#34;: \u0026#34;application/json\u0026#34;, ...headers, }, body: data ? JSON.stringify(data) : undefined, signal: controller.signal, }); clearTimeout(timeoutId); // å¤„ç†é”™è¯¯çŠ¶æ€ç  if (!response.ok) { const error = await response.json().catch(() =\u0026gt; ({})); throw new Error( error.message || `Request failed with status ${response.status}` ); } const result = await response.json(); // å¦‚æœéœ€è¦ç¼“å­˜ï¼Œå­˜å‚¨ç»“æœ if (cache) { apiCache.set(effectiveCacheKey, result); } return result; } catch (error) { clearTimeout(timeoutId); // é‡æ–°æŠ›å‡ºé”™è¯¯ï¼Œä¿ç•™åŸå§‹å †æ ˆ if (error.name === \u0026#34;AbortError\u0026#34;) { throw new Error(`Request timeout after ${timeout}ms`); } throw error; } } // å¯¼å‡ºè¯·æ±‚æ–¹æ³• export const api = { get: (url, options) =\u0026gt; request(url, { ...options, method: \u0026#34;GET\u0026#34; }), post: (url, data, options) =\u0026gt; request(url, { ...options, method: \u0026#34;POST\u0026#34;, data }), put: (url, data, options) =\u0026gt; request(url, { ...options, method: \u0026#34;PUT\u0026#34;, data }), delete: (url, options) =\u0026gt; request(url, { ...options, method: \u0026#34;DELETE\u0026#34; }), // è·å–è¯·æ±‚çŠ¶æ€ invalidateCache: (cacheKey) =\u0026gt; { apiCache.delete(cacheKey); }, clearCache: () =\u0026gt; { apiCache.clear(); }, }; ç„¶åä¸ºæ¯ä¸ªä¸šåŠ¡é¢†åŸŸåˆ›å»ºä¸“ç”¨æ•°æ®æœåŠ¡ï¼š\n// api/products.js - äº§å“é¢†åŸŸAPI import { api } from \u0026#34;./core\u0026#34;; import { useMutation, useQuery } from \u0026#34;../hooks/api\u0026#34;; // åŸºç¡€ç«¯ç‚¹ const BASE_URL = \u0026#34;/api/products\u0026#34;; // äº§å“APIæ–¹æ³• export const productApi = { // è·å–äº§å“åˆ—è¡¨ getProducts: (filters = {}) =\u0026gt; { const queryString = new URLSearchParams(filters).toString(); const url = `${BASE_URL}${queryString ? `?${queryString}` : \u0026#34;\u0026#34;}`; return api.get(url, { cache: true }); }, // è·å–å•ä¸ªäº§å“ getProduct: (id) =\u0026gt; { return api.get(`${BASE_URL}/${id}`, { cache: true }); }, // åˆ›å»ºäº§å“ createProduct: (data) =\u0026gt; { return api.post(BASE_URL, data); }, // æ›´æ–°äº§å“ updateProduct: (id, data) =\u0026gt; { return api.put(`${BASE_URL}/${id}`, data); }, // åˆ é™¤äº§å“ deleteProduct: (id) =\u0026gt; { return api.delete(`${BASE_URL}/${id}`); }, // é‡æ–°éªŒè¯ç¼“å­˜ invalidateProducts: () =\u0026gt; { api.invalidateCache((key) =\u0026gt; key.startsWith(\u0026#34;GET:\u0026#34; + BASE_URL)); }, }; // React Hooks for products export function useProducts(filters = {}, options = {}) { return useQuery( [\u0026#34;products\u0026#34;, filters], () =\u0026gt; productApi.getProducts(filters), options ); } export function useProduct(id, options = {}) { return useQuery([\u0026#34;product\u0026#34;, id], () =\u0026gt; productApi.getProduct(id), options); } export function useCreateProduct() { return useMutation((data) =\u0026gt; productApi.createProduct(data), { onSuccess: () =\u0026gt; { // è‡ªåŠ¨é‡æ–°éªŒè¯äº§å“åˆ—è¡¨ productApi.invalidateProducts(); }, }); } // æ›´å¤šæ•°æ®æ“ä½œé’©å­... é…å¥—è®¾è®¡äº†è‡ªå®šä¹‰é’©å­æ¥ç®€åŒ–æ•°æ®è·å–ï¼š\n// hooks/api.js - æ•°æ®è·å–é’©å­ import { useState, useEffect, useCallback, useRef } from \u0026#34;react\u0026#34;; // ç®€åŒ–ç‰ˆçš„æŸ¥è¯¢é’©å­ export function useQuery(queryKey, queryFn, options = {}) { const { enabled = true, retry = 3, retryDelay = 1000, onSuccess, onError, initialData, staleTime = 0, // æ•°æ®æœ‰æ•ˆæœŸ } = options; // çŠ¶æ€ç®¡ç† const [data, setData] = useState(initialData); const [error, setError] = useState(null); const [status, setStatus] = useState(\u0026#34;idle\u0026#34;); // å¼•ç”¨å€¼ const queryKeyRef = useRef(JSON.stringify(queryKey)); const fetchTimestampRef = useRef(0); const retryCountRef = useRef(0); // å½“å‰æŸ¥è¯¢æ˜¯å¦è¿‡æœŸ const isStale = useCallback(() =\u0026gt; { if (staleTime === 0) return true; return Date.now() - fetchTimestampRef.current \u0026gt; staleTime; }, [staleTime]); // æ‰§è¡ŒæŸ¥è¯¢ const execute = useCallback(async () =\u0026gt; { // é¿å…é‡å¤æŸ¥è¯¢ if (status === \u0026#34;loading\u0026#34;) return; // å¦‚æœæ•°æ®æœªè¿‡æœŸä¸”å­˜åœ¨ï¼Œä¸æ‰§è¡ŒæŸ¥è¯¢ if (data \u0026amp;\u0026amp; !isStale()) return; setStatus(\u0026#34;loading\u0026#34;); retryCountRef.current = 0; const fetchData = async () =\u0026gt; { try { const result = await queryFn(); setData(result); setError(null); setStatus(\u0026#34;success\u0026#34;); fetchTimestampRef.current = Date.now(); if (onSuccess) onSuccess(result); } catch (err) { // é‡è¯•é€»è¾‘ if (retryCountRef.current \u0026lt; retry) { retryCountRef.current++; const delay = typeof retryDelay === \u0026#34;function\u0026#34; ? retryDelay(retryCountRef.current) : retryDelay; setTimeout(fetchData, delay); } else { setError(err); setStatus(\u0026#34;error\u0026#34;); if (onError) onError(err); } } }; fetchData(); }, [data, isStale, onError, onSuccess, queryFn, retry, retryDelay, status]); // åˆå§‹è¯·æ±‚å’ŒæŸ¥è¯¢é”®å˜æ›´æ—¶è¯·æ±‚ useEffect(() =\u0026gt; { const currentQueryKey = JSON.stringify(queryKey); if (queryKeyRef.current !== currentQueryKey) { queryKeyRef.current = currentQueryKey; // æŸ¥è¯¢é”®å˜åŒ–ï¼Œé‡ç½®çŠ¶æ€ setStatus(\u0026#34;idle\u0026#34;); setData(initialData); setError(null); } if (enabled) { execute(); } }, [queryKeyRef.current, enabled, execute, initialData]); // åˆ·æ–°æ•°æ®çš„æ–¹æ³• const refetch = useCallback(() =\u0026gt; { return execute(); }, [execute]); return { data, error, isLoading: status === \u0026#34;loading\u0026#34;, isSuccess: status === \u0026#34;success\u0026#34;, isError: status === \u0026#34;error\u0026#34;, refetch, }; } // æ•°æ®å˜æ›´é’©å­ export function useMutation(mutationFn, options = {}) { const { onSuccess, onError, onSettled } = options; const [state, setState] = useState({ isLoading: false, isSuccess: false, isError: false, error: null, data: undefined, }); const reset = useCallback(() =\u0026gt; { setState({ isLoading: false, isSuccess: false, isError: false, error: null, data: undefined, }); }, []); const mutate = useCallback( async (variables) =\u0026gt; { setState({ ...state, isLoading: true }); try { const data = await mutationFn(variables); setState({ isLoading: false, isSuccess: true, isError: false, error: null, data, }); if (onSuccess) { onSuccess(data, variables); } if (onSettled) { onSettled(data, null, variables); } return data; } catch (error) { setState({ isLoading: false, isSuccess: false, isError: true, error, data: undefined, }); if (onError) { onError(error, variables); } if (onSettled) { onSettled(undefined, error, variables); } throw error; } }, [mutationFn, onError, onSettled, onSuccess, state] ); return { ...state, mutate, reset, }; } è¿™ç§æ¶æ„å¤§å¤§æ”¹è¿›äº†æ•°æ®è·å–æ•ˆç‡ï¼š\nè‡ªåŠ¨ç¼“å­˜å‡å°‘é‡å¤è¯·æ±‚ ç»Ÿä¸€é”™è¯¯å¤„ç†å’Œé‡è¯•é€»è¾‘ å“åº”å¼æ•°æ®æ›´æ–° è‡ªåŠ¨æ•°æ®å¤±æ•ˆ é‡æ„åï¼ŒAPI è¯·æ±‚æ•°é‡å‡å°‘äº†çº¦ 70%ï¼Œæ•°æ®åŠ è½½æ—¶é—´å‡å°‘äº†çº¦ 55%ã€‚\nä»£ç åˆ†å‰²ä¸æ‡’åŠ è½½æˆ˜ç•¥ ä¼ ç»Ÿå‰ç«¯åº”ç”¨é€šå¸¸åªè€ƒè™‘è·¯ç”±çº§åˆ«çš„ä»£ç åˆ†å‰²ï¼Œä½†æˆ‘ä»¬æ›´è¿›ä¸€æ­¥ï¼š\n// ç»„ä»¶çº§åˆ«ä»£ç åˆ†å‰² import React, { lazy, Suspense } from \u0026#34;react\u0026#34;; import Loading from \u0026#34;../../components/Loading\u0026#34;; // åŸºäºä¸šåŠ¡è§„åˆ™çš„é«˜çº§æ‡’åŠ è½½ function lazyWithPreload(factory) { const Component = lazy(factory); Component.preload = factory; return Component; } // å¤æ‚ä»ªè¡¨æ¿ç»„ä»¶æŒ‰éœ€åŠ è½½ const DashboardMetrics = lazyWithPreload(() =\u0026gt; import(\u0026#34;./DashboardMetrics\u0026#34;)); const RevenueChart = lazyWithPreload(() =\u0026gt; import(\u0026#34;./RevenueChart\u0026#34;)); const OrdersTable = lazyWithPreload(() =\u0026gt; import(\u0026#34;./OrdersTable\u0026#34;)); const CustomerMap = lazyWithPreload(() =\u0026gt; import(\u0026#34;./CustomerMap\u0026#34;)); // åŸºäºç”¨æˆ·è§’è‰²å†³å®šæ˜¯å¦é¢„åŠ è½½ function Dashboard({ userRole }) { const [activeTab, setActiveTab] = useState(\u0026#34;overview\u0026#34;); // é¢„åŠ è½½ç­–ç•¥ useEffect(() =\u0026gt; { // ç®¡ç†å‘˜ç”¨æˆ·é¢„åŠ è½½æ‰€æœ‰ç»„ä»¶ if (userRole === \u0026#34;admin\u0026#34;) { DashboardMetrics.preload(); RevenueChart.preload(); OrdersTable.preload(); CustomerMap.preload(); } else { // æ™®é€šç”¨æˆ·åªé¢„åŠ è½½åŸºç¡€ç»„ä»¶ DashboardMetrics.preload(); } }, [userRole]); // å½“ç”¨æˆ·å°†é¼ æ ‡æ‚¬åœåœ¨é€‰é¡¹å¡ä¸Šæ—¶é¢„åŠ è½½å¯¹åº”ç»„ä»¶ const handleTabHover = (tab) =\u0026gt; { if (tab === \u0026#34;revenue\u0026#34; \u0026amp;\u0026amp; activeTab !== \u0026#34;revenue\u0026#34;) { RevenueChart.preload(); } else if (tab === \u0026#34;orders\u0026#34; \u0026amp;\u0026amp; activeTab !== \u0026#34;orders\u0026#34;) { OrdersTable.preload(); } else if (tab === \u0026#34;customers\u0026#34; \u0026amp;\u0026amp; activeTab !== \u0026#34;customers\u0026#34;) { CustomerMap.preload(); } }; return ( \u0026lt;div className=\u0026#34;dashboard\u0026#34;\u0026gt; \u0026lt;nav className=\u0026#34;dashboard-tabs\u0026#34;\u0026gt; \u0026lt;button className={activeTab === \u0026#34;overview\u0026#34; ? \u0026#34;active\u0026#34; : \u0026#34;\u0026#34;} onClick={() =\u0026gt; setActiveTab(\u0026#34;overview\u0026#34;)} \u0026gt; Overview \u0026lt;/button\u0026gt; \u0026lt;button className={activeTab === \u0026#34;revenue\u0026#34; ? \u0026#34;active\u0026#34; : \u0026#34;\u0026#34;} onClick={() =\u0026gt; setActiveTab(\u0026#34;revenue\u0026#34;)} onMouseEnter={() =\u0026gt; handleTabHover(\u0026#34;revenue\u0026#34;)} \u0026gt; Revenue \u0026lt;/button\u0026gt; {/* å…¶ä»–é€‰é¡¹å¡ */} \u0026lt;/nav\u0026gt; \u0026lt;div className=\u0026#34;dashboard-content\u0026#34;\u0026gt; {activeTab === \u0026#34;overview\u0026#34; \u0026amp;\u0026amp; ( \u0026lt;Suspense fallback={\u0026lt;Loading /\u0026gt;}\u0026gt; \u0026lt;DashboardMetrics /\u0026gt; \u0026lt;/Suspense\u0026gt; )} {activeTab === \u0026#34;revenue\u0026#34; \u0026amp;\u0026amp; ( \u0026lt;Suspense fallback={\u0026lt;Loading /\u0026gt;}\u0026gt; \u0026lt;RevenueChart /\u0026gt; \u0026lt;/Suspense\u0026gt; )} {/* å…¶ä»–å†…å®¹ */} \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; ); } æˆ‘ä»¬ç”šè‡³å¯¹ç»„ä»¶åº“åšäº†æ›´ç²¾ç»†çš„æ‹†åˆ†ï¼š\n// æŒ‰éœ€åŠ è½½çš„ç»„ä»¶åº“ // components/index.js export { Button } from \u0026#34;./Button\u0026#34;; export { Card } from \u0026#34;./Card\u0026#34;; export { Table } from \u0026#34;./Table\u0026#34;; // ...é¿å…ä¸€æ¬¡å¯¼å…¥æ‰€æœ‰ç»„ä»¶ // ä½¿ç”¨ç¤ºä¾‹ - åªå¯¼å…¥éœ€è¦çš„ç»„ä»¶ import { Button, Card } from \u0026#34;../components\u0026#34;; // è€Œä¸æ˜¯ import * from \u0026#39;../components\u0026#39;; è¿™ç§æ‹†åˆ†ç­–ç•¥å°†åˆå§‹åŠ è½½çš„ç»„ä»¶åº“ä»£ç å‡å°‘äº†çº¦ 85%ï¼Œå®ç°äº†çœŸæ­£çš„æŒ‰éœ€åŠ è½½ã€‚\næ¸è¿›å¼æ¶æ„è¿ç§»ç­–ç•¥ å¯¹äºå¤§å‹é—ç•™åº”ç”¨ï¼Œæˆ‘ä»¬å¼€å‘äº†ä¸€ç§\u0026quot;å®¹å™¨æ¨¡å¼\u0026quot;ï¼Œå®ç°æ¸è¿›å¼å¾®å‰ç«¯è¿ç§»ï¼š\n// é—ç•™åº”ç”¨åŒ…è£…å™¨ import React, { useEffect, useRef } from \u0026#34;react\u0026#34;; // åŒ…è£…æ—§åº”ç”¨çš„å®¹å™¨ export function LegacyAppContainer({ route, onNavigate }) { const containerRef = useRef(null); useEffect(() =\u0026gt; { if (!containerRef.current) return; // æ³¨å…¥æ—§åº”ç”¨ const clean = mountLegacyApp(containerRef.current, { initialRoute: route, onNavigate: (newRoute) =\u0026gt; { // å½“æ—§åº”ç”¨å¯¼èˆªæ—¶é€šçŸ¥æ–°æ¶æ„ if (onNavigate) onNavigate(newRoute); }, }); return () =\u0026gt; { // æ¸…ç†æ—§åº”ç”¨ if (clean) clean(); }; }, [route, onNavigate]); return \u0026lt;div className=\u0026#34;legacy-container\u0026#34; ref={containerRef} /\u0026gt;; } // åœ¨æ—§åº”ç”¨ä¸­æ³¨å…¥é€šä¿¡æ¡¥æ¥å™¨ function mountLegacyApp(container, options) { const { initialRoute, onNavigate } = options; // åŠ è½½æ—§åº”ç”¨è„šæœ¬ const script = document.createElement(\u0026#34;script\u0026#34;); script.src = \u0026#34;/legacy-app.js\u0026#34;; document.head.appendChild(script); return new Promise((resolve) =\u0026gt; { // ç­‰å¾…æ—§åº”ç”¨åŠ è½½å®Œæˆ window.onLegacyAppLoaded = () =\u0026gt; { // åˆå§‹åŒ–æ—§åº”ç”¨ window.legacyApp.init(container, initialRoute); // ç›‘å¬æ—§åº”ç”¨å¯¼èˆª window.legacyApp.onNavigate = onNavigate; // è¿”å›æ¸…ç†å‡½æ•° resolve(() =\u0026gt; { window.legacyApp.unmount(); container.innerHTML = \u0026#34;\u0026#34;; }); }; }); } è¿™ç§æ–¹å¼è®©æˆ‘ä»¬èƒ½å¤Ÿå¢é‡è¿ç§»ï¼Œè€Œä¸æ˜¯ä¸€æ¬¡æ€§é‡å†™æ•´ä¸ªåº”ç”¨ã€‚\næ„å»ºä¼˜åŒ–ä¸éƒ¨ç½²ç­–ç•¥ é™¤äº†å‰ç«¯æ¶æ„ï¼Œæˆ‘ä»¬è¿˜ä¼˜åŒ–äº†æ„å»ºç³»ç»Ÿï¼š\n// webpack.prod.js - ä¼˜åŒ–ç”Ÿäº§æ„å»º const { BundleAnalyzerPlugin } = require(\u0026#34;webpack-bundle-analyzer\u0026#34;); const CompressionPlugin = require(\u0026#34;compression-webpack-plugin\u0026#34;); const TerserPlugin = require(\u0026#34;terser-webpack-plugin\u0026#34;); module.exports = { // åŸºç¡€é…ç½®... optimization: { minimizer: [ new TerserPlugin({ terserOptions: { compress: { drop_console: true, }, }, extractComments: false, }), ], splitChunks: { chunks: \u0026#34;all\u0026#34;, maxInitialRequests: 25, minSize: 20000, cacheGroups: { vendors: { test: /[\\\\/]node_modules[\\\\/]/, name(module) { // ä¸ºæ¯ä¸ªnpmåŒ…åˆ›å»ºå•ç‹¬çš„chunk const packageName = module.context.match( /[\\\\/]node_modules[\\\\/](.*?)([\\\\/]|$)/ )[1]; return `npm.${packageName.replace(\u0026#34;@\u0026#34;, \u0026#34;\u0026#34;)}`; }, }, common: { minChunks: 2, priority: -10, reuseExistingChunk: true, }, }, }, }, plugins: [ // å…¶ä»–æ’ä»¶... new CompressionPlugin({ algorithm: \u0026#34;gzip\u0026#34;, test: /\\.(js|css|html|svg)$/, threshold: 10240, minRatio: 0.8, }), process.env.ANALYZE \u0026amp;\u0026amp; new BundleAnalyzerPlugin(), ].filter(Boolean), }; æˆ‘ä»¬è¿˜é‡‡ç”¨äº†å¢é‡éƒ¨ç½²ç­–ç•¥ï¼Œåªæ›´æ–°å˜æ›´çš„æ¨¡å—ï¼Œå¤§å¤§å‡å°‘äº†éƒ¨ç½²æ—¶é—´å’Œé£é™©ã€‚\nå®é™…æ€§èƒ½æ”¹è¿›æ•°æ® æ¶æ„é‡æ„å–å¾—äº†æ˜¾è‘—æˆæ•ˆ:\næŒ‡æ ‡ é‡æ„å‰ é‡æ„å æ”¹è¿›ç‡ é¦–å±åŠ è½½æ—¶é—´ 8.6s 1.2s 86% åˆå§‹ JS ä½“ç§¯ 1.6MB 280KB 83% å†…å­˜ä½¿ç”¨ å¹³å‡ 215MB å¹³å‡ 76MB 65% äº¤äº’å“åº”æ—¶é—´ å¹³å‡ 600ms \u0026lt;100ms 83% API è¯·æ±‚æ•° ~120 æ¬¡/é¡µé¢ ~35 æ¬¡/é¡µé¢ 71% å¼€å‘è¿­ä»£å‘¨æœŸ 2 å‘¨ 4 å¤© 71% æ›´é‡è¦çš„æ˜¯ï¼Œç³»ç»Ÿå¯ç»´æŠ¤æ€§å¤§å¹…æå‡ï¼Œæ–°åŠŸèƒ½å¼€å‘é€Ÿåº¦æé«˜äº† 3 å€ã€‚\næ¶æ„ä¼˜åŒ–çš„å…³é”®æ•™è®­ æ€»ç»“è¿™æ¬¡é‡æ„çš„å…³é”®ç»éªŒï¼š\nä¸šåŠ¡è¾¹ç•Œä¼˜å…ˆäºæŠ€æœ¯è¾¹ç•Œ: æŒ‰ç…§ä¸šåŠ¡åŸŸè€ŒéæŠ€æœ¯å±‚åˆ†å‰²åº”ç”¨ï¼Œä½¿å›¢é˜Ÿèƒ½ä¸“æ³¨äºå®Œæ•´åŠŸèƒ½è€ŒéæŠ€æœ¯å±‚\nçŠ¶æ€æ˜¯é¦–è¦æ€§èƒ½ç“¶é¢ˆ: å¤§å‹åº”ç”¨ä¸­ï¼ŒçŠ¶æ€ç®¡ç†æ¯”æ¸²æŸ“ä¼˜åŒ–æ›´èƒ½å½±å“æ€§èƒ½\nä»…æŒ‰éœ€åŠ è½½ï¼Œç”šè‡³è¿æ¡†æ¶ä¹Ÿæ˜¯: å¯¹ React ç­‰åŸºç¡€åº“åº”ç”¨ä»£ç åˆ†å‰²ï¼ŒåªåŠ è½½å¿…è¦éƒ¨åˆ†\næ•°æ®è·å–ç­–ç•¥æ˜¯éšè—çš„é‡‘çŸ¿: ä¼˜åŒ– API è°ƒç”¨æ¨¡å¼å¸¸å¸¸æ¯”ä¼˜åŒ–ç»„ä»¶æ¸²æŸ“æ›´æœ‰æ•ˆ\næ¸è¿›å¢å¼ºèƒœè¿‡å…¨é¢é‡æ„: ä½¿ç”¨å®¹å™¨æ¨¡å¼æ¸è¿›è¿ç§»ï¼Œè€Œéä¸€æ¬¡æ€§å¤§è§„æ¨¡é‡å†™\nç›‘æ§å’Œè¡¡é‡æ˜¯å…³é”®: æ²¡æœ‰æ•°æ®æ”¯æŒçš„æ¶æ„å†³ç­–å¾€å¾€æ˜¯é”™è¯¯çš„\næ¶æ„æ€§èƒ½çš„æœªæ¥è¶‹åŠ¿ é€šè¿‡è¿™ä¸ªé¡¹ç›®ï¼Œæˆ‘è§‚å¯Ÿåˆ°å‡ ä¸ªå€¼å¾—å…³æ³¨çš„å‰ç«¯æ¶æ„è¶‹åŠ¿ï¼š\næœåŠ¡å™¨ç»„ä»¶ï¼šReact Server Components ç­‰æŠ€æœ¯è¿›ä¸€æ­¥æ¨¡ç³Šå‰åç«¯è¾¹ç•Œ\nç»†ç²’åº¦åŒ…ç®¡ç†ï¼šES æ¨¡å—å’Œ Import Maps è®©æµè§ˆå™¨ç›´æ¥ç®¡ç†ä¾èµ–æˆä¸ºå¯èƒ½\né™æ€ç”Ÿæˆä¸å¢é‡é™æ€å†ç”Ÿï¼šè¶Šæ¥è¶Šå¤šå†…å®¹å‰ç½®åˆ°æ„å»ºæ—¶ï¼Œè€Œéè¿è¡Œæ—¶\nè¾¹ç¼˜è®¡ç®—ï¼šå°†æ¸²æŸ“é€»è¾‘æ¨å‘ CDN è¾¹ç¼˜ï¼Œå‡å°‘å»¶è¿Ÿ\næˆ‘ä»¬å·²ç»å¼€å§‹åœ¨é¡¹ç›®ä¸­å®éªŒæ€§åœ°åº”ç”¨è¿™äº›æŠ€æœ¯ï¼Œæœªæ¥çš„æ¶æ„å°†æ›´å€¾å‘äº\u0026quot;åˆ†å¸ƒå¼æ¸²æŸ“\u0026quot;ï¼Œè€Œéä¼ ç»Ÿçš„å®¢æˆ·ç«¯/æœåŠ¡å™¨äºŒåˆ†æ³•ã€‚\nç»“è¯­ å‰ç«¯æ¶æ„è®¾è®¡ä¸æ€§èƒ½ä¼˜åŒ–ä¸æ˜¯ç‹¬ç«‹çš„å…³æ³¨ç‚¹ï¼Œè€Œæ˜¯å¯†ä¸å¯åˆ†çš„æ•´ä½“ã€‚æ­£ç¡®çš„æ¶æ„å†³ç­–æœ¬èº«å°±èƒ½å¸¦æ¥å·¨å¤§çš„æ€§èƒ½æå‡ï¼Œæ— éœ€äº‹åä¼˜åŒ–ã€‚\né€šè¿‡æ‹†åˆ†å·¨çŸ³åº”ç”¨ä¸ºå¾®å‰ç«¯ã€é‡æ„çŠ¶æ€ç®¡ç†ã€ä¼˜åŒ–æ•°æ®è·å–ç­–ç•¥å’Œå®æ–½æ™ºèƒ½ä»£ç åˆ†å‰²ï¼Œæˆ‘ä»¬ä¸ä»…æ˜¾è‘—æå‡äº†åº”ç”¨æ€§èƒ½ï¼Œè¿˜æ”¹å–„äº†å¼€å‘ä½“éªŒå’Œç³»ç»Ÿå¯ç»´æŠ¤æ€§ã€‚\næ¶æ„å±‚é¢çš„ä¼˜åŒ–æä¾›äº†æ¯”ç»„ä»¶çº§ä¼˜åŒ–æ›´æŒä¹…ã€æ›´æ·±è¿œçš„ä»·å€¼ã€‚æ­£å¦‚æˆ‘ä»¬åœ¨è¿™ä¸ªé¡¹ç›®ä¸­æ‰€è¯æ˜çš„ï¼Œæ€è€ƒç³»ç»Ÿçš„åˆ†å½¢ç»“æ„ï¼Œä»æ•´ä½“åˆ°å±€éƒ¨ï¼Œèƒ½å¸¦æ¥è¶…å‡ºé¢„æœŸçš„æ€§èƒ½æ”¹è¿›ã€‚\næ— è®ºä½ æ˜¯æ„å»ºå…¨æ–°åº”ç”¨è¿˜æ˜¯æ”¹è¿›ç°æœ‰ç³»ç»Ÿï¼Œè®°ä½è¿™ä¸€ç‚¹ï¼šä¼Ÿå¤§çš„æ€§èƒ½å§‹äºä¼Ÿå¤§çš„æ¶æ„ï¼ŒäºŒè€…ç›¸è¾…ç›¸æˆï¼Œå…±åŒæ„å»ºå“è¶Šçš„ç”¨æˆ·ä½“éªŒã€‚\nç›¸å…³é˜…è¯» Vite æ„å»º React é¡¹ç›®çš„æè‡´ä¼˜åŒ– - äº†è§£å¦‚ä½•ä¼˜åŒ–å‰ç«¯æ„å»ºæµç¨‹ React è™šæ‹Ÿ DOM æ·±åº¦å‰–æ - æ·±å…¥ç†è§£ React æ¸²æŸ“æœºåˆ¶ ç°ä»£å‰ç«¯å·¥ç¨‹åŒ–å®è·µæŒ‡å— - æ¢ç´¢æ›´å¤šå·¥ç¨‹åŒ–æœ€ä½³å®è·µ ","permalink":"https://www.yss520.online/zh/posts/architecture-and-performance/","summary":"\u003ch1 id=\"ç°ä»£å‰ç«¯æ¶æ„è®¾è®¡ä¸æ€§èƒ½ä»åˆ†å½¢åˆ°åŸå­çš„æ€§èƒ½æå‡ä¹‹æ—…\"\u003eç°ä»£å‰ç«¯æ¶æ„è®¾è®¡ä¸æ€§èƒ½ï¼šä»åˆ†å½¢åˆ°åŸå­çš„æ€§èƒ½æå‡ä¹‹æ—…\u003c/h1\u003e\n\u003cp\u003eå»å¹´æˆ‘è´Ÿè´£é‡æ„äº†ä¸€ä¸ªè¿è¡Œäº† 5 å¹´çš„å¤§å‹ B2B SaaS å¹³å°ã€‚æœ€åˆï¼Œå®ƒæ˜¯ä¸€ä¸ªå•ä½“ React åº”ç”¨ï¼Œä»£ç è¶…è¿‡ 15 ä¸‡è¡Œï¼Œè¿è¡Œç¼“æ…¢ä¸”ç»´æŠ¤å›°éš¾ã€‚ç»è¿‡ 3 ä¸ªæœˆçš„æ¶æ„é‡è®¾è®¡ï¼Œæˆ‘ä»¬å°†é¦–å±åŠ è½½æ—¶é—´ä» 8.6 ç§’é™è‡³ 1.2 ç§’ï¼Œå†…å­˜ä½¿ç”¨å‡å°‘ 65%ï¼Œäº¤äº’å“åº”ä»å¹³å‡ 600ms æå‡è‡³ä¸åˆ° 100msã€‚æ›´é‡è¦çš„æ˜¯ï¼Œå¼€å‘æ•ˆç‡æé«˜äº† 3 å€ï¼Œè¿™ç§æ¶æ„å±‚é¢çš„ä¼˜åŒ–å½±å“æ·±è¿œï¼Œä»Šå¤©æˆ‘æƒ³åˆ†äº«è¿™æ®µç»å†ã€‚\u003c/p\u003e\n\u003ch2 id=\"ç°ä»£æ¶æ„æ¨¡å¼ä¸æ€§èƒ½çš„éšç§˜å…³ç³»\"\u003eç°ä»£æ¶æ„æ¨¡å¼ä¸æ€§èƒ½çš„éšç§˜å…³ç³»\u003c/h2\u003e\n\u003cp\u003eä¼ ç»Ÿè§‚ç‚¹è®¤ä¸ºæ¶æ„æ˜¯ä¸ºäº†å¯ç»´æŠ¤æ€§ï¼Œæ€§èƒ½ä¼˜åŒ–æ˜¯å•ç‹¬çš„ä»»åŠ¡ã€‚å®é™…ä¸Šï¼Œæ­£ç¡®çš„æ¶æ„å†³ç­–æœ¬èº«å°±èƒ½å¸¦æ¥æ˜¾è‘—çš„æ€§èƒ½æå‡ã€‚\u003c/p\u003e\n\u003ch3 id=\"ä»å·¨çŸ³åˆ°å¾®å‰ç«¯æ‹†åˆ†ä¸æ‡’åŠ è½½çš„è‰ºæœ¯\"\u003eä»å·¨çŸ³åˆ°å¾®å‰ç«¯ï¼šæ‹†åˆ†ä¸æ‡’åŠ è½½çš„è‰ºæœ¯\u003c/h3\u003e\n\u003cp\u003eæœ€åˆçš„å•ä½“åº”ç”¨å«æœ‰è¶…è¿‡ 20 ä¸ªä¸»è¦ä¸šåŠ¡æ¨¡å—ï¼Œæ‰€æœ‰ä»£ç æ‰“åŒ…åœ¨ä¸€èµ·ï¼Œå¯¼è‡´å³ä½¿ç”¨æˆ·åªéœ€ä¸€ä¸ªç®€å•åŠŸèƒ½ï¼Œä¹Ÿè¦åŠ è½½æ•´ä¸ªåº”ç”¨ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-javascript\" data-lang=\"javascript\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e// åŸå§‹å…¥å£æ–‡ä»¶ - æ‰€æœ‰æ¨¡å—ä¸€æ¬¡æ€§åŠ è½½\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003eimport\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eReact\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003efrom\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;react\u0026#34;\u003c/span\u003e;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003eimport\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eReactDOM\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003efrom\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;react-dom\u0026#34;\u003c/span\u003e;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003eimport\u003c/span\u003e { \u003cspan style=\"color:#a6e22e\"\u003eBrowserRouter\u003c/span\u003e } \u003cspan style=\"color:#a6e22e\"\u003efrom\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;react-router-dom\u0026#34;\u003c/span\u003e;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003eimport\u003c/span\u003e { \u003cspan style=\"color:#a6e22e\"\u003eProvider\u003c/span\u003e } \u003cspan style=\"color:#a6e22e\"\u003efrom\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;react-redux\u0026#34;\u003c/span\u003e;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e// å¯¼å…¥æ‰€æœ‰æ¨¡å—\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003eimport\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eDashboard\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003efrom\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;./modules/dashboard\u0026#34;\u003c/span\u003e;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003eimport\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eInventory\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003efrom\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;./modules/inventory\u0026#34;\u003c/span\u003e;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003eimport\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eOrders\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003efrom\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;./modules/orders\u0026#34;\u003c/span\u003e;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003eimport\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eAnalytics\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003efrom\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;./modules/analytics\u0026#34;\u003c/span\u003e;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003eimport\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eUsers\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003efrom\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;./modules/users\u0026#34;\u003c/span\u003e;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003eimport\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eSettings\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003efrom\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;./modules/settings\u0026#34;\u003c/span\u003e;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e// ... 15ä¸ªå…¶ä»–æ¨¡å—\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003eimport\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003estore\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003efrom\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;./store\u0026#34;\u003c/span\u003e;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003eimport\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eApp\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003efrom\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;./App\u0026#34;\u003c/span\u003e;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a6e22e\"\u003eReactDOM\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003erender\u003c/span\u003e(\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#f92672\"\u003e\u0026lt;\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003eProvider\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003estore\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e{\u003cspan style=\"color:#a6e22e\"\u003estore\u003c/span\u003e}\u003cspan style=\"color:#f92672\"\u003e\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003e\u0026lt;\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003eBrowserRouter\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#f92672\"\u003e\u0026lt;\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003eApp\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e/\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003e\u0026lt;\u003c/span\u003e\u003cspan style=\"color:#960050;background-color:#1e0010\"\u003e/BrowserRouter\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#f92672\"\u003e\u0026lt;\u003c/span\u003e\u003cspan style=\"color:#960050;background-color:#1e0010\"\u003e/Provider\u0026gt;,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  document.\u003cspan style=\"color:#a6e22e\"\u003egetElementById\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;root\u0026#34;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e);\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eè¿™å¯¼è‡´åˆå§‹ JavaScript åŒ…è¾¾åˆ° 5.8MBï¼Œå³ä½¿ç»è¿‡å‹ç¼©ä¹Ÿæœ‰ 1.6MBã€‚æˆ‘ä»¬å†³å®šé‡‡ç”¨å¾®å‰ç«¯æ¶æ„ï¼Œä½†ä¸æ˜¯ç›²ç›®è·Ÿé£ï¼Œè€Œæ˜¯æ ¹æ®ä¸šåŠ¡è¾¹ç•Œç²¾ç¡®åˆ’åˆ†ï¼š\u003c/p\u003e","title":"ç°ä»£å‰ç«¯æ¶æ„è®¾è®¡ä¸æ€§èƒ½ä¼˜åŒ–"},{"content":"å‰ç«¯æ„å»ºç³»ç»Ÿçš„æ¼”è¿›ä¸ä¼˜åŒ–ï¼šä»æ‰“åŒ…åˆ°æ— æ„å»º ä¸Šä¸ªæœˆæˆ‘ä»¬å›¢é˜Ÿé‡æ„äº†ä¸€ä¸ªæœ‰ 4 å¹´å†å²çš„å¤§å‹å‰ç«¯é¡¹ç›®çš„æ„å»ºç³»ç»Ÿï¼Œä»è€æ—§çš„ Webpack é…ç½®è¿ç§»åˆ°ç°ä»£åŒ–çš„ Vite æ„å»ºã€‚é¢„è®¡éœ€è¦ä¸¤å‘¨çš„å·¥ä½œå®é™…ä¸ŠèŠ±äº†ä¸€ä¸ªæœˆï¼Œä½†ç»“æœè®©äººæŒ¯å¥‹ï¼šå¼€å‘æœåŠ¡å™¨å¯åŠ¨æ—¶é—´ä» 40 ç§’é™åˆ°ä¸åˆ° 2 ç§’ï¼Œæ„å»ºæ—¶é—´å‡å°‘äº† 70%ï¼Œæœ€ç»ˆåŒ…ä½“ç§¯ç¼©å°äº† 23%ã€‚è¿™æ¬¡ç»å†è®©æˆ‘é‡æ–°å®¡è§†äº†å‰ç«¯æ„å»ºç³»ç»Ÿçš„å‘å±•å†ç¨‹ï¼Œä»Šå¤©å°±æ¥åˆ†äº«ä¸€äº›æ·±åº¦æ€è€ƒã€‚\næ„å»ºç³»ç»Ÿçš„åº•å±‚åŸç†ï¼šæ¯”æƒ³è±¡ä¸­å¤æ‚å¾—å¤š å½“æˆ‘ä»¬è¿è¡Œnpm startæ—¶ï¼ŒèƒŒååˆ°åº•å‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿé€šè¿‡ç ”ç©¶å„ç§å·¥å…·çš„æºç ï¼Œæˆ‘å‘ç°æ„å»ºå·¥å…·è¿œæ¯”æˆ‘æƒ³è±¡çš„å¤æ‚ã€‚\nå…ˆçœ‹çœ‹æœ€åŸºç¡€çš„éƒ¨åˆ†ï¼šæ¨¡å—è§£æã€‚ä»¥ Webpack ä¸ºä¾‹ï¼Œå®ƒçš„æ¨¡å—è§£æè¿‡ç¨‹ï¼š\n// webpackæºç ç®€åŒ–ç‰ˆç‰‡æ®µ function createResolver(options) { return (context, request, callback) =\u0026gt; { // ä»å½“å‰è·¯å¾„å¼€å§‹æ£€ç´¢æ¨¡å— const possiblePaths = [ path.join(context, request), path.join(context, \u0026#34;node_modules\u0026#34;, request), // ä¸€ç›´å‘ä¸ŠæŸ¥æ‰¾node_modules ]; // ä¾æ¬¡å°è¯•æ¯ä¸ªå¯èƒ½çš„è·¯å¾„ for (const modulePath of possiblePaths) { if (fs.existsSync(modulePath)) { return callback(null, modulePath); } // å°è¯•æ‰©å±•å for (const ext of [\u0026#34;.js\u0026#34;, \u0026#34;.json\u0026#34;, \u0026#34;.node\u0026#34;]) { const withExt = modulePath + ext; if (fs.existsSync(withExt)) { return callback(null, withExt); } } } // æ¨¡å—æœªæ‰¾åˆ° callback(new Error(`Module not found: ${request}`)); }; } çœ‹èµ·æ¥ç®€å•ï¼Œä½†å®é™…å®ç°è¦è€ƒè™‘å„ç§è¾¹ç¼˜æƒ…å†µï¼šè½¯é“¾æ¥ã€package.json ä¸­çš„å­—æ®µé¡ºåºã€å„ç§å¯¼å…¥è¯­æ³•ç­‰ã€‚\nä¸€ä¸ªæœ‰è¶£çš„å‘ç°æ˜¯ï¼Œè®¸å¤šå¼€å‘è€…ä¸çŸ¥é“ä¸ºä»€ä¹ˆnode_modulesä¼šè†¨èƒ€å¾—å¦‚æ­¤ä¹‹å¿«ã€‚æ¢ç©¶åŸå› éœ€è¦ç†è§£ Node çš„æ¨¡å—è§£æç®—æ³•ï¼š\n// ç®€åŒ–ç‰ˆçš„Nodeæ¨¡å—æŸ¥æ‰¾ç®—æ³• function findModule(fromDir, moduleName) { // å…ˆæ£€æŸ¥å½“å‰ç›®å½•çš„node_modules let currentDir = fromDir; while (currentDir !== \u0026#34;/\u0026#34;) { const modulePath = path.join(currentDir, \u0026#34;node_modules\u0026#34;, moduleName); if (fs.existsSync(modulePath)) { return modulePath; } // ç»§ç»­å‘ä¸Šå±‚ç›®å½•æŸ¥æ‰¾ currentDir = path.dirname(currentDir); } throw new Error(`Cannot find module \u0026#39;${moduleName}\u0026#39;`); } è¿™ä¸ªç®—æ³•å¯¼è‡´äº†åŒä¸€ä¸ªåŒ…çš„å¤šä¸ªç‰ˆæœ¬ä¼šè¢«å®‰è£…åœ¨ä¸åŒå±‚çº§çš„node_modulesä¸­ï¼Œå½¢æˆäº†è‡­åæ˜­è‘—çš„\u0026quot;ä¾èµ–åœ°ç‹±\u0026quot;ã€‚\næ–°æ—¶ä»£æ„å»ºå·¥å…·çš„ç§˜å¯†æ­¦å™¨ï¼šESM ä¸æµè§ˆå™¨åŸç”Ÿæ¨¡å— ä¼ ç»Ÿæ„å»ºå·¥å…·ä¸ç°ä»£æ„å»ºå·¥å…·çš„ä¸€ä¸ªæ ¸å¿ƒåŒºåˆ«æ˜¯å¯¹ ESM çš„å¤„ç†æ–¹å¼ã€‚ä»¥ Vite ä¸ºä¾‹ï¼Œå®ƒçš„å¼€å‘æ¨¡å¼ä¸‹ä¸æ‰“åŒ…ï¼Œè€Œæ˜¯åˆ©ç”¨æµè§ˆå™¨åŸç”Ÿ ESM èƒ½åŠ›ï¼š\n// Viteå¼€å‘æœåŠ¡å™¨ç®€åŒ–æ ¸å¿ƒé€»è¾‘ async function createDevServer() { // åˆ›å»ºHTTPæœåŠ¡å™¨ const server = http.createServer(async (req, res) =\u0026gt; { const url = new URL(req.url, `http://${req.headers.host}`); const pathname = url.pathname; // å¤„ç†HTMLè¯·æ±‚ if (pathname === \u0026#34;/\u0026#34;) { // æä¾›å…¥å£HTMLï¼Œæ³¨å…¥å®¢æˆ·ç«¯è„šæœ¬ const html = await fs.readFile(\u0026#34;index.html\u0026#34;, \u0026#34;utf-8\u0026#34;); const injectedHtml = html.replace( \u0026#34;\u0026lt;/head\u0026gt;\u0026#34;, `\u0026lt;script type=\u0026#34;module\u0026#34; src=\u0026#34;/@vite/client\u0026#34;\u0026gt;\u0026lt;/script\u0026gt;\u0026lt;/head\u0026gt;` ); res.end(injectedHtml); return; } // å¤„ç†JavaScriptæ¨¡å—è¯·æ±‚ if (pathname.endsWith(\u0026#34;.js\u0026#34;) || pathname.endsWith(\u0026#34;.ts\u0026#34;)) { // è¯»å–æ–‡ä»¶ const filePath = path.join(process.cwd(), pathname); let code = await fs.readFile(filePath, \u0026#34;utf-8\u0026#34;); // è½¬æ¢importè¯­å¥ä¸ºæµè§ˆå™¨å¯ç†è§£çš„è·¯å¾„ code = code.replace( /import\\s+(\\{[^}]+\\}|\\w+)\\s+from\\s+[\u0026#39;\u0026#34;]([^\u0026#39;\u0026#34;]+)[\u0026#39;\u0026#34;]/g, (match, imports, importPath) =\u0026gt; { // å¤„ç†node_moduleså¯¼å…¥ if (!importPath.startsWith(\u0026#34;.\u0026#34;) \u0026amp;\u0026amp; !importPath.startsWith(\u0026#34;/\u0026#34;)) { return `import ${imports} from \u0026#34;/@modules/${importPath}\u0026#34;`; } return match; } ); // å¤„ç†TypeScriptæˆ–å…¶ä»–è½¬æ¢ if (pathname.endsWith(\u0026#34;.ts\u0026#34;)) { code = transformTs(code); } res.setHeader(\u0026#34;Content-Type\u0026#34;, \u0026#34;application/javascript\u0026#34;); res.end(code); return; } // å¤„ç†node_modulesä¸­çš„æ¨¡å— if (pathname.startsWith(\u0026#34;/@modules/\u0026#34;)) { const moduleName = pathname.slice(\u0026#34;/@modules/\u0026#34;.length); const modulePath = resolveNodeModule(moduleName); // å¤„ç†å¤–éƒ¨æ¨¡å—... // ... } // å…¶ä»–èµ„æºå¤„ç†... }); return server; } è¿™æ®µä»£ç æ­ç¤ºäº† Vite ä¸ Webpack çš„å…³é”®åŒºåˆ«ï¼šVite åœ¨å¼€å‘æ¨¡å¼ä¸‹ä¸æ‰“åŒ…ï¼Œè€Œæ˜¯æ‹¦æˆªæµè§ˆå™¨çš„æ¨¡å—è¯·æ±‚ï¼ŒåŠ¨æ€å¤„ç†æ¯ä¸ªè¯·æ±‚å¹¶æä¾›è½¬æ¢åçš„å•ä¸ªæ–‡ä»¶ã€‚\nåœ¨æˆ‘ä»¬è¿ç§»åˆ° Vite çš„é¡¹ç›®ä¸­ï¼Œå¼€å‘ä½“éªŒçš„æå‡éå¸¸æ˜¾è‘—ï¼Œçƒ­æ›´æ–°æ—¶é—´ä» 1-2 ç§’é™åˆ°äº†æ¥è¿‘å®æ—¶ã€‚ä½†å†…éƒ¨å®ç°å¤æ‚åº¦è¿œè¶…é¢„æœŸã€‚\næºç åˆ†æï¼šWebpack ä¸ Vite çš„å†…éƒ¨ä¼˜åŒ–å·®å¼‚ æ·±å…¥ Webpack å’Œ Vite çš„æºç å¯¹æ¯”ï¼Œå‘ç°äº†å‡ ä¸ªå…³é”®çš„æ€§èƒ½å·®å¼‚ç‚¹ï¼š\n1. ç¼“å­˜æœºåˆ¶ // Webpackæ„å»ºç¼“å­˜å®ç°ç‰‡æ®µ class Cache { constructor(options) { this.options = options || {}; this.hooks = { store: new SyncHook([\u0026#34;cache\u0026#34;, \u0026#34;callback\u0026#34;]), storeBuildDependencies: new SyncHook([\u0026#34;dependencies\u0026#34;]), get: new SyncHook([\u0026#34;cache\u0026#34;, \u0026#34;identifier\u0026#34;, \u0026#34;etag\u0026#34;]), }; this.idToCache = new Map(); this.etags = new Map(); } // å‘ç¼“å­˜ä¸­å­˜å…¥æ•°æ® store(identifier, etag, data, callback) { this.idToCache.set(identifier, data); this.etags.set(identifier, etag); this.hooks.store.call(data, callback); } // ä»ç¼“å­˜ä¸­è¯»å–æ•°æ® get(identifier, etag, callback) { const data = this.idToCache.get(identifier); const oldEtag = this.etags.get(identifier); if (data \u0026amp;\u0026amp; oldEtag === etag) { this.hooks.get.call(data, identifier, etag); return data; } callback(); return null; } } ç›¸æ¯”ä¹‹ä¸‹ï¼ŒVite çš„ç¼“å­˜ç­–ç•¥æ›´æ¿€è¿›ä¹Ÿæ›´ç²¾ç»†ï¼š\n// Viteçš„ç¼“å­˜å®ç°ç®€åŒ–ç‰ˆ const cacheDir = path.join(os.tmpdir(), \u0026#34;vite-cache\u0026#34;); // ç¡®ä¿ç¼“å­˜ç›®å½•å­˜åœ¨ if (!fs.existsSync(cacheDir)) { fs.mkdirSync(cacheDir, { recursive: true }); } // æ„å»ºæ–‡ä»¶ç¼“å­˜é”® function getCacheKey(filePath, transform) { const fileStats = fs.statSync(filePath); const mtime = fileStats.mtimeMs.toString(); const content = fs.readFileSync(filePath, \u0026#34;utf-8\u0026#34;); const transformKey = JSON.stringify(transform); return crypto .createHash(\u0026#34;md5\u0026#34;) .update(filePath + content + mtime + transformKey) .digest(\u0026#34;hex\u0026#34;); } // ç¼“å­˜è½¬æ¢ç»“æœ async function transformWithCache(filePath, transform) { const cacheKey = getCacheKey(filePath, transform); const cachePath = path.join(cacheDir, cacheKey); // æ£€æŸ¥ç¼“å­˜ if (fs.existsSync(cachePath)) { return JSON.parse(fs.readFileSync(cachePath, \u0026#34;utf-8\u0026#34;)).result; } // ç¼“å­˜æœªå‘½ä¸­ï¼Œæ‰§è¡Œè½¬æ¢ const result = await transform(fs.readFileSync(filePath, \u0026#34;utf-8\u0026#34;)); // ä¿å­˜åˆ°ç¼“å­˜ fs.writeFileSync( cachePath, JSON.stringify({ result, timestamp: Date.now() }) ); return result; } Vite å°†ç¼“å­˜ç²¾ç»†åŒ–åˆ°æ¯ä¸ªæ–‡ä»¶å’Œè½¬æ¢æ­¥éª¤ï¼Œè€Œä¸æ˜¯åƒ Webpack é‚£æ ·å¯¹æ•´ä¸ªæ¨¡å—å›¾è¿›è¡Œç¼“å­˜ã€‚è¿™ç§æ–¹å¼åœ¨å¢é‡æ„å»ºæ—¶ä¼˜åŠ¿æ˜æ˜¾ã€‚\n2. å¹¶è¡Œå¤„ç† å¦ä¸€ä¸ªå…³é”®åŒºåˆ«æ˜¯å¹¶è¡Œå¤„ç†ç­–ç•¥ï¼š\n// Webpackä¸­çš„å¹¶è¡Œå¤„ç†(ç®€åŒ–ç‰ˆ) class MultiCompiler { constructor(compilers) { this.compilers = compilers; } run(callback) { let remaining = this.compilers.length; const errors = []; const result = []; // å¹¶è¡Œæ‰§è¡Œæ‰€æœ‰ç¼–è¯‘å™¨ for (const compiler of this.compilers) { compiler.run((err, stats) =\u0026gt; { if (err) errors.push(err); result.push(stats); remaining--; if (remaining === 0) { callback(errors.length \u0026gt; 0 ? errors : null, result); } }); } } } Vite çš„å¹¶è¡Œç­–ç•¥æ›´åŠ åŠ¨æ€ï¼š\n// Viteçš„åŠ¨æ€å¹¶è¡Œä½œä¸šè°ƒåº¦å™¨(ç®€åŒ–ç‰ˆ) class Scheduler { constructor(maxConcurrency = os.cpus().length - 1) { this.maxConcurrency = maxConcurrency; this.queue = []; this.activeCount = 0; } async add(task) { return new Promise((resolve, reject) =\u0026gt; { this.queue.push({ task, resolve, reject }); this.scheduleNext(); }); } scheduleNext() { if (this.activeCount \u0026gt;= this.maxConcurrency || this.queue.length === 0) { return; } this.activeCount++; const { task, resolve, reject } = this.queue.shift(); Promise.resolve(task()) .then(resolve) .catch(reject) .finally(() =\u0026gt; { this.activeCount--; this.scheduleNext(); }); } } // ä½¿ç”¨è°ƒåº¦å™¨å¤„ç†ä»»åŠ¡ const scheduler = new Scheduler(); async function processFiles(files) { return Promise.all( files.map((file) =\u0026gt; scheduler.add(() =\u0026gt; transformFile(file))) ); } åœ¨å®é™…é¡¹ç›®ä¸­ï¼ŒVite çš„è¿™ç§åŸºäºå·¥ä½œè€…æ± çš„åŠ¨æ€è°ƒåº¦ï¼Œå¯¹äºå¤§å‹é¡¹ç›®çš„æ„å»ºé€Ÿåº¦æå‡æ˜¾è‘—ã€‚\nå®æˆ˜æ¡ˆä¾‹ï¼šå¤§å‹é¡¹ç›®çš„æ„å»ºä¼˜åŒ– åœ¨ä¸€ä¸ªæœ‰ä¸Šç™¾ä¸ªé¡µé¢çš„ç”µå•†å¹³å°é‡æ„ä¸­ï¼Œæˆ‘ä»¬é¢ä¸´æ„å»ºæ€§èƒ½é—®é¢˜ï¼Œé‡‡å–äº†ä»¥ä¸‹ä¼˜åŒ–æªæ–½ï¼š\n1. ä»£ç åˆ†å‰²ç­–ç•¥é‡æ„ // ä¼˜åŒ–å‰çš„Webpackä»£ç åˆ†å‰²é…ç½® module.exports = { // ... optimization: { splitChunks: { chunks: \u0026#34;all\u0026#34;, cacheGroups: { vendors: { test: /[\\\\/]node_modules[\\\\/]/, priority: -10, }, default: { minChunks: 2, priority: -20, reuseExistingChunk: true, }, }, }, }, }; // ä¼˜åŒ–åçš„ç»†ç²’åº¦ä»£ç åˆ†å‰²é…ç½® module.exports = { // ... optimization: { splitChunks: { chunks: \u0026#34;all\u0026#34;, maxInitialRequests: 30, maxAsyncRequests: 30, minSize: 20000, cacheGroups: { framework: { test: /[\\\\/]node_modules[\\\\/](react|react-dom|react-router|react-router-dom)[\\\\/]/, name: \u0026#34;framework\u0026#34;, priority: 40, }, ui: { test: /[\\\\/]node_modules[\\\\/](antd|@ant-design)[\\\\/]/, name: \u0026#34;ui\u0026#34;, priority: 30, }, commons: { test: /[\\\\/]node_modules[\\\\/]/, name(module) { // è·å–æ¨¡å—çš„npmåŒ…å const packageName = module.context.match( /[\\\\/]node_modules[\\\\/](.*?)([\\\\/]|$)/ )[1]; // é¿å…ç”Ÿæˆå¤ªé•¿çš„chunkå return `npm.${packageName.replace(\u0026#34;@\u0026#34;, \u0026#34;\u0026#34;)}`; }, priority: 20, }, shared: { test: /[\\\\/]src[\\\\/]shared[\\\\/]/, name: \u0026#34;shared\u0026#34;, priority: 10, minChunks: 2, }, }, }, }, }; è¿™ç§åˆ†å±‚çš„ä»£ç åˆ†å‰²ç­–ç•¥å°†é¦–æ¬¡åŠ è½½æ—¶é—´å‡å°‘äº† 32%ï¼Œå› ä¸ºå®ƒè®©æµè§ˆå™¨èƒ½å¤Ÿæ›´å¥½åœ°å¹¶è¡Œä¸‹è½½èµ„æºï¼Œå¹¶æé«˜äº†ç¼“å­˜æ•ˆç‡ã€‚\n2. åŸºäºè·¯ç”±çš„æ‡’åŠ è½½ // ä¼˜åŒ–å‰ï¼šæ‰‹åŠ¨æ‡’åŠ è½½å„ä¸ªè·¯ç”± const routes = [ { path: \u0026#34;/\u0026#34;, component: Home, }, { path: \u0026#34;/products\u0026#34;, component: React.lazy(() =\u0026gt; import(\u0026#34;./pages/Products\u0026#34;)), }, // ...æ›´å¤šè·¯ç”± ]; // ä¼˜åŒ–åï¼šè‡ªåŠ¨åŒ–çš„è·¯ç”±æ‡’åŠ è½½ç³»ç»Ÿ function createRoutes(routeConfigs) { return routeConfigs.map((config) =\u0026gt; { // åŸºç¡€è·¯ç”±æ— éœ€æ‡’åŠ è½½ if (config.isCore) { return config; } // ä¸ºå…¶ä»–è·¯ç”±æ·»åŠ æ‡’åŠ è½½ return { ...config, component: React.lazy(() =\u0026gt; { // æ·»åŠ é¢„å–é€»è¾‘ const componentPromise = import(`./pages/${config.componentPath}`); // é¢„åŠ è½½ç›¸å…³èµ„æº if (config.preloadResources) { Promise.all( config.preloadResources.map((resource) =\u0026gt; import(`./resources/${resource}`) ) ).catch((err) =\u0026gt; console.warn(\u0026#34;Preload failed:\u0026#34;, err)); } return componentPromise; }), }; }); } // æ™ºèƒ½é¢„åŠ è½½ç³»ç»Ÿ function useIntelligentPreload(routes) { useEffect(() =\u0026gt; { // æ£€æµ‹ç”¨æˆ·ç©ºé—²æ—¶é—´ if (\u0026#34;requestIdleCallback\u0026#34; in window) { requestIdleCallback(() =\u0026gt; { // åˆ†æç”¨æˆ·è¡Œä¸ºé¢„æµ‹ä¸‹ä¸€æ­¥å¯èƒ½è®¿é—®çš„è·¯ç”± const predictedRoutes = predictUserNavigation(); // é¢„åŠ è½½é¢„æµ‹çš„è·¯ç”± for (const route of predictedRoutes) { const routeConfig = routes.find((r) =\u0026gt; r.path === route); if (routeConfig \u0026amp;\u0026amp; routeConfig.component.preload) { routeConfig.component.preload(); } } }); } }, [routes]); } è¿™ä¸ªç³»ç»Ÿä¸ä»…è‡ªåŠ¨å¤„ç†æ‡’åŠ è½½ï¼Œè¿˜æ ¹æ®ç”¨æˆ·è¡Œä¸ºæ™ºèƒ½é¢„åŠ è½½ï¼Œæ˜¾è‘—æå‡äº†é¡µé¢åˆ‡æ¢é€Ÿåº¦ã€‚\n3. ä¾èµ–ä¼˜åŒ– // é¡¹ç›®å¯åŠ¨å‰æ‰§è¡Œçš„ä¾èµ–åˆ†æè„šæœ¬ const madge = require(\u0026#34;madge\u0026#34;); const chalk = require(\u0026#34;chalk\u0026#34;); const { execSync } = require(\u0026#34;child_process\u0026#34;); async function analyzeDependencies() { // åˆ›å»ºä¾èµ–å›¾ const dependencyGraph = await madge(\u0026#34;./src/index.js\u0026#34;, { fileExtensions: [\u0026#34;js\u0026#34;, \u0026#34;jsx\u0026#34;, \u0026#34;ts\u0026#34;, \u0026#34;tsx\u0026#34;], }); // æŸ¥æ‰¾å¾ªç¯ä¾èµ– const circles = dependencyGraph.circular(); if (circles.length \u0026gt; 0) { console.log(chalk.red(\u0026#34;âš ï¸ æ£€æµ‹åˆ°å¾ªç¯ä¾èµ–:\u0026#34;)); circles.forEach((circle) =\u0026gt; { console.log(chalk.yellow(\u0026#34; \u0026#34; + circle.join(\u0026#34; -\u0026gt; \u0026#34;))); }); } // æŸ¥æ‰¾æœªä½¿ç”¨çš„ä¾èµ– console.log(chalk.blue(\u0026#34;åˆ†ææœªä½¿ç”¨çš„ä¾èµ–...\u0026#34;)); const unusedDeps = findUnusedDependencies(\u0026#34;./package.json\u0026#34;); if (unusedDeps.length \u0026gt; 0) { console.log(chalk.yellow(\u0026#34;æœªä½¿ç”¨çš„ä¾èµ–:\u0026#34;)); unusedDeps.forEach((dep) =\u0026gt; { console.log(` ${dep}`); }); // æ¨èå‘½ä»¤ console.log(chalk.green(\u0026#34;\\næ¨èæ‰§è¡Œ:\u0026#34;)); console.log(` npm uninstall ${unusedDeps.join(\u0026#34; \u0026#34;)}`); } // æŸ¥æ‰¾é‡å¤çš„ä¾èµ–ç‰ˆæœ¬ console.log(chalk.blue(\u0026#34;\\næ£€æŸ¥é‡å¤ä¾èµ–...\u0026#34;)); const duplicateDeps = findDuplicateDependencies(); if (duplicateDeps.length \u0026gt; 0) { console.log(chalk.yellow(\u0026#34;æ£€æµ‹åˆ°é‡å¤ä¾èµ–ç‰ˆæœ¬:\u0026#34;)); duplicateDeps.forEach(({ name, versions }) =\u0026gt; { console.log(` ${name}: ${versions.join(\u0026#34;, \u0026#34;)}`); }); console.log(chalk.green(\u0026#34;\\næ¨èæ‰§è¡Œ:\u0026#34;)); console.log(\u0026#34; npm dedupe\u0026#34;); } } function findUnusedDependencies(packageJsonPath) { // å®ç°æŸ¥æ‰¾æœªä½¿ç”¨ä¾èµ–çš„é€»è¾‘... } function findDuplicateDependencies() { const output = execSync(\u0026#34;npm ls --json\u0026#34;).toString(); // è§£ænpm lsè¾“å‡ºä»¥æ‰¾åˆ°é‡å¤ä¾èµ–... } analyzeDependencies().catch(console.error); è¿™ä¸ªè„šæœ¬å¸®åŠ©æˆ‘ä»¬è¯†åˆ«å¹¶ç§»é™¤äº†å¤§é‡æ— ç”¨ä¾èµ–ï¼Œä»¥åŠè§£å†³äº†ä¾èµ–ç‰ˆæœ¬å†²çªï¼Œæœ€ç»ˆå‡å°‘äº† 23%çš„ node_modules ä½“ç§¯ã€‚\næ¢ç´¢æ— æ„å»ºçš„æœªæ¥ï¼šESM ä¸ Import Maps æœ€è¿‘æˆ‘å¼€å§‹ç ”ç©¶ä¸€ç§æ›´æ¿€è¿›çš„æ–¹å‘ï¼šå®Œå…¨æ— æ„å»ºå¼€å‘ã€‚ç°ä»£æµè§ˆå™¨å·²ç»æ”¯æŒ ESMï¼Œå†é…åˆ Import Mapsï¼Œç†è®ºä¸Šæ— éœ€æ‰“åŒ…å·¥å…·å°±èƒ½å¼€å‘ç°ä»£ Web åº”ç”¨ï¼š\n\u0026lt;!-- ä½¿ç”¨Import Mapså®ç°æ— æ„å»ºå¼€å‘ --\u0026gt; \u0026lt;!DOCTYPE html\u0026gt; \u0026lt;html\u0026gt; \u0026lt;head\u0026gt; \u0026lt;script type=\u0026#34;importmap\u0026#34;\u0026gt; { \u0026#34;imports\u0026#34;: { \u0026#34;react\u0026#34;: \u0026#34;https://esm.sh/react@18.2.0\u0026#34;, \u0026#34;react-dom/client\u0026#34;: \u0026#34;https://esm.sh/react-dom@18.2.0/client\u0026#34;, \u0026#34;@/components/\u0026#34;: \u0026#34;/src/components/\u0026#34;, \u0026#34;@/utils/\u0026#34;: \u0026#34;/src/utils/\u0026#34; } } \u0026lt;/script\u0026gt; \u0026lt;script type=\u0026#34;module\u0026#34;\u0026gt; import React from \u0026#34;react\u0026#34;; import { createRoot } from \u0026#34;react-dom/client\u0026#34;; import { App } from \u0026#34;./src/App.js\u0026#34;; const root = createRoot(document.getElementById(\u0026#34;root\u0026#34;)); root.render(React.createElement(App)); \u0026lt;/script\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; \u0026lt;div id=\u0026#34;root\u0026#34;\u0026gt;\u0026lt;/div\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; æˆ‘åœ¨ä¸€ä¸ªå°å‹é¡¹ç›®ä¸­å°è¯•äº†è¿™ç§æ–¹æ³•ï¼Œå¼€å‘ä½“éªŒå‡ºå¥‡åœ°å¥½ã€‚ä½†ä¸ºä½•ä¸»æµé¡¹ç›®ä»ç„¶éœ€è¦æ„å»ºå·¥å…·ï¼ŸåŸå› åŒ…æ‹¬ï¼š\næµè§ˆå™¨å…¼å®¹æ€§ï¼šè™½ç„¶ç°ä»£æµè§ˆå™¨æ”¯æŒ ESMï¼Œä½†å¯¹æ—§æµè§ˆå™¨çš„æ”¯æŒä»ç„¶éœ€è¦è½¬è¯‘ å¼€å‘ä½“éªŒï¼šTypeScriptã€JSX ç­‰éœ€è¦è½¬è¯‘ æ€§èƒ½ä¼˜åŒ–ï¼šç”Ÿäº§ç¯å¢ƒä»éœ€æ‰“åŒ…ã€å‹ç¼©ã€ä»£ç åˆ†å‰²ç­‰ä¼˜åŒ– CSS å¤„ç†ï¼šCSS Modulesã€é¢„å¤„ç†å™¨ç­‰ä»éœ€æ„å»ºå·¥å…· è¿™è®©æˆ‘æ„è¯†åˆ°ï¼Œæ„å»ºå·¥å…·çš„é‡ç‚¹æ­£åœ¨ä»\u0026quot;ä½¿ä»£ç èƒ½å¤Ÿè¿è¡Œ\u0026quot;è½¬å˜ä¸º\u0026quot;ä¼˜åŒ–ä»£ç è¿è¡Œæ–¹å¼\u0026quot;ã€‚\nå·¥ç¨‹åŒ–å®è·µï¼šå°†æ„å»ºçŸ¥è¯†èå…¥æ—¥å¸¸å¼€å‘ é€šè¿‡æ·±å…¥ç†è§£æ„å»ºåŸç†ï¼Œæˆ‘ä»¬è°ƒæ•´äº†å›¢é˜Ÿçš„å¼€å‘å®è·µï¼š\n1. å¼€å‘æƒ¯ä¾‹é‡æ„ // ä»¥å‰ï¼šå…¨å±€å¯¼å…¥æ•´ä¸ªåº“ import _ from \u0026#34;lodash\u0026#34;; // æ”¹è¿›ï¼šç²¾ç¡®å¯¼å…¥æ‰€éœ€æ–¹æ³• import debounce from \u0026#34;lodash/debounce\u0026#34;; import throttle from \u0026#34;lodash/throttle\u0026#34;; // æ›´å¥½ï¼šä½¿ç”¨è½»é‡æ›¿ä»£å“ import debounce from \u0026#34;just-debounce-it\u0026#34;; import throttle from \u0026#34;just-throttle\u0026#34;; 2. æ¨¡å—è¾¹ç•Œæ£€æŸ¥ æˆ‘ä»¬å¼€å‘äº†ä¸€ä¸ª ESLint æ’ä»¶æ¥çº¦æŸæ¨¡å—è¾¹ç•Œï¼š\n// eslint-plugin-module-boundaries.js module.exports = { rules: { \u0026#34;no-cross-boundary-imports\u0026#34;: { create(context) { return { ImportDeclaration(node) { const { source } = node; const importPath = source.value; const filename = context.getFilename(); // æ£€æŸ¥æ˜¯å¦è·¨è¶Šæ¨¡å—è¾¹ç•Œ if ( isFeatureA(filename) \u0026amp;\u0026amp; importPath.includes(\u0026#34;features/featureB\u0026#34;) ) { context.report({ node, message: \u0026#34;Feature modules should not directly import from other feature modules\u0026#34;, }); } // æ£€æŸ¥æ˜¯å¦è¿åå±‚æ¬¡ç»“æ„ if (isUiLayer(importPath) \u0026amp;\u0026amp; isModelLayer(filename)) { context.report({ node, message: \u0026#34;Model layer cannot import from UI layer\u0026#34;, }); } }, }; }, }, }, }; function isFeatureA(path) { return path.includes(\u0026#34;features/featureA\u0026#34;); } function isUiLayer(path) { return path.includes(\u0026#34;/ui/\u0026#34;) || path.includes(\u0026#34;/components/\u0026#34;); } function isModelLayer(path) { return path.includes(\u0026#34;/models/\u0026#34;) || path.includes(\u0026#34;/stores/\u0026#34;); } è¿™ä¸ªæ’ä»¶ç¡®ä¿äº†æ¨¡å—è¾¹ç•Œçš„æ¸…æ™°ï¼Œæé«˜äº†æ„å»ºä¼˜åŒ–çš„æ•ˆæœã€‚\n3. åŠ¨æ€åŠ è½½ç­–ç•¥æ¨¡å¼ // å°è£…åŠ¨æ€å¯¼å…¥é€»è¾‘ï¼Œæ·»åŠ é”™è¯¯å¤„ç†ã€é‡è¯•å’Œç›‘æ§ export function lazyLoad( factory, { fallback = null, errorComponent = DefaultErrorComponent, retries = 3, timeout = 10000, onError, onSuccess, } = {} ) { const LazyComponent = React.lazy(() =\u0026gt; { // æ·»åŠ è¶…æ—¶æ§åˆ¶ const timeoutPromise = new Promise((_, reject) =\u0026gt; { setTimeout(() =\u0026gt; reject(new Error(\u0026#34;Loading timeout\u0026#34;)), timeout); }); // å®ç°é‡è¯•é€»è¾‘ function attemptLoad(attemptsLeft) { return Promise.race([ factory().catch((error) =\u0026gt; { if (attemptsLeft \u0026lt;= 1) throw error; // æŒ‡æ•°å›é€€é‡è¯• return new Promise((resolve) =\u0026gt; { const delay = 2 ** (retries - attemptsLeft) * 300; setTimeout(() =\u0026gt; resolve(attemptLoad(attemptsLeft - 1)), delay); }); }), timeoutPromise, ]); } // æ‰§è¡ŒåŠ è½½ return attemptLoad(retries) .then((result) =\u0026gt; { if (onSuccess) onSuccess(); return result; }) .catch((error) =\u0026gt; { if (onError) onError(error); // è®°å½•é”™è¯¯åˆ°ç›‘æ§ç³»ç»Ÿ logError(\u0026#34;Module load failure\u0026#34;, error); if (process.env.NODE_ENV !== \u0026#34;production\u0026#34;) { // å¼€å‘ç¯å¢ƒæŠ›å‡ºé”™è¯¯ throw error; } // ç”Ÿäº§ç¯å¢ƒå›é€€åˆ°é”™è¯¯ç»„ä»¶ return { default: () =\u0026gt; React.createElement(errorComponent, { error, retry: () =\u0026gt; lazyLoad(factory, options), }), }; }); }); return (props) =\u0026gt; ( \u0026lt;React.Suspense fallback={fallback}\u0026gt; \u0026lt;LazyComponent {...props} /\u0026gt; \u0026lt;/React.Suspense\u0026gt; ); } // ä½¿ç”¨ç¤ºä¾‹ const ProductDetails = lazyLoad(() =\u0026gt; import(\u0026#34;./ProductDetails\u0026#34;), { fallback: \u0026lt;ProductSkeleton /\u0026gt;, onError: (error) =\u0026gt; trackEvent(\u0026#34;product_load_failed\u0026#34;, { error: error.message }), retries: 2, }); è¿™ä¸ªç­–ç•¥åœ¨æˆ‘ä»¬çš„é¡¹ç›®ä¸­æ˜¾è‘—æé«˜äº†é¡µé¢åŠ è½½æˆåŠŸç‡ï¼Œå°¤å…¶æ˜¯åœ¨ç½‘ç»œæ¡ä»¶ä¸ä½³çš„ç¯å¢ƒä¸‹ã€‚\næ€§èƒ½åŸºå‡†ä¸ä¼˜åŒ–ç›®æ ‡ æ„å»ºä¼˜åŒ–ä¸èƒ½ç›²ç›®è¿›è¡Œï¼Œæˆ‘ä»¬è®¾å®šäº†æ˜ç¡®çš„åŸºå‡†å’Œç›®æ ‡ï¼š\n// performance-budget.js module.exports = { // åŒ…ä½“ç§¯é¢„ç®— bundleBudgets: { // åˆå§‹åŒ…ä½“ç§¯ä¸Šé™ initial: { javascript: 180 * 1024, // 180KB css: 50 * 1024, // 50KB total: 230 * 1024, // 230KB }, // å•ä¸ªå¼‚æ­¥chunkä¸Šé™ async: { javascript: 100 * 1024, // 100KB css: 30 * 1024, // 30KB total: 130 * 1024, // 130KB }, }, // æ„å»ºæ€§èƒ½é¢„ç®— buildPerformance: { development: { startup: 3000, // 3ç§’å¯åŠ¨æ—¶é—´ rebuildAverage: 300, // 300msçƒ­æ›´æ–°å¹³å‡æ—¶é—´ }, production: { total: 5 * 60 * 1000, // 5åˆ†é’Ÿæ€»æ„å»ºæ—¶é—´ }, }, // è¿è¡Œæ—¶æ€§èƒ½æŒ‡æ ‡ runtimeMetrics: { FCP: 1500, // First Contentful Paint: 1.5s LCP: 2500, // Largest Contentful Paint: 2.5s FID: 100, // First Input Delay: 100ms CLS: 0.1, // Cumulative Layout Shift: 0.1 TTI: 3500, // Time to Interactive: 3.5s }, }; // æ„å»ºè¿‡ç¨‹ä¸­æ£€æŸ¥é¢„ç®— function checkBudgets(stats, budgets) { const { assets } = stats.toJson({ assets: true, }); const initialAssets = assets.filter( (asset) =\u0026gt; !asset.chunkNames.some((name) =\u0026gt; name.startsWith(\u0026#34;async-\u0026#34;)) ); const initialJSSize = initialAssets .filter((asset) =\u0026gt; asset.name.endsWith(\u0026#34;.js\u0026#34;)) .reduce((size, asset) =\u0026gt; size + asset.size, 0); if (initialJSSize \u0026gt; budgets.initial.javascript) { console.error( `âŒ JSåŒ…ä½“ç§¯è¶…è¿‡é¢„ç®—: ${(initialJSSize / 1024).toFixed(2)}KB (é¢„ç®—: ${( budgets.initial.javascript / 1024 ).toFixed(2)}KB)` ); // åˆ†æä¸»è¦è´¡çŒ®è€… console.log(\u0026#34;ä½“ç§¯è´¡çŒ®åˆ†æ:\u0026#34;); initialAssets .filter((asset) =\u0026gt; asset.name.endsWith(\u0026#34;.js\u0026#34;)) .sort((a, b) =\u0026gt; b.size - a.size) .slice(0, 5) .forEach((asset) =\u0026gt; { console.log(` ${asset.name}: ${(asset.size / 1024).toFixed(2)}KB`); }); if (process.env.CI) { process.exit(1); // åœ¨CIç¯å¢ƒä¸­å¤±è´¥æ„å»º } } // æ£€æŸ¥å…¶ä»–æŒ‡æ ‡... } è¿™äº›é¢„ç®—ä¸ä»…ä½œä¸ºå¼€å‘æŒ‡å—ï¼Œä¹Ÿé›†æˆåˆ°äº† CI æµç¨‹ä¸­ï¼Œç¡®ä¿æ€§èƒ½ä¸ä¼šéšç€æ—¶é—´é€€åŒ–ã€‚\næ„å»ºç³»ç»Ÿçš„æœªæ¥ å…³æ³¨æ„å»ºå·¥å…·çš„å‘å±•ï¼Œæˆ‘å¯¹æœªæ¥æœ‰å‡ ç‚¹é¢„æµ‹ï¼š\næ›´ç»†ç²’åº¦çš„å¢é‡æ„å»ºï¼šéšç€é¡¹ç›®è§„æ¨¡å¢é•¿ï¼Œæ„å»ºå·¥å…·å°†æ›´åŠ æ³¨é‡å¢é‡æ„å»ºèƒ½åŠ›\næ··åˆè¿è¡Œæ—¶æ¨¡å¼ï¼šç”Ÿäº§ç¯å¢ƒå°†é‡‡ç”¨æ‰“åŒ…+ESM æ··åˆæ¨¡å¼ï¼Œå¹³è¡¡åŒ…å¤§å°å’Œç¼“å­˜æ•ˆç‡\næ„å»ºæ—¶é—´ç¼–è¯‘ï¼šå°†æ›´å¤šé€»è¾‘ä»è¿è¡Œæ—¶ç§»è‡³ç¼–è¯‘æ—¶ï¼Œæå‡è¿è¡Œæ—¶æ€§èƒ½\nWebAssembly æ„å»ºå·¥å…·é“¾ï¼šæ„å»ºå·¥å…·æœ¬èº«å°†æ›´å¤šé‡‡ç”¨ WebAssemblyï¼Œæå‡å·¥å…·æœ¬èº«æ€§èƒ½\næˆ‘æ­£åœ¨å®éªŒçš„ä¸€ä¸ªåŸå‹æ˜¯åŸºäº WebAssembly çš„å¿«é€Ÿå¢é‡æ„å»ºç³»ç»Ÿï¼š\n// åŸºäºWebAssemblyçš„å¢é‡æ„å»ºç³»ç»ŸåŸå‹ const { BuildSystem } = await WebAssembly.instantiateStreaming( fetch(\u0026#34;/build-system.wasm\u0026#34;) ); // åˆå§‹åŒ–æ„å»ºç³»ç»Ÿ const builder = new BuildSystem({ entryPoints: [\u0026#34;src/index.js\u0026#34;], outdir: \u0026#34;dist\u0026#34;, incremental: true, plugins: [ // æ’ä»¶ä»ç„¶ç”¨JSå®ç°ï¼Œä½†æ ¸å¿ƒé€»è¾‘åœ¨WASMä¸­ cssPlugin(), imagePlugin(), // ...å…¶ä»–æ’ä»¶ ], }); // å¯åŠ¨æ–‡ä»¶ç›‘å¬ builder.watch({ onRebuild(error, result) { if (error) { console.error(\u0026#34;æ„å»ºå¤±è´¥:\u0026#34;, error); return; } console.log(`é‡å»ºå®Œæˆï¼Œè€—æ—¶: ${result.timeMs}ms`); console.log(`æ›´æ–°çš„æ–‡ä»¶: ${result.changedFiles.join(\u0026#34;, \u0026#34;)}`); // é€šçŸ¥å¼€å‘æœåŠ¡å™¨åˆ·æ–° notifyDevServer(result.changedFiles); }, }); åˆæ­¥æµ‹è¯•è¡¨æ˜ï¼ŒWebAssembly ç‰ˆæœ¬çš„è§£æå™¨å’Œè½¬æ¢å™¨æ¯”çº¯ JavaScript ç‰ˆæœ¬å¿« 2-5 å€ï¼Œå°¤å…¶æ˜¯åœ¨å¤„ç†å¤§å‹é¡¹ç›®æ—¶ã€‚\nå†™åœ¨æœ€å å‰ç«¯æ„å»ºç³»ç»Ÿæ˜¯å‰ç«¯å·¥ç¨‹åŒ–çš„åŸºçŸ³ï¼Œä¹Ÿæ˜¯æ€§èƒ½ä¼˜åŒ–çš„å…³é”®ä¸€ç¯ã€‚é€šè¿‡æ·±å…¥ç†è§£æ„å»ºå·¥å…·çš„åŸç†ï¼Œæˆ‘ä»¬èƒ½å¤Ÿåšå‡ºæ›´æ˜æ™ºçš„æ¶æ„å†³ç­–ï¼Œé¿å…å¸¸è§çš„æ€§èƒ½é™·é˜±ã€‚\nå€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œæ„å»ºä¼˜åŒ–ä¸åº”è¯¥æ˜¯å­¤ç«‹çš„æŠ€æœ¯ä»»åŠ¡ï¼Œè€Œåº”è¯¥èå…¥æ—¥å¸¸å¼€å‘å®è·µã€‚å›¢é˜Ÿå…±åŒéµå¾ªè‰¯å¥½çš„æ¨¡å—åŒ–åŸåˆ™å’Œä¾èµ–ç®¡ç†å®è·µï¼Œæ‰èƒ½çœŸæ­£å‘æŒ¥æ„å»ºä¼˜åŒ–çš„ä»·å€¼ã€‚\nå¦‚æœæˆ‘èƒ½ç»™å‰ç«¯å¼€å‘è€…ä¸€æ¡å»ºè®®ï¼Œé‚£å°±æ˜¯èŠ±æ—¶é—´ç ”ç©¶ä½ æ­£åœ¨ä½¿ç”¨çš„æ„å»ºå·¥å…·çš„æºç ã€‚äº†è§£å®ƒä»¬çš„å†…éƒ¨å·¥ä½œåŸç†ï¼Œä¼šè®©ä½ å¯¹æ•´ä¸ªå‰ç«¯ç”Ÿæ€æœ‰æ›´æ·±çš„ç†è§£ï¼Œå¹¶å¸®åŠ©ä½ çªç ´æ€§èƒ½ç“¶é¢ˆã€‚\nä¸‹æ¬¡æˆ‘æ‰“ç®—æ·±å…¥åˆ†ææµè§ˆå™¨æ¸²æŸ“ç®¡çº¿ä¸æ€§èƒ½ä¼˜åŒ–çš„å…³ç³»ï¼Œæ•¬è¯·æœŸå¾…ï¼\n","permalink":"https://www.yss520.online/zh/posts/front-end-engineering/","summary":"\u003ch1 id=\"å‰ç«¯æ„å»ºç³»ç»Ÿçš„æ¼”è¿›ä¸ä¼˜åŒ–ä»æ‰“åŒ…åˆ°æ— æ„å»º\"\u003eå‰ç«¯æ„å»ºç³»ç»Ÿçš„æ¼”è¿›ä¸ä¼˜åŒ–ï¼šä»æ‰“åŒ…åˆ°æ— æ„å»º\u003c/h1\u003e\n\u003cp\u003eä¸Šä¸ªæœˆæˆ‘ä»¬å›¢é˜Ÿé‡æ„äº†ä¸€ä¸ªæœ‰ 4 å¹´å†å²çš„å¤§å‹å‰ç«¯é¡¹ç›®çš„æ„å»ºç³»ç»Ÿï¼Œä»è€æ—§çš„ Webpack é…ç½®è¿ç§»åˆ°ç°ä»£åŒ–çš„ Vite æ„å»ºã€‚é¢„è®¡éœ€è¦ä¸¤å‘¨çš„å·¥ä½œå®é™…ä¸ŠèŠ±äº†ä¸€ä¸ªæœˆï¼Œä½†ç»“æœè®©äººæŒ¯å¥‹ï¼šå¼€å‘æœåŠ¡å™¨å¯åŠ¨æ—¶é—´ä» 40 ç§’é™åˆ°ä¸åˆ° 2 ç§’ï¼Œæ„å»ºæ—¶é—´å‡å°‘äº† 70%ï¼Œæœ€ç»ˆåŒ…ä½“ç§¯ç¼©å°äº† 23%ã€‚è¿™æ¬¡ç»å†è®©æˆ‘é‡æ–°å®¡è§†äº†å‰ç«¯æ„å»ºç³»ç»Ÿçš„å‘å±•å†ç¨‹ï¼Œä»Šå¤©å°±æ¥åˆ†äº«ä¸€äº›æ·±åº¦æ€è€ƒã€‚\u003c/p\u003e\n\u003ch2 id=\"æ„å»ºç³»ç»Ÿçš„åº•å±‚åŸç†æ¯”æƒ³è±¡ä¸­å¤æ‚å¾—å¤š\"\u003eæ„å»ºç³»ç»Ÿçš„åº•å±‚åŸç†ï¼šæ¯”æƒ³è±¡ä¸­å¤æ‚å¾—å¤š\u003c/h2\u003e\n\u003cp\u003eå½“æˆ‘ä»¬è¿è¡Œ\u003ccode\u003enpm start\u003c/code\u003eæ—¶ï¼ŒèƒŒååˆ°åº•å‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿé€šè¿‡ç ”ç©¶å„ç§å·¥å…·çš„æºç ï¼Œæˆ‘å‘ç°æ„å»ºå·¥å…·è¿œæ¯”æˆ‘æƒ³è±¡çš„å¤æ‚ã€‚\u003c/p\u003e\n\u003cp\u003eå…ˆçœ‹çœ‹æœ€åŸºç¡€çš„éƒ¨åˆ†ï¼šæ¨¡å—è§£æã€‚ä»¥ Webpack ä¸ºä¾‹ï¼Œå®ƒçš„æ¨¡å—è§£æè¿‡ç¨‹ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-javascript\" data-lang=\"javascript\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e// webpackæºç ç®€åŒ–ç‰ˆç‰‡æ®µ\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003efunction\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003ecreateResolver\u003c/span\u003e(\u003cspan style=\"color:#a6e22e\"\u003eoptions\u003c/span\u003e) {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#66d9ef\"\u003ereturn\u003c/span\u003e (\u003cspan style=\"color:#a6e22e\"\u003econtext\u003c/span\u003e, \u003cspan style=\"color:#a6e22e\"\u003erequest\u003c/span\u003e, \u003cspan style=\"color:#a6e22e\"\u003ecallback\u003c/span\u003e) =\u0026gt; {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#75715e\"\u003e// ä»å½“å‰è·¯å¾„å¼€å§‹æ£€ç´¢æ¨¡å—\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e    \u003cspan style=\"color:#66d9ef\"\u003econst\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003epossiblePaths\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e [\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#a6e22e\"\u003epath\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003ejoin\u003c/span\u003e(\u003cspan style=\"color:#a6e22e\"\u003econtext\u003c/span\u003e, \u003cspan style=\"color:#a6e22e\"\u003erequest\u003c/span\u003e),\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#a6e22e\"\u003epath\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003ejoin\u003c/span\u003e(\u003cspan style=\"color:#a6e22e\"\u003econtext\u003c/span\u003e, \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;node_modules\u0026#34;\u003c/span\u003e, \u003cspan style=\"color:#a6e22e\"\u003erequest\u003c/span\u003e),\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#75715e\"\u003e// ä¸€ç›´å‘ä¸ŠæŸ¥æ‰¾node_modules\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e    ];\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#75715e\"\u003e// ä¾æ¬¡å°è¯•æ¯ä¸ªå¯èƒ½çš„è·¯å¾„\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e    \u003cspan style=\"color:#66d9ef\"\u003efor\u003c/span\u003e (\u003cspan style=\"color:#66d9ef\"\u003econst\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003emodulePath\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003eof\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003epossiblePaths\u003c/span\u003e) {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e (\u003cspan style=\"color:#a6e22e\"\u003efs\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003eexistsSync\u003c/span\u003e(\u003cspan style=\"color:#a6e22e\"\u003emodulePath\u003c/span\u003e)) {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#66d9ef\"\u003ereturn\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003ecallback\u003c/span\u003e(\u003cspan style=\"color:#66d9ef\"\u003enull\u003c/span\u003e, \u003cspan style=\"color:#a6e22e\"\u003emodulePath\u003c/span\u003e);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      }\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#75715e\"\u003e// å°è¯•æ‰©å±•å\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e      \u003cspan style=\"color:#66d9ef\"\u003efor\u003c/span\u003e (\u003cspan style=\"color:#66d9ef\"\u003econst\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eext\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003eof\u003c/span\u003e [\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;.js\u0026#34;\u003c/span\u003e, \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;.json\u0026#34;\u003c/span\u003e, \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;.node\u0026#34;\u003c/span\u003e]) {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#66d9ef\"\u003econst\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003ewithExt\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003emodulePath\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eext\u003c/span\u003e;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e (\u003cspan style=\"color:#a6e22e\"\u003efs\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003eexistsSync\u003c/span\u003e(\u003cspan style=\"color:#a6e22e\"\u003ewithExt\u003c/span\u003e)) {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e          \u003cspan style=\"color:#66d9ef\"\u003ereturn\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003ecallback\u003c/span\u003e(\u003cspan style=\"color:#66d9ef\"\u003enull\u003c/span\u003e, \u003cspan style=\"color:#a6e22e\"\u003ewithExt\u003c/span\u003e);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        }\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      }\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    }\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#75715e\"\u003e// æ¨¡å—æœªæ‰¾åˆ°\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e    \u003cspan style=\"color:#a6e22e\"\u003ecallback\u003c/span\u003e(\u003cspan style=\"color:#66d9ef\"\u003enew\u003c/span\u003e Error(\u003cspan style=\"color:#e6db74\"\u003e`Module not found: \u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e${\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003erequest\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e}\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e`\u003c/span\u003e));\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  };\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eçœ‹èµ·æ¥ç®€å•ï¼Œä½†å®é™…å®ç°è¦è€ƒè™‘å„ç§è¾¹ç¼˜æƒ…å†µï¼šè½¯é“¾æ¥ã€package.json ä¸­çš„å­—æ®µé¡ºåºã€å„ç§å¯¼å…¥è¯­æ³•ç­‰ã€‚\u003c/p\u003e","title":"ç°ä»£å‰ç«¯å·¥ç¨‹åŒ–å®è·µæŒ‡å—"},{"content":"æ·±å…¥æµè§ˆå™¨æ¸²æŸ“ç®¡çº¿ï¼šä»åƒç´ åˆ°å±å¹•çš„æ€§èƒ½ä¼˜åŒ–ä¹‹æ—… ä¸Šä¸ªå­£åº¦ï¼Œæˆ‘ä»¬å›¢é˜Ÿæ¥æ‰‹äº†ä¸€ä¸ªæ€§èƒ½å ªå¿§çš„å¤§å‹ Dashboard é¡¹ç›®ï¼š60 å¤šä¸ªå›¾è¡¨ã€å¤æ‚çš„äº¤äº’ã€é¢‘ç¹çš„æ•°æ®æ›´æ–°ï¼Œåœ¨ä¸­ç«¯è®¾å¤‡ä¸Šå¡é¡¿æ˜æ˜¾ã€‚ç”¨æˆ·åé¦ˆ\u0026quot;ç‚¹å‡»æŒ‰é’®åˆ° UI å“åº”éœ€è¦ 2-3 ç§’\u0026quot;ï¼Œè¿™ç»å¯¹æ˜¯ç¾éš¾çº§ä½“éªŒã€‚\nç»è¿‡ 8 å‘¨çš„æ·±åº¦ä¼˜åŒ–ï¼Œæˆ‘ä»¬å°†äº¤äº’å»¶è¿Ÿä»å¹³å‡ 2.5 ç§’é™è‡³ä¸åˆ° 100msï¼Œæµç•…åº¦æå‡äº† 25 å€ã€‚è¿™ä¸ªè¿‡ç¨‹è®©æˆ‘é‡æ–°å®¡è§†äº†æµè§ˆå™¨æ¸²æŸ“ç®¡çº¿çš„æ¯ä¸ªç¯èŠ‚ï¼Œä»Šå¤©æƒ³åˆ†äº«è¿™æ®µæ·±å…¥åƒç´ çº§ä¼˜åŒ–çš„å¿ƒå¾—ã€‚\næµè§ˆå™¨æ¸²æŸ“ç®¡çº¿ï¼šæ¯”æƒ³è±¡ä¸­æ›´å¤æ‚çš„è¿‡ç¨‹ å½“æˆ‘ä»¬è°ˆè®ºæµè§ˆå™¨æ¸²æŸ“ï¼Œå¤§å¤šæ•°å¼€å‘è€…åªçŸ¥é“å…³é”®è¯ï¼šDOMã€CSSOMã€RenderTreeã€‚ä½†å®é™…è¿‡ç¨‹è¿œæ¯”è¿™ä¸‰ä¸ªæ­¥éª¤å¤æ‚å¾—å¤šã€‚é€šè¿‡ç ”ç©¶ Chromium æºç ï¼Œæˆ‘å¾—ä»¥çª¥è§æµè§ˆå™¨æ¸²æŸ“çš„å®Œæ•´è¿‡ç¨‹ã€‚\nè®©æˆ‘ä»¬å…ˆçœ‹ä¸€ä¸ªç®€åŒ–ä½†æ›´å…¨é¢çš„æ¸²æŸ“æµç¨‹ï¼š\nJavaScript â†’ Style â†’ Layout â†’ Layer â†’ Paint â†’ Composite æ¯ä¸ªé˜¶æ®µçš„æºç å®ç°éƒ½æå…¶å¤æ‚ã€‚ä»¥ Layoutï¼ˆå¸ƒå±€ï¼‰é˜¶æ®µä¸ºä¾‹ï¼ŒChrome ä¸­çš„å®ç°ï¼š\n// Chromiumæºç ç®€åŒ–ç‰‡æ®µ - LayoutObject::UpdateLayoutå‡½æ•° void LayoutObject::UpdateLayout() { // æ£€æŸ¥æ˜¯å¦éœ€è¦å®Œæ•´å¸ƒå±€ if (NeedsLayout()) { // LayoutObjectæœ‰ä¸åŒç±»å‹ï¼Œæ¯ç§ç±»å‹çš„å¸ƒå±€ç®—æ³•ä¸åŒ if (IsLayoutBlock()) { ToLayoutBlock(this)-\u0026gt;LayoutBlock(); } else if (IsText()) { ToLayoutText(this)-\u0026gt;LayoutText(); } else { // å…¶ä»–å¸ƒå±€å¯¹è±¡ç±»å‹... } // é€’å½’å¸ƒå±€å­å…ƒç´  for (LayoutObject* child = FirstChild(); child; child = child-\u0026gt;NextSibling()) { if (child-\u0026gt;NeedsLayout()) { child-\u0026gt;UpdateLayout(); } } // æ¸…é™¤å¸ƒå±€æ ‡è®° ClearNeedsLayout(); } } // LayoutBlockå¯¹è±¡çš„å¸ƒå±€å®ç° void LayoutBlock::LayoutBlock() { // ç¡®å®šå®½åº¦ ComputeBlockWidth(); // å¸ƒå±€å­å…ƒç´  LayoutChildren(); // ç¡®å®šé«˜åº¦ ComputeBlockHeight(); // å¤„ç†æº¢å‡º ComputeOverflow(); } è¿™æ®µä»£ç æ­ç¤ºäº†å…³é”®ä¿¡æ¯ï¼šæµè§ˆå™¨å¸ƒå±€æ˜¯é€’å½’è¿‡ç¨‹ï¼Œä¸€ä¸ªç®€å•çš„ DOM ç»“æ„å˜åŒ–å¯èƒ½è§¦å‘æ•´ä¸ªæ ‘çš„é‡æ–°å¸ƒå±€ã€‚äº†è§£è¿™ä¸€ç‚¹å¯¹ä¼˜åŒ–è‡³å…³é‡è¦ã€‚\næ€§èƒ½ç“¶é¢ˆçš„æºå¤´ï¼šä» DevTools çœ‹çœŸç›¸ è¦ä¼˜åŒ–æ€§èƒ½ï¼Œé¦–å…ˆè¦çŸ¥é“ç“¶é¢ˆåœ¨å“ªé‡Œã€‚Chrome DevTools çš„ Performance é¢æ¿æ˜¯è§‚å¯Ÿæ¸²æŸ“ç®¡çº¿çš„ç»ä½³å·¥å…·ã€‚\nåœ¨é¡¹ç›®ä¼˜åŒ–è¿‡ç¨‹ä¸­ï¼Œæˆ‘å‘ç°äº†å‡ ä¸ªå…¸å‹çš„æ€§èƒ½æ€æ‰‹ï¼š\n1. å¸ƒå±€æŠ–åŠ¨(Layout Thrashing) // ç¾éš¾æ€§çš„å¸ƒå±€æŠ–åŠ¨ä»£ç  function updateCardPositions() { const cards = document.querySelectorAll(\u0026#34;.card\u0026#34;); // ç¬¬ä¸€è½®ï¼šè¯»å–å¸ƒå±€ä¿¡æ¯ cards.forEach((card) =\u0026gt; { const height = card.offsetHeight; // è¯»å–ï¼Œè§¦å‘åŒæ­¥å¸ƒå±€ // ç¬¬äºŒè½®ï¼šä¿®æ”¹DOM card.style.height = height + 10 + \u0026#34;px\u0026#34;; // å†™å…¥ï¼Œä½¿å‰é¢çš„å¸ƒå±€å¤±æ•ˆ const newHeight = card.offsetHeight; // å†æ¬¡è¯»å–ï¼Œå†æ¬¡è§¦å‘åŒæ­¥å¸ƒå±€! card.style.lineHeight = newHeight * 0.8 + \u0026#34;px\u0026#34;; // å†æ¬¡å†™å…¥ }); } åœ¨ DevTools ä¸­ï¼Œè¿™ç§ä»£ç ä¼šäº§ç”Ÿé”¯é½¿çŠ¶çš„æ¸²æŸ“è®°å½•ï¼šå¸ƒå±€(ç´«è‰²) â†’ æ ·å¼è®¡ç®—(è“è‰²) â†’ å¸ƒå±€ â†’ æ ·å¼è®¡ç®—\u0026hellip;åå¤äº¤æ›¿ï¼Œå½¢æˆæ‰€è°“çš„\u0026quot;å¼ºåˆ¶åŒæ­¥å¸ƒå±€\u0026quot;ã€‚\nä¿®å¤æ–¹æ³•æ˜¯åˆ†ç¦»è¯»å†™æ“ä½œï¼š\n// ä¼˜åŒ–åçš„ä»£ç  - è¯»å†™åˆ†ç¦» function updateCardPositions() { const cards = document.querySelectorAll(\u0026#34;.card\u0026#34;); const cardMeasurements = []; // ç¬¬ä¸€é˜¶æ®µï¼šè¯»å–æ‰€æœ‰å¸ƒå±€ä¿¡æ¯ cards.forEach((card) =\u0026gt; { cardMeasurements.push({ element: card, height: card.offsetHeight, }); }); // ç¬¬äºŒé˜¶æ®µï¼šä¸€æ¬¡æ€§ä¿®æ”¹DOM cardMeasurements.forEach((measurement) =\u0026gt; { const { element, height } = measurement; element.style.height = height + 10 + \u0026#34;px\u0026#34;; element.style.lineHeight = (height + 10) * 0.8 + \u0026#34;px\u0026#34;; }); } è¿™æ ·æµè§ˆå™¨åªéœ€è¿›è¡Œä¸€æ¬¡å¸ƒå±€è®¡ç®—ï¼Œè€Œä¸æ˜¯åå¤è®¡ç®—ã€‚åœ¨æˆ‘ä»¬çš„ Dashboard é¡¹ç›®ä¸­ï¼Œä»…è¿™ä¸€ä¼˜åŒ–å°±å‡å°‘äº† 250ms çš„æ¸²æŸ“æ—¶é—´ã€‚\n2. å±‚çˆ†ç‚¸(Layer Explosion) å¬è¯´è¿‡\u0026quot;æå‡åˆ° GPU å±‚å¯ä»¥ä¼˜åŒ–æ€§èƒ½\u0026quot;åï¼Œå¼€å‘è€…ç»å¸¸è¿‡åº¦ä½¿ç”¨will-change: transformæˆ–transform: translateZ(0)ã€‚è¿™ä¼šå¯¼è‡´å±‚çˆ†ç‚¸ï¼š\n/* ç¾éš¾æ€§çš„CSS - è¿‡åº¦æå‡å±‚ */ .card { will-change: transform; /* ä¸ºæ¯ä¸ªå¡ç‰‡åˆ›å»ºæ–°å±‚ */ } /* JavaScriptä¸­ä¹Ÿç»å¸¸è¿™æ ·åš */ document.querySelectorAll(\u0026#39;.element\u0026#39;).forEach(el =\u0026gt; { el.style.transform = \u0026#39;translateZ(0)\u0026#39;; // å¼ºåˆ¶æå‡åˆ°æ–°å±‚ }); åœ¨ DevTools çš„ Layers é¢æ¿ä¸­ï¼Œè¿™ä¼šå¯¼è‡´æ•°ç™¾ä¸ªåˆæˆå±‚ï¼Œåè€Œä¸¥é‡å½±å“æ€§èƒ½ã€‚æˆ‘åœ¨é¡¹ç›®ä¸­å‘ç°äº†è¶…è¿‡ 200 ä¸ªä¸å¿…è¦çš„å±‚ï¼\nå±‚ç®¡ç†çš„åŸåˆ™æ˜¯ï¼šåªä¸ºé¢‘ç¹ç§»åŠ¨çš„å¤§å…ƒç´ åˆ›å»ºå±‚ï¼Œè€Œéæ‰€æœ‰å…ƒç´ ã€‚ä¿®å¤æ–¹æ³•ï¼š\n/* ä¼˜åŒ–åçš„CSS */ .card { /* ç§»é™¤é€šç”¨çš„will-change */ } /* åªä¸ºçœŸæ­£éœ€è¦çš„å…ƒç´ æ·»åŠ  */ .card--animated { will-change: transform; } /* æ›´å¥½çš„åšæ³•ï¼šåŠ¨æ€ç®¡ç†å±‚ */ æ›´æ™ºèƒ½çš„æ–¹æ³•æ˜¯åŠ¨æ€ç®¡ç†å±‚ï¼š\n// é«˜æ€§èƒ½çš„å±‚ç®¡ç† const carousel = document.querySelector(\u0026#34;.carousel\u0026#34;); // ä»…åœ¨æ»‘åŠ¨å¼€å§‹æ—¶æå‡ carousel.addEventListener(\u0026#34;touchstart\u0026#34;, () =\u0026gt; { // å³å°†å¼€å§‹åŠ¨ç”»ï¼Œæå‡åˆ°åˆæˆå±‚ carousel.style.willChange = \u0026#34;transform\u0026#34;; }); // æ»‘åŠ¨ç»“æŸåæ’¤é”€æå‡ carousel.addEventListener(\u0026#34;touchend\u0026#34;, () =\u0026gt; { // è®¾ç½®ä¸€ä¸ªå»¶è¿Ÿï¼Œç¡®ä¿åŠ¨ç”»å®Œæˆ setTimeout(() =\u0026gt; { carousel.style.willChange = \u0026#34;auto\u0026#34;; }, 300); }); ç§»é™¤ä¸å¿…è¦çš„å±‚åï¼Œæˆ‘ä»¬çš„å†…å­˜ä½¿ç”¨å‡å°‘äº† 40%ï¼Œåˆæˆæ—¶é—´å‡å°‘äº† 65%ã€‚\nè§£ææ¸²æŸ“ç®¡çº¿çš„å…³é”®é˜¶æ®µ ä¸ºäº†ç³»ç»Ÿä¼˜åŒ–ï¼Œéœ€è¦æ·±å…¥äº†è§£æ¯ä¸ªæ¸²æŸ“é˜¶æ®µåŠå…¶ä¼˜åŒ–æ–¹å‘ï¼š\n1. JavaScript æ‰§è¡Œä¸ DOM æ“ä½œ JavaScript æ‰§è¡Œæ˜¯æ¸²æŸ“ç®¡çº¿çš„èµ·ç‚¹ï¼Œä¹Ÿæ˜¯æœ€å¸¸è§çš„æ€§èƒ½ç“¶é¢ˆã€‚\nåœ¨ Dashboard é¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬å‘ç°äº†ä¸€ä¸ªå…¸å‹é—®é¢˜ï¼š\n// åŸå§‹ä»£ç  - ä½æ•ˆDOMæ“ä½œ function updateDashboard(data) { // æ¸…ç©ºå¹¶é‡å»ºæ•´ä¸ªåˆ—è¡¨ const container = document.getElementById(\u0026#34;metrics-container\u0026#34;); container.innerHTML = \u0026#34;\u0026#34;; data.metrics.forEach((metric) =\u0026gt; { const card = document.createElement(\u0026#34;div\u0026#34;); card.className = \u0026#34;metric-card\u0026#34;; // å¤§é‡DOMæ“ä½œ const title = document.createElement(\u0026#34;h3\u0026#34;); title.textContent = metric.name; card.appendChild(title); const value = document.createElement(\u0026#34;div\u0026#34;); value.className = \u0026#34;metric-value\u0026#34;; value.textContent = formatValue(metric.value); card.appendChild(value); // æ›´å¤šDOMå…ƒç´ ... container.appendChild(card); }); } é€šè¿‡ Chrome çš„ Performance é¢æ¿åˆ†æï¼Œå‘ç°è¿™æ®µä»£ç æ¶ˆè€—äº† 180msï¼Œä¸»è¦ç”¨äº DOM æ“ä½œã€‚ä¼˜åŒ–æ–¹æ³•æ˜¯ä½¿ç”¨ DocumentFragment å’Œ DOM é‡ç”¨ï¼š\n// ä¼˜åŒ–åçš„DOMæ“ä½œ function updateDashboard(data) { const container = document.getElementById(\u0026#34;metrics-container\u0026#34;); const fragment = document.createDocumentFragment(); const existingCards = Array.from(container.querySelectorAll(\u0026#34;.metric-card\u0026#34;)); // é‡ç”¨ç°æœ‰DOMå…ƒç´  data.metrics.forEach((metric, index) =\u0026gt; { let card; // é‡ç”¨æˆ–åˆ›å»ºæ–°å…ƒç´  if (index \u0026lt; existingCards.length) { card = existingCards[index]; } else { card = createMetricCard(); // åˆ›å»ºæ–°å¡ç‰‡åŠå…¶æ‰€æœ‰å­å…ƒç´  fragment.appendChild(card); } // åªæ›´æ–°å†…å®¹ï¼Œä¸é‡å»ºç»“æ„ card.querySelector(\u0026#34;h3\u0026#34;).textContent = metric.name; card.querySelector(\u0026#34;.metric-value\u0026#34;).textContent = formatValue(metric.value); // æ›´æ–°å…¶ä»–éƒ¨åˆ†... }); // ç§»é™¤å¤šä½™çš„å¡ç‰‡ for (let i = data.metrics.length; i \u0026lt; existingCards.length; i++) { container.removeChild(existingCards[i]); } // ä¸€æ¬¡æ€§æ·»åŠ æ–°å…ƒç´  if (fragment.children.length \u0026gt; 0) { container.appendChild(fragment); } } è¿™ç§ä¼˜åŒ–å°† DOM æ“ä½œæ—¶é—´é™è‡³ 40msï¼Œå‡å°‘äº†è¿‘ 80%çš„ DOM å¤„ç†æ—¶é—´ã€‚\n2. æ ·å¼è®¡ç®—(Style Calculate) æ¯å½“ DOM å˜åŒ–ï¼Œæµè§ˆå™¨éœ€è¦é‡æ–°è®¡ç®—å…ƒç´ æ ·å¼ã€‚è¿™ä¸ªè¿‡ç¨‹å¯èƒ½éå¸¸è€—æ—¶ï¼Œå°¤å…¶æ˜¯é€‰æ‹©å™¨å¤æ‚åº¦é«˜æˆ–æ ·å¼è§„åˆ™å¤šæ—¶ã€‚\nä»¥ä¸‹æ˜¯ Chromium å¤„ç†æ ·å¼çš„ç®€åŒ–é€»è¾‘ï¼š\n// Chromiumæºç ç®€åŒ– - æ ·å¼è®¡ç®— void StyleEngine::RecalculateStyle() { // éå†æ‰€æœ‰éœ€è¦é‡æ–°è®¡ç®—æ ·å¼çš„å…ƒç´  for (Element* element : elements_needs_style_recalc) { // ä¸ºæ¯ä¸ªå…ƒç´ è®¡ç®—æ ·å¼ ComputedStyle* style = ResolveStyle(element); element-\u0026gt;SetComputedStyle(style); } } ComputedStyle* StyleResolver::ResolveStyle(Element* element) { // åˆ›å»ºæ ·å¼å¯¹è±¡ ComputedStyle* style = new ComputedStyle(); // åº”ç”¨æ‰€æœ‰åŒ¹é…çš„CSSè§„åˆ™ MatchAllRules(element, style); // è®¡ç®—å±‚å å€¼ CascadeStyle(style); // å¤„ç†ç»§æ‰¿ InheritProperties(element, style); return style; } è¿™ä¸ªè¿‡ç¨‹çš„æ€§èƒ½å…³é”®æ˜¯é€‰æ‹©å™¨å¤æ‚åº¦å’Œæ ·å¼è§„åˆ™æ•°é‡ã€‚\nåœ¨ Dashboard é¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬å‘ç°äº†å‡ ä¸ªæ ·å¼æ€§èƒ½æ€æ‰‹ï¼š\n/* æ€§èƒ½æ€æ‰‹çš„CSS */ .dashboard .widget-container .widget .widget-header .title span { /* æ·±åº¦åµŒå¥—é€‰æ‹©å™¨ */ color: #333; } /* é€šé…ç¬¦å’Œä½æ•ˆé€‰æ‹©å™¨ */ .dashboard * .title { font-weight: bold; } /* å¤æ‚çš„è®¡ç®— */ .metric-value { width: calc(100% - 20px - 2rem - 3vw); /* å¤æ‚è®¡ç®— */ } ä¼˜åŒ–åçš„ CSSï¼š\n/* ä¼˜åŒ–åçš„CSS */ .widget-title { /* æ‰å¹³åŒ–ç±»å */ color: #333; } /* é¿å…é€šé…ç¬¦ */ .dashboard-title { font-weight: bold; } /* ç®€åŒ–è®¡ç®— */ .metric-value { width: calc(100% - 4rem); /* ç®€åŒ–è®¡ç®— */ } æˆ‘ä»¬è¿˜å¼•å…¥äº† CSS å˜é‡ï¼Œå‡å°‘äº†é‡å¤å®šä¹‰ï¼š\n:root { --spacing-unit: 8px; --primary-color: #1a73e8; } .widget-header { padding: calc(var(--spacing-unit) * 2); color: var(--primary-color); } .widget-content { margin: var(--spacing-unit); } è¿™äº›ä¼˜åŒ–å°†æ ·å¼è®¡ç®—æ—¶é—´å‡å°‘äº†çº¦ 45%ã€‚\n3. å¸ƒå±€(Layout) å¸ƒå±€æ˜¯è®¡ç®—å…ƒç´ å‡ ä½•ä¿¡æ¯ï¼ˆä½ç½®å’Œå¤§å°ï¼‰çš„è¿‡ç¨‹ã€‚è¿™ä¸€æ­¥åœ¨å¤æ‚é¡µé¢ä¸Šå°¤å…¶æ˜‚è´µã€‚\næˆ‘ä»¬é¡¹ç›®ä¸­çš„å¸¸è§æ€§èƒ½é—®é¢˜æ˜¯è¿‡åº¦è§¦å‘é‡æ’ï¼ˆreflowï¼‰ï¼š\n// ä½æ•ˆå¸ƒå±€ä»£ç  function updateCharts() { charts.forEach((chart) =\u0026gt; { // æ¯æ¬¡å¾ªç¯éƒ½è§¦å‘å¸ƒå±€ const width = chart.parentNode.offsetWidth; chart.style.width = width + \u0026#34;px\u0026#34;; // æ›´æ–°åå†æ¬¡è¯»å–ï¼Œåˆè§¦å‘å¸ƒå±€ chart.style.height = chart.offsetWidth * 0.6 + \u0026#34;px\u0026#34;; // åˆå§‹åŒ–/æ›´æ–°å›¾è¡¨ initializeChart(chart); }); } ä¼˜åŒ–ç­–ç•¥æ˜¯æ‰¹é‡è¯»å–ï¼Œæ‰¹é‡å†™å…¥ï¼š\n// ä¼˜åŒ–å¸ƒå±€æ“ä½œ function updateCharts() { // å…ˆæ”¶é›†æ‰€æœ‰éœ€è¦çš„åº¦é‡ const chartMeasurements = charts.map((chart) =\u0026gt; { return { chart, width: chart.parentNode.offsetWidth, }; }); // å†ä¸€æ¬¡æ€§åº”ç”¨æ‰€æœ‰æ ·å¼æ›´æ”¹ chartMeasurements.forEach((item) =\u0026gt; { const { chart, width } = item; chart.style.width = width + \u0026#34;px\u0026#34;; chart.style.height = width * 0.6 + \u0026#34;px\u0026#34;; }); // æœ€ååˆå§‹åŒ–æ‰€æœ‰å›¾è¡¨ chartMeasurements.forEach((item) =\u0026gt; { initializeChart(item.chart); }); } æ›´å…³é”®çš„æ˜¯é¿å…å¸ƒå±€æŠ–åŠ¨çš„å¸¸è§æ¨¡å¼ï¼š\n// ä½¿ç”¨FastDOMåº“é¿å…å¸ƒå±€æŠ–åŠ¨ import fastdom from \u0026#34;fastdom\u0026#34;; function optimizedUpdate() { // è¯»å–é˜¶æ®µï¼Œæ”¶é›†æ‰€æœ‰åº¦é‡ fastdom.measure(() =\u0026gt; { const width = container.offsetWidth; const height = container.offsetHeight; // å†™å…¥é˜¶æ®µï¼Œä¸€æ¬¡æ€§åº”ç”¨æ‰€æœ‰æ›´æ”¹ fastdom.mutate(() =\u0026gt; { element1.style.width = width / 2 + \u0026#34;px\u0026#34;; element2.style.height = height / 3 + \u0026#34;px\u0026#34;; }); }); } é€šè¿‡è¿™ç§ä¼˜åŒ–ï¼Œæˆ‘ä»¬å°†å¸ƒå±€æ—¶é—´å‡å°‘äº†çº¦ 60%ã€‚\n4. ç»˜åˆ¶(Paint)å’Œåˆæˆ(Composite) ç»˜åˆ¶æ˜¯ç”Ÿæˆå›¾åƒçš„è¿‡ç¨‹ï¼Œåˆæˆæ˜¯å°†å›¾å±‚ç»„åˆæˆæœ€ç»ˆæ˜¾ç¤ºçš„è¿‡ç¨‹ã€‚\nåœ¨ Chromium ä¸­ï¼ŒPaintLayer å¯¹è±¡æ§åˆ¶ç»˜åˆ¶ï¼š\n// Chromiumç»˜åˆ¶å®ç°ç®€åŒ–ç‰ˆ void PaintLayer::Paint() { // ç¡®å®šéœ€è¦é‡ç»˜çš„åŒºåŸŸ IntRect damagedRect = ComputeDamagedRect(); // å‡†å¤‡ç»˜åˆ¶ä¸Šä¸‹æ–‡ GraphicsContext context(damagedRect); // ç»˜åˆ¶èƒŒæ™¯ PaintBackground(context); // ç»˜åˆ¶å†…å®¹ PaintContents(context); // ç»˜åˆ¶è¾¹æ¡†å’Œè½®å»“ PaintBorderAndOutline(context); // é€’å½’ç»˜åˆ¶å­å±‚ for (PaintLayer* child : children_) { child-\u0026gt;Paint(); } } å…³é”®ä¼˜åŒ–ç‚¹æ˜¯å‡å°‘ç»˜åˆ¶åŒºåŸŸå’Œé¿å…ä¸å¿…è¦çš„é‡ç»˜ã€‚\nDashboard é¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬å‘ç°æŸäº›åŠ¨ç”»å¯¼è‡´æ•´é¡µé‡ç»˜ï¼š\n/* å¯¼è‡´è¿‡åº¦ç»˜åˆ¶çš„CSS */ .widget { box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1); /* æ˜‚è´µçš„ç»˜åˆ¶å±æ€§ */ border-radius: 4px; transition: all 0.3s ease; /* \u0026#39;all\u0026#39;è¿‡äºå®½æ³› */ } .widget:hover { box-shadow: 0 4px 15px rgba(0, 0, 0, 0.15); /* æ‚¬åœæ—¶æ”¹å˜é˜´å½± */ transform: translateY(-2px); } ä¿®æ”¹ä¸ºï¼š\n/* ä¼˜åŒ–ç»˜åˆ¶çš„CSS */ .widget { /* ä½¿ç”¨åˆæˆå±æ€§ï¼Œé¿å…é‡ç»˜ */ transform: translateZ(0); /* æå‡ä¸ºåˆæˆå±‚ */ box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1); border-radius: 4px; transition: transform 0.3s ease; /* ä»…è¿‡æ¸¡transformå±æ€§ */ } .widget:hover { transform: translateY(-2px); /* åªæ”¹å˜transformï¼Œä¸è§¦å‘é‡ç»˜ */ } åœ¨ JavaScript åŠ¨ç”»ä¸­ï¼Œä¼˜å…ˆä½¿ç”¨ transform å’Œ opacityï¼š\n// ä½æ•ˆåŠ¨ç”» function animateElement(element) { let position = 0; function step() { position += 2; element.style.left = position + \u0026#34;px\u0026#34;; // è§¦å‘å¸ƒå±€+é‡ç»˜ if (position \u0026lt; 300) { requestAnimationFrame(step); } } requestAnimationFrame(step); } // é«˜æ•ˆåŠ¨ç”» function animateElement(element) { let position = 0; function step() { position += 2; element.style.transform = `translateX(${position}px)`; // åªè§¦å‘åˆæˆ if (position \u0026lt; 300) { requestAnimationFrame(step); } } requestAnimationFrame(step); } è¿™äº›ä¼˜åŒ–å°†ç»˜åˆ¶å’Œåˆæˆæ—¶é—´å‡å°‘äº†çº¦ 70%ï¼ŒåŠ¨ç”»å¸§ç‡ä»çº¦ 25fps æå‡è‡³ç¨³å®š 60fpsã€‚\nç°ä»£æ¸²æŸ“ä¼˜åŒ–æŠ€æœ¯ é™¤äº†ä¼ ç»Ÿä¼˜åŒ–å¤–ï¼Œç°ä»£æµè§ˆå™¨æä¾›äº†æ–° API æ¥è¿›ä¸€æ­¥ä¼˜åŒ–æ¸²æŸ“æ€§èƒ½ï¼š\n1. å†…å®¹å¯è§æ€§ API(Content-Visibility) /* ä½¿ç”¨content-visibilityä¼˜åŒ–é•¿åˆ—è¡¨ */ .dashboard-item { content-visibility: auto; contain-intrinsic-size: 200px; /* æä¾›å°ºå¯¸ä¼°è®¡ */ } è¿™ä¸ªå±æ€§å‘Šè¯‰æµè§ˆå™¨è·³è¿‡å¯¹å±å¹•å¤–å…ƒç´ çš„æ¸²æŸ“ï¼Œæå¤§å‡å°‘äº†åˆå§‹æ¸²æŸ“æ—¶é—´ã€‚åœ¨æˆ‘ä»¬çš„é¡¹ç›®ä¸­ï¼Œåˆå§‹æ¸²æŸ“æ—¶é—´å‡å°‘äº†çº¦ 40%ã€‚\n2. CSS Containment /* ä½¿ç”¨CSS Containmentä¼˜åŒ–å¸ƒå±€æ€§èƒ½ */ .widget { contain: content; /* å‘Šè¯‰æµè§ˆå™¨è¯¥å…ƒç´ å†…éƒ¨ä¸ä¼šå½±å“å¤–éƒ¨å¸ƒå±€ */ } /* æ›´ç»†ç²’åº¦æ§åˆ¶ */ .isolated-component { contain: layout style paint; /* æ›´å…·ä½“çš„æ§åˆ¶ */ } è¿™å‘Šè¯‰æµè§ˆå™¨å…ƒç´ å†…éƒ¨å˜åŒ–ä¸ä¼šå½±å“å¤–éƒ¨ï¼Œå…è®¸æ›´ç§¯æçš„ä¼˜åŒ–ã€‚æˆ‘ä»¬çš„é¡¹ç›®ä¸­ï¼Œè¿™å°†æ¸²æŸ“æœŸé—´çš„å¸ƒå±€æ—¶é—´å‡å°‘äº†çº¦ 30%ã€‚\n3. è¯·æ±‚åŠ¨ç”»å¸§ä¸ç©ºé—²å›è°ƒ // é«˜çº§åŠ¨ç”»è°ƒåº¦ class AnimationScheduler { constructor() { this.animations = new Map(); this.visibleAnimations = new Set(); this.frameId = null; this.lastFrameTime = 0; this.frameRate = 60; this.frameBudget = 1000 / this.frameRate; // åˆ©ç”¨IntersectionObserverä¼˜åŒ–å±å¹•å¤–å…ƒç´  this.observer = new IntersectionObserver( (entries) =\u0026gt; { entries.forEach((entry) =\u0026gt; { const id = entry.target.dataset.animationId; if (!id) return; if (entry.isIntersecting) { this.visibleAnimations.add(id); } else { this.visibleAnimations.delete(id); } }); }, { rootMargin: \u0026#34;100px\u0026#34; } ); } register(element, animationFn, options = {}) { const id = `animation-${Date.now()}-${Math.random() .toString(36) .substr(2, 9)}`; element.dataset.animationId = id; this.animations.set(id, { element, animationFn, options, startTime: 0, lastFrameTime: 0, state: {}, }); // è§‚å¯Ÿå…ƒç´ å¯è§æ€§ this.observer.observe(element); // å¦‚æœå½“å‰å¯è§ï¼Œæ·»åŠ åˆ°å¯è§åŠ¨ç”»é›† if (element.getBoundingClientRect().top \u0026lt; window.innerHeight) { this.visibleAnimations.add(id); } // å¦‚æœæ˜¯ç¬¬ä¸€ä¸ªåŠ¨ç”»ï¼Œå¼€å§‹åŠ¨ç”»å¾ªç¯ if (this.animations.size === 1) { this.start(); } return id; } unregister(id) { const animation = this.animations.get(id); if (animation) { this.observer.unobserve(animation.element); this.animations.delete(id); this.visibleAnimations.delete(id); } // å¦‚æœæ²¡æœ‰æ›´å¤šåŠ¨ç”»ï¼Œåœæ­¢åŠ¨ç”»å¾ªç¯ if (this.animations.size === 0) { this.stop(); } } start() { if (this.frameId) return; const animate = (timestamp) =\u0026gt; { const deltaTime = this.lastFrameTime ? timestamp - this.lastFrameTime : 0; this.lastFrameTime = timestamp; // æ‰§è¡Œæ‰€æœ‰å¯è§çš„åŠ¨ç”» this.visibleAnimations.forEach((id) =\u0026gt; { const animation = this.animations.get(id); if (!animation) return; if (animation.startTime === 0) { animation.startTime = timestamp; animation.lastFrameTime = timestamp; } const elapsed = timestamp - animation.startTime; const frameDelta = timestamp - animation.lastFrameTime; try { animation.animationFn({ element: animation.element, timestamp, elapsed, delta: frameDelta, state: animation.state, }); } catch (err) { console.error(\u0026#34;Animation error:\u0026#34;, err); } animation.lastFrameTime = timestamp; }); this.frameId = requestAnimationFrame(animate); }; this.frameId = requestAnimationFrame(animate); } stop() { if (this.frameId) { cancelAnimationFrame(this.frameId); this.frameId = null; } } // æ ¹æ®è®¾å¤‡æ€§èƒ½åŠ¨æ€è°ƒæ•´å¸§ç‡ adaptToDevicePerformance() { let frameTimeSum = 0; let frameCount = 0; const maxSamples = 30; // æµ‹é‡å¸§æ—¶é—´ const measureFrameTime = (timestamp) =\u0026gt; { const now = performance.now(); const frameTime = now - timestamp; frameTimeSum += frameTime; frameCount++; if (frameCount \u0026gt;= maxSamples) { const avgFrameTime = frameTimeSum / frameCount; // å¦‚æœå¹³å‡å¸§æ—¶é—´è¶…è¿‡16ms (60fps)ï¼Œé™ä½ç›®æ ‡å¸§ç‡ if (avgFrameTime \u0026gt; 16) { this.frameRate = Math.max( 30, Math.min(60, Math.floor(1000 / avgFrameTime)) ); this.frameBudget = 1000 / this.frameRate; console.log(`Adjusting target frame rate to ${this.frameRate}fps`); } else { // æ€§èƒ½è‰¯å¥½ï¼Œæ¢å¤60fps this.frameRate = 60; this.frameBudget = 1000 / 60; } // é‡ç½®ç»Ÿè®¡ frameTimeSum = 0; frameCount = 0; } setTimeout(() =\u0026gt; { requestAnimationFrame(measureFrameTime); }, 1000); // æ¯ç§’é‡‡æ ·ä¸€æ¬¡ }; requestAnimationFrame(measureFrameTime); } } // ä½¿ç”¨ç¤ºä¾‹ const scheduler = new AnimationScheduler(); scheduler.adaptToDevicePerformance(); // æ³¨å†Œä¸€ä¸ªç®€å•åŠ¨ç”» const element = document.querySelector(\u0026#34;.animated-element\u0026#34;); scheduler.register(element, ({ elapsed }) =\u0026gt; { const progress = (elapsed % 2000) / 2000; const x = Math.sin(progress * Math.PI * 2) * 50; element.style.transform = `translateX(${x}px)`; }); è¿™ä¸ªç³»ç»Ÿèƒ½å¤Ÿ:\nåªæ¸²æŸ“å¯è§å…ƒç´ çš„åŠ¨ç”» æ ¹æ®è®¾å¤‡æ€§èƒ½åŠ¨æ€è°ƒæ•´å¸§ç‡ æä¾›æ—¶é—´å’ŒçŠ¶æ€ç®¡ç† å¤„ç†å¼‚å¸¸ï¼Œé˜²æ­¢ä¸€ä¸ªåŠ¨ç”»é”™è¯¯å½±å“å…¶ä»–åŠ¨ç”» åœ¨æˆ‘ä»¬çš„ Dashboard é¡¹ç›®ä¸­ï¼Œè¿™ä¸€ç³»ç»Ÿå°†åŠ¨ç”»å¼€é”€å‡å°‘äº†çº¦ 75%ã€‚\nå®æˆ˜æ¡ˆä¾‹ï¼šæ•°æ®å¯è§†åŒ–ä»ªè¡¨ç›˜çš„æé™ä¼˜åŒ– è¿™æ˜¯æˆ‘ä»¬å›¢é˜Ÿå¤„ç†çš„å®é™…æ¡ˆä¾‹ã€‚ä»ªè¡¨ç›˜åŒ…å« 60+ç»„ä»¶ï¼Œæ¯ç§’å¤„ç†æ•°åƒæ¡æ•°æ®æ›´æ–°ã€‚\né—®é¢˜è¯Šæ–­ ä½¿ç”¨ Chrome Performance å’Œ Frame Rendering Statsï¼Œæˆ‘ä»¬è¯†åˆ«å‡ºå‡ ä¸ªå…³é”®ç“¶é¢ˆï¼š\né«˜é¢‘æ•°æ®æ›´æ–°å¯¼è‡´çš„è¿ç»­é‡æ¸²æŸ“ å¤æ‚å›¾è¡¨å¸ƒå±€è§¦å‘çš„é¢‘ç¹é‡æ’ å›¾è¡¨åŠ¨ç”»å¼•èµ·çš„è¿‡åº¦ç»˜åˆ¶ åˆ†å±‚ä¼˜åŒ–ç­–ç•¥ æˆ‘ä»¬é‡‡ç”¨ä¸‰å±‚ä¼˜åŒ–ç­–ç•¥ï¼š\nç¬¬ä¸€å±‚ï¼šæ•°æ®å¤„ç†ä¸æ›´æ–°ç­–ç•¥ // ä¼˜åŒ–å‰ï¼šæ•°æ®å˜åŒ–ç›´æ¥è§¦å‘æ¸²æŸ“ function handleDataUpdate(newData) { this.data = newData; this.render(); // ç›´æ¥è§¦å‘æ¸²æŸ“ } // ä¼˜åŒ–åï¼šæ™ºèƒ½æ‰¹å¤„ç†æ›´æ–° class SmartDashboard { constructor() { this.pendingUpdates = new Map(); this.updateScheduled = false; this.renderTime = 0; } // æ¥æ”¶æ•°æ®æ›´æ–° handleDataUpdate(chartId, newData) { this.pendingUpdates.set(chartId, newData); if (!this.updateScheduled) { this.scheduleUpdate(); } } // æ™ºèƒ½è°ƒåº¦æ›´æ–° scheduleUpdate() { this.updateScheduled = true; // ä¼°ç®—æ‰€éœ€æ¸²æŸ“æ—¶é—´ const estimatedRenderTime = this.pendingUpdates.size * this.averageChartRenderTime; if (estimatedRenderTime \u0026gt; 16) { // è¶…è¿‡ä¸€å¸§çš„æ—¶é—´é¢„ç®— // ä½¿ç”¨ç©ºé—²æ—¶é—´æ¸²æŸ“ï¼Œå¯èƒ½ä¼šå»¶è¿Ÿ requestIdleCallback(() =\u0026gt; this.flushUpdates()); } else { // å¿«é€Ÿæ¸²æŸ“ï¼Œä¸‹ä¸€å¸§æ‰§è¡Œ requestAnimationFrame(() =\u0026gt; this.flushUpdates()); } } // æ‰¹é‡æ‰§è¡Œæ›´æ–° flushUpdates() { this.updateScheduled = false; const renderStart = performance.now(); // é¦–å…ˆæ›´æ–°æœ€é‡è¦çš„å›¾è¡¨ const criticalCharts = Array.from(this.pendingUpdates.keys()).filter( (id) =\u0026gt; this.charts.get(id).priority === \u0026#34;high\u0026#34; ); // ç„¶åæ›´æ–°æ¬¡è¦å›¾è¡¨ const nonCriticalCharts = Array.from(this.pendingUpdates.keys()).filter( (id) =\u0026gt; this.charts.get(id).priority !== \u0026#34;high\u0026#34; ); // ç«‹å³æ›´æ–°å…³é”®å›¾è¡¨ criticalCharts.forEach((id) =\u0026gt; { const chart = this.charts.get(id); chart.update(this.pendingUpdates.get(id)); this.pendingUpdates.delete(id); }); // å¦‚æœæœ‰æ—¶é—´ï¼Œæ›´æ–°éå…³é”®å›¾è¡¨ï¼›å¦åˆ™é‡æ–°è°ƒåº¦ if (this.pendingUpdates.size \u0026gt; 0) { requestIdleCallback(() =\u0026gt; { nonCriticalCharts.forEach((id) =\u0026gt; { if (this.pendingUpdates.has(id)) { const chart = this.charts.get(id); chart.update(this.pendingUpdates.get(id)); this.pendingUpdates.delete(id); } }); }); } // æ›´æ–°æ¸²æŸ“æ—¶é—´ç»Ÿè®¡ this.renderTime = performance.now() - renderStart; this.updateRenderTimeStats(); } } ç¬¬äºŒå±‚ï¼šæ¸²æŸ“ä¼˜åŒ– // é«˜æ•ˆå›¾è¡¨æ¸²æŸ“ç»„ä»¶ class OptimizedChartComponent { constructor(container) { this.container = container; this.canvas = document.createElement(\u0026#34;canvas\u0026#34;); this.container.appendChild(this.canvas); this.ctx = this.canvas.getContext(\u0026#34;2d\u0026#34;); // ä½¿ç”¨ResizeObserveré¿å…å¸ƒå±€æŠ–åŠ¨ this.resizeObserver = new ResizeObserver((entries) =\u0026gt; { const { width, height } = entries[0].contentRect; this.resizeCanvas(width, height); }); this.resizeObserver.observe(container); // ç¼“å­˜å¸¸ç”¨å€¼ä»¥é¿å…é‡å¤è®¡ç®— this.cachedValues = new Map(); } // è°ƒæ•´ç”»å¸ƒå¤§å° resizeCanvas(width, height) { // è®¾ç½®å°ºå¯¸å¹¶åº”ç”¨è®¾å¤‡åƒç´ æ¯” const dpr = window.devicePixelRatio || 1; this.canvas.width = width * dpr; this.canvas.height = height * dpr; this.canvas.style.width = `${width}px`; this.canvas.style.height = `${height}px`; this.ctx.scale(dpr, dpr); // æ ‡è®°ç¼“å­˜éœ€è¦æ›´æ–° this.invalidateCache(); // æ ¹æ®æ–°å°ºå¯¸é‡ç»˜ this.render(); } // é«˜æ•ˆæ¸²æŸ“ï¼Œä½¿ç”¨å¢é‡æ›´æ–° render() { const { data, options } = this; if (!data) return; // åªé‡ç»˜å˜åŒ–çš„éƒ¨åˆ† if (this.canIncrementalUpdate) { this.incrementalUpdate(); return; } // å›é€€åˆ°å®Œæ•´é‡ç»˜ this.fullRender(); } // ä¼˜åŒ–è®¡ç®—å€¼ç¼“å­˜ getComputedValue(key, computer) { if (this.cachedValues.has(key)) { return this.cachedValues.get(key); } const value = computer(); this.cachedValues.set(key, value); return value; } invalidateCache() { this.cachedValues.clear(); } } ç¬¬ä¸‰å±‚ï¼šGPU åŠ é€Ÿä¸ç¦»å±æ¸²æŸ“ // GPUåŠ é€Ÿçš„é«˜æ€§èƒ½å›¾è¡¨ç»„ä»¶ class GPUAcceleratedChart extends OptimizedChartComponent { constructor(container) { super(container); // åˆ›å»ºç¦»å±canvasç”¨äºç¼“å­˜é™æ€éƒ¨åˆ† this.offscreenCanvas = document.createElement(\u0026#34;canvas\u0026#34;); this.offscreenCtx = this.offscreenCanvas.getContext(\u0026#34;2d\u0026#34;); // ç”¨äºWebGLæ¸²æŸ“çš„canvas this.glCanvas = document.createElement(\u0026#34;canvas\u0026#34;); this.gl = this.glCanvas.getContext(\u0026#34;webgl2\u0026#34;); this.container.appendChild(this.glCanvas); // åˆå§‹åŒ–WebGL this.initWebGL(); } // åˆå§‹åŒ–WebGL initWebGL() { // çœç•¥WebGLåˆå§‹åŒ–ä»£ç ... } // æ ¹æ®æ•°æ®å¤æ‚åº¦é€‰æ‹©æ¸²æŸ“æ–¹å¼ render() { const { data } = this; if (data.points.length \u0026gt; 10000) { // å¤§æ•°æ®é›†ä½¿ç”¨WebGLæ¸²æŸ“ this.renderWithWebGL(); } else if (data.points.length \u0026gt; 1000) { // ä¸­ç­‰æ•°æ®é›†ä½¿ç”¨Canvas2D + ä¼˜åŒ– this.renderOptimizedCanvas(); } else { // å°æ•°æ®é›†ä½¿ç”¨æ ‡å‡†Canvas2D super.render(); } } // WebGLæ¸²æŸ“é«˜æ€§èƒ½å›¾è¡¨ renderWithWebGL() { const { gl, data } = this; // å‡†å¤‡æ•°æ®ç¼“å†²åŒº const points = new Float32Array(data.points.flatMap((p) =\u0026gt; [p.x, p.y])); // æ›´æ–°ç¼“å†²åŒºæ•°æ® gl.bindBuffer(gl.ARRAY_BUFFER, this.pointBuffer); gl.bufferData(gl.ARRAY_BUFFER, points, gl.DYNAMIC_DRAW); // æ¸²æŸ“ gl.drawArrays(gl.POINTS, 0, data.points.length); } // ä¼˜åŒ–çš„Canvas2Dæ¸²æŸ“ renderOptimizedCanvas() { const { ctx, data, options } = this; // æ¸…é™¤ç”»å¸ƒ ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height); // ç»˜åˆ¶é™æ€å…ƒç´ åˆ°ç¦»å±Canvas if (this.staticContentChanged) { this.renderStaticContent(); this.staticContentChanged = false; } // å¤åˆ¶é™æ€å†…å®¹ ctx.drawImage(this.offscreenCanvas, 0, 0); // åªç»˜åˆ¶åŠ¨æ€éƒ¨åˆ† this.renderDynamicContent(); } // ç¦»å±æ¸²æŸ“é™æ€å†…å®¹ renderStaticContent() { const { offscreenCtx, options } = this; // ç»˜åˆ¶åæ ‡è½´ã€ç½‘æ ¼ã€æ ‡ç­¾ç­‰é™æ€å†…å®¹... } // ç»˜åˆ¶åŠ¨æ€å†…å®¹ renderDynamicContent() { const { ctx, data } = this; // åªç»˜åˆ¶æ•°æ®ç‚¹ã€é«˜äº®ç­‰åŠ¨æ€å†…å®¹... } } ä¼˜åŒ–ç»“æœ å®æ–½è¿™ä¸‰å±‚ä¼˜åŒ–åï¼š\nCPU ä½¿ç”¨ç‡ï¼šä»å¹³å‡ 85%é™è‡³ 35% å¸§ç‡ï¼šä»å¹³å‡ 25fps æå‡è‡³ç¨³å®š 60fps äº¤äº’å»¶è¿Ÿï¼šä» 2.5 ç§’å‡å°‘è‡³ä¸åˆ° 100ms å†…å­˜ä½¿ç”¨ï¼šå‡å°‘ 30% åˆå§‹åŠ è½½æ—¶é—´ï¼šå‡å°‘ 45% ç°ä»£æµè§ˆå™¨æ¸²æŸ“çš„æœªæ¥æ–¹å‘ è·Ÿè¸ª Chrome å’Œå…¶ä»–æµè§ˆå™¨çš„å¼€å‘ï¼Œæˆ‘çœ‹åˆ°å‡ ä¸ªå€¼å¾—å…³æ³¨çš„æ–°æ–¹å‘ï¼š\n1. RenderingNG æ¶æ„ Chrome çš„æ–°ä¸€ä»£æ¸²æŸ“å¼•æ“ç®€åŒ–äº†æ¸²æŸ“ç®¡çº¿ï¼Œä¸“æ³¨äºå¹¶è¡ŒåŒ–å’Œå¤åˆä¼˜åŒ–ã€‚å…³é”®æ”¹è¿›ï¼š\nå¹¶è¡Œæ …æ ¼åŒ–ï¼šå¤šçº¿ç¨‹ç”Ÿæˆä½å›¾ åˆæˆå™¨çº¿ç¨‹ä¼˜åŒ–ï¼šæ›´é«˜æ•ˆçš„å±‚ç®¡ç† æ˜¾ç¤ºåˆ—è¡¨ï¼šå‡å°‘å†—ä½™ç»˜åˆ¶æ“ä½œ 2. Paint Worklet ä¸ Houdini // æ³¨å†Œä¸€ä¸ªPaintWorkletç¤ºä¾‹ CSS.paintWorklet.addModule(\u0026#34;myPainter.js\u0026#34;); // myPainter.js class MyPainter { static get inputProperties() { return [\u0026#34;--pattern-color\u0026#34;, \u0026#34;--pattern-size\u0026#34;]; } paint(ctx, size, properties) { const color = properties.get(\u0026#34;--pattern-color\u0026#34;).toString(); const patternSize = parseInt(properties.get(\u0026#34;--pattern-size\u0026#34;)); // è‡ªå®šä¹‰ç»˜åˆ¶é€»è¾‘ ctx.fillStyle = color; for (let y = 0; y \u0026lt; size.height; y += patternSize) { for (let x = 0; x \u0026lt; size.width; x += patternSize) { ctx.beginPath(); ctx.arc(x, y, patternSize / 2, 0, 2 * Math.PI); ctx.fill(); } } } } registerPaint(\u0026#34;myPattern\u0026#34;, MyPainter); è¿™ç§æŠ€æœ¯å…è®¸åˆ›å»º GPU åŠ é€Ÿçš„è‡ªå®šä¹‰èƒŒæ™¯å’Œæ•ˆæœï¼Œæ— éœ€ JavaScript åŠ¨ç”»ã€‚\n3. WebGPU // WebGPUç¤ºä¾‹ç®€åŒ–ä»£ç  async function initWebGPU() { if (!navigator.gpu) { throw new Error(\u0026#34;WebGPU not supported\u0026#34;); } // è·å–GPUé€‚é…å™¨ const adapter = await navigator.gpu.requestAdapter(); // è·å–GPUè®¾å¤‡ const device = await adapter.requestDevice(); // åˆ›å»ºæ¸²æŸ“ç®¡çº¿ const pipeline = device.createRenderPipeline({ vertex: { module: device.createShaderModule({ code: vertexShader, }), entryPoint: \u0026#34;main\u0026#34;, }, fragment: { module: device.createShaderModule({ code: fragmentShader, }), entryPoint: \u0026#34;main\u0026#34;, targets: [{ format: \u0026#34;bgra8unorm\u0026#34; }], }, primitive: { topology: \u0026#34;triangle-list\u0026#34; }, }); // åˆ›å»ºå‘½ä»¤ç¼–ç å™¨ const commandEncoder = device.createCommandEncoder(); // åˆ›å»ºæ¸²æŸ“é€šé“ const renderPass = commandEncoder.beginRenderPass({ colorAttachments: [ { view: context.getCurrentTexture().createView(), loadValue: { r: 0, g: 0, b: 0, a: 1 }, storeOp: \u0026#34;store\u0026#34;, }, ], }); // è®¾ç½®æ¸²æŸ“ç®¡çº¿ renderPass.setPipeline(pipeline); // ç»˜åˆ¶ renderPass.draw(3, 1, 0, 0); renderPass.endPass(); // æäº¤å‘½ä»¤ device.queue.submit([commandEncoder.finish()]); } WebGPU æä¾›æ¯” WebGL æ›´åº•å±‚çš„ GPU è®¿é—®ï¼Œæ€§èƒ½æå‡æ˜¾è‘—ï¼Œç‰¹åˆ«é€‚åˆæ•°æ®å¯è§†åŒ–å’Œå¤æ‚æ¸²æŸ“ã€‚\næœ€åçš„æ€è€ƒ æµè§ˆå™¨æ¸²æŸ“ç®¡çº¿ä¼˜åŒ–æ˜¯å‰ç«¯æ€§èƒ½çš„æ ¸å¿ƒæˆ˜åœºã€‚é€šè¿‡æ·±å…¥ç†è§£æ¯ä¸ªæ¸²æŸ“é˜¶æ®µçš„å·¥ä½œåŸç†ï¼Œæˆ‘ä»¬èƒ½å¤Ÿç¼–å†™æ›´ç¬¦åˆæµè§ˆå™¨å·¥ä½œæ¨¡å¼çš„ä»£ç ï¼Œæ˜¾è‘—æå‡æ€§èƒ½ã€‚\næœ€é‡è¦çš„å‡ æ¡ç»éªŒï¼š\næµ‹é‡ä¼˜å…ˆï¼šä½¿ç”¨ Performance é¢æ¿ç¡®å®šçœŸæ­£çš„ç“¶é¢ˆï¼Œè€Œä¸æ˜¯å‡­æ„Ÿè§‰ä¼˜åŒ– ç†è§£æ¸²æŸ“é˜¶æ®µï¼šä¸åŒé˜¶æ®µéœ€è¦ä¸åŒçš„ä¼˜åŒ–ç­–ç•¥ è¯»å†™åˆ†ç¦»ï¼šå§‹ç»ˆå°† DOM è¯»å–å’Œä¿®æ”¹æ“ä½œåˆ†æ‰¹æ‰§è¡Œ å‡å°‘é‡æ’ï¼šå°½å¯èƒ½ä½¿ç”¨ transform å’Œ opacity ä»£æ›¿ä¿®æ”¹ä½ç½®å’Œå°ºå¯¸ åˆ†å±‚ä¼˜åŒ–ï¼šä»æ•°æ®å¤„ç†ã€æ¸²æŸ“ç­–ç•¥åˆ° GPU åŠ é€Ÿï¼Œå¤šæ–¹é¢ç»“åˆ ç›‘æ§æ€§èƒ½ï¼šå»ºç«‹æ€§èƒ½é¢„ç®—å’ŒæŒç»­ç›‘æ§ç³»ç»Ÿ å…³äºæœ€åä¸€ç‚¹ï¼Œæˆ‘ä»¬åœ¨é¡¹ç›®ä¸­å»ºç«‹äº†ä¸€ä¸ªæ€§èƒ½ç›‘æ§ç³»ç»Ÿï¼Œå€¼å¾—åˆ†äº«ï¼š\n// æ€§èƒ½ç›‘æ§ç³»ç»Ÿ class PerformanceMonitor { constructor() { this.metrics = { FPS: [], layoutDuration: [], paintDuration: [], longTasks: [], jank: [], memoryUsage: [], }; this.thresholds = { FPS: 55, layoutDuration: 10, // ms paintDuration: 8, // ms jank: 50, // ms memoryUsage: 100, // MB }; this.frameCount = 0; this.lastFrameTime = performance.now(); this.observing = false; this.setupObservers(); } setupObservers() { // FPSè®¡æ•°å™¨ this.animationFrameId = null; // ç›‘æ§é•¿ä»»åŠ¡ this.longTaskObserver = new PerformanceObserver((entries) =\u0026gt; { entries.getEntries().forEach((entry) =\u0026gt; { this.metrics.longTasks.push({ duration: entry.duration, startTime: entry.startTime, timestamp: Date.now(), }); // è®°å½•å¡é¡¿ if (entry.duration \u0026gt; this.thresholds.jank) { this.metrics.jank.push({ duration: entry.duration, timestamp: Date.now(), }); // å‘é€è­¦æŠ¥ this.alertPerformanceIssue(\u0026#34;jank\u0026#34;, entry.duration); } }); }); // ç›‘æ§å¸ƒå±€å’Œç»˜åˆ¶æ€§èƒ½ this.performanceObserver = new PerformanceObserver((entries) =\u0026gt; { for (const entry of entries.getEntries()) { if (entry.name.includes(\u0026#34;layout\u0026#34;)) { this.metrics.layoutDuration.push(entry.duration); if (entry.duration \u0026gt; this.thresholds.layoutDuration) { this.alertPerformanceIssue(\u0026#34;layout\u0026#34;, entry.duration); } } if (entry.name.includes(\u0026#34;paint\u0026#34;)) { this.metrics.paintDuration.push(entry.duration); if (entry.duration \u0026gt; this.thresholds.paintDuration) { this.alertPerformanceIssue(\u0026#34;paint\u0026#34;, entry.duration); } } } }); // å†…å­˜ä½¿ç”¨ç›‘æ§ if (performance.memory) { this.memoryMonitorId = null; } } start() { if (this.observing) return; this.observing = true; // å¯åŠ¨FPSè®¡æ•°å™¨ const trackFPS = () =\u0026gt; { const now = performance.now(); const elapsed = now - this.lastFrameTime; this.frameCount++; // æ¯ç§’è®¡ç®—ä¸€æ¬¡FPS if (elapsed \u0026gt;= 1000) { const fps = Math.round((this.frameCount * 1000) / elapsed); this.metrics.FPS.push({ value: fps, timestamp: Date.now(), }); // æ£€æŸ¥FPSæ˜¯å¦ä½äºé˜ˆå€¼ if (fps \u0026lt; this.thresholds.FPS) { this.alertPerformanceIssue(\u0026#34;fps\u0026#34;, fps); } this.frameCount = 0; this.lastFrameTime = now; } this.animationFrameId = requestAnimationFrame(trackFPS); }; this.animationFrameId = requestAnimationFrame(trackFPS); // å¯åŠ¨é•¿ä»»åŠ¡è§‚å¯Ÿå™¨ this.longTaskObserver.observe({ entryTypes: [\u0026#34;longtask\u0026#34;] }); // å¯åŠ¨æ€§èƒ½è§‚å¯Ÿå™¨ this.performanceObserver.observe({ entryTypes: [\u0026#34;measure\u0026#34;, \u0026#34;resource\u0026#34;], buffered: true, }); // ç›‘æ§å†…å­˜ä½¿ç”¨ if (performance.memory) { this.memoryMonitorId = setInterval(() =\u0026gt; { const memoryUsage = performance.memory.usedJSHeapSize / (1024 * 1024); this.metrics.memoryUsage.push({ value: memoryUsage, timestamp: Date.now(), }); if (memoryUsage \u0026gt; this.thresholds.memoryUsage) { this.alertPerformanceIssue(\u0026#34;memory\u0026#34;, memoryUsage); } }, 5000); } } stop() { this.observing = false; if (this.animationFrameId) { cancelAnimationFrame(this.animationFrameId); } this.longTaskObserver.disconnect(); this.performanceObserver.disconnect(); if (this.memoryMonitorId) { clearInterval(this.memoryMonitorId); } } // æŠ¥å‘Šæ€§èƒ½é—®é¢˜ alertPerformanceIssue(type, value) { console.warn(`Performance issue detected: ${type} (${value})`); // å‘é€åˆ°åˆ†ææœåŠ¡ if (this.analyticsEnabled) { sendAnalytics(\u0026#34;performance_issue\u0026#34;, { type, value, url: window.location.href, userAgent: navigator.userAgent, timestamp: Date.now(), }); } } // è·å–æ€§èƒ½æŠ¥å‘Š getReport() { const avgFPS = this.calculateAverage( this.metrics.FPS.map((item) =\u0026gt; item.value) ); const avgLayoutDuration = this.calculateAverage( this.metrics.layoutDuration ); const avgPaintDuration = this.calculateAverage(this.metrics.paintDuration); return { avgFPS, avgLayoutDuration, avgPaintDuration, jankEvents: this.metrics.jank.length, longTasks: this.metrics.longTasks.length, avgMemoryUsage: this.calculateAverage( this.metrics.memoryUsage.map((item) =\u0026gt; item.value) ), timestamp: Date.now(), }; } calculateAverage(arr) { if (arr.length === 0) return 0; return arr.reduce((sum, val) =\u0026gt; sum + val, 0) / arr.length; } } // ä½¿ç”¨ç¤ºä¾‹ const monitor = new PerformanceMonitor(); monitor.start(); // å®šæœŸå‘é€æŠ¥å‘Š setInterval(() =\u0026gt; { const report = monitor.getReport(); // å‘é€åˆ°æœåŠ¡å™¨ fetch(\u0026#34;/api/performance\u0026#34;, { method: \u0026#34;POST\u0026#34;, headers: { \u0026#34;Content-Type\u0026#34;: \u0026#34;application/json\u0026#34; }, body: JSON.stringify(report), }); // é‡ç½®æ”¶é›†çš„æ•°æ®ï¼Œä¿æŒå†…å­˜å ç”¨è¾ƒä½ monitor.metrics = { FPS: [], layoutDuration: [], paintDuration: [], longTasks: [], jank: [], memoryUsage: [], }; }, 60000); // æ¯åˆ†é’Ÿå‘é€ä¸€æ¬¡ è¿™å¥—ç›‘æ§ç³»ç»Ÿå¸®åŠ©æˆ‘ä»¬å®æ—¶æ£€æµ‹æ€§èƒ½é—®é¢˜ï¼Œå¹¶åœ¨å‘å¸ƒåæŒç»­ç›‘æ§äº§å“æ€§èƒ½ï¼Œç¡®ä¿ä¼˜åŒ–æˆæœé•¿æœŸä¿æŒã€‚\nWeb åŠ¨ç”»çš„æ¸²æŸ“ä¼˜åŒ– åŠ¨ç”»æ˜¯ç°ä»£ç½‘é¡µçš„é‡è¦ç»„æˆéƒ¨åˆ†ï¼Œä¹Ÿæ˜¯æ€§èƒ½æŒ‘æˆ˜çš„ä¸»è¦æ¥æºã€‚æ·±å…¥ç†è§£ä¸åŒåŠ¨ç”»æŠ€æœ¯çš„æ¸²æŸ“ç‰¹æ€§è‡³å…³é‡è¦ï¼š\nCSS åŠ¨ç”»ä¸æ¸²æŸ“ç®¡çº¿ /* é«˜æ€§èƒ½çš„CSSåŠ¨ç”» */ .efficient-animation { transform: translateX(0); opacity: 1; transition: transform 0.3s ease, opacity 0.3s ease; will-change: transform, opacity; } .efficient-animation:hover { transform: translateX(20px); opacity: 0.8; } /* ä½æ€§èƒ½çš„CSSåŠ¨ç”» */ .inefficient-animation { left: 0; background-color: red; box-shadow: 0 0 10px rgba(0, 0, 0, 0.5); transition: left 0.3s ease, background-color 0.3s ease, box-shadow 0.3s ease; } .inefficient-animation:hover { left: 20px; background-color: blue; box-shadow: 0 0 20px rgba(0, 0, 0, 0.8); } é€šè¿‡ DevTools Performance é¢æ¿åˆ†æï¼Œtransform/opacity åŠ¨ç”»åªè§¦å‘åˆæˆï¼Œè€Œ left/background-color/box-shadow åŠ¨ç”»è§¦å‘å¸ƒå±€å’Œç»˜åˆ¶ï¼Œæ€§èƒ½å·®è·é«˜è¾¾ 10 å€ã€‚\nä¸ºä¼˜åŒ–å¤æ‚åŠ¨ç”»ï¼Œæˆ‘ä»¬å¼€å‘äº†ä¸€ä¸ªæ™ºèƒ½åŠ¨ç”»è°ƒåº¦ç³»ç»Ÿï¼š\n// æ™ºèƒ½åŠ¨ç”»è°ƒåº¦ç³»ç»Ÿ class AnimationScheduler { constructor() { this.animations = new Map(); this.visibleAnimations = new Set(); this.frameId = null; this.lastFrameTime = 0; this.frameRate = 60; this.frameBudget = 1000 / this.frameRate; // åˆ©ç”¨IntersectionObserverä¼˜åŒ–å±å¹•å¤–å…ƒç´  this.observer = new IntersectionObserver( (entries) =\u0026gt; { entries.forEach((entry) =\u0026gt; { const id = entry.target.dataset.animationId; if (!id) return; if (entry.isIntersecting) { this.visibleAnimations.add(id); } else { this.visibleAnimations.delete(id); } }); }, { rootMargin: \u0026#34;100px\u0026#34; } ); } register(element, animationFn, options = {}) { const id = `animation-${Date.now()}-${Math.random() .toString(36) .substr(2, 9)}`; element.dataset.animationId = id; this.animations.set(id, { element, animationFn, options, startTime: 0, lastFrameTime: 0, state: {}, }); // è§‚å¯Ÿå…ƒç´ å¯è§æ€§ this.observer.observe(element); // å¦‚æœå½“å‰å¯è§ï¼Œæ·»åŠ åˆ°å¯è§åŠ¨ç”»é›† if (element.getBoundingClientRect().top \u0026lt; window.innerHeight) { this.visibleAnimations.add(id); } // å¦‚æœæ˜¯ç¬¬ä¸€ä¸ªåŠ¨ç”»ï¼Œå¼€å§‹åŠ¨ç”»å¾ªç¯ if (this.animations.size === 1) { this.start(); } return id; } unregister(id) { const animation = this.animations.get(id); if (animation) { this.observer.unobserve(animation.element); this.animations.delete(id); this.visibleAnimations.delete(id); } // å¦‚æœæ²¡æœ‰æ›´å¤šåŠ¨ç”»ï¼Œåœæ­¢åŠ¨ç”»å¾ªç¯ if (this.animations.size === 0) { this.stop(); } } start() { if (this.frameId) return; const animate = (timestamp) =\u0026gt; { const deltaTime = this.lastFrameTime ? timestamp - this.lastFrameTime : 0; this.lastFrameTime = timestamp; // æ‰§è¡Œæ‰€æœ‰å¯è§çš„åŠ¨ç”» this.visibleAnimations.forEach((id) =\u0026gt; { const animation = this.animations.get(id); if (!animation) return; if (animation.startTime === 0) { animation.startTime = timestamp; animation.lastFrameTime = timestamp; } const elapsed = timestamp - animation.startTime; const frameDelta = timestamp - animation.lastFrameTime; try { animation.animationFn({ element: animation.element, timestamp, elapsed, delta: frameDelta, state: animation.state, }); } catch (err) { console.error(\u0026#34;Animation error:\u0026#34;, err); } animation.lastFrameTime = timestamp; }); this.frameId = requestAnimationFrame(animate); }; this.frameId = requestAnimationFrame(animate); } stop() { if (this.frameId) { cancelAnimationFrame(this.frameId); this.frameId = null; } } // æ ¹æ®è®¾å¤‡æ€§èƒ½åŠ¨æ€è°ƒæ•´å¸§ç‡ adaptToDevicePerformance() { let frameTimeSum = 0; let frameCount = 0; const maxSamples = 30; // æµ‹é‡å¸§æ—¶é—´ const measureFrameTime = (timestamp) =\u0026gt; { const now = performance.now(); const frameTime = now - timestamp; frameTimeSum += frameTime; frameCount++; if (frameCount \u0026gt;= maxSamples) { const avgFrameTime = frameTimeSum / frameCount; // å¦‚æœå¹³å‡å¸§æ—¶é—´è¶…è¿‡16ms (60fps)ï¼Œé™ä½ç›®æ ‡å¸§ç‡ if (avgFrameTime \u0026gt; 16) { this.frameRate = Math.max( 30, Math.min(60, Math.floor(1000 / avgFrameTime)) ); this.frameBudget = 1000 / this.frameRate; console.log(`Adjusting target frame rate to ${this.frameRate}fps`); } else { // æ€§èƒ½è‰¯å¥½ï¼Œæ¢å¤60fps this.frameRate = 60; this.frameBudget = 1000 / 60; } // é‡ç½®ç»Ÿè®¡ frameTimeSum = 0; frameCount = 0; } setTimeout(() =\u0026gt; { requestAnimationFrame(measureFrameTime); }, 1000); // æ¯ç§’é‡‡æ ·ä¸€æ¬¡ }; requestAnimationFrame(measureFrameTime); } } // ä½¿ç”¨ç¤ºä¾‹ const scheduler = new AnimationScheduler(); scheduler.adaptToDevicePerformance(); // æ³¨å†Œä¸€ä¸ªç®€å•åŠ¨ç”» const element = document.querySelector(\u0026#34;.animated-element\u0026#34;); scheduler.register(element, ({ elapsed }) =\u0026gt; { const progress = (elapsed % 2000) / 2000; const x = Math.sin(progress * Math.PI * 2) * 50; element.style.transform = `translateX(${x}px)`; }); è¿™ä¸ªç³»ç»Ÿèƒ½å¤Ÿ:\nåªæ¸²æŸ“å¯è§å…ƒç´ çš„åŠ¨ç”» æ ¹æ®è®¾å¤‡æ€§èƒ½åŠ¨æ€è°ƒæ•´å¸§ç‡ æä¾›æ—¶é—´å’ŒçŠ¶æ€ç®¡ç† å¤„ç†å¼‚å¸¸ï¼Œé˜²æ­¢ä¸€ä¸ªåŠ¨ç”»é”™è¯¯å½±å“å…¶ä»–åŠ¨ç”» åœ¨æˆ‘ä»¬çš„ Dashboard é¡¹ç›®ä¸­ï¼Œè¿™ä¸€ç³»ç»Ÿå°†åŠ¨ç”»å¼€é”€å‡å°‘äº†çº¦ 75%ã€‚\nå“åº”å¼è®¾è®¡ä¸æ¸²æŸ“æ€§èƒ½çš„å¹³è¡¡ å“åº”å¼è®¾è®¡ä¸æ¸²æŸ“æ€§èƒ½å¸¸å¸¸æ˜¯ä¸€å¯¹çŸ›ç›¾ï¼Œç‰¹åˆ«æ˜¯åœ¨ä½ç«¯è®¾å¤‡ä¸Šã€‚æˆ‘ä»¬å¼€å‘äº†ä¸€ç§åŸºäºè®¾å¤‡æ€§èƒ½çš„è‡ªé€‚åº”æ¸²æŸ“ç­–ç•¥ï¼š\n// åŸºäºè®¾å¤‡æ€§èƒ½çš„å“åº”å¼æ¸²æŸ“ class AdaptiveRenderer { constructor() { this.performanceScore = 0; // 0-100 this.featureFlags = { enableAnimations: true, enableParallax: true, enableShadows: true, enableBlur: true, useHighResImages: true, enableBackgroundEffects: true, }; this.measureDevicePerformance(); } async measureDevicePerformance() { // è¿è¡Œä¸€ç³»åˆ—æ€§èƒ½æµ‹è¯• const scores = []; // æµ‹è¯•1: åŸºç¡€JSæ€§èƒ½ scores.push(await this.testJSPerformance()); // æµ‹è¯•2: DOMæ“ä½œæ€§èƒ½ scores.push(await this.testDOMPerformance()); // æµ‹è¯•3: æ¸²æŸ“æ€§èƒ½ scores.push(await this.testRenderingPerformance()); // è®¡ç®—å¹³å‡åˆ†æ•° this.performanceScore = scores.reduce((a, b) =\u0026gt; a + b, 0) / scores.length; // æ ¹æ®æ€§èƒ½é…ç½®åŠŸèƒ½ this.configureFeatures(); // åº”ç”¨é…ç½® this.applyConfiguration(); console.log(`è®¾å¤‡æ€§èƒ½è¯„åˆ†: ${this.performanceScore.toFixed(2)}/100`); } async testJSPerformance() { const startTime = performance.now(); // è¿è¡Œè®¡ç®—å¯†é›†å‹ä»»åŠ¡ let result = 0; for (let i = 0; i \u0026lt; 1000000; i++) { result += Math.sin(i) * Math.cos(i); } const duration = performance.now() - startTime; // åŸºå‡†æ—¶é—´ï¼šå¦‚æœåœ¨200mså†…å®Œæˆï¼Œæ»¡åˆ†ä¸º100 return Math.min(100, (200 / Math.max(duration, 1)) * 100); } async testDOMPerformance() { // åˆ›å»ºä¸´æ—¶å®¹å™¨ const container = document.createElement(\u0026#34;div\u0026#34;); container.style.position = \u0026#34;absolute\u0026#34;; container.style.left = \u0026#34;-9999px\u0026#34;; container.style.visibility = \u0026#34;hidden\u0026#34;; document.body.appendChild(container); const startTime = performance.now(); // åˆ›å»ºå¤§é‡DOMå…ƒç´  for (let i = 0; i \u0026lt; 1000; i++) { const div = document.createElement(\u0026#34;div\u0026#34;); div.textContent = `Item ${i}`; container.appendChild(div); } // å¼ºåˆ¶å¸ƒå±€åˆ·æ–° container.offsetHeight; const duration = performance.now() - startTime; // æ¸…ç† document.body.removeChild(container); // åŸºå‡†æ—¶é—´ï¼šå¦‚æœåœ¨100mså†…å®Œæˆï¼Œæ»¡åˆ†ä¸º100 return Math.min(100, (100 / Math.max(duration, 1)) * 100); } async testRenderingPerformance() { // åˆ›å»ºä¸´æ—¶ç”»å¸ƒè¿›è¡Œæ¸²æŸ“æµ‹è¯• const canvas = document.createElement(\u0026#34;canvas\u0026#34;); canvas.width = 500; canvas.height = 500; const ctx = canvas.getContext(\u0026#34;2d\u0026#34;); const startTime = performance.now(); // ç»˜åˆ¶å¤§é‡å½¢çŠ¶ for (let i = 0; i \u0026lt; 1000; i++) { ctx.beginPath(); ctx.arc( Math.random() * 500, Math.random() * 500, Math.random() * 20 + 5, 0, Math.PI * 2 ); ctx.fillStyle = `rgba(${Math.random() * 255}, ${Math.random() * 255}, ${ Math.random() * 255 }, 0.5)`; ctx.fill(); } const duration = performance.now() - startTime; // åŸºå‡†æ—¶é—´ï¼šå¦‚æœåœ¨50mså†…å®Œæˆï¼Œæ»¡åˆ†ä¸º100 return Math.min(100, (50 / Math.max(duration, 1)) * 100); } configureFeatures() { // åŸºäºæ€§èƒ½åˆ†æ•°é…ç½®åŠŸèƒ½ if (this.performanceScore \u0026lt; 20) { // æä½ç«¯è®¾å¤‡ this.featureFlags = { enableAnimations: false, enableParallax: false, enableShadows: false, enableBlur: false, useHighResImages: false, enableBackgroundEffects: false, }; } else if (this.performanceScore \u0026lt; 40) { // ä½ç«¯è®¾å¤‡ this.featureFlags = { enableAnimations: true, enableParallax: false, enableShadows: false, enableBlur: false, useHighResImages: false, enableBackgroundEffects: false, }; } else if (this.performanceScore \u0026lt; 60) { // ä¸­ç«¯è®¾å¤‡ this.featureFlags = { enableAnimations: true, enableParallax: true, enableShadows: false, enableBlur: false, useHighResImages: true, enableBackgroundEffects: false, }; } else if (this.performanceScore \u0026lt; 80) { // ä¸­é«˜ç«¯è®¾å¤‡ this.featureFlags = { enableAnimations: true, enableParallax: true, enableShadows: true, enableBlur: false, useHighResImages: true, enableBackgroundEffects: true, }; } else { // é«˜ç«¯è®¾å¤‡ - å¯ç”¨æ‰€æœ‰åŠŸèƒ½ this.featureFlags = { enableAnimations: true, enableParallax: true, enableShadows: true, enableBlur: true, useHighResImages: true, enableBackgroundEffects: true, }; } } applyConfiguration() { // æ·»åŠ åŸºäºæ€§èƒ½çš„CSSç±» document.documentElement.classList.toggle( \u0026#34;reduce-animations\u0026#34;, !this.featureFlags.enableAnimations ); document.documentElement.classList.toggle( \u0026#34;reduce-effects\u0026#34;, !this.featureFlags.enableShadows ); document.documentElement.classList.toggle( \u0026#34;high-performance-mode\u0026#34;, this.performanceScore \u0026lt; 60 ); // é…ç½®å›¾ç‰‡è´¨é‡ if (!this.featureFlags.useHighResImages) { document.querySelectorAll(\u0026#34;img[data-src-lowres]\u0026#34;).forEach((img) =\u0026gt; { img.src = img.dataset.srcLowres; }); } // é…ç½®èƒŒæ™¯æ•ˆæœ if (!this.featureFlags.enableBackgroundEffects) { document.querySelectorAll(\u0026#34;.background-effect\u0026#34;).forEach((el) =\u0026gt; { el.style.display = \u0026#34;none\u0026#34;; }); } // è¾“å‡ºé…ç½®ä¿¡æ¯ console.table(this.featureFlags); } } // ä½¿ç”¨ç¤ºä¾‹ document.addEventListener(\u0026#34;DOMContentLoaded\u0026#34;, () =\u0026gt; { const renderer = new AdaptiveRenderer(); }); ç›¸åº”çš„ CSS:\n/* åŸºäºæ€§èƒ½é…ç½®çš„è‡ªé€‚åº”CSS */ .card { border-radius: 8px; transition: transform 0.3s ease; } /* å¯¹ä½æ€§èƒ½è®¾å¤‡ç¦ç”¨åŠ¨ç”» */ .reduce-animations .card { transition: none; } /* å¯¹ä½æ€§èƒ½è®¾å¤‡ç®€åŒ–æ•ˆæœ */ .card { box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15); } .reduce-effects .card { box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1); } /* èƒŒæ™¯æ•ˆæœ */ .background-effect { background: linear-gradient(45deg, #f3f3f3, #ffffff); animation: gradientShift 10s ease infinite; } .high-performance-mode .background-effect { background: #f7f7f7; animation: none; } @keyframes gradientShift { 0% { background-position: 0% 50%; } 50% { background-position: 100% 50%; } 100% { background-position: 0% 50%; } } /* æ¨¡ç³Šæ•ˆæœåªåœ¨é«˜ç«¯è®¾å¤‡å¯ç”¨ */ .blur-effect { backdrop-filter: blur(10px); } .high-performance-mode .blur-effect { backdrop-filter: none; background-color: rgba(255, 255, 255, 0.9); } è¿™ç§æ–¹æ³•è®©æˆ‘ä»¬èƒ½æä¾›æœ€ä½³çš„ç”¨æˆ·ä½“éªŒï¼ŒåŒæ—¶ä¿æŒå„ç§è®¾å¤‡çš„æµç•…æ€§ã€‚åœ¨ä¸­ä½ç«¯å®‰å“è®¾å¤‡ä¸Šï¼Œæˆ‘ä»¬çš„ Dashboard æ€§èƒ½æå‡äº† 3 å€ï¼Œç”¨æˆ·æ»¡æ„åº¦æ˜¾è‘—æé«˜ã€‚\nå†™åœ¨æœ€å æµè§ˆå™¨æ¸²æŸ“ç®¡çº¿çš„ä¼˜åŒ–æ˜¯ä¸€é¡¹éœ€è¦ä¸æ–­å­¦ä¹ å’Œå®è·µçš„æŠ€æœ¯ã€‚æ¯ä¸€æ¬¡ Chrome æ›´æ–°ï¼Œéƒ½ä¼šå¸¦æ¥æ–°çš„æ¸²æŸ“ä¼˜åŒ–æœºä¼šã€‚æœ€å…³é”®çš„æ˜¯å»ºç«‹åŸºäºæ•°æ®çš„æ€§èƒ½æ–‡åŒ– - æµ‹é‡ã€ä¼˜åŒ–ã€éªŒè¯ï¼Œè€Œä¸æ˜¯å‡­æ„Ÿè§‰ã€‚\næˆ‘ä»¬å›¢é˜Ÿç°åœ¨å°†æ€§èƒ½æŒ‡æ ‡ä½œä¸ºåŠŸèƒ½å‘å¸ƒçš„å¿…æ£€é¡¹ï¼Œä¸åŠŸèƒ½å®Œæ•´æ€§å’Œ UI è®¾è®¡åŒç­‰é‡è¦ã€‚è¿™ç¡®ä¿äº†å³ä½¿åœ¨ä¸æ–­æ·»åŠ æ–°åŠŸèƒ½çš„æƒ…å†µä¸‹ï¼Œäº§å“æ€§èƒ½ä¹Ÿèƒ½ä¿æŒåœ¨é«˜æ°´å¹³ã€‚\næœ€åï¼Œåˆ†äº«ä¸€æ¡é‡‘å¥ï¼š\u0026ldquo;ä¼˜åŒ–ä¸æ˜¯ç›®çš„ï¼Œç”¨æˆ·ä½“éªŒæ‰æ˜¯ã€‚\u0026rdquo; æ€§èƒ½ä¼˜åŒ–çš„ç»ˆæç›®æ ‡æ˜¯è®©ç”¨æˆ·æ„Ÿåˆ°åº”ç”¨æµç•…è‡ªç„¶ï¼Œè€Œä¸æ˜¯ä¸ºäº†ä¼˜åŒ–è€Œä¼˜åŒ–ã€‚æœ‰æ—¶å€™ï¼Œç‰ºç‰²ä¸€ç‚¹æŠ€æœ¯ä¸Šçš„å®Œç¾ï¼Œæ¢å–æ›´å¥½çš„ç”¨æˆ·æ„ŸçŸ¥ï¼Œæ˜¯æ›´æ˜æ™ºçš„é€‰æ‹©ã€‚\nä¸‹æ¬¡æˆ‘è®¡åˆ’åˆ†äº«ç°ä»£å‰ç«¯æ¶æ„è®¾è®¡ä¸æ€§èƒ½çš„å…³ç³»ï¼Œæ¢è®¨å¦‚ä½•ä»æ¶æ„å±‚é¢æå‡åº”ç”¨æ€§èƒ½ã€‚æ•¬è¯·æœŸå¾…ã€‚\n","permalink":"https://www.yss520.online/zh/posts/browser-render/","summary":"\u003ch1 id=\"æ·±å…¥æµè§ˆå™¨æ¸²æŸ“ç®¡çº¿ä»åƒç´ åˆ°å±å¹•çš„æ€§èƒ½ä¼˜åŒ–ä¹‹æ—…\"\u003eæ·±å…¥æµè§ˆå™¨æ¸²æŸ“ç®¡çº¿ï¼šä»åƒç´ åˆ°å±å¹•çš„æ€§èƒ½ä¼˜åŒ–ä¹‹æ—…\u003c/h1\u003e\n\u003cp\u003eä¸Šä¸ªå­£åº¦ï¼Œæˆ‘ä»¬å›¢é˜Ÿæ¥æ‰‹äº†ä¸€ä¸ªæ€§èƒ½å ªå¿§çš„å¤§å‹ Dashboard é¡¹ç›®ï¼š60 å¤šä¸ªå›¾è¡¨ã€å¤æ‚çš„äº¤äº’ã€é¢‘ç¹çš„æ•°æ®æ›´æ–°ï¼Œåœ¨ä¸­ç«¯è®¾å¤‡ä¸Šå¡é¡¿æ˜æ˜¾ã€‚ç”¨æˆ·åé¦ˆ\u0026quot;ç‚¹å‡»æŒ‰é’®åˆ° UI å“åº”éœ€è¦ 2-3 ç§’\u0026quot;ï¼Œè¿™ç»å¯¹æ˜¯ç¾éš¾çº§ä½“éªŒã€‚\u003c/p\u003e\n\u003cp\u003eç»è¿‡ 8 å‘¨çš„æ·±åº¦ä¼˜åŒ–ï¼Œæˆ‘ä»¬å°†äº¤äº’å»¶è¿Ÿä»å¹³å‡ 2.5 ç§’é™è‡³ä¸åˆ° 100msï¼Œæµç•…åº¦æå‡äº† 25 å€ã€‚è¿™ä¸ªè¿‡ç¨‹è®©æˆ‘é‡æ–°å®¡è§†äº†æµè§ˆå™¨æ¸²æŸ“ç®¡çº¿çš„æ¯ä¸ªç¯èŠ‚ï¼Œä»Šå¤©æƒ³åˆ†äº«è¿™æ®µæ·±å…¥åƒç´ çº§ä¼˜åŒ–çš„å¿ƒå¾—ã€‚\u003c/p\u003e\n\u003ch2 id=\"æµè§ˆå™¨æ¸²æŸ“ç®¡çº¿æ¯”æƒ³è±¡ä¸­æ›´å¤æ‚çš„è¿‡ç¨‹\"\u003eæµè§ˆå™¨æ¸²æŸ“ç®¡çº¿ï¼šæ¯”æƒ³è±¡ä¸­æ›´å¤æ‚çš„è¿‡ç¨‹\u003c/h2\u003e\n\u003cp\u003eå½“æˆ‘ä»¬è°ˆè®ºæµè§ˆå™¨æ¸²æŸ“ï¼Œå¤§å¤šæ•°å¼€å‘è€…åªçŸ¥é“å…³é”®è¯ï¼šDOMã€CSSOMã€RenderTreeã€‚ä½†å®é™…è¿‡ç¨‹è¿œæ¯”è¿™ä¸‰ä¸ªæ­¥éª¤å¤æ‚å¾—å¤šã€‚é€šè¿‡ç ”ç©¶ Chromium æºç ï¼Œæˆ‘å¾—ä»¥çª¥è§æµè§ˆå™¨æ¸²æŸ“çš„å®Œæ•´è¿‡ç¨‹ã€‚\u003c/p\u003e\n\u003cp\u003eè®©æˆ‘ä»¬å…ˆçœ‹ä¸€ä¸ªç®€åŒ–ä½†æ›´å…¨é¢çš„æ¸²æŸ“æµç¨‹ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-fallback\" data-lang=\"fallback\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eJavaScript â†’ Style â†’ Layout â†’ Layer â†’ Paint â†’ Composite\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eæ¯ä¸ªé˜¶æ®µçš„æºç å®ç°éƒ½æå…¶å¤æ‚ã€‚ä»¥ Layoutï¼ˆå¸ƒå±€ï¼‰é˜¶æ®µä¸ºä¾‹ï¼ŒChrome ä¸­çš„å®ç°ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-cpp\" data-lang=\"cpp\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e// Chromiumæºç ç®€åŒ–ç‰‡æ®µ - LayoutObject::UpdateLayoutå‡½æ•°\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003evoid\u003c/span\u003e LayoutObject\u003cspan style=\"color:#f92672\"\u003e::\u003c/span\u003eUpdateLayout() {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#75715e\"\u003e// æ£€æŸ¥æ˜¯å¦éœ€è¦å®Œæ•´å¸ƒå±€\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e  \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e (NeedsLayout()) {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#75715e\"\u003e// LayoutObjectæœ‰ä¸åŒç±»å‹ï¼Œæ¯ç§ç±»å‹çš„å¸ƒå±€ç®—æ³•ä¸åŒ\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e    \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e (IsLayoutBlock()) {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      ToLayoutBlock(\u003cspan style=\"color:#66d9ef\"\u003ethis\u003c/span\u003e)\u003cspan style=\"color:#f92672\"\u003e-\u0026gt;\u003c/span\u003eLayoutBlock();\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    } \u003cspan style=\"color:#66d9ef\"\u003eelse\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eif\u003c/span\u003e (IsText()) {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      ToLayoutText(\u003cspan style=\"color:#66d9ef\"\u003ethis\u003c/span\u003e)\u003cspan style=\"color:#f92672\"\u003e-\u0026gt;\u003c/span\u003eLayoutText();\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    } \u003cspan style=\"color:#66d9ef\"\u003eelse\u003c/span\u003e {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#75715e\"\u003e// å…¶ä»–å¸ƒå±€å¯¹è±¡ç±»å‹...\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e    }\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#75715e\"\u003e// é€’å½’å¸ƒå±€å­å…ƒç´ \n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e    \u003cspan style=\"color:#66d9ef\"\u003efor\u003c/span\u003e (LayoutObject\u003cspan style=\"color:#f92672\"\u003e*\u003c/span\u003e child \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e FirstChild(); child; child \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e child\u003cspan style=\"color:#f92672\"\u003e-\u0026gt;\u003c/span\u003eNextSibling()) {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e (child\u003cspan style=\"color:#f92672\"\u003e-\u0026gt;\u003c/span\u003eNeedsLayout()) {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        child\u003cspan style=\"color:#f92672\"\u003e-\u0026gt;\u003c/span\u003eUpdateLayout();\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      }\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    }\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#75715e\"\u003e// æ¸…é™¤å¸ƒå±€æ ‡è®°\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e    ClearNeedsLayout();\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  }\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e// LayoutBlockå¯¹è±¡çš„å¸ƒå±€å®ç°\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003evoid\u003c/span\u003e LayoutBlock\u003cspan style=\"color:#f92672\"\u003e::\u003c/span\u003eLayoutBlock() {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#75715e\"\u003e// ç¡®å®šå®½åº¦\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e  ComputeBlockWidth();\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#75715e\"\u003e// å¸ƒå±€å­å…ƒç´ \n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e  LayoutChildren();\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#75715e\"\u003e// ç¡®å®šé«˜åº¦\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e  ComputeBlockHeight();\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#75715e\"\u003e// å¤„ç†æº¢å‡º\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e  ComputeOverflow();\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eè¿™æ®µä»£ç æ­ç¤ºäº†å…³é”®ä¿¡æ¯ï¼šæµè§ˆå™¨å¸ƒå±€æ˜¯é€’å½’è¿‡ç¨‹ï¼Œä¸€ä¸ªç®€å•çš„ DOM ç»“æ„å˜åŒ–å¯èƒ½è§¦å‘æ•´ä¸ªæ ‘çš„é‡æ–°å¸ƒå±€ã€‚äº†è§£è¿™ä¸€ç‚¹å¯¹ä¼˜åŒ–è‡³å…³é‡è¦ã€‚\u003c/p\u003e","title":"æµè§ˆå™¨æ¸²æŸ“æœºåˆ¶æ·±åº¦å‰–æ"},{"content":"React æœåŠ¡å™¨ç»„ä»¶ï¼šé‡æ–°æ€è€ƒå‰ç«¯ä¸åç«¯çš„è¾¹ç•Œ ä¸¤å‘¨å‰åˆšä¸Šçº¿äº†æˆ‘ä»¬å›¢é˜ŸèŠ±äº† 3 ä¸ªæœˆé‡æ„çš„ç”µå•†å¹³å°ï¼Œè¿™æ¬¡æœ€å¤§çš„æŠ€æœ¯æŒ‘æˆ˜æ˜¯å…¨é¢é‡‡ç”¨äº† React æœåŠ¡å™¨ç»„ä»¶ï¼ˆServer Componentsï¼‰ã€‚è¿™ä¸ªå†³å®šç¡®å®å¸¦æ¥äº†ä¸å°‘æŒ‘æˆ˜ï¼Œä½†æ•ˆæœä»¤äººæƒŠå–œï¼šé¦–å±åŠ è½½æ—¶é—´å‡å°‘äº† 62%ï¼ŒJS åŒ…ä½“ç§¯å‡å°‘äº† 41%ï¼Œè€Œä¸”å¼€å‘ä½“éªŒå‡ºä¹æ„æ–™åœ°å¥½ã€‚ä»Šå¤©æƒ³åˆ†äº«ä¸€ä¸‹æˆ‘ä»¬å¯¹æœåŠ¡å™¨ç»„ä»¶çš„æ¢ç´¢å†ç¨‹å’Œå®æˆ˜ç»éªŒã€‚\næœåŠ¡å™¨ç»„ä»¶ï¼šä¸åªæ˜¯å¦ä¸€ç§ SSR ç¬¬ä¸€æ¬¡å¬è¯´æœåŠ¡å™¨ç»„ä»¶æ—¶ï¼Œæˆ‘çš„ååº”æ˜¯\u0026quot;è¿™ä¸å°±æ˜¯ SSR æ¢äº†ä¸ªåå­—å—ï¼Ÿ\u0026ldquo;é€šè¿‡æ·±å…¥ç ”ç©¶æºç å’Œå®è·µï¼Œæˆ‘å‘ç°è¿™æ˜¯ä¸ªæ ¹æœ¬æ€§çš„è¯¯è§£ã€‚\næœåŠ¡å™¨ç»„ä»¶ï¼ˆRSCï¼‰ä¸ä¼ ç»ŸæœåŠ¡ç«¯æ¸²æŸ“ï¼ˆSSRï¼‰çš„åŒºåˆ«ï¼Œæ¯”æƒ³è±¡ä¸­å¤§å¾—å¤šï¼š\n// ä¼ ç»ŸSSRï¼šæ•´ä¸ªç»„ä»¶æ ‘åœ¨æœåŠ¡å™¨æ¸²æŸ“åï¼Œå‘é€å®Œæ•´HTMLåˆ°å®¢æˆ·ç«¯ï¼Œç„¶åhydrate // å®¢æˆ·ç«¯éœ€è¦ä¸‹è½½æ•´ä¸ªç»„ä»¶çš„JSä»£ç æ‰èƒ½è¿›è¡Œäº¤äº’ // æœåŠ¡å™¨ç»„ä»¶ï¼šåªåœ¨æœåŠ¡å™¨ä¸Šè¿è¡Œï¼Œä¸å‘é€ç»„ä»¶ä»£ç åˆ°å®¢æˆ·ç«¯ // ğŸ‘‡ è¿™ä¸ªç»„ä»¶çš„ä»£ç æ°¸è¿œä¸ä¼šå‘é€åˆ°å®¢æˆ·ç«¯ \u0026#34;use server\u0026#34;; async function ProductDetails({ id }) { // ç›´æ¥è®¿é—®æœåŠ¡å™¨èµ„æº(æ•°æ®åº“ã€æ–‡ä»¶ç³»ç»Ÿç­‰) const product = await db.products.findById(id); const relatedProducts = await db.products.findRelated(id); return ( \u0026lt;div\u0026gt; \u0026lt;h1\u0026gt;{product.name}\u0026lt;/h1\u0026gt; \u0026lt;p\u0026gt;{product.description}\u0026lt;/p\u0026gt; \u0026lt;price\u0026gt;{formatCurrency(product.price)}\u0026lt;/price\u0026gt; {/* å¯ä»¥åœ¨æœåŠ¡å™¨ä¸Šæ¸²æŸ“å®¢æˆ·ç«¯ç»„ä»¶ */} \u0026lt;AddToCartButton productId={id} /\u0026gt; {/* å¯ä»¥å¼•ç”¨å…¶ä»–æœåŠ¡å™¨ç»„ä»¶ */} \u0026lt;RelatedProducts products={relatedProducts} /\u0026gt; \u0026lt;/div\u0026gt; ); } ç¿»å¼€ React æºç ï¼Œå¯ä»¥çœ‹åˆ°æœåŠ¡å™¨ç»„ä»¶çš„æœ¬è´¨æ˜¯ä¸€ç§æ–°çš„ç»„ä»¶æ¨¡å‹ï¼Œå®ƒåˆ›å»ºäº†ä¸€ä¸ªè·¨æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯çš„æ¸²æŸ“è¾¹ç•Œï¼š\n// Reactå†…éƒ¨å¯¹æœåŠ¡å™¨ç»„ä»¶çš„å¤„ç†ï¼ˆç®€åŒ–ç‰ˆï¼‰ function processServerComponent(element, request) { const Component = element.type; const props = element.props; // è°ƒç”¨ç»„ä»¶å‡½æ•°è·å–ç»“æœ const result = Component(props); // å¦‚æœç»“æœæ˜¯Promiseï¼ˆå¼‚æ­¥ç»„ä»¶ï¼‰ï¼Œåˆ™ç­‰å¾…å®ƒå®Œæˆ if (isPromise(result)) { return result.then((resolved) =\u0026gt; { return serializeResult(resolved, request); }); } // åºåˆ—åŒ–ç»“æœï¼ŒåŒ…æ‹¬å°†å®¢æˆ·ç«¯ç»„ä»¶æ›¿æ¢ä¸ºå¼•ç”¨ return serializeResult(result, request); } function serializeResult(node, request) { // å¦‚æœæ˜¯å®¢æˆ·ç«¯ç»„ä»¶ï¼Œæ›¿æ¢ä¸ºå¯¹è¯¥ç»„ä»¶çš„å¼•ç”¨ if (isClientComponent(node.type)) { return { $$typeof: REACT_ELEMENT_TYPE, type: CLIENT_REFERENCE, props: serializeProps(node.props, request), }; } // ç»§ç»­å¤„ç†å­èŠ‚ç‚¹ // ... } è¿™æ®µä»£ç å±•ç¤ºäº† React å¦‚ä½•å¤„ç†æœåŠ¡å™¨ç»„ä»¶ï¼šå®ƒåœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œç»„ä»¶ï¼Œå¹¶å°†ç»“æœï¼ˆè€Œéç»„ä»¶ä»£ç ï¼‰åºåˆ—åŒ–åå‘é€ç»™å®¢æˆ·ç«¯ã€‚è¿™ä¸ä¼ ç»Ÿ SSR çš„\u0026quot;å…ˆåœ¨æœåŠ¡å™¨æ¸²æŸ“ HTMLï¼Œå†åœ¨å®¢æˆ·ç«¯é‡æ–°æ‰§è¡Œç»„ä»¶ä»£ç \u0026quot;å®Œå…¨ä¸åŒã€‚\næœåŠ¡å™¨ç»„ä»¶çš„æ ¸å¿ƒä»·å€¼ æ·±å…¥ä½¿ç”¨åï¼Œæˆ‘æ€»ç»“å‡ºæœåŠ¡å™¨ç»„ä»¶çš„ä¸‰å¤§æ ¸å¿ƒä»·å€¼ï¼š\n1. é›¶å®¢æˆ·ç«¯ JS å¼€é”€ æœåŠ¡å™¨ç»„ä»¶ä¸ä¼šè¢«å‘é€åˆ°å®¢æˆ·ç«¯ï¼Œè¿™æ„å‘³ç€å®ƒä»¬ä¸ä¼šå¢åŠ  JS åŒ…ä½“ç§¯ã€‚åœ¨æˆ‘ä»¬çš„ç”µå•†å¹³å°ä¸­ï¼Œä»…è¿™ä¸€ç‚¹å°±å¸®æˆ‘ä»¬å‰Šå‡äº†è¿‘ 40%çš„ JS ä½“ç§¯ï¼š\n// ğŸ“¦ ä¼ ç»Ÿå®¢æˆ·ç«¯ç»„ä»¶æ–¹å¼ import { formatCurrency } from \u0026#34;big-date-library\u0026#34;; // ~300KB import ProductGallery from \u0026#34;./ProductGallery\u0026#34;; // ~120KB import ProductSpecs from \u0026#34;./ProductSpecs\u0026#34;; // ~80KB function ProductPage({ productId }) { const [product, setProduct] = useState(null); useEffect(() =\u0026gt; { fetchProduct(productId).then(setProduct); }, [productId]); if (!product) return \u0026lt;Loading /\u0026gt;; return ( \u0026lt;div\u0026gt; \u0026lt;ProductGallery images={product.images} /\u0026gt; \u0026lt;h1\u0026gt;{product.name}\u0026lt;/h1\u0026gt; \u0026lt;p\u0026gt;{formatCurrency(product.price)}\u0026lt;/p\u0026gt; \u0026lt;ProductSpecs specs={product.specifications} /\u0026gt; \u0026lt;/div\u0026gt; ); } // ğŸš€ ä½¿ç”¨æœåŠ¡å™¨ç»„ä»¶ // è¿™ä¸ªæ–‡ä»¶åœ¨æœåŠ¡å™¨ä¸Šè¿è¡Œï¼Œä¸ä¼šå¢åŠ å®¢æˆ·ç«¯JSä½“ç§¯ import { formatCurrency } from \u0026#34;big-date-library\u0026#34;; // 0KBå®¢æˆ·ç«¯å¼€é”€ import ProductGallery from \u0026#34;./ProductGallery.client\u0026#34;; // å®¢æˆ·ç«¯ç»„ä»¶ import ProductSpecs from \u0026#34;./ProductSpecs\u0026#34;; // æœåŠ¡å™¨ç»„ä»¶ï¼Œ0KBå®¢æˆ·ç«¯å¼€é”€ async function ProductPage({ productId }) { // ç›´æ¥åœ¨æœåŠ¡å™¨è·å–æ•°æ® const product = await db.products.findById(productId); return ( \u0026lt;div\u0026gt; \u0026lt;ProductGallery images={product.images} /\u0026gt; \u0026lt;h1\u0026gt;{product.name}\u0026lt;/h1\u0026gt; \u0026lt;p\u0026gt;{formatCurrency(product.price)}\u0026lt;/p\u0026gt; \u0026lt;ProductSpecs specs={product.specifications} /\u0026gt; \u0026lt;/div\u0026gt; ); } 2. ç›´æ¥è®¿é—®æœåŠ¡å™¨èµ„æº æœåŠ¡å™¨ç»„ä»¶å¯ä»¥ç›´æ¥è®¿é—®æ•°æ®åº“ã€æ–‡ä»¶ç³»ç»Ÿç­‰èµ„æºï¼Œæ— éœ€ API ä¸­é—´å±‚ï¼š\n// ä¼ ç»Ÿæ–¹å¼ï¼šéœ€è¦åˆ›å»ºAPIç«¯ç‚¹ï¼Œç„¶ååœ¨å‰ç«¯è°ƒç”¨ // APIç«¯ç‚¹ (server.js) app.get(\u0026#34;/api/products/:id/recommended\u0026#34;, async (req, res) =\u0026gt; { const { id } = req.params; const recommendations = await db.recommendations.findForProduct(id); res.json(recommendations); }); // Reactç»„ä»¶ (client) function RecommendedProducts({ productId }) { const [products, setProducts] = useState([]); const [loading, setLoading] = useState(true); useEffect(() =\u0026gt; { fetch(`/api/products/${productId}/recommended`) .then((r) =\u0026gt; r.json()) .then((data) =\u0026gt; { setProducts(data); setLoading(false); }); }, [productId]); if (loading) return \u0026lt;Spinner /\u0026gt;; return ( \u0026lt;div className=\u0026#34;recommendations\u0026#34;\u0026gt; {products.map((product) =\u0026gt; ( \u0026lt;ProductCard key={product.id} product={product} /\u0026gt; ))} \u0026lt;/div\u0026gt; ); } // æœåŠ¡å™¨ç»„ä»¶æ–¹å¼ï¼šç›´æ¥è®¿é—®æ•°æ® async function RecommendedProducts({ productId }) { // ç›´æ¥æŸ¥è¯¢æ•°æ®åº“ const products = await db.recommendations.findForProduct(productId); return ( \u0026lt;div className=\u0026#34;recommendations\u0026#34;\u0026gt; {products.map((product) =\u0026gt; ( \u0026lt;ProductCard key={product.id} product={product} /\u0026gt; ))} \u0026lt;/div\u0026gt; ); } 3. å¢é‡é‡‡ç”¨ä¸æ··åˆæ¸²æŸ“ æœ€è®©æˆ‘æƒŠå–œçš„æ˜¯ï¼ŒæœåŠ¡å™¨ç»„ä»¶è®¾è®¡äº†æ¸…æ™°çš„æœåŠ¡å™¨/å®¢æˆ·ç«¯è¾¹ç•Œï¼Œå…è®¸å¢é‡é‡‡ç”¨å’Œæ··åˆæ¸²æŸ“ï¼š\n// æœåŠ¡å™¨ç»„ä»¶ import { Suspense } from \u0026#34;react\u0026#34;; import ProductDetails from \u0026#34;./ProductDetails\u0026#34;; // æœåŠ¡å™¨ç»„ä»¶ import Reviews from \u0026#34;./Reviews\u0026#34;; // æœåŠ¡å™¨ç»„ä»¶ import AddToCart from \u0026#34;./AddToCart.client\u0026#34;; // å®¢æˆ·ç«¯ç»„ä»¶ import RecommendationSlider from \u0026#34;./RecommendationSlider.client\u0026#34;; // å®¢æˆ·ç«¯ç»„ä»¶ export default async function ProductPage({ id }) { // åœ¨æœåŠ¡å™¨è·å–äº§å“æ•°æ® const product = await getProduct(id); return ( \u0026lt;div className=\u0026#34;product-page\u0026#34;\u0026gt; {/* é™æ€å†…å®¹ - æœåŠ¡å™¨æ¸²æŸ“ */} \u0026lt;ProductDetails product={product} /\u0026gt; {/* äº¤äº’éƒ¨åˆ† - å®¢æˆ·ç«¯ç»„ä»¶ */} \u0026lt;AddToCart product={product} /\u0026gt; {/* æœåŠ¡å™¨å†…å®¹+å®¢æˆ·ç«¯è¡Œä¸ºçš„æ··åˆ */} \u0026lt;Suspense fallback={\u0026lt;LoadingReviews /\u0026gt;}\u0026gt; \u0026lt;Reviews productId={id} /\u0026gt; \u0026lt;/Suspense\u0026gt; {/* å®¢æˆ·ç«¯äº¤äº’ç»„ä»¶ */} \u0026lt;RecommendationSlider productId={id} /\u0026gt; \u0026lt;/div\u0026gt; ); } åœ¨æˆ‘ä»¬çš„é¡¹ç›®ä¸­ï¼ŒUI å¤§è‡´æŒ‰è¿™æ ·çš„æ¯”ä¾‹åˆ’åˆ†ï¼š\n70%æ˜¯çº¯æœåŠ¡å™¨ç»„ä»¶ï¼ˆäº§å“ä¿¡æ¯ã€åˆ†ç±»åˆ—è¡¨ã€è¯¦æƒ…ç­‰ï¼‰ 20%æ˜¯æ··åˆç»„ä»¶ï¼ˆè¯„è®ºç³»ç»Ÿã€ç­›é€‰é¢æ¿ç­‰ï¼‰ 10%æ˜¯çº¯å®¢æˆ·ç«¯ç»„ä»¶ï¼ˆè´­ç‰©è½¦ã€äº¤äº’å¼ç»„ä»¶ç­‰ï¼‰ è¿™ç§åˆ’åˆ†å¤§å¹…å‡å°‘äº† JS ä½“ç§¯ï¼ŒåŒæ—¶ä¿ç•™äº†å¤æ‚äº¤äº’æ‰€éœ€çš„å®¢æˆ·ç«¯èƒ½åŠ›ã€‚\nå®æˆ˜æ¡ˆä¾‹ï¼šç”µå•†å¹³å°çš„é‡æ„ åœ¨æˆ‘ä»¬çš„ç”µå•†å¹³å°é‡æ„ä¸­ï¼Œé‡‡ç”¨æœåŠ¡å™¨ç»„ä»¶è§£å†³äº†å‡ ä¸ªå…³é”®ç—›ç‚¹ï¼š\n1. è§£å†³å¤§å‹äº§å“ç›®å½•çš„æ€§èƒ½é—®é¢˜ åŸæœ¬çš„äº§å“ç›®å½•é¡µé¢æ˜¯ä¸ªæ€§èƒ½å™©æ¢¦ï¼šå¤§é‡ JS ä»£ç ã€å¤æ‚çŠ¶æ€ç®¡ç†ã€é¢‘ç¹ API è°ƒç”¨ã€‚ä½¿ç”¨æœåŠ¡å™¨ç»„ä»¶åï¼š\n// äº§å“ç›®å½• - æœåŠ¡å™¨ç»„ä»¶ export default async function ProductCatalog({ categoryId, filters, sort, page }) { // åœ¨æœåŠ¡å™¨ç›´æ¥æŸ¥è¯¢ï¼Œæ— éœ€APIè°ƒç”¨ const { products, totalPages } = await getProducts({ categoryId, filters, sort, page, pageSize: 24 }); // ç»Ÿè®¡æ•°æ®ç›´æ¥åœ¨æœåŠ¡å™¨è®¡ç®— const stats = computeProductStats(products); return ( \u0026lt;div className=\u0026#34;catalog\u0026#34;\u0026gt; \u0026lt;div className=\u0026#34;catalog-header\u0026#34;\u0026gt; \u0026lt;h1\u0026gt;{getCategoryName(categoryId)}\u0026lt;/h1\u0026gt; \u0026lt;p\u0026gt;{products.length} products found\u0026lt;/p\u0026gt; \u0026lt;ProductStats stats={stats} /\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;div className=\u0026#34;catalog-layout\u0026#34;\u0026gt; {/* ç­›é€‰å™¨UI - å®¢æˆ·ç«¯äº¤äº’ç»„ä»¶ */} \u0026lt;FilterPanel currentFilters={filters} availableFilters={getAvailableFilters(categoryId)} /\u0026gt; \u0026lt;div className=\u0026#34;product-grid\u0026#34;\u0026gt; {products.map(product =\u0026gt; ( \u0026lt;ProductCard key={product.id} product={product} /\u0026gt; ))} \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; {/* åˆ†é¡µæ§ä»¶ - å®¢æˆ·ç«¯ç»„ä»¶ */} \u0026lt;Pagination currentPage={page} totalPages={totalPages} /\u0026gt; \u0026lt;/div\u0026gt; ); } // ProductCard - å¯ä»¥æ˜¯æœåŠ¡å™¨ç»„ä»¶ï¼Œå› ä¸ºä¸»è¦æ˜¯å±•ç¤º function ProductCard({ product }) { return ( \u0026lt;div className=\u0026#34;product-card\u0026#34;\u0026gt; \u0026lt;Image src={product.imageUrl} alt={product.name} width={300} height={300} loading=\u0026#34;lazy\u0026#34; /\u0026gt; \u0026lt;h3\u0026gt;{product.name}\u0026lt;/h3\u0026gt; \u0026lt;p className=\u0026#34;price\u0026#34;\u0026gt;{formatCurrency(product.price)}\u0026lt;/p\u0026gt; {/* æ·»åŠ åˆ°è´­ç‰©è½¦æŒ‰é’® - å®¢æˆ·ç«¯ç»„ä»¶ */} \u0026lt;AddToCartButton productId={product.id} /\u0026gt; \u0026lt;/div\u0026gt; ); } // FilterPanel - å®¢æˆ·ç«¯ç»„ä»¶ï¼Œéœ€è¦äº¤äº’ \u0026#39;use client\u0026#39;; import { useRouter, usePathname, useSearchParams } from \u0026#39;next/navigation\u0026#39;; export default function FilterPanel({ currentFilters, availableFilters }) { const router = useRouter(); const pathname = usePathname(); const searchParams = useSearchParams(); function updateFilters(newFilters) { const params = new URLSearchParams(searchParams); // æ›´æ–°URLå‚æ•° Object.entries(newFilters).forEach(([key, value]) =\u0026gt; { if (value) { params.set(key, value); } else { params.delete(key); } }); router.replace(`${pathname}?${params.toString()}`); } return ( \u0026lt;div className=\u0026#34;filters\u0026#34;\u0026gt; {/* ç­›é€‰UIå®ç° */} \u0026lt;/div\u0026gt; ); } è¿™ç§æ¶æ„è§£å†³äº†å‡ ä¸ªé—®é¢˜ï¼š\näº§å“æ•°æ®ç›´æ¥åœ¨æœåŠ¡å™¨è·å–å’Œå¤„ç†ï¼Œæ— éœ€å®¢æˆ·ç«¯ API è°ƒç”¨ å¤§éƒ¨åˆ† UI æ˜¯æœåŠ¡å™¨æ¸²æŸ“çš„ï¼Œå‡å°‘äº†å®¢æˆ·ç«¯ JS ç­›é€‰å’Œåˆ†é¡µæ˜¯å®¢æˆ·ç«¯äº¤äº’ï¼Œä½†çŠ¶æ€é€šè¿‡ URL å‚æ•°ç®¡ç†ï¼Œä½¿é¡µé¢å¯åˆ†äº«å’Œ SEO å‹å¥½ æ·»åŠ åˆ°è´­ç‰©è½¦ç­‰äº¤äº’åŠŸèƒ½ä¿ç•™åœ¨å®¢æˆ·ç«¯ 2. å¤§å‹è¡¨å•çš„ä¼˜åŒ– å¤æ‚è¡¨å•æ˜¯æœåŠ¡å™¨ç»„ä»¶çš„æŒ‘æˆ˜ï¼Œå› ä¸ºè¡¨å•é€šå¸¸éœ€è¦å®¢æˆ·ç«¯äº¤äº’ã€‚æˆ‘ä»¬é‡‡ç”¨äº†æ··åˆæ–¹å¼ï¼š\n// å•†å“åˆ›å»ºé¡µé¢ - æ··åˆæœåŠ¡å™¨å’Œå®¢æˆ·ç«¯ç»„ä»¶ import ProductFormClient from \u0026#39;./ProductForm.client\u0026#39;; export default async function CreateProductPage() { // åœ¨æœåŠ¡å™¨è·å–æ‰€éœ€æ•°æ® const categories = await getCategories(); const attributes = await getProductAttributes(); const taxRates = await getTaxRates(); // æ‰€æœ‰è¡¨å•é€»è¾‘åœ¨å®¢æˆ·ç«¯ return ( \u0026lt;div className=\u0026#34;create-product\u0026#34;\u0026gt; \u0026lt;h1\u0026gt;Create New Product\u0026lt;/h1\u0026gt; \u0026lt;ProductFormClient categories={categories} attributes={attributes} taxRates={taxRates} // ä¼ é€’åˆå§‹æ•°æ®ï¼Œä½†è¡¨å•é€»è¾‘åœ¨å®¢æˆ·ç«¯ /\u0026gt; \u0026lt;/div\u0026gt; ); } // ProductForm.client.js - å®¢æˆ·ç«¯ç»„ä»¶ \u0026#39;use client\u0026#39;; import { useState } from \u0026#39;react\u0026#39;; import { createProduct } from \u0026#39;@/actions/products\u0026#39;; export default function ProductForm({ categories, attributes, taxRates }) { const [formState, setFormState] = useState({ name: \u0026#39;\u0026#39;, description: \u0026#39;\u0026#39;, price: \u0026#39;\u0026#39;, // ... å…¶ä»–å­—æ®µ }); async function handleSubmit(e) { e.preventDefault(); // ä½¿ç”¨æœåŠ¡å™¨æ“ä½œæäº¤è¡¨å• const result = await createProduct(formState); // ...å¤„ç†ç»“æœ } return ( \u0026lt;form onSubmit={handleSubmit}\u0026gt; {/* è¡¨å•å®ç° */} \u0026lt;/form\u0026gt; ); } // åœ¨æœåŠ¡å™¨ä¸Šå¤„ç†è¡¨å•æäº¤çš„æ“ä½œ // actions/products.js \u0026#39;use server\u0026#39;; export async function createProduct(data) { // éªŒè¯ const validationResult = validateProduct(data); if (!validationResult.success) { return { error: validationResult.errors }; } // å¤„ç†å›¾ç‰‡ä¸Šä¼  let imageUrls = []; if (data.images) { imageUrls = await uploadProductImages(data.images); } // ä¿å­˜åˆ°æ•°æ®åº“ const product = await db.products.create({ ...data, imageUrls, createdAt: new Date(), }); // å¯èƒ½çš„åç»­å¤„ç† await generateProductSitemap(); await invalidateProductCache(); return { success: true, productId: product.id }; } è¿™ç§æ¨¡å¼ä¸­ï¼š\næœåŠ¡å™¨ç»„ä»¶è·å–æ‰€æœ‰å¿…è¦æ•°æ® è¡¨å• UI å’ŒçŠ¶æ€ç®¡ç†åœ¨å®¢æˆ·ç«¯ è¡¨å•æäº¤ä½¿ç”¨æœåŠ¡å™¨æ“ä½œï¼ˆServer Actionsï¼‰ å¤æ‚çš„ä¸šåŠ¡é€»è¾‘åœ¨æœåŠ¡å™¨æ‰§è¡Œ 3. ä¼˜åŒ–äº¤äº’å¼ä»ªè¡¨ç›˜ ä»ªè¡¨ç›˜é¡µé¢é€šå¸¸æ•°æ®å¯†é›†ä¸”éœ€è¦äº¤äº’ï¼Œæˆ‘ä»¬é‡‡ç”¨äº†é€æ­¥åŠ è½½çš„æ–¹å¼ï¼š\n// ä»ªè¡¨ç›˜ - æœåŠ¡å™¨ç»„ä»¶ import { Suspense } from \u0026#39;react\u0026#39;; import DashboardClient from \u0026#39;./Dashboard.client\u0026#39;; import SalesChart from \u0026#39;./SalesChart\u0026#39;; import TopProducts from \u0026#39;./TopProducts\u0026#39;; import RecentOrders from \u0026#39;./RecentOrders\u0026#39;; export default async function Dashboard() { // è·å–åŸºæœ¬æ•°æ® const summaryData = await getDashboardSummary(); return ( \u0026lt;div className=\u0026#34;dashboard\u0026#34;\u0026gt; \u0026lt;h1\u0026gt;Sales Dashboard\u0026lt;/h1\u0026gt; {/* å®¢æˆ·ç«¯æ§åˆ¶ç»„ä»¶ */} \u0026lt;DashboardClient initialData={summaryData} /\u0026gt; \u0026lt;div className=\u0026#34;dashboard-grid\u0026#34;\u0026gt; {/* å›¾è¡¨æ˜¯æœåŠ¡å™¨æ¸²æŸ“ + å®¢æˆ·ç«¯äº¤äº’çš„æ··åˆ */} \u0026lt;Suspense fallback={\u0026lt;ChartSkeleton /\u0026gt;}\u0026gt; \u0026lt;SalesChart /\u0026gt; \u0026lt;/Suspense\u0026gt; {/* äº§å“åˆ—è¡¨ - æœåŠ¡å™¨ç»„ä»¶ */} \u0026lt;Suspense fallback={\u0026lt;ProductsSkeleton /\u0026gt;}\u0026gt; \u0026lt;TopProducts /\u0026gt; \u0026lt;/Suspense\u0026gt; {/* æœ€è¿‘è®¢å• - æœåŠ¡å™¨ç»„ä»¶ï¼Œä½†æœ‰å®¢æˆ·ç«¯äº¤äº’ */} \u0026lt;Suspense fallback={\u0026lt;OrdersSkeleton /\u0026gt;}\u0026gt; \u0026lt;RecentOrders /\u0026gt; \u0026lt;/Suspense\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; ); } // SalesChart.js - æ··åˆç»„ä»¶ import { SalesChartClient } from \u0026#39;./SalesChart.client\u0026#39;; export default async function SalesChart() { // åœ¨æœåŠ¡å™¨è·å–å›¾è¡¨æ•°æ® const chartData = await getChartData(); // æŠŠæ•°æ®ä¼ ç»™å®¢æˆ·ç«¯ç»„ä»¶è¿›è¡Œäº¤äº’æ¸²æŸ“ return \u0026lt;SalesChartClient initialData={chartData} /\u0026gt;; } // SalesChart.client.js \u0026#39;use client\u0026#39;; import { useState } from \u0026#39;react\u0026#39;; import { LineChart } from \u0026#39;@/components/charts\u0026#39;; import { fetchSalesData } from \u0026#39;@/api/sales\u0026#39;; export function SalesChartClient({ initialData }) { const [data, setData] = useState(initialData); const [timeRange, setTimeRange] = useState(\u0026#39;month\u0026#39;); async function updateTimeRange(range) { setTimeRange(range); // å®¢æˆ·ç«¯è·å–æ–°æ•°æ® const newData = await fetchSalesData(range); setData(newData); } return ( \u0026lt;div className=\u0026#34;sales-chart\u0026#34;\u0026gt; \u0026lt;div className=\u0026#34;chart-controls\u0026#34;\u0026gt; \u0026lt;button className={timeRange === \u0026#39;week\u0026#39; ? \u0026#39;active\u0026#39; : \u0026#39;\u0026#39;} onClick={() =\u0026gt; updateTimeRange(\u0026#39;week\u0026#39;)} \u0026gt; Week \u0026lt;/button\u0026gt; \u0026lt;button className={timeRange === \u0026#39;month\u0026#39; ? \u0026#39;active\u0026#39; : \u0026#39;\u0026#39;} onClick={() =\u0026gt; updateTimeRange(\u0026#39;month\u0026#39;)} \u0026gt; Month \u0026lt;/button\u0026gt; \u0026lt;button className={timeRange === \u0026#39;year\u0026#39; ? \u0026#39;active\u0026#39; : \u0026#39;\u0026#39;} onClick={() =\u0026gt; updateTimeRange(\u0026#39;year\u0026#39;)} \u0026gt; Year \u0026lt;/button\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;LineChart data={data} /\u0026gt; \u0026lt;/div\u0026gt; ); } è¿™ç§æ–¹æ¡ˆè®©æˆ‘ä»¬è·å¾—äº†å‡ ä¸ªå…³é”®å¥½å¤„ï¼š\nåˆå§‹æ•°æ®åœ¨æœåŠ¡å™¨è·å–ï¼Œå®ç°å¿«é€Ÿé¦–å±åŠ è½½ äº¤äº’éƒ¨åˆ†ä¿ç•™åœ¨å®¢æˆ·ç«¯ ä½¿ç”¨ Suspense å®ç°æµå¼æ¸²æŸ“ï¼Œè®©é¡µé¢é€æ­¥åŠ è½½ ç”¨æˆ·æ„ŸçŸ¥æ€§èƒ½å¤§å¹…æå‡ æœåŠ¡å™¨ç»„ä»¶çš„å…³é”®å®ç°ç»†èŠ‚ æ·±å…¥æºç åå‘ç°ï¼ŒæœåŠ¡å™¨ç»„ä»¶çš„å®ç°ç›¸å½“å¤æ‚ï¼Œä½†æœ‰å‡ ä¸ªå…³é”®ç‚¹å€¼å¾—ç†è§£ï¼š\n1. RSC æœ‰ç‹¬ç‰¹çš„åºåˆ—åŒ–åè®® æœåŠ¡å™¨ç»„ä»¶è¾“å‡ºçš„ä¸æ˜¯ HTMLï¼Œè€Œæ˜¯ä¸€ç§ç‰¹æ®Šçš„æ ¼å¼ï¼Œå¯ä»¥åœ¨ React æºç ä¸­çœ‹åˆ°ï¼š\n// ç®€åŒ–ç‰ˆåºåˆ—åŒ– function encodeRow(response, id, tag, chunk) { let result = id + \u0026#34;:\u0026#34; + tag; if (chunk !== null) { result += chunk; } return result + \u0026#34;\\n\u0026#34;; } // åºåˆ—åŒ–Reactå…ƒç´  function serializeElement(response, id, element) { if (element.type === Symbol.for(\u0026#34;react.element\u0026#34;)) { // åºåˆ—åŒ–Reactå…ƒç´  const children = []; React.Children.forEach(element.props.children, (child) =\u0026gt; { const childId = generateRandomId(); children.push(childId); serializeNode(response, childId, child); }); return encodeRow( response, id, \u0026#34;J\u0026#34;, JSON.stringify({ type: element.type.displayName || element.type.name, props: { ...element.props, children }, }) ); } // å¤„ç†å…¶ä»–ç±»å‹... } è¿™ä½¿å¾—æœåŠ¡å™¨å¯ä»¥æµå¼ä¼ è¾“ UI éƒ¨åˆ†ï¼Œè€Œä¸éœ€è¦ç­‰å¾…æ•´ä¸ªé¡µé¢å‡†å¤‡å¥½ã€‚\n2. åŒå‘æ•°æ®æµçš„å®ç° æœåŠ¡å™¨æ“ä½œï¼ˆServer Actionsï¼‰æ˜¯æœåŠ¡å™¨ç»„ä»¶çš„é‡è¦é…å¥—åŠŸèƒ½ï¼Œå®ƒå®ç°äº†ä»å®¢æˆ·ç«¯åˆ°æœåŠ¡å™¨çš„æ•°æ®æµï¼š\n// æœåŠ¡å™¨æ“ä½œçš„ç®€åŒ–å®ç° \u0026#34;use server\u0026#34;; // è¿™ä¸ªå‡½æ•°å¯ä»¥åœ¨å®¢æˆ·ç«¯ç»„ä»¶ä¸­è°ƒç”¨ export async function updateUserProfile(formData) { // éªŒè¯è¯·æ±‚ const session = await getServerSession(); if (!session) { return { error: \u0026#34;Unauthorized\u0026#34; }; } // å¤„ç†è¡¨å•æ•°æ® const name = formData.get(\u0026#34;name\u0026#34;); const email = formData.get(\u0026#34;email\u0026#34;); try { // æ›´æ–°æ•°æ®åº“ await db.users.update({ where: { id: session.user.id }, data: { name, email }, }); // è¿”å›ç»“æœ return { success: true }; } catch (error) { return { error: \u0026#34;Failed to update profile\u0026#34;, details: process.env.NODE_ENV === \u0026#34;development\u0026#34; ? error.message : undefined, }; } } åœ¨å®¢æˆ·ç«¯ç»„ä»¶ä¸­ä½¿ç”¨å®ƒï¼š\n\u0026#34;use client\u0026#34;; import { updateUserProfile } from \u0026#34;@/actions/user\u0026#34;; export function ProfileForm({ user }) { async function handleSubmit(event) { event.preventDefault(); const formData = new FormData(event.target); const result = await updateUserProfile(formData); if (result.error) { // å¤„ç†é”™è¯¯ } else { // å¤„ç†æˆåŠŸ } } return ( \u0026lt;form onSubmit={handleSubmit}\u0026gt; \u0026lt;input name=\u0026#34;name\u0026#34; defaultValue={user.name} /\u0026gt; \u0026lt;input name=\u0026#34;email\u0026#34; defaultValue={user.email} /\u0026gt; \u0026lt;button type=\u0026#34;submit\u0026#34;\u0026gt;Update Profile\u0026lt;/button\u0026gt; \u0026lt;/form\u0026gt; ); } è¿™ç§æ¨¡å¼å°†å®¢æˆ·ç«¯çš„äº‹ä»¶å¤„ç†ä¸æœåŠ¡å™¨çš„æ•°æ®å¤„ç†æ— ç¼è¿æ¥ï¼Œæ— éœ€æ„å»º API å±‚ã€‚\nå®æˆ˜ä¸­çš„æ¶æ„å†³ç­–ä¸æœ€ä½³å®è·µ ç»è¿‡å‡ ä¸ªæœˆçš„å®æˆ˜ï¼Œæˆ‘æ€»ç»“äº†ä¸€äº›æœåŠ¡å™¨ç»„ä»¶ç›¸å…³çš„æœ€ä½³å®è·µï¼š\n1. æ˜ç¡®ç»„ä»¶è¾¹ç•Œåˆ†ç¦» src/ â”œâ”€â”€ components/ â”‚ â”œâ”€â”€ ui/ # å¯é‡ç”¨UIç»„ä»¶ï¼ˆå¤§å¤šæ˜¯å®¢æˆ·ç«¯ç»„ä»¶ï¼‰ â”‚ â”‚ â”œâ”€â”€ Navigation/ â”‚ â”‚ â”‚ â”œâ”€â”€ index.js # æœåŠ¡å™¨ç»„ä»¶å…¥å£ â”‚ â”‚ â”‚ â”œâ”€â”€ MobileMenu.client.js # å®¢æˆ·ç«¯äº¤äº’ç»„ä»¶ â”‚ â”‚ â”‚ â””â”€â”€ NavItem.js # æœåŠ¡å™¨ç»„ä»¶ â”‚ â”‚ â”‚ â”œâ”€â”€ products/ # äº§å“ç›¸å…³ç»„ä»¶ â”‚ â”‚ â”œâ”€â”€ Card/ â”‚ â”‚ â”‚ â”œâ”€â”€ index.js # æœåŠ¡å™¨ç»„ä»¶åŒ…è£…å™¨ â”‚ â”‚ â”‚ â”œâ”€â”€ CardContent.js # æœåŠ¡å™¨ç»„ä»¶ â”‚ â”‚ â”‚ â”œâ”€â”€ AddToCart.client.js # å®¢æˆ·ç«¯ç»„ä»¶ â”‚ â”‚ â”‚ â””â”€â”€ utils.js # æœåŠ¡å™¨+å®¢æˆ·ç«¯å…±äº«å·¥å…· â”‚ â”‚ â”‚ â””â”€â”€ ui/ # é€šç”¨UIç»„ä»¶ â”‚ â”œâ”€â”€ Button/ â”‚ â”œâ”€â”€ Card/ â”‚ â””â”€â”€ Modal.client.js # æ˜ç¡®æ ‡è®°å®¢æˆ·ç«¯ç»„ä»¶ â”‚ â”œâ”€â”€ lib/ # é€šç”¨å·¥å…·åº“ â”‚ â”œâ”€â”€ server/ # ä»…æœåŠ¡å™¨å·¥å…· â”‚ â”‚ â”œâ”€â”€ db.js # æ•°æ®åº“å®¢æˆ·ç«¯ â”‚ â”‚ â””â”€â”€ auth.js # è®¤è¯å·¥å…· â”‚ â”œâ”€â”€ client/ # ä»…å®¢æˆ·ç«¯å·¥å…· â”‚ â”‚ â””â”€â”€ analytics.js # åˆ†æå·¥å…· â”‚ â””â”€â”€ shared/ # å…±äº«å·¥å…· â”‚ â””â”€â”€ formatting.js # æ—¥æœŸ/è´§å¸æ ¼å¼åŒ– â”‚ â”œâ”€â”€ app/ # è·¯ç”±å’Œé¡µé¢ â””â”€â”€ actions/ # æœåŠ¡å™¨æ“ä½œ 2. é¿å…é“å…·é’»æ¢ï¼Œåˆç†ä½¿ç”¨ä¸Šä¸‹æ–‡ ç”±äºå®¢æˆ·ç«¯ç»„ä»¶æ— æ³•å†å¯¼å…¥æœåŠ¡å™¨ç»„ä»¶ï¼Œå®¹æ˜“äº§ç”Ÿé“å…·é’»æ¢é—®é¢˜ã€‚æˆ‘ä»¬é‡‡ç”¨äº†ä»¥ä¸‹ç­–ç•¥ï¼š\n// åœ¨æœåŠ¡å™¨ç»„ä»¶ä¸­è®¾ç½®é¡µé¢å¸ƒå±€å’Œæ•°æ® export default async function ProductPage({ productId }) { const product = await getProduct(productId); const user = await getCurrentUser(); return ( \u0026lt;div className=\u0026#34;product-page\u0026#34;\u0026gt; \u0026lt;ProductDetails product={product} /\u0026gt; {/* å°†æ‰€æœ‰å®¢æˆ·ç«¯äº¤äº’éœ€è¦çš„æ•°æ®ä¸€æ¬¡æ€§ä¼ é€’ä¸‹å» */} \u0026lt;ClientInteractiveSection product={product} isLoggedIn={!!user} userId={user?.id} userRoles={user?.roles || []} /\u0026gt; \u0026lt;/div\u0026gt; ); } // å®¢æˆ·ç«¯äº¤äº’åŒºåŸŸ - ä¸€ä¸ªå®¢æˆ·ç«¯ç»„ä»¶å®¹å™¨ \u0026#39;use client\u0026#39;; import { createContext } from \u0026#39;react\u0026#39;; import AddToCart from \u0026#39;./AddToCart\u0026#39;; import ProductActions from \u0026#39;./ProductActions\u0026#39;; import Reviews from \u0026#39;./Reviews\u0026#39;; // åˆ›å»ºä¸Šä¸‹æ–‡é¿å…é“å…·é’»æ¢ const ProductContext = createContext(null); export default function ClientInteractiveSection({ product, isLoggedIn, userId, userRoles }) { const contextValue = { product, user: { isLoggedIn, id: userId, roles: userRoles } }; return ( \u0026lt;ProductContext.Provider value={contextValue}\u0026gt; \u0026lt;div className=\u0026#34;interactive-section\u0026#34;\u0026gt; \u0026lt;AddToCart /\u0026gt; \u0026lt;ProductActions /\u0026gt; \u0026lt;Reviews /\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/ProductContext.Provider\u0026gt; ); } 3. æœåŠ¡å™¨ç»„ä»¶ä¸­çš„é”™è¯¯å¤„ç† æœåŠ¡å™¨ç»„ä»¶çš„é”™è¯¯å¤„ç†æ¯”å®¢æˆ·ç«¯æ›´å¤æ‚ï¼Œå› ä¸ºå®ƒä»¬å¯èƒ½åœ¨æ„å»ºæ—¶ã€è¯·æ±‚æ—¶æˆ–æ¸²æŸ“æ—¶å¤±è´¥ï¼š\n// æœåŠ¡å™¨ç»„ä»¶çš„é”™è¯¯è¾¹ç•Œ export default function ProductsLayout({ children }) { return ( \u0026lt;div className=\u0026#34;products-section\u0026#34;\u0026gt; \u0026lt;h1\u0026gt;Products\u0026lt;/h1\u0026gt; {/* æ•è·äº§å“åˆ—è¡¨çš„é”™è¯¯ */} \u0026lt;ErrorBoundary fallback={\u0026lt;ProductsErrorFallback /\u0026gt;}\u0026gt; {children} \u0026lt;/ErrorBoundary\u0026gt; \u0026lt;/div\u0026gt; ); } // é”™è¯¯é¡µé¢ - error.js \u0026#39;use client\u0026#39;; export default function ProductsError({ error, reset }) { // æŠ¥å‘Šé”™è¯¯åˆ°ç›‘æ§æœåŠ¡ useEffect(() =\u0026gt; { reportError(error); }, [error]); return ( \u0026lt;div className=\u0026#34;error-container\u0026#34;\u0026gt; \u0026lt;h2\u0026gt;Something went wrong\u0026lt;/h2\u0026gt; \u0026lt;p\u0026gt;We couldn\u0026#39;t load the products. Please try again later.\u0026lt;/p\u0026gt; \u0026lt;button onClick={reset}\u0026gt;Try again\u0026lt;/button\u0026gt; \u0026lt;/div\u0026gt; ); } // åŠ è½½çŠ¶æ€ - loading.js export default function ProductsLoading() { return ( \u0026lt;div className=\u0026#34;products-loading\u0026#34;\u0026gt; \u0026lt;ProductGridSkeleton items={12} /\u0026gt; \u0026lt;/div\u0026gt; ); } 4. ç¼“å­˜ä¸é‡æ–°éªŒè¯ç­–ç•¥ æˆ‘ä»¬å‘ç°æœåŠ¡å™¨ç»„ä»¶çš„æ€§èƒ½å¾ˆå¤§ç¨‹åº¦ä¸Šå–å†³äºç¼“å­˜ç­–ç•¥ï¼š\n// åˆ©ç”¨Next.jsçš„ç¼“å­˜API import { cache } from \u0026#34;react\u0026#34;; // ç¼“å­˜å‡½æ•°è°ƒç”¨ç»“æœ export const getProduct = cache(async (id) =\u0026gt; { const product = await db.products.findUnique({ where: { id }, }); return product; }); // ä½¿ç”¨åŠ¨æ€é…ç½®çš„ç¼“å­˜ export async function getCategoryProducts(categoryId, options = {}) { // è·å–ç¼“å­˜é…ç½® const { revalidate = 3600 } = options; // å¸¦ç¼“å­˜çš„è·å– const response = await fetch( `${process.env.API_URL}/categories/${categoryId}/products`, { next: { revalidate } } ); if (!response.ok) { throw new Error(`Failed to fetch products for category ${categoryId}`); } return response.json(); } // é¡µé¢ç»„ä»¶ä¸­ä½¿ç”¨ç¼“å­˜ export default async function CategoryPage({ params, searchParams }) { const { categoryId } = params; const { sort, filter } = searchParams; // åŠ¨æ€å†³å®šç¼“å­˜ç­–ç•¥ // - çƒ­é—¨åˆ†ç±»æ›´é¢‘ç¹åˆ·æ–° // - æœ‰ç­›é€‰æ¡ä»¶æ—¶ä¸ç¼“å­˜ const cacheOptions = { revalidate: isPopularCategory(categoryId) ? 300 : 3600, }; if (Object.keys(filter || {}).length \u0026gt; 0) { // æœ‰ç­›é€‰æ¡ä»¶ï¼Œä¸ä½¿ç”¨ç¼“å­˜ cacheOptions.revalidate = 0; } const products = await getCategoryProducts(categoryId, cacheOptions); // ...æ¸²æŸ“é¡µé¢ } å¸¸è§é™·é˜±ä¸è§£å†³æ–¹æ¡ˆ åœ¨å‡ ä¸ªæœˆçš„å®è·µä¸­ï¼Œæˆ‘ä»¬è¸©è¿‡ä¸å°‘å‘ï¼Œæ€»ç»“å¦‚ä¸‹ï¼š\n1. \u0026ldquo;å®¢æˆ·ç«¯ç»„ä»¶ä¸èƒ½å¯¼å…¥æœåŠ¡å™¨ç»„ä»¶\u0026quot;çš„é™åˆ¶ è¿™æ˜¯æ–°æ‰‹æœ€å¸¸è§çš„é—®é¢˜ï¼Œæ­£ç¡®çš„æ¨¡å¼æ˜¯ï¼š\n// âŒ é”™è¯¯æ–¹å¼ // Header.client.js (å®¢æˆ·ç«¯ç»„ä»¶) import UserProfile from \u0026#39;./UserProfile\u0026#39;; // é”™è¯¯ï¼å®¢æˆ·ç«¯ç»„ä»¶ä¸èƒ½å¯¼å…¥æœåŠ¡å™¨ç»„ä»¶ export default function Header() { return ( \u0026lt;header\u0026gt; \u0026lt;Logo /\u0026gt; \u0026lt;UserProfile /\u0026gt; {/* è¿™ä¸ä¼šå·¥ä½œ */} \u0026lt;/header\u0026gt; ); } // âœ… æ­£ç¡®æ–¹å¼ // 1. åœ¨çˆ¶æœåŠ¡å™¨ç»„ä»¶ä¸­å¯¼å…¥ä¸¤è€… // Page.js (æœåŠ¡å™¨ç»„ä»¶) import Header from \u0026#39;./Header.client\u0026#39;; import UserProfile from \u0026#39;./UserProfile\u0026#39;; export default function Page() { return ( \u0026lt;div\u0026gt; \u0026lt;Header\u0026gt; \u0026lt;UserProfile /\u0026gt; {/* å°†æœåŠ¡å™¨ç»„ä»¶ä½œä¸ºå±æ€§ä¼ é€’ç»™å®¢æˆ·ç«¯ç»„ä»¶ */} \u0026lt;/Header\u0026gt; \u0026lt;main\u0026gt;...\u0026lt;/main\u0026gt; \u0026lt;/div\u0026gt; ); } // 2. å®¢æˆ·ç«¯ç»„ä»¶æ¥æ”¶children // Header.client.js export default function Header({ children }) { return ( \u0026lt;header\u0026gt; \u0026lt;Logo /\u0026gt; {children} {/* æ¥æ”¶ä»æœåŠ¡å™¨ç»„ä»¶ä¼ æ¥çš„å†…å®¹ */} \u0026lt;/header\u0026gt; ); } 2. å¤„ç†å¤§å‹è¡¨å•é€»è¾‘ å¤æ‚è¡¨å•éœ€è¦å®¢æˆ·ç«¯äº¤äº’ï¼Œæˆ‘ä»¬å¼€å‘äº†ä¸€ç§æ¨¡å¼æ¥å¹³è¡¡æœåŠ¡å™¨éªŒè¯å’Œå®¢æˆ·ç«¯ä½“éªŒï¼š\n// æœåŠ¡å™¨æ“ä½œ - åŒ…å«éªŒè¯é€»è¾‘ \u0026#34;use server\u0026#34;; import { z } from \u0026#34;zod\u0026#34;; // è¡¨å•éªŒè¯æ¨¡å¼ const productSchema = z.object({ name: z.string().min(3).max(100), price: z.number().positive(), description: z.string().optional(), // ...å…¶ä»–å­—æ®µ }); export async function createProduct(formData) { // è§£æå’ŒéªŒè¯ const parsed = Object.fromEntries(formData.entries()); parsed.price = Number(parsed.price); // éªŒè¯ const validation = productSchema.safeParse(parsed); if (!validation.success) { return { success: false, errors: validation.error.flatten().fieldErrors, }; } // æ•°æ®åº“æ“ä½œ try { const product = await db.products.create({ data: validation.data, }); return { success: true, productId: product.id, }; } catch (error) { return { success: false, errors: { _form: [\u0026#34;Failed to create product\u0026#34;] }, }; } } // å®¢æˆ·ç«¯è¡¨å•ç»„ä»¶ (\u0026#34;use client\u0026#34;); import { useState } from \u0026#34;react\u0026#34;; import { createProduct } from \u0026#34;@/actions/products\u0026#34;; export default function ProductForm() { const [errors, setErrors] = useState({}); const [isSubmitting, setIsSubmitting] = useState(false); async function handleSubmit(e) { e.preventDefault(); setIsSubmitting(true); const formData = new FormData(e.target); const result = await createProduct(formData); setIsSubmitting(false); if (!result.success) { setErrors(result.errors); return; } // æˆåŠŸå¤„ç†... } return ( \u0026lt;form onSubmit={handleSubmit}\u0026gt; \u0026lt;div className=\u0026#34;form-field\u0026#34;\u0026gt; \u0026lt;label htmlFor=\u0026#34;name\u0026#34;\u0026gt;Product Name\u0026lt;/label\u0026gt; \u0026lt;input id=\u0026#34;name\u0026#34; name=\u0026#34;name\u0026#34; /\u0026gt; {errors.name \u0026amp;\u0026amp; \u0026lt;div className=\u0026#34;error\u0026#34;\u0026gt;{errors.name[0]}\u0026lt;/div\u0026gt;} \u0026lt;/div\u0026gt; {/* å…¶ä»–å­—æ®µ */} \u0026lt;button type=\u0026#34;submit\u0026#34; disabled={isSubmitting}\u0026gt; {isSubmitting ? \u0026#34;Creating...\u0026#34; : \u0026#34;Create Product\u0026#34;} \u0026lt;/button\u0026gt; {errors._form \u0026amp;\u0026amp; \u0026lt;div className=\u0026#34;form-error\u0026#34;\u0026gt;{errors._form[0]}\u0026lt;/div\u0026gt;} \u0026lt;/form\u0026gt; ); } 3. æœç´¢ä¸è¿‡æ»¤åŠŸèƒ½çš„å®ç° // æœç´¢ç»“æœé¡µ - æœåŠ¡å™¨ç»„ä»¶ï¼ˆç»­ï¼‰ export default async function SearchResults({ searchParams }) { const query = searchParams.q || \u0026#34;\u0026#34;; let products = []; if (query.trim()) { products = await searchProducts(query); } return ( \u0026lt;div className=\u0026#34;search-results\u0026#34;\u0026gt; \u0026lt;h1\u0026gt;Search Results for \u0026#34;{query}\u0026#34;\u0026lt;/h1\u0026gt; {products.length === 0 ? ( \u0026lt;p\u0026gt;No products found. Try a different search term.\u0026lt;/p\u0026gt; ) : ( \u0026lt;div className=\u0026#34;products-grid\u0026#34;\u0026gt; {products.map((product) =\u0026gt; ( \u0026lt;ProductCard key={product.id} product={product} /\u0026gt; ))} \u0026lt;/div\u0026gt; )} {/* æœç´¢ç­›é€‰å™¨ - å®¢æˆ·ç«¯äº¤äº’ç»„ä»¶ */} \u0026lt;SearchFilters currentFilters={searchParams} totalResults={products.length} /\u0026gt; \u0026lt;/div\u0026gt; ); } // æœåŠ¡å™¨ç«¯æœç´¢å‡½æ•° async function searchProducts(query, filters = {}) { // å¯ä»¥ç›´æ¥è®¿é—®æ•°æ®åº“æˆ–æœç´¢å¼•æ“ const products = await db.products.findMany({ where: { OR: [ { name: { contains: query, mode: \u0026#34;insensitive\u0026#34; } }, { description: { contains: query, mode: \u0026#34;insensitive\u0026#34; } }, ], // åº”ç”¨é¢å¤–ç­›é€‰æ¡ä»¶ ...(filters.category ? { categoryId: filters.category } : {}), ...(filters.minPrice ? { price: { gte: Number(filters.minPrice) } } : {}), ...(filters.maxPrice ? { price: { lte: Number(filters.maxPrice) } } : {}), }, orderBy: { // åŠ¨æ€æ’åº [filters.sortBy || \u0026#34;createdAt\u0026#34;]: filters.sortOrder || \u0026#34;desc\u0026#34;, }, take: 50, }); return products; } è¿™ç§æ¨¡å¼æœ‰å‡ ä¸ªæ˜æ˜¾ä¼˜åŠ¿ï¼š\næœç´¢çŠ¶æ€ä¿å­˜åœ¨ URL ä¸­ï¼Œæ”¯æŒåˆ†äº«å’Œæµè§ˆå™¨å†å² æœåŠ¡å™¨å¤„ç†æœç´¢é€»è¾‘ï¼Œé¿å…å°†å¤æ‚æŸ¥è¯¢ä¼ è¾“åˆ°å®¢æˆ·ç«¯ å®¢æˆ·ç«¯ç»„ä»¶å¤„ç†äº¤äº’ä½“éªŒï¼Œä¿æŒç•Œé¢æµç•…å“åº” 4. ç®¡ç†è®¤è¯ä¸æˆæƒ æœåŠ¡å™¨ç»„ä»¶æœ¬è´¨ä¸Šæ˜¯ä¿å¯†çš„ï¼Œè¿™ç»™è®¤è¯å’Œæˆæƒå¸¦æ¥äº†æ–°æ€è·¯ï¼š\n// ä¸­é—´ä»¶ - å¤„ç†è®¤è¯é€»è¾‘ import { NextResponse } from \u0026#39;next/server\u0026#39;; import { getToken } from \u0026#39;next-auth/jwt\u0026#39;; export async function middleware(request) { // æ£€æŸ¥æ˜¯å¦éœ€è¦è®¤è¯çš„è·¯å¾„ if (request.nextUrl.pathname.startsWith(\u0026#39;/dashboard\u0026#39;)) { const token = await getToken({ req: request }); // æœªè®¤è¯ï¼Œé‡å®šå‘åˆ°ç™»å½• if (!token) { const url = new URL(\u0026#39;/login\u0026#39;, request.url); url.searchParams.set(\u0026#39;callbackUrl\u0026#39;, request.nextUrl.pathname); return NextResponse.redirect(url); } // æ£€æŸ¥æƒé™ if ( request.nextUrl.pathname.startsWith(\u0026#39;/dashboard/admin\u0026#39;) \u0026amp;\u0026amp; !token.user?.roles?.includes(\u0026#39;ADMIN\u0026#39;) ) { return NextResponse.redirect(new URL(\u0026#39;/dashboard\u0026#39;, request.url)); } } return NextResponse.next(); } // å¸ƒå±€ç»„ä»¶ä¸­çš„æƒé™æ§åˆ¶ export default async function DashboardLayout({ children }) { // æœåŠ¡å™¨ç«¯è·å–ç”¨æˆ·ä¿¡æ¯ const user = await getServerSession(); if (!user) { // ç†è®ºä¸Šä¸åº”è¯¥è¿›å…¥è¿™é‡Œï¼Œå› ä¸ºä¸­é—´ä»¶å·²ç»å¤„ç†äº† // ä½†ä½œä¸ºé¢å¤–å®‰å…¨æªæ–½ redirect(\u0026#39;/login\u0026#39;); } return ( \u0026lt;div className=\u0026#34;dashboard-layout\u0026#34;\u0026gt; \u0026lt;DashboardSidebar userRole={user.role} userName={user.name} /\u0026gt; \u0026lt;div className=\u0026#34;dashboard-content\u0026#34;\u0026gt; {children} \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; ); } // é¡µé¢çº§åˆ«çš„æƒé™æ£€æŸ¥ export default async function AdminSettingsPage() { const session = await getServerSession(); // æ£€æŸ¥æƒé™ if (!session?.user?.roles.includes(\u0026#39;ADMIN\u0026#39;)) { // å¯ä»¥é€‰æ‹©é‡å®šå‘æˆ–æ˜¾ç¤ºé”™è¯¯ notFound(); // æˆ– // throw new Error(\u0026#39;Unauthorized\u0026#39;); } const settings = await getAdminSettings(); return ( \u0026lt;div className=\u0026#34;admin-settings\u0026#34;\u0026gt; \u0026lt;h1\u0026gt;Admin Settings\u0026lt;/h1\u0026gt; {/* æ•æ„Ÿå†…å®¹åœ¨æœåŠ¡å™¨ç»„ä»¶ä¸­æ˜¯å®‰å…¨çš„ */} \u0026lt;SettingsForm initialData={settings} /\u0026gt; \u0026lt;/div\u0026gt; ); } è¿™ç§æ–¹æ³•çš„äº®ç‚¹æ˜¯ï¼š\næ•æ„Ÿé€»è¾‘åœ¨æœåŠ¡å™¨æ‰§è¡Œï¼Œä¸ä¼šæš´éœ²ç»™å®¢æˆ·ç«¯ å¤šå±‚ä¿æŠ¤ï¼šä¸­é—´ä»¶ã€å¸ƒå±€ç»„ä»¶å’Œé¡µé¢ç»„ä»¶ å®¢æˆ·ç«¯ UI å’ŒæœåŠ¡å™¨æƒé™æ£€æŸ¥å®Œå…¨åˆ†ç¦» æ€§èƒ½ä¼˜åŒ–ç­–ç•¥ å®æˆ˜ä¸­ï¼Œæˆ‘ä»¬å‘ç°æœåŠ¡å™¨ç»„ä»¶éœ€è¦ç‰¹å®šçš„æ€§èƒ½ä¼˜åŒ–æ€è·¯ï¼š\n1. ç¼“å­˜ä¸æ•°æ®è®¿é—®ä¼˜åŒ– // å®šä¹‰æŸ¥è¯¢å‡½æ•°ï¼Œä½¿ç”¨React cache import { cache } from \u0026#34;react\u0026#34;; // åŒ…è£…æ•°æ®åº“æŸ¥è¯¢ä»¥å¯ç”¨ç¼“å­˜ export const getProduct = cache(async (id) =\u0026gt; { const product = await db.products.findUnique({ where: { id }, }); return product; }); export const getCategory = cache(async (id) =\u0026gt; { return db.categories.findUnique({ where: { id } }); }); // ä½¿ç”¨ç¼“å­˜å‡½æ•°é¿å…é‡å¤æŸ¥è¯¢ async function ProductWithCategory({ productId }) { const product = await getProduct(productId); // è¿™ä¸ªè°ƒç”¨ä¼šåˆ©ç”¨ç¼“å­˜ï¼Œå¦‚æœåœ¨åŒä¸€è¯·æ±‚ä¸­å·²ç»æŸ¥è¯¢è¿‡ const category = await getCategory(product.categoryId); return ( \u0026lt;div\u0026gt; \u0026lt;h1\u0026gt;{product.name}\u0026lt;/h1\u0026gt; \u0026lt;p\u0026gt;Category: {category.name}\u0026lt;/p\u0026gt; \u0026lt;/div\u0026gt; ); } // æµå¼ä¼ è¾“ä¼˜åŒ– - é€šè¿‡Suspenseåˆ†è§£å¤§é¡µé¢ export default function ProductPage({ productId }) { return ( \u0026lt;div\u0026gt; \u0026lt;Suspense fallback={\u0026lt;ProductSkeleton /\u0026gt;}\u0026gt; \u0026lt;ProductDetails id={productId} /\u0026gt; \u0026lt;/Suspense\u0026gt; \u0026lt;Suspense fallback={\u0026lt;ReviewsSkeleton /\u0026gt;}\u0026gt; \u0026lt;ProductReviews id={productId} /\u0026gt; \u0026lt;/Suspense\u0026gt; \u0026lt;Suspense fallback={\u0026lt;RelatedSkeleton /\u0026gt;}\u0026gt; \u0026lt;RelatedProducts id={productId} /\u0026gt; \u0026lt;/Suspense\u0026gt; \u0026lt;/div\u0026gt; ); } 2. é€‰æ‹©æ€§æ¿€æ´»å®¢æˆ·ç«¯ç»„ä»¶ å‡å°‘ JavaScript ä½“ç§¯çš„å…³é”®æ˜¯é™åˆ¶å®¢æˆ·ç«¯ç»„ä»¶çš„èŒƒå›´ï¼š\n// âŒ ç²—ç²’åº¦å®¢æˆ·ç«¯ç»„ä»¶ // \u0026#39;use client\u0026#39;; // export default function ProductCard({ product }) { // // æ•´ä¸ªå¡ç‰‡éƒ½å˜æˆå®¢æˆ·ç«¯ç»„ä»¶ï¼ŒåŒ…æ‹¬ä¸éœ€è¦äº¤äº’çš„éƒ¨åˆ† // } // âœ… ç»†ç²’åº¦å®¢æˆ·ç«¯ç»„ä»¶ export default function ProductCard({ product }) { // ä¸»è¦å†…å®¹æ˜¯æœåŠ¡å™¨ç»„ä»¶ return ( \u0026lt;div className=\u0026#34;product-card\u0026#34;\u0026gt; \u0026lt;Image src={product.imageUrl} alt={product.name} width={300} height={300} /\u0026gt; \u0026lt;h3\u0026gt;{product.name}\u0026lt;/h3\u0026gt; \u0026lt;p className=\u0026#34;price\u0026#34;\u0026gt;{formatCurrency(product.price)}\u0026lt;/p\u0026gt; {/* åªæœ‰äº¤äº’éƒ¨åˆ†æ˜¯å®¢æˆ·ç«¯ç»„ä»¶ */} \u0026lt;AddToCartButton product={product} /\u0026gt; \u0026lt;/div\u0026gt; ); } // å®¢æˆ·ç«¯äº’åŠ¨æŒ‰é’® (\u0026#34;use client\u0026#34;); import { useCart } from \u0026#34;@/hooks/useCart\u0026#34;; function AddToCartButton({ product }) { const { addToCart, isInCart } = useCart(); function handleAddToCart() { addToCart(product); } return ( \u0026lt;button onClick={handleAddToCart} disabled={isInCart(product.id)} className=\u0026#34;add-to-cart-button\u0026#34; \u0026gt; {isInCart(product.id) ? \u0026#34;Added to Cart\u0026#34; : \u0026#34;Add to Cart\u0026#34;} \u0026lt;/button\u0026gt; ); } 3. ä¼˜åŒ–å›¾åƒå’Œèµ„æºåŠ è½½ æœåŠ¡å™¨ç»„ä»¶å…è®¸æ™ºèƒ½åœ°ä¼˜åŒ–èµ„æºï¼š\n// åœ¨æœåŠ¡å™¨ç»„ä»¶ä¸­ä¼˜åŒ–å›¾åƒ async function ProductGallery({ productId }) { const product = await getProduct(productId); const images = await getProductImages(productId); // åœ¨æœåŠ¡å™¨ä¸Šç¡®å®šæœ€ä½³å›¾åƒå°ºå¯¸ const deviceBreakpoints = [640, 768, 1024, 1280]; // æ£€æµ‹å›¾åƒæ ¼å¼æ”¯æŒ const supportsWebP = checkBrowserSupport(headers(), \u0026#34;webp\u0026#34;); const supportsAVIF = checkBrowserSupport(headers(), \u0026#34;avif\u0026#34;); // é€‰æ‹©æœ€åˆé€‚çš„æ ¼å¼ const format = supportsAVIF ? \u0026#34;avif\u0026#34; : supportsWebP ? \u0026#34;webp\u0026#34; : \u0026#34;jpg\u0026#34;; return ( \u0026lt;div className=\u0026#34;product-gallery\u0026#34;\u0026gt; \u0026lt;div className=\u0026#34;main-image\u0026#34;\u0026gt; \u0026lt;Image src={optimizeImageUrl(product.mainImage, { width: 800, height: 800, format, })} alt={product.name} width={800} height={800} priority // LCPä¼˜åŒ– /\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;div className=\u0026#34;thumbnail-grid\u0026#34;\u0026gt; {images.map((image) =\u0026gt; ( \u0026lt;ThumbnailImage key={image.id} image={image} format={format} /\u0026gt; ))} \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; ); } // åªåœ¨å®¢æˆ·ç«¯åŠ è½½å¿…è¦çš„JS function ProductPage({ productId }) { return ( \u0026lt;div\u0026gt; \u0026lt;ProductDetails id={productId} /\u0026gt; {/* åªæœ‰å¯è§æ—¶æ‰åŠ è½½è¯„è®ºJS */} \u0026lt;ClientSideOnly fallback={\u0026lt;ReviewsPlaceholder /\u0026gt;}\u0026gt; \u0026lt;ProductReviews id={productId} /\u0026gt; \u0026lt;/ClientSideOnly\u0026gt; \u0026lt;/div\u0026gt; ); } ä¸ç°æœ‰ç”Ÿæ€ç³»ç»Ÿé›†æˆ æœåŠ¡å™¨ç»„ä»¶æ˜¯æ–°èŒƒå¼ï¼Œä¸ç°æœ‰åº“é›†æˆéœ€è¦ä¸€äº›æŠ€å·§ï¼š\n1. çŠ¶æ€ç®¡ç†è§£å†³æ–¹æ¡ˆ // ä¸Reduxé›†æˆçš„æ¨¡å¼ // providers.js - å®¢æˆ·ç«¯ç»„ä»¶ \u0026#39;use client\u0026#39;; import { Provider } from \u0026#39;react-redux\u0026#39;; import { store } from \u0026#39;@/lib/store\u0026#39;; export function ReduxProvider({ children }) { return \u0026lt;Provider store={store}\u0026gt;{children}\u0026lt;/Provider\u0026gt;; } // æ ¹å¸ƒå±€ export default function RootLayout({ children }) { return ( \u0026lt;html lang=\u0026#34;en\u0026#34;\u0026gt; \u0026lt;body\u0026gt; \u0026lt;ReduxProvider\u0026gt; {children} \u0026lt;/ReduxProvider\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; ); } // æœåŠ¡å™¨ç»„ä»¶å’ŒReduxäº¤äº’ export default async function ProductPage({ params }) { // åœ¨æœåŠ¡å™¨è·å–åˆå§‹æ•°æ® const product = await getProduct(params.id); return ( \u0026lt;div\u0026gt; {/* é™æ€å†…å®¹ - æœåŠ¡å™¨æ¸²æŸ“ */} \u0026lt;ProductDetails product={product} /\u0026gt; {/* ä¸Reduxäº¤äº’çš„ç»„ä»¶ */} \u0026lt;AddToCartSection product={product} /\u0026gt; \u0026lt;/div\u0026gt; ); } // å®¢æˆ·ç«¯Reduxäº¤äº’ç»„ä»¶ \u0026#39;use client\u0026#39;; import { useDispatch, useSelector } from \u0026#39;react-redux\u0026#39;; import { addToCart, selectIsInCart } from \u0026#39;@/lib/features/cart/cartSlice\u0026#39;; function AddToCartSection({ product }) { const dispatch = useDispatch(); const isInCart = useSelector(state =\u0026gt; selectIsInCart(state, product.id)); function handleAddToCart() { dispatch(addToCart(product)); } return ( \u0026lt;div className=\u0026#34;cart-section\u0026#34;\u0026gt; \u0026lt;button onClick={handleAddToCart} disabled={isInCart} \u0026gt; {isInCart ? \u0026#39;In Cart\u0026#39; : \u0026#39;Add to Cart\u0026#39;} \u0026lt;/button\u0026gt; \u0026lt;/div\u0026gt; ); } 2. æ•°æ®è·å–åº“ ä¸ React Query è¿™ç±»åº“é›†æˆï¼š\n// providers.js - å®¢æˆ·ç«¯ç»„ä»¶ \u0026#34;use client\u0026#34;; import { QueryClient, QueryClientProvider } from \u0026#34;@tanstack/react-query\u0026#34;; import { useState } from \u0026#34;react\u0026#34;; export function QueryProvider({ children }) { const [queryClient] = useState( () =\u0026gt; new QueryClient({ defaultOptions: { queries: { staleTime: 60 * 1000, }, }, }) ); return ( \u0026lt;QueryClientProvider client={queryClient}\u0026gt;{children}\u0026lt;/QueryClientProvider\u0026gt; ); } // åœ¨æœåŠ¡å™¨ç»„ä»¶ä¸React Queryåä½œ // æœåŠ¡å™¨ç»„ä»¶ export default async function ProductsPage() { // è·å–åˆå§‹æ•°æ® const initialProducts = await getProducts(); return ( \u0026lt;div\u0026gt; {/* ä¼ é€’åˆå§‹æ•°æ®ç»™å®¢æˆ·ç«¯ç»„ä»¶ */} \u0026lt;ProductList initialProducts={initialProducts} /\u0026gt; \u0026lt;/div\u0026gt; ); } // å®¢æˆ·ç«¯ç»„ä»¶ - ä½¿ç”¨React Query (\u0026#34;use client\u0026#34;); import { useQuery } from \u0026#34;@tanstack/react-query\u0026#34;; export function ProductList({ initialProducts }) { const { data: products } = useQuery({ queryKey: [\u0026#34;products\u0026#34;], queryFn: async () =\u0026gt; { const res = await fetch(\u0026#34;/api/products\u0026#34;); return res.json(); }, // ä½¿ç”¨æœåŠ¡å™¨åˆå§‹æ•°æ® initialData: initialProducts, }); return ( \u0026lt;div className=\u0026#34;products-grid\u0026#34;\u0026gt; {products.map((product) =\u0026gt; ( \u0026lt;ProductItem key={product.id} product={product} /\u0026gt; ))} \u0026lt;/div\u0026gt; ); } å®æˆ˜ç»éªŒæ€»ç»“ åœ¨å®é™…é¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬æ€»ç»“äº†å‡ ç‚¹å…³é”®ç»éªŒï¼š\n1. æ¸è¿›å¼é‡‡ç”¨ç­–ç•¥ æœåŠ¡å™¨ç»„ä»¶ä¸éœ€è¦ä¸€æ¬¡æ€§å…¨éƒ¨ä½¿ç”¨ï¼Œå¯ä»¥æ¸è¿›å¼é‡‡ç”¨ï¼š\nä»é¡µé¢çº§åˆ«å¼€å§‹ï¼šé¦–å…ˆå°†é¡µé¢çº§ç»„ä»¶è½¬æ¢ä¸ºæœåŠ¡å™¨ç»„ä»¶ï¼Œä¿ç•™ç°æœ‰å®¢æˆ·ç«¯ç»„ä»¶ è¯†åˆ«æ•°æ®å¯†é›†å‹ç»„ä»¶ï¼šä¼˜å…ˆè½¬æ¢é‚£äº›ä¸»è¦ç”¨äºæ˜¾ç¤ºæ•°æ®çš„ç»„ä»¶ ä¿ç•™äº¤äº’å¯†é›†å‹ç»„ä»¶ï¼šè¡¨å•ã€æ§ä»¶å’Œé«˜åº¦äº¤äº’çš„ UI ä¿ç•™ä¸ºå®¢æˆ·ç«¯ç»„ä»¶ // æ¸è¿›å¼é‡‡ç”¨ç¤ºä¾‹ // ç¬¬ä¸€é˜¶æ®µï¼šä»…é¡µé¢æ˜¯æœåŠ¡å™¨ç»„ä»¶ export default async function ProductsPage() { const products = await getProducts(); return \u0026lt;ExistingClientProductList products={products} /\u0026gt;; } // ç¬¬äºŒé˜¶æ®µï¼šæ‹†åˆ†é™æ€å’Œäº¤äº’éƒ¨åˆ† export default async function ProductsPage() { const products = await getProducts(); return ( \u0026lt;\u0026gt; {/* æ–°çš„æœåŠ¡å™¨ç»„ä»¶ */} \u0026lt;ProductsHeader categoryName=\u0026#34;All Products\u0026#34; count={products.length} /\u0026gt; {/* ç°æœ‰å®¢æˆ·ç«¯ç»„ä»¶ */} \u0026lt;ExistingClientProductList products={products} /\u0026gt; \u0026lt;/\u0026gt; ); } // ç¬¬ä¸‰é˜¶æ®µï¼šè¿›ä¸€æ­¥é‡æ„ export default async function ProductsPage() { const products = await getProducts(); const categories = await getCategories(); return ( \u0026lt;\u0026gt; \u0026lt;ProductsHeader categoryName=\u0026#34;All Products\u0026#34; count={products.length} /\u0026gt; \u0026lt;div className=\u0026#34;products-layout\u0026#34;\u0026gt; {/* è½¬æ¢ä¸ºæœåŠ¡å™¨ç»„ä»¶ */} \u0026lt;CategoriesSidebar categories={categories} /\u0026gt; \u0026lt;div className=\u0026#34;products-content\u0026#34;\u0026gt; {/* é™æ€éƒ¨åˆ†å˜ä¸ºæœåŠ¡å™¨ç»„ä»¶ */} \u0026lt;ProductGrid products={products} /\u0026gt; {/* ä¿ç•™äº¤äº’éƒ¨åˆ†ä¸ºå®¢æˆ·ç«¯ */} \u0026lt;ClientPagination totalItems={products.length} itemsPerPage={24} /\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/\u0026gt; ); } 2. ä¿æŒä»£ç åº“ç»„ç»‡ éšç€ç»„ä»¶åˆ’åˆ†å˜å¾—æ›´å¤æ‚ï¼Œä»£ç ç»„ç»‡å˜å¾—æ›´åŠ é‡è¦ï¼š\nsrc/ â”œâ”€â”€ components/ â”‚ â”œâ”€â”€ global/ # è·¨é¡µé¢ç»„ä»¶ â”‚ â”‚ â”œâ”€â”€ Navigation/ â”‚ â”‚ â”‚ â”œâ”€â”€ index.js # æœåŠ¡å™¨ç»„ä»¶å…¥å£ â”‚ â”‚ â”‚ â”œâ”€â”€ MobileMenu.client.js # å®¢æˆ·ç«¯äº¤äº’ç»„ä»¶ â”‚ â”‚ â”‚ â””â”€â”€ NavItem.js # æœåŠ¡å™¨ç»„ä»¶ â”‚ â”‚ â”‚ â”œâ”€â”€ products/ # äº§å“ç›¸å…³ç»„ä»¶ â”‚ â”‚ â”œâ”€â”€ Card/ â”‚ â”‚ â”‚ â”œâ”€â”€ index.js # æœåŠ¡å™¨ç»„ä»¶åŒ…è£…å™¨ â”‚ â”‚ â”‚ â”œâ”€â”€ CardContent.js # æœåŠ¡å™¨ç»„ä»¶ â”‚ â”‚ â”‚ â”œâ”€â”€ AddToCart.client.js # å®¢æˆ·ç«¯ç»„ä»¶ â”‚ â”‚ â”‚ â””â”€â”€ utils.js # æœåŠ¡å™¨+å®¢æˆ·ç«¯å…±äº«å·¥å…· â”‚ â”‚ â”‚ â””â”€â”€ ui/ # é€šç”¨UIç»„ä»¶ â”‚ â”œâ”€â”€ Button/ â”‚ â”œâ”€â”€ Card/ â”‚ â””â”€â”€ Modal.client.js # æ˜ç¡®æ ‡è®°å®¢æˆ·ç«¯ç»„ä»¶ â”‚ â”œâ”€â”€ lib/ # é€šç”¨å·¥å…·åº“ â”‚ â”œâ”€â”€ server/ # ä»…æœåŠ¡å™¨å·¥å…· â”‚ â”‚ â”œâ”€â”€ db.js # æ•°æ®åº“å®¢æˆ·ç«¯ â”‚ â”‚ â””â”€â”€ auth.js # è®¤è¯å·¥å…· â”‚ â”œâ”€â”€ client/ # ä»…å®¢æˆ·ç«¯å·¥å…· â”‚ â”‚ â””â”€â”€ analytics.js # åˆ†æå·¥å…· â”‚ â””â”€â”€ shared/ # å…±äº«å·¥å…· â”‚ â””â”€â”€ formatting.js # æ—¥æœŸ/è´§å¸æ ¼å¼åŒ– â”‚ â”œâ”€â”€ app/ # è·¯ç”±å’Œé¡µé¢ â””â”€â”€ actions/ # æœåŠ¡å™¨æ“ä½œ 3. æ€§èƒ½é¢„ç®—ä¸åˆ†æ æˆ‘ä»¬å»ºç«‹äº†ä¸¥æ ¼çš„æ€§èƒ½é¢„ç®—ï¼Œå¹¶ä½¿ç”¨å·¥å…·ç¡®ä¿ç¬¦åˆè¦æ±‚ï¼š\n// æ€§èƒ½æµ‹é‡ç»„ä»¶ - ä»…å¼€å‘ç¯å¢ƒ function withPerformanceTracking(Component, options = {}) { const { name = Component.name, budget = { js: 50, lcp: 2.5 } } = options; if (process.env.NODE_ENV !== \u0026#34;development\u0026#34;) { return Component; } return function PerformanceTrackedComponent(props) { useEffect(() =\u0026gt; { // æµ‹é‡JSå¤§å° const scriptElements = document.querySelectorAll(\u0026#34;script[src]\u0026#34;); let totalJSSize = 0; Promise.all( Array.from(scriptElements).map(async (script) =\u0026gt; { try { const response = await fetch(script.src); const text = await response.text(); return text.length / 1024; // KB } catch (e) { return 0; } }) ).then((sizes) =\u0026gt; { totalJSSize = sizes.reduce((sum, size) =\u0026gt; sum + size, 0); if (totalJSSize \u0026gt; budget.js) { console.warn( `Performance budget exceeded: ${name} loads ${totalJSSize.toFixed( 2 )}KB JS ` + `(budget: ${budget.js}KB)` ); } else { console.log( `Performance budget OK: ${name} loads ${totalJSSize.toFixed( 2 )}KB JS ` + `(budget: ${budget.js}KB)` ); } }); // æµ‹é‡LCP new PerformanceObserver((entryList) =\u0026gt; { for (const entry of entryList.getEntries()) { const lcpTime = entry.startTime / 1000; if (lcpTime \u0026gt; budget.lcp) { console.warn( `LCP budget exceeded: ${name} LCP is ${lcpTime.toFixed(2)}s ` + `(budget: ${budget.lcp}s)` ); } else { console.log( `LCP budget OK: ${name} LCP is ${lcpTime.toFixed(2)}s ` + `(budget: ${budget.lcp}s)` ); } } }).observe({ type: \u0026#34;largest-contentful-paint\u0026#34;, buffered: true }); }, []); return \u0026lt;Component {...props} /\u0026gt;; }; } // ä½¿ç”¨ç¤ºä¾‹ const ProductPageWithTracking = withPerformanceTracking(ProductPage, { name: \u0026#34;ProductPage\u0026#34;, budget: { js: 100, lcp: 1.8 }, }); å±•æœ›æœªæ¥ éšç€ React æœåŠ¡å™¨ç»„ä»¶çš„æˆç†Ÿï¼Œæˆ‘é¢„è§æœªæ¥å‡ å¹´ä¼šæœ‰å‡ ä¸ªå‘å±•æ–¹å‘ï¼š\næ›´ç»†ç²’åº¦çš„æ°´åˆæ§åˆ¶ï¼šç›®å‰æ•´ä¸ªå®¢æˆ·ç«¯ç»„ä»¶æ ‘éƒ½ä¼šä¸€èµ·æ°´åˆï¼Œæœªæ¥å¯èƒ½æ”¯æŒéƒ¨åˆ†æ°´åˆ\næœåŠ¡å™¨ç»„ä»¶ä¸ Edge è¿è¡Œæ—¶ï¼šåœ¨è¾¹ç¼˜ç½‘ç»œè¿è¡Œï¼Œè¿›ä¸€æ­¥å‡å°‘å»¶è¿Ÿ\næ¸è¿›å¢å¼ºçš„è¡¨å•ï¼šå®¢æˆ·ç«¯ JS å¤±è´¥æ—¶è¡¨å•ä»èƒ½å·¥ä½œçš„ä¼˜é›…é™çº§æ–¹æ¡ˆ\næµå¼æ•°æ®æ›´æ–°ï¼šæœåŠ¡å™¨ç»„ä»¶ä¸ WebSocket æˆ– SSE ç»“åˆï¼Œå®ç°å®æ—¶æ›´æ–°\næˆ‘ä»¬å·²ç»åœ¨å®éªŒä¸€äº›è¿™æ ·çš„æ¦‚å¿µï¼š\n// å®éªŒæ€§ï¼šè¾¹ç¼˜è¿è¡Œçš„æœåŠ¡å™¨ç»„ä»¶ export const runtime = \u0026#39;edge\u0026#39;; export default async function NearestStoreLocator({ userLocation }) { // åœ¨è¾¹ç¼˜ç½‘ç»œæ‰§è¡Œï¼Œå‡å°‘å»¶è¿Ÿ const nearbyStores = await getNearestStores(userLocation); return ( \u0026lt;div className=\u0026#34;store-locator\u0026#34;\u0026gt; \u0026lt;h2\u0026gt;Stores Near You\u0026lt;/h2\u0026gt; \u0026lt;StoreList stores={nearbyStores} /\u0026gt; \u0026lt;/div\u0026gt; ); } // å®éªŒæ€§ï¼šæµå¼å®æ—¶æ›´æ–° // å®æ—¶æ•°æ®ç»„ä»¶ export default function StockTicker({ symbol }) { return ( \u0026lt;div className=\u0026#34;stock-ticker\u0026#34;\u0026gt; \u0026lt;h3\u0026gt;{symbol}\u0026lt;/h3\u0026gt; \u0026lt;Suspense fallback={\u0026lt;LoadingPrice /\u0026gt;}\u0026gt; \u0026lt;StreamingStockPrice symbol={symbol} /\u0026gt; \u0026lt;/Suspense\u0026gt; \u0026lt;/div\u0026gt; ); } // æµå¼æ›´æ–°ç»„ä»¶ async function StreamingStockPrice({ symbol }) { const initialPrice = await getStockPrice(symbol); return ( \u0026lt;StockPriceClient symbol={symbol} initialPrice={initialPrice} streamUrl={`/api/stocks/stream?symbol=${symbol}`} /\u0026gt; ); } // å®¢æˆ·ç«¯æµå¼ç»„ä»¶ \u0026#39;use client\u0026#39;; import { useState, useEffect } from \u0026#39;react\u0026#39;; function StockPriceClient({ symbol, initialPrice, streamUrl }) { const [price, setPrice] = useState(initialPrice); const [trend, setTrend] = useState(\u0026#39;neutral\u0026#39;); useEffect(() =\u0026gt; { const evtSource = new EventSource(streamUrl); evtSource.onmessage = (event) =\u0026gt; { const newPrice = JSON.parse(event.data).price; setTrend(newPrice \u0026gt; price ? \u0026#39;up\u0026#39; : newPrice \u0026lt; price ? \u0026#39;down\u0026#39; : \u0026#39;neutral\u0026#39;); setPrice(newPrice); }; return () =\u0026gt; evtSource.close(); }, [streamUrl, price]); return ( \u0026lt;div className={`price-display ${trend}`}\u0026gt; ${price.toFixed(2)} \u0026lt;/div\u0026gt; ); } ç»“è¯­ ä»æºç ç ”ç©¶åˆ°å®æˆ˜åº”ç”¨ï¼ŒæœåŠ¡å™¨ç»„ä»¶ç»™æˆ‘ç•™ä¸‹äº†æ·±åˆ»å°è±¡ã€‚å®ƒä¸ä»…æ˜¯ä¸€ç§æ–°æŠ€æœ¯ï¼Œæ›´æ˜¯ä¸€ç§æ€ç»´æ–¹å¼çš„è½¬å˜â€”â€”é‡æ–°æ€è€ƒå‰ç«¯ä¸åç«¯çš„è¾¹ç•Œï¼ŒæŒ‘æˆ˜\u0026quot;æ‰€æœ‰é€»è¾‘éƒ½åº”è¯¥åœ¨å®¢æˆ·ç«¯\u0026quot;çš„ä¼ ç»Ÿè§‚å¿µã€‚\nå½“ç„¶ï¼ŒæœåŠ¡å™¨ç»„ä»¶ä¸æ˜¯ä¸‡èƒ½çš„ã€‚åœ¨æˆ‘ä»¬çš„é¡¹ç›®ä¸­ï¼Œé«˜åº¦äº¤äº’çš„ç®¡ç†ç•Œé¢ä»ç„¶ä¸»è¦ä½¿ç”¨å®¢æˆ·ç«¯ç»„ä»¶ã€‚å…³é”®æ˜¯æ‰¾åˆ°åˆé€‚çš„å¹³è¡¡ç‚¹ï¼Œè®©é™æ€å†…å®¹ç•™åœ¨æœåŠ¡å™¨ï¼Œè®©äº¤äº’ä½“éªŒç•™åœ¨å®¢æˆ·ç«¯ã€‚\nå¦‚æœä½ è¿˜æ²¡å°è¯•è¿‡æœåŠ¡å™¨ç»„ä»¶ï¼Œå¼ºçƒˆå»ºè®®åœ¨ä¸‹ä¸€ä¸ªé¡¹ç›®ä¸­æ¢ç´¢ã€‚å³ä½¿åªæ˜¯å°†å‡ ä¸ªå…³é”®é¡µé¢è½¬æ¢ä¸ºæœåŠ¡å™¨ç»„ä»¶ï¼Œä¹Ÿèƒ½å¸¦æ¥æ˜¾è‘—çš„æ€§èƒ½æå‡å’Œå¼€å‘ä½“éªŒæ”¹å–„ã€‚\nä¸‹æ¬¡æˆ‘è®¡åˆ’æ·±å…¥åˆ†æ React çš„æ–°ä¸€ä»£ç¼–è¯‘ç­–ç•¥ï¼Œæ•¬è¯·å…³æ³¨ï¼\n","permalink":"https://www.yss520.online/zh/posts/react-server-render/","summary":"\u003ch1 id=\"react-æœåŠ¡å™¨ç»„ä»¶é‡æ–°æ€è€ƒå‰ç«¯ä¸åç«¯çš„è¾¹ç•Œ\"\u003eReact æœåŠ¡å™¨ç»„ä»¶ï¼šé‡æ–°æ€è€ƒå‰ç«¯ä¸åç«¯çš„è¾¹ç•Œ\u003c/h1\u003e\n\u003cp\u003eä¸¤å‘¨å‰åˆšä¸Šçº¿äº†æˆ‘ä»¬å›¢é˜ŸèŠ±äº† 3 ä¸ªæœˆé‡æ„çš„ç”µå•†å¹³å°ï¼Œè¿™æ¬¡æœ€å¤§çš„æŠ€æœ¯æŒ‘æˆ˜æ˜¯å…¨é¢é‡‡ç”¨äº† React æœåŠ¡å™¨ç»„ä»¶ï¼ˆServer Componentsï¼‰ã€‚è¿™ä¸ªå†³å®šç¡®å®å¸¦æ¥äº†ä¸å°‘æŒ‘æˆ˜ï¼Œä½†æ•ˆæœä»¤äººæƒŠå–œï¼šé¦–å±åŠ è½½æ—¶é—´å‡å°‘äº† 62%ï¼ŒJS åŒ…ä½“ç§¯å‡å°‘äº† 41%ï¼Œè€Œä¸”å¼€å‘ä½“éªŒå‡ºä¹æ„æ–™åœ°å¥½ã€‚ä»Šå¤©æƒ³åˆ†äº«ä¸€ä¸‹æˆ‘ä»¬å¯¹æœåŠ¡å™¨ç»„ä»¶çš„æ¢ç´¢å†ç¨‹å’Œå®æˆ˜ç»éªŒã€‚\u003c/p\u003e\n\u003ch2 id=\"æœåŠ¡å™¨ç»„ä»¶ä¸åªæ˜¯å¦ä¸€ç§-ssr\"\u003eæœåŠ¡å™¨ç»„ä»¶ï¼šä¸åªæ˜¯å¦ä¸€ç§ SSR\u003c/h2\u003e\n\u003cp\u003eç¬¬ä¸€æ¬¡å¬è¯´æœåŠ¡å™¨ç»„ä»¶æ—¶ï¼Œæˆ‘çš„ååº”æ˜¯\u0026quot;è¿™ä¸å°±æ˜¯ SSR æ¢äº†ä¸ªåå­—å—ï¼Ÿ\u0026ldquo;é€šè¿‡æ·±å…¥ç ”ç©¶æºç å’Œå®è·µï¼Œæˆ‘å‘ç°è¿™æ˜¯ä¸ªæ ¹æœ¬æ€§çš„è¯¯è§£ã€‚\u003c/p\u003e\n\u003cp\u003eæœåŠ¡å™¨ç»„ä»¶ï¼ˆRSCï¼‰ä¸ä¼ ç»ŸæœåŠ¡ç«¯æ¸²æŸ“ï¼ˆSSRï¼‰çš„åŒºåˆ«ï¼Œæ¯”æƒ³è±¡ä¸­å¤§å¾—å¤šï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-javascript\" data-lang=\"javascript\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e// ä¼ ç»ŸSSRï¼šæ•´ä¸ªç»„ä»¶æ ‘åœ¨æœåŠ¡å™¨æ¸²æŸ“åï¼Œå‘é€å®Œæ•´HTMLåˆ°å®¢æˆ·ç«¯ï¼Œç„¶åhydrate\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e// å®¢æˆ·ç«¯éœ€è¦ä¸‹è½½æ•´ä¸ªç»„ä»¶çš„JSä»£ç æ‰èƒ½è¿›è¡Œäº¤äº’\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e// æœåŠ¡å™¨ç»„ä»¶ï¼šåªåœ¨æœåŠ¡å™¨ä¸Šè¿è¡Œï¼Œä¸å‘é€ç»„ä»¶ä»£ç åˆ°å®¢æˆ·ç«¯\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e// ğŸ‘‡ è¿™ä¸ªç»„ä»¶çš„ä»£ç æ°¸è¿œä¸ä¼šå‘é€åˆ°å®¢æˆ·ç«¯\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;use server\u0026#34;\u003c/span\u003e;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003easync\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003efunction\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eProductDetails\u003c/span\u003e({ \u003cspan style=\"color:#a6e22e\"\u003eid\u003c/span\u003e }) {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#75715e\"\u003e// ç›´æ¥è®¿é—®æœåŠ¡å™¨èµ„æº(æ•°æ®åº“ã€æ–‡ä»¶ç³»ç»Ÿç­‰)\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e  \u003cspan style=\"color:#66d9ef\"\u003econst\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eproduct\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003eawait\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003edb\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003eproducts\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003efindById\u003c/span\u003e(\u003cspan style=\"color:#a6e22e\"\u003eid\u003c/span\u003e);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#66d9ef\"\u003econst\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003erelatedProducts\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003eawait\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003edb\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003eproducts\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003efindRelated\u003c/span\u003e(\u003cspan style=\"color:#a6e22e\"\u003eid\u003c/span\u003e);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#66d9ef\"\u003ereturn\u003c/span\u003e (\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003e\u0026lt;\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003ediv\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#f92672\"\u003e\u0026lt;\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003eh1\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e\u0026gt;\u003c/span\u003e{\u003cspan style=\"color:#a6e22e\"\u003eproduct\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003ename\u003c/span\u003e}\u003cspan style=\"color:#f92672\"\u003e\u0026lt;\u003c/span\u003e\u003cspan style=\"color:#960050;background-color:#1e0010\"\u003e/h1\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#f92672\"\u003e\u0026lt;\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003ep\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e\u0026gt;\u003c/span\u003e{\u003cspan style=\"color:#a6e22e\"\u003eproduct\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003edescription\u003c/span\u003e}\u003cspan style=\"color:#f92672\"\u003e\u0026lt;\u003c/span\u003e\u003cspan style=\"color:#960050;background-color:#1e0010\"\u003e/p\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#f92672\"\u003e\u0026lt;\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003eprice\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e\u0026gt;\u003c/span\u003e{\u003cspan style=\"color:#a6e22e\"\u003eformatCurrency\u003c/span\u003e(\u003cspan style=\"color:#a6e22e\"\u003eproduct\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003eprice\u003c/span\u003e)}\u003cspan style=\"color:#f92672\"\u003e\u0026lt;\u003c/span\u003e\u003cspan style=\"color:#960050;background-color:#1e0010\"\u003e/price\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      {\u003cspan style=\"color:#75715e\"\u003e/* å¯ä»¥åœ¨æœåŠ¡å™¨ä¸Šæ¸²æŸ“å®¢æˆ·ç«¯ç»„ä»¶ */\u003c/span\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#f92672\"\u003e\u0026lt;\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003eAddToCartButton\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eproductId\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e{\u003cspan style=\"color:#a6e22e\"\u003eid\u003c/span\u003e} \u003cspan style=\"color:#f92672\"\u003e/\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      {\u003cspan style=\"color:#75715e\"\u003e/* å¯ä»¥å¼•ç”¨å…¶ä»–æœåŠ¡å™¨ç»„ä»¶ */\u003c/span\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#f92672\"\u003e\u0026lt;\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003eRelatedProducts\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eproducts\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e{\u003cspan style=\"color:#a6e22e\"\u003erelatedProducts\u003c/span\u003e} \u003cspan style=\"color:#f92672\"\u003e/\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003e\u0026lt;\u003c/span\u003e\u003cspan style=\"color:#960050;background-color:#1e0010\"\u003e/div\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  );\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eç¿»å¼€ React æºç ï¼Œå¯ä»¥çœ‹åˆ°æœåŠ¡å™¨ç»„ä»¶çš„æœ¬è´¨æ˜¯ä¸€ç§æ–°çš„ç»„ä»¶æ¨¡å‹ï¼Œå®ƒåˆ›å»ºäº†ä¸€ä¸ªè·¨æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯çš„æ¸²æŸ“è¾¹ç•Œï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-javascript\" data-lang=\"javascript\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e// Reactå†…éƒ¨å¯¹æœåŠ¡å™¨ç»„ä»¶çš„å¤„ç†ï¼ˆç®€åŒ–ç‰ˆï¼‰\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003efunction\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eprocessServerComponent\u003c/span\u003e(\u003cspan style=\"color:#a6e22e\"\u003eelement\u003c/span\u003e, \u003cspan style=\"color:#a6e22e\"\u003erequest\u003c/span\u003e) {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#66d9ef\"\u003econst\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eComponent\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eelement\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003etype\u003c/span\u003e;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#66d9ef\"\u003econst\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eprops\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eelement\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003eprops\u003c/span\u003e;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#75715e\"\u003e// è°ƒç”¨ç»„ä»¶å‡½æ•°è·å–ç»“æœ\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e  \u003cspan style=\"color:#66d9ef\"\u003econst\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eresult\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eComponent\u003c/span\u003e(\u003cspan style=\"color:#a6e22e\"\u003eprops\u003c/span\u003e);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#75715e\"\u003e// å¦‚æœç»“æœæ˜¯Promiseï¼ˆå¼‚æ­¥ç»„ä»¶ï¼‰ï¼Œåˆ™ç­‰å¾…å®ƒå®Œæˆ\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e  \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e (\u003cspan style=\"color:#a6e22e\"\u003eisPromise\u003c/span\u003e(\u003cspan style=\"color:#a6e22e\"\u003eresult\u003c/span\u003e)) {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003ereturn\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eresult\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003ethen\u003c/span\u003e((\u003cspan style=\"color:#a6e22e\"\u003eresolved\u003c/span\u003e) =\u0026gt; {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#66d9ef\"\u003ereturn\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eserializeResult\u003c/span\u003e(\u003cspan style=\"color:#a6e22e\"\u003eresolved\u003c/span\u003e, \u003cspan style=\"color:#a6e22e\"\u003erequest\u003c/span\u003e);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    });\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  }\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#75715e\"\u003e// åºåˆ—åŒ–ç»“æœï¼ŒåŒ…æ‹¬å°†å®¢æˆ·ç«¯ç»„ä»¶æ›¿æ¢ä¸ºå¼•ç”¨\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e  \u003cspan style=\"color:#66d9ef\"\u003ereturn\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eserializeResult\u003c/span\u003e(\u003cspan style=\"color:#a6e22e\"\u003eresult\u003c/span\u003e, \u003cspan style=\"color:#a6e22e\"\u003erequest\u003c/span\u003e);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003efunction\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eserializeResult\u003c/span\u003e(\u003cspan style=\"color:#a6e22e\"\u003enode\u003c/span\u003e, \u003cspan style=\"color:#a6e22e\"\u003erequest\u003c/span\u003e) {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#75715e\"\u003e// å¦‚æœæ˜¯å®¢æˆ·ç«¯ç»„ä»¶ï¼Œæ›¿æ¢ä¸ºå¯¹è¯¥ç»„ä»¶çš„å¼•ç”¨\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e  \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e (\u003cspan style=\"color:#a6e22e\"\u003eisClientComponent\u003c/span\u003e(\u003cspan style=\"color:#a6e22e\"\u003enode\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003etype\u003c/span\u003e)) {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003ereturn\u003c/span\u003e {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#a6e22e\"\u003e$$typeof\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e:\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eREACT_ELEMENT_TYPE\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#a6e22e\"\u003etype\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e:\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eCLIENT_REFERENCE\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#a6e22e\"\u003eprops\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e:\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eserializeProps\u003c/span\u003e(\u003cspan style=\"color:#a6e22e\"\u003enode\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003eprops\u003c/span\u003e, \u003cspan style=\"color:#a6e22e\"\u003erequest\u003c/span\u003e),\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    };\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  }\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#75715e\"\u003e// ç»§ç»­å¤„ç†å­èŠ‚ç‚¹\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e  \u003cspan style=\"color:#75715e\"\u003e// ...\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eè¿™æ®µä»£ç å±•ç¤ºäº† React å¦‚ä½•å¤„ç†æœåŠ¡å™¨ç»„ä»¶ï¼šå®ƒåœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œç»„ä»¶ï¼Œå¹¶å°†ç»“æœï¼ˆè€Œéç»„ä»¶ä»£ç ï¼‰åºåˆ—åŒ–åå‘é€ç»™å®¢æˆ·ç«¯ã€‚è¿™ä¸ä¼ ç»Ÿ SSR çš„\u0026quot;å…ˆåœ¨æœåŠ¡å™¨æ¸²æŸ“ HTMLï¼Œå†åœ¨å®¢æˆ·ç«¯é‡æ–°æ‰§è¡Œç»„ä»¶ä»£ç \u0026quot;å®Œå…¨ä¸åŒã€‚\u003c/p\u003e","title":"ReactæœåŠ¡ç«¯æ¸²æŸ“å®æˆ˜æŒ‡å—"},{"content":"React å¹¶å‘æ¨¡å¼æ­ç§˜ï¼šä»æºç çœ‹æ¶æ„æ¼”è¿› ä¸Šå‘¨æ”¶åˆ°ä¸€ä¸ªæ£˜æ‰‹ä»»åŠ¡ï¼šä¼˜åŒ–æˆ‘ä»¬çš„åå°ç³»ç»Ÿåœ¨ä½ç«¯è®¾å¤‡ä¸Šçš„æ€§èƒ½ã€‚è¡¨æ ¼æ¸²æŸ“ã€ç­›é€‰ã€åŠ¨ç”»ï¼Œä¸€ç³»åˆ—æ“ä½œè®©è€æ—§è®¾å¤‡å¡åˆ°å´©æºƒã€‚æ­£å¥½å€Ÿæ­¤æœºä¼šï¼Œæˆ‘æ·±å…¥ç ”ç©¶äº† React 18 çš„å¹¶å‘æ¸²æŸ“æœºåˆ¶ï¼Œå‘ç°è¿™ç¡®å®æ˜¯æŠŠè§£å†³æ€§èƒ½é—®é¢˜çš„åˆ©å™¨ã€‚\nå¹¶å‘æ¨¡å¼ï¼šReact æ¶æ„çš„é‡å¤§è½¬å˜ React çš„å¹¶å‘æ¨¡å¼å¯èƒ½æ˜¯è‡ª Hooks ä»¥æ¥æœ€é‡å¤§çš„æ¶æ„å˜é©ã€‚æœ¬è´¨ä¸Šï¼Œè¿™æ˜¯ä¸€ç§æ–°çš„æ¸²æŸ“æ¨¡å¼ï¼Œå…è®¸ Reactä¸­æ–­ã€æš‚åœå’Œæ¢å¤æ¸²æŸ“å·¥ä½œã€‚è¿™å¬èµ·æ¥å¾ˆç®€å•ï¼Œä½†å®ç°èµ·æ¥æå…¶å¤æ‚ï¼Œè¿™ä¹Ÿè§£é‡Šäº†ä¸ºä»€ä¹ˆ React å›¢é˜ŸèŠ±äº†è¿‘ 5 å¹´æ—¶é—´æ‰å°†å…¶æ­£å¼å‘å¸ƒã€‚\nç¿»å¼€æºç ï¼Œç¬¬ä¸€ä¸ªå…³é”®æ¦‚å¿µæ˜¯ä¼˜å…ˆçº§è°ƒåº¦ï¼š\n// ç®€åŒ–ç‰ˆçš„ä»»åŠ¡ä¼˜å…ˆçº§å®šä¹‰ export const DiscreteEventPriority = SyncLane; // æœ€é«˜ä¼˜å…ˆçº§ï¼Œå¦‚ç‚¹å‡» export const ContinuousEventPriority = InputContinuousLane; // è¿ç»­äº‹ä»¶ï¼Œå¦‚æ‹–æ‹½ export const DefaultEventPriority = DefaultLane; // é»˜è®¤ä¼˜å…ˆçº§ export const IdleEventPriority = IdleLane; // ç©ºé—²ä¼˜å…ˆçº§ è¿™äº›ä¼˜å…ˆçº§å¸¸é‡ä¸ä»…ä»…æ˜¯æ•°å­—ï¼Œå®ƒä»¬åœ¨ React å†…éƒ¨ä½¿ç”¨äº†ä¸€ç§ç§°ä¸º\u0026quot;Lanes\u0026quot;çš„ä½å­—æ®µè¡¨ç¤ºæ³•ï¼Œè¿™ä½¿å¾— React å¯ä»¥é«˜æ•ˆåœ°å¤„ç†å’Œæ¯”è¾ƒå¤šä¸ªä¼˜å…ˆçº§ã€‚\n// Lanesçš„å®ç°ï¼ˆç®€åŒ–ç‰ˆï¼‰ export const TotalLanes = 31; // å°†å¤šä¸ªlaneåˆå¹¶ export function mergeLanes(a, b) { return a | b; } // æ£€æŸ¥lanesä¸­æ˜¯å¦åŒ…å«ç‰¹å®šlane export function includesSomeLane(a, b) { return (a \u0026amp; b) !== NoLanes; } è¿™ç§ä½è¿ç®—å®ç°æ—¢é«˜æ•ˆåˆå·§å¦™ï¼Œè®© React èƒ½å¤Ÿç”¨å•ä¸ª 32 ä½æ•´æ•°è¡¨ç¤ºå’Œå¤„ç†å¤šä¸ªä¼˜å…ˆçº§ï¼Œé¿å…äº†å¤æ‚æ•°æ®ç»“æ„å¸¦æ¥çš„æ€§èƒ½å¼€é”€ã€‚\nä¸­æ–­ä¸æ¢å¤ï¼šæ¸²æŸ“çš„æ–°èŒƒå¼ å¹¶å‘æ¨¡å¼æœ€æ ¸å¿ƒçš„èƒ½åŠ›æ˜¯\u0026quot;ä¸­æ–­ä¸æ¢å¤\u0026quot;ã€‚åœ¨æ—§ç‰ˆ React ä¸­ï¼Œä¸€æ—¦å¼€å§‹æ¸²æŸ“å°±å¿…é¡»å®Œæˆï¼Œè¿™åœ¨å¤§å‹åº”ç”¨ä¸­å¯èƒ½å¯¼è‡´æ˜æ˜¾çš„å¡é¡¿ã€‚\nåœ¨ React 18 ä¸­ï¼Œæ¸²æŸ“é€»è¾‘è¢«é‡æ„ä¸º\u0026quot;workLoop\u0026quot;ï¼š\nfunction workLoopConcurrent() { // æ‰§è¡Œå·¥ä½œï¼Œç›´åˆ°æ²¡æœ‰æ›´å¤šæ—¶é—´æˆ–å·¥ä½œå®Œæˆ while (workInProgress !== null \u0026amp;\u0026amp; !shouldYield()) { performUnitOfWork(workInProgress); } } function shouldYield() { // æ£€æŸ¥æ˜¯å¦éœ€è¦è®©å‡ºæ§åˆ¶æƒç»™æµè§ˆå™¨ return ( // æ£€æŸ¥æ˜¯å¦æœ‰æ›´é«˜ä¼˜å…ˆçº§çš„å·¥ä½œ currentEventTransitionLane !== NoLane \u0026amp;\u0026amp; // æ˜¯å¦å·²ç»ç”¨å®Œåˆ†é…çš„æ—¶é—´ç‰‡ scheduler.unstable_shouldYield() ); } è¿™æ®µä»£ç å±•ç¤ºäº† React æ˜¯å¦‚ä½•å®ç°\u0026quot;å¯ä¸­æ–­æ¸²æŸ“\u0026quot;çš„ï¼šåœ¨workLoopConcurrentä¸­ï¼ŒReact ä¼šä¸æ–­æ£€æŸ¥shouldYield()ï¼Œå¦‚æœéœ€è¦è®©å‡ºæ§åˆ¶æƒï¼ˆæ¯”å¦‚æœ‰æ›´é«˜ä¼˜å…ˆçº§ä»»åŠ¡æˆ–æ—¶é—´ç‰‡ç”¨å®Œï¼‰ï¼Œå®ƒä¼šæš‚åœå½“å‰å·¥ä½œï¼Œå¹¶åœ¨ç¨åæ¢å¤ã€‚\nåœ¨ä¸€ä¸ªå†…å®¹ç®¡ç†ç³»ç»Ÿé¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬åˆ©ç”¨è¿™ä¸ªæœºåˆ¶æå¤§æ”¹å–„äº†ç¼–è¾‘ä½“éªŒï¼š\nfunction DocumentEditor() { const [isPending, startTransition] = useTransition(); const [content, setContent] = useState(initialContent); const [searchResults, setSearchResults] = useState([]); // å½“ç”¨æˆ·è¾“å…¥æ—¶ï¼Œæˆ‘ä»¬å¸Œæœ›UIä¿æŒå“åº” function handleContentChange(newContent) { // ç«‹å³æ›´æ–°å†…å®¹ï¼Œä¿è¯è¾“å…¥æµç•… setContent(newContent); // å°†æœç´¢æ“ä½œæ ‡è®°ä¸ºä½ä¼˜å…ˆçº§è¿‡æ¸¡ startTransition(() =\u0026gt; { // è¿™ä¸ªå¤æ‚è®¡ç®—ä¼šåœ¨åå°è¿›è¡Œï¼Œä¸ä¼šé˜»å¡ç”¨æˆ·è¾“å…¥ setSearchResults(findAllMatches(newContent)); }); } return ( \u0026lt;div\u0026gt; \u0026lt;TextEditor content={content} onChange={handleContentChange} /\u0026gt; {isPending ? ( \u0026lt;LoadingIndicator /\u0026gt; ) : ( \u0026lt;SearchResultsPanel results={searchResults} /\u0026gt; )} \u0026lt;/div\u0026gt; ); } æ•ˆæœéå¸¸æ˜æ˜¾ï¼šå³ä½¿åœ¨å¤„ç†å¤§å‹æ–‡æ¡£æ—¶ï¼Œè¾“å…¥ååº”ä¹Ÿä¿æŒæµç•…ï¼Œæœç´¢ç»“æœä¼šåœ¨åå°è®¡ç®—å®Œæˆåå†æ˜¾ç¤ºï¼Œç”¨æˆ·ä½“éªŒå¤§å¹…æå‡ã€‚\næ·±å…¥ Fiberï¼šå¹¶å‘æ¨¡å¼çš„éª¨æ¶ å¹¶å‘æ¨¡å¼çš„å®ç°ä¾èµ–äº React çš„ Fiber æ¶æ„ã€‚Fiber æœ¬è´¨ä¸Šæ˜¯ä¸€ç§é“¾è¡¨ç»“æ„ï¼Œä¸“ä¸ºå¢é‡æ¸²æŸ“è®¾è®¡ï¼š\n// FiberèŠ‚ç‚¹ç»“æ„ï¼ˆç®€åŒ–ï¼‰ function FiberNode(tag, pendingProps, key, mode) { // å®ä¾‹ç›¸å…³ this.tag = tag; this.key = key; this.elementType = null; this.type = null; this.stateNode = null; // Fiberé“¾æ¥ç»“æ„ this.return = null; this.child = null; this.sibling = null; this.index = 0; // å·¥ä½œç›¸å…³ this.pendingProps = pendingProps; this.memoizedProps = null; this.memoizedState = null; this.dependencies = null; // å‰¯ä½œç”¨ this.flags = NoFlags; this.subtreeFlags = NoFlags; this.deletions = null; // è°ƒåº¦ç›¸å…³ this.lanes = NoLanes; this.childLanes = NoLanes; // æ›¿ä»£æ ‘ this.alternate = null; } åœ¨å¹¶å‘æ¨¡å¼ä¸‹ï¼ŒReact ç»´æŠ¤ä¸¤æ£µ Fiber æ ‘ï¼šå½“å‰æ ‘ï¼ˆcurrentï¼‰å’Œå·¥ä½œæ ‘ï¼ˆworkInProgressï¼‰ã€‚å½“ React æ¸²æŸ“æ—¶ï¼Œå®ƒåœ¨ workInProgress æ ‘ä¸Šå·¥ä½œï¼Œè¿™æ ·å³ä½¿æ¸²æŸ“è¢«ä¸­æ–­ï¼Œç”¨æˆ·ä»ç„¶èƒ½çœ‹åˆ°å®Œæ•´çš„ UIã€‚\nè¿™ç§\u0026quot;åŒç¼“å†²\u0026quot;æŠ€æœ¯åœ¨æºç ä¸­è¿™æ ·å®ç°ï¼š\nfunction createWorkInProgress(current, pendingProps) { let workInProgress = current.alternate; if (workInProgress === null) { // å¦‚æœæ›¿ä»£æ ‘ä¸å­˜åœ¨ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„ workInProgress = createFiber( current.tag, pendingProps, current.key, current.mode ); workInProgress.elementType = current.elementType; workInProgress.type = current.type; workInProgress.stateNode = current.stateNode; // åŒå‘é“¾æ¥ workInProgress.alternate = current; current.alternate = workInProgress; } else { // æ›´æ–°å·²å­˜åœ¨çš„æ›¿ä»£æ ‘ workInProgress.pendingProps = pendingProps; workInProgress.type = current.type; // é‡ç½®å‰¯ä½œç”¨åˆ—è¡¨ workInProgress.flags = NoFlags; workInProgress.subtreeFlags = NoFlags; workInProgress.deletions = null; } // å¤åˆ¶ç›¸å…³å­—æ®µ workInProgress.child = current.child; workInProgress.memoizedProps = current.memoizedProps; workInProgress.memoizedState = current.memoizedState; // ...å…¶ä»–å­—æ®µ return workInProgress; } è¿™æ®µä»£ç å±•ç¤ºäº†\u0026quot;å·¥ä½œä¸­\u0026quot;æ ‘æ˜¯å¦‚ä½•åˆ›å»ºå’Œå¤ç”¨çš„ã€‚å½“ React å¯¹ç»„ä»¶æ ‘è¿›è¡Œæ¸²æŸ“æ—¶ï¼Œå®ƒå…ˆä»å½“å‰æ ‘å¤åˆ¶ä¸€ä¸ª workInProgress ç‰ˆæœ¬ï¼Œç„¶ååœ¨è¿™ä¸ªå‰¯æœ¬ä¸Šè¿›è¡Œä¿®æ”¹ï¼Œå®Œæˆåå†\u0026quot;åŸå­åœ°\u0026quot;åˆ‡æ¢å½“å‰æ ‘å¼•ç”¨ï¼Œè¿™å°±æ˜¯ React å®ç°å¯ä¸­æ–­æ¸²æŸ“è€Œä¸äº§ç”Ÿè§†è§‰ä¸ä¸€è‡´çš„å…³é”®ã€‚\nSuspense ä¸æ•°æ®è·å– å¹¶å‘æ¨¡å¼æœ€å¸å¼•äººçš„ç‰¹æ€§ä¹‹ä¸€æ˜¯ä¸ Suspense é›†æˆï¼Œå®ç°å£°æ˜å¼çš„æ•°æ®è·å–ã€‚é€šè¿‡æºç å¯ä»¥çœ‹åˆ° Suspense çš„å®ç°åŸç†ï¼š\n// æ£€æŸ¥å­æ ‘æ˜¯å¦è¢«æŒ‚èµ· function renderWithHooks( current, workInProgress, Component, props, context, renderLanes ) { // ... let children; try { // å°è¯•æ¸²æŸ“ç»„ä»¶ children = Component(props, context); } catch (error) { if ( typeof error === \u0026#34;object\u0026#34; \u0026amp;\u0026amp; error !== null \u0026amp;\u0026amp; typeof error.then === \u0026#34;function\u0026#34; ) { // æ•è·åˆ°Promiseï¼Œè¡¨ç¤ºç»„ä»¶è¢«æŒ‚èµ· const suspendedComponent = workInProgress.type; const suspenseHandlers = new Set(); // æ‰¾åˆ°æœ€è¿‘çš„Suspenseè¾¹ç•Œ let suspenseState = workInProgress.memoizedState; while (suspenseState === null \u0026amp;\u0026amp; workInProgress.return !== null) { workInProgress = workInProgress.return; suspenseState = workInProgress.memoizedState; if (workInProgress.tag === SuspenseComponent) { suspenseHandlers.add(workInProgress); } } // å°†PromiseæŠ›å‡ºï¼Œç”±Reactè°ƒåº¦å™¨å¤„ç† throw { $$typeof: Symbol.for(\u0026#34;react.memo\u0026#34;), type: \u0026#34;SuspenseList\u0026#34;, promise: error, suspendedComponentType: suspendedComponent, suspenseHandlers, }; } else { // çœŸæ­£çš„é”™è¯¯ï¼Œé‡æ–°æŠ›å‡º throw error; } } return children; } è¿™æ®µä»£ç æ­ç¤ºäº† Suspense çš„å·¥ä½œåŸç†ï¼šå½“ç»„ä»¶æŠ›å‡º Promise æ—¶ï¼ŒReact ä¼šæ•è·å®ƒï¼Œå¯»æ‰¾æœ€è¿‘çš„ Suspense è¾¹ç•Œï¼Œç„¶åæ˜¾ç¤º fallback å†…å®¹ï¼ŒåŒæ—¶è®°ä½è¿™ä¸ª Promiseã€‚å½“ Promise å®Œæˆåï¼ŒReact ä¼šé‡æ–°å°è¯•æ¸²æŸ“ç»„ä»¶ã€‚\nåœ¨ä¸€ä¸ªæ•°æ®å¯†é›†å‹åº”ç”¨ä¸­ï¼Œæˆ‘ä»¬åˆ©ç”¨è¿™ä¸€æœºåˆ¶å¤§å¹…ç®€åŒ–äº†åŠ è½½çŠ¶æ€ç®¡ç†ï¼š\n// ä½¿ç”¨React 18çš„Suspenseè¿›è¡Œæ•°æ®è·å– function ProductPage({ id }) { return ( \u0026lt;div\u0026gt; \u0026lt;Header /\u0026gt; \u0026lt;Suspense fallback={\u0026lt;Spinner /\u0026gt;}\u0026gt; \u0026lt;ProductDetails id={id} /\u0026gt; \u0026lt;/Suspense\u0026gt; \u0026lt;Suspense fallback={\u0026lt;Spinner /\u0026gt;}\u0026gt; \u0026lt;ProductReviews id={id} /\u0026gt; \u0026lt;RecommendedProducts id={id} /\u0026gt; \u0026lt;/Suspense\u0026gt; \u0026lt;/div\u0026gt; ); } // æ•°æ®è·å–ç»„ä»¶ function ProductDetails({ id }) { // è¿™ä¸ªè‡ªå®šä¹‰Hookä¼šåœ¨æ•°æ®æœªå‡†å¤‡å¥½æ—¶æŠ›å‡ºPromise const product = useProduct(id); return \u0026lt;div\u0026gt;{/* æ¸²æŸ“äº§å“è¯¦æƒ… */}\u0026lt;/div\u0026gt;; } è¿™ç§æ–¹å¼è®©æˆ‘ä»¬å¯ä»¥æ‘†è„±æ¡ä»¶æ¸²æŸ“çš„å¤æ‚é€»è¾‘ï¼Œä»£ç å˜å¾—æ›´åŠ å£°æ˜å¼å’Œå¯ç»´æŠ¤ã€‚\næ€§èƒ½ä¼˜åŒ–ï¼šè‡ªåŠ¨æ‰¹å¤„ç† æºç ä¸­å¦ä¸€ä¸ªå¼•äººæ³¨ç›®çš„å¹¶å‘ç‰¹æ€§æ˜¯è‡ªåŠ¨æ‰¹å¤„ç†ã€‚åœ¨ React 17 ä¸­ï¼Œåªæœ‰äº‹ä»¶å¤„ç†å‡½æ•°å†…éƒ¨çš„æ›´æ–°ä¼šè¢«è‡ªåŠ¨æ‰¹å¤„ç†ï¼›è€Œ React 18 æ‰©å±•äº†è¿™ä¸€æœºåˆ¶ï¼š\n// ç®€åŒ–çš„æ‰¹å¤„ç†å®ç° let isInsideEventHandler = false; let pendingUpdates = []; function batchedUpdates(fn) { const prevIsInsideEventHandler = isInsideEventHandler; isInsideEventHandler = true; try { return fn(); } finally { isInsideEventHandler = prevIsInsideEventHandler; if (!isInsideEventHandler) { flushPendingUpdates(); } } } function enqueueUpdate(fiber, lane) { if (isInsideEventHandler) { pendingUpdates.push({ fiber, lane }); } else { // ç«‹å³å¤„ç†æ›´æ–° scheduleUpdateOnFiber(fiber, lane); } } function flushPendingUpdates() { if (pendingUpdates.length \u0026gt; 0) { const uniqueUpdates = dedupeUpdates(pendingUpdates); pendingUpdates = []; for (let i = 0; i \u0026lt; uniqueUpdates.length; i++) { const { fiber, lane } = uniqueUpdates[i]; scheduleUpdateOnFiber(fiber, lane); } } } React 18 å°†è¿™ä¸€æœºåˆ¶æ‰©å±•åˆ°å‡ ä¹æ‰€æœ‰çš„æ›´æ–°åœºæ™¯ï¼š\nfunction App() { const [count, setCount] = useState(0); const [flag, setFlag] = useState(false); function handleClick() { // React 18è‡ªåŠ¨æ‰¹å¤„ç†è¿™ä¸¤ä¸ªæ›´æ–°ï¼Œåªè§¦å‘ä¸€æ¬¡é‡æ¸²æŸ“ setCount((c) =\u0026gt; c + 1); setFlag((f) =\u0026gt; !f); // å³ä½¿åœ¨å¼‚æ­¥å›è°ƒä¸­ï¼Œä¹Ÿä¼šè¢«æ‰¹å¤„ç†ï¼ Promise.resolve().then(() =\u0026gt; { setCount((c) =\u0026gt; c + 1); setFlag((f) =\u0026gt; !f); }); } console.log(\u0026#34;Render!\u0026#34;); // æ¯ç»„æ›´æ–°åªä¼šæ‰“å°ä¸€æ¬¡ return ( \u0026lt;button onClick={handleClick}\u0026gt; Count: {count}, Flag: {String(flag)} \u0026lt;/button\u0026gt; ); } åœ¨æˆ‘ä»¬çš„åº”ç”¨ä¸­ï¼Œå¯ç”¨ React 18 åï¼Œæ¸²æŸ“æ¬¡æ•°å‡å°‘äº†çº¦ 30%ï¼Œä»…ä»…å› ä¸ºæ›´æ–°è¢«æ›´æœ‰æ•ˆåœ°æ‰¹å¤„ç†äº†ã€‚\nuseDeferredValueï¼šå¹³æ»‘è¿‡æ¸¡çš„æ–°æ–¹å¼ useDeferredValue æ˜¯å¹¶å‘æ¨¡å¼ä¸­æˆ‘æœ€å–œæ¬¢çš„ API ä¹‹ä¸€ã€‚æºç ä¸­ï¼Œå®ƒçš„å®ç°ä¸ useTransition ç±»ä¼¼ï¼Œä½†ç”¨é€”ç•¥æœ‰ä¸åŒï¼š\n// useDeferredValueçš„ç®€åŒ–å®ç° function useDeferredValue(value) { const [prevValue, setPrevValue] = useState(value); const pendingValue = useRef(null); const pendingCommit = useRef(null); // å½“å€¼å˜åŒ–æ—¶ useEffect(() =\u0026gt; { // ä¿å­˜å½“å‰å€¼ pendingValue.current = value; // è®¾ç½®ä½ä¼˜å…ˆçº§æ›´æ–° if (pendingCommit.current === null) { pendingCommit.current = requestIdleCallback(() =\u0026gt; { setPrevValue(pendingValue.current); pendingCommit.current = null; }); } return () =\u0026gt; { if (pendingCommit.current !== null) { cancelIdleCallback(pendingCommit.current); pendingCommit.current = null; } }; }, [value]); return prevValue; } è¿™ä¸ª Hook å…è®¸æˆ‘ä»¬æ¨è¿Ÿä¸€ä¸ªå€¼çš„æ›´æ–°ï¼Œè®©å®ƒåœ¨\u0026quot;åå°\u0026quot;æ›´æ–°ï¼Œè€Œä¸é˜»å¡ä¸»è¦ UIã€‚åœ¨å¤„ç†è¾“å…¥è¿‡æ»¤è¿™ç±»åœºæ™¯æ—¶ç‰¹åˆ«æœ‰ç”¨ï¼š\nfunction SearchableList({ items }) { const [query, setQuery] = useState(\u0026#34;\u0026#34;); // ä½¿ç”¨å»¶è¿Ÿå€¼è¿›è¡Œè¿‡æ»¤ï¼Œç¡®ä¿è¾“å…¥å§‹ç»ˆæµç•… const deferredQuery = useDeferredValue(query); // åŸºäºdeferredQueryè¿‡æ»¤ï¼Œä¸ä¼šé˜»å¡è¾“å…¥ const filteredItems = useMemo(() =\u0026gt; { console.log(`è¿‡æ»¤ä¸­... æŸ¥è¯¢: \u0026#34;${deferredQuery}\u0026#34;`); return items.filter((item) =\u0026gt; item.toLowerCase().includes(deferredQuery.toLowerCase()) ); }, [items, deferredQuery]); function handleChange(e) { setQuery(e.target.value); } // æ˜¾ç¤ºè§†è§‰æç¤ºï¼ŒæŒ‡ç¤ºè¿‡æ»¤ç»“æœä¸æ˜¯æœ€æ–°çš„ const isStale = query !== deferredQuery; return ( \u0026lt;div\u0026gt; \u0026lt;input value={query} onChange={handleChange} /\u0026gt; \u0026lt;div style={{ opacity: isStale ? 0.8 : 1 }}\u0026gt; {filteredItems.map((item) =\u0026gt; ( \u0026lt;div key={item}\u0026gt;{item}\u0026lt;/div\u0026gt; ))} \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; ); } åœ¨ä¸€ä¸ªæœ‰ 10000+æ¡æ•°æ®çš„è¡¨æ ¼ä¸­ï¼Œè¿™ä¸ªæ¨¡å¼è®©æœç´¢ä½“éªŒä»å¡é¡¿ä¸å ªå˜å¾—æµç•…è‡ªç„¶ï¼Œç”¨æˆ·ä½“éªŒæå‡æ˜æ˜¾ã€‚\nå¹¶å‘æ¨¡å¼çš„å±€é™ä¸é™·é˜± æ·±å…¥ä½¿ç”¨åå‘ç°ï¼Œå¹¶å‘æ¨¡å¼è™½ç„¶å¼ºå¤§ï¼Œä½†ä¹Ÿæœ‰ä¸€äº›éœ€è¦æ³¨æ„çš„åœ°æ–¹ã€‚\nä¸€ä¸ªå¸¸è§é™·é˜±æ˜¯çŠ¶æ€æ›´æ–°æ—¶åºçš„å˜åŒ–ï¼š\nfunction PotentialIssue() { const [isPending, startTransition] = useTransition(); const [value, setValue] = useState(\u0026#34;\u0026#34;); const [results, setResults] = useState([]); function handleChange(e) { const newValue = e.target.value; // ç«‹å³æ›´æ–° setValue(newValue); // ğŸ”´ æ½œåœ¨é—®é¢˜ï¼šå¦‚æœå¿«é€Ÿè¾“å…¥ï¼Œå¯èƒ½ä¼šä»¥é”™è¯¯çš„é¡ºåºæ‰§è¡Œ startTransition(() =\u0026gt; { searchAPI(newValue).then((data) =\u0026gt; { setResults(data); }); }); } // ... } ç”±äºå¹¶å‘æ¨¡å¼å¯èƒ½ä»¥ä¸åŒä¼˜å…ˆçº§å¤„ç†æ›´æ–°ï¼Œå¦‚æœä¸å°å¿ƒå¯èƒ½å¯¼è‡´çŠ¶æ€æ›´æ–°çš„é¡ºåºä¸é¢„æœŸä¸ç¬¦ã€‚è§£å†³æ–¹æ³•æ˜¯ä½¿ç”¨å‡½æ•°å¼æ›´æ–°æˆ–ä¿æŒè‰¯å¥½çš„ä¾èµ–ç®¡ç†ã€‚\nå¦ä¸€ä¸ªæŒ‘æˆ˜æ˜¯ä¸ç¬¬ä¸‰æ–¹åº“é›†æˆã€‚è®¸å¤šç°æœ‰åº“å¹¶æœªé’ˆå¯¹å¹¶å‘æ¨¡å¼ä¼˜åŒ–ï¼Œå¯èƒ½åœ¨æ—¶åºä¸Šäº§ç”Ÿé—®é¢˜ï¼š\nfunction ThirdPartyIntegration() { const chartRef = useRef(null); const [data, setData] = useState(initialData); // ä½¿ç”¨useDeferredValueä¼˜åŒ–æ€§èƒ½ const deferredData = useDeferredValue(data); // ğŸ”´ æ½œåœ¨é—®é¢˜ï¼šç¬¬ä¸‰æ–¹åº“å¯èƒ½æ— æ³•æ­£ç¡®å¤„ç†å»¶è¿Ÿæ›´æ–° useEffect(() =\u0026gt; { if (chartRef.current) { // å¦‚æœåº“å†…éƒ¨ç¼“å­˜äº†æŸäº›çŠ¶æ€ï¼Œå¯èƒ½ä¼šäº§ç”Ÿä¸ä¸€è‡´ thirdPartyChart.update(chartRef.current, deferredData); } }, [deferredData]); // ... } ä¸ºè§£å†³è¿™äº›é—®é¢˜ï¼ŒReact æä¾›äº†useSyncExternalStore Hookï¼Œä¸“é—¨è®¾è®¡ç”¨äºä¸å¤–éƒ¨æ•°æ®æºå®‰å…¨é›†æˆã€‚\nå®æˆ˜æ¡ˆä¾‹ï¼šå¤æ‚è¡¨å•çš„ä¼˜åŒ– åœ¨ä¸€ä¸ªä¼ä¸šç®¡ç†ç³»ç»Ÿä¸­ï¼Œæˆ‘ä»¬é‡åˆ°ä¸€ä¸ªå¤æ‚çš„é—®é¢˜ï¼šä¸€ä¸ªåŒ…å«å‡ åä¸ªå­—æ®µå’ŒåŠ¨æ€è®¡ç®—çš„è¡¨å•ï¼Œåœ¨ä½ç«¯è®¾å¤‡ä¸Šå‡ ä¹æ— æ³•ä½¿ç”¨ã€‚åº”ç”¨å¹¶å‘æ¨¡å¼åï¼Œæˆ‘ä»¬é‡æ„äº†æ ¸å¿ƒé€»è¾‘ï¼š\nfunction ComplexForm() { const [formState, dispatch] = useReducer(formReducer, initialState); const [isPending, startTransition] = useTransition(); // åˆ†ç¦»å³æ—¶åé¦ˆçš„UIçŠ¶æ€å’Œæ˜‚è´µè®¡ç®—çš„ç»“æœ const [uiState, setUiState] = useState({ currentField: null, showValidation: false, }); // æ˜‚è´µè®¡ç®—ä½¿ç”¨å»¶è¿Ÿå€¼ const deferredFormState = useDeferredValue(formState); // æœ‰ä¾èµ–äºformStateçš„æ˜‚è´µè®¡ç®— const derivedValues = useMemo(() =\u0026gt; { return calculateDerivedValues(deferredFormState); }, [deferredFormState]); function handleFieldChange(field, value) { // ç«‹å³æ›´æ–°UIçŠ¶æ€ä¿æŒå“åº”æ€§ setUiState((prev) =\u0026gt; ({ ...prev, currentField: field, })); // å°†å¯èƒ½å¯¼è‡´å¤§é‡é‡æ–°è®¡ç®—çš„çŠ¶æ€æ›´æ–°æ ‡è®°ä¸ºè¿‡æ¸¡ startTransition(() =\u0026gt; { dispatch({ type: \u0026#34;FIELD_CHANGE\u0026#34;, field, value, }); }); } function handleValidation() { setUiState((prev) =\u0026gt; ({ ...prev, showValidation: true, })); startTransition(() =\u0026gt; { const errors = validateForm(formState); dispatch({ type: \u0026#34;SET_ERRORS\u0026#34;, errors, }); }); } // ä½¿ç”¨ç®—æ³•çµæ´»å¤„ç†è¡¨å•å­—æ®µçš„æ¸²æŸ“ return ( \u0026lt;FormContext.Provider value={{ formState, derivedValues, handleFieldChange, isPending, currentField: uiState.currentField, }} \u0026gt; \u0026lt;form onSubmit={handleValidation}\u0026gt; {/* è¡¨å•å­—æ®µå’ŒUI */} {/* ä½¿ç”¨Suspenseè¾¹ç•Œéš”ç¦»æ˜‚è´µéƒ¨åˆ† */} \u0026lt;Suspense fallback={\u0026lt;LoadingIndicator /\u0026gt;}\u0026gt; \u0026lt;ComplexCalculationsSection formState={deferredFormState} /\u0026gt; \u0026lt;/Suspense\u0026gt; {isPending \u0026amp;\u0026amp; \u0026lt;SpinnerOverlay /\u0026gt;} \u0026lt;/form\u0026gt; \u0026lt;/FormContext.Provider\u0026gt; ); } è¿™ä¸ªé‡æ„å°†è¡¨å•çš„äº¤äº’ä½“éªŒä»\u0026quot;å‹‰å¼ºèƒ½ç”¨\u0026quot;æå‡åˆ°\u0026quot;æµç•…è‡ªç„¶\u0026quot;ï¼Œå°¤å…¶åœ¨ç§»åŠ¨è®¾å¤‡ä¸Šæ•ˆæœæ˜æ˜¾ã€‚å…³é”®ç­–ç•¥æ˜¯ï¼š\nå°† UI çŠ¶æ€ä¸ä¸šåŠ¡çŠ¶æ€åˆ†ç¦» ä½¿ç”¨startTransitionæ ‡è®°æ˜‚è´µæ›´æ–° å°†å¤æ‚è®¡ç®—ä¸ UI åˆ†ç¦»ï¼Œä½¿ç”¨useDeferredValue ä½¿ç”¨ Suspense è¾¹ç•Œéš”ç¦»å¯èƒ½æŒ‚èµ·çš„éƒ¨åˆ† å¹¶å‘ç‰¹æ€§çš„æœ€ä½³å®è·µ ç»è¿‡å‡ ä¸ªæœˆçš„å®è·µï¼Œæˆ‘æ€»ç»“äº†ä¸€äº›ä½¿ç”¨å¹¶å‘æ¨¡å¼çš„æœ€ä½³å®è·µï¼š\n1. æ˜ç¡®åŒºåˆ†å³æ—¶æ›´æ–°å’Œè¿‡æ¸¡æ›´æ–° // é€šç”¨æ¨¡å¼ function UserInterface() { // å³æ—¶åé¦ˆçš„UIçŠ¶æ€ const [uiState, setUiState] = useState({ activeTab: \u0026#34;details\u0026#34;, isExpanded: false, }); // å¯èƒ½éœ€è¦æ˜‚è´µè®¡ç®—çš„æ•°æ®çŠ¶æ€ const [dataState, updateData] = useReducer(dataReducer, initialData); const [isPending, startTransition] = useTransition(); function handleUserAction(action) { // 1. ç«‹å³æ›´æ–°UIåé¦ˆ setUiState((prev) =\u0026gt; ({ ...prev, // ç«‹å³ååº”çš„UIå˜åŒ– })); // 2. åœ¨è¿‡æ¸¡ä¸­å¤„ç†æ•°æ®æ›´æ–° startTransition(() =\u0026gt; { updateData({ type: action.type, payload: action.data, }); }); } // ... } 2. ä½¿ç”¨ useDeferredValue ä¼˜åŒ–æ•°æ®å¯è§†åŒ– function DataVisualization({ rawData }) { // å»¶è¿Ÿå¤„ç†å¤§æ•°æ®é›† const deferredData = useDeferredValue(rawData); // æ˜‚è´µçš„æ•°æ®è½¬æ¢ const processedData = useMemo(() =\u0026gt; { return processData(deferredData); }, [deferredData]); // æ˜¾ç¤ºåŠ è½½æŒ‡ç¤ºå™¨ const isStale = rawData !== deferredData; return ( \u0026lt;div className={isStale ? \u0026#34;updating\u0026#34; : \u0026#34;\u0026#34;}\u0026gt; \u0026lt;Chart data={processedData} /\u0026gt; {isStale \u0026amp;\u0026amp; \u0026lt;SpinnerOverlay /\u0026gt;} \u0026lt;/div\u0026gt; ); } 3. ç»“åˆå¹¶å‘æ¨¡å¼ä¸è™šæ‹ŸåŒ– åœ¨å¤§å‹åˆ—è¡¨æ¸²æŸ“æ—¶ï¼Œç»“åˆå¹¶å‘æ¨¡å¼ä¸è™šæ‹ŸåŒ–æŠ€æœ¯æ•ˆæœæ›´ä½³ï¼š\nfunction OptimizedList({ items, filter }) { const [isPending, startTransition] = useTransition(); const [filteredItems, setFilteredItems] = useState(items); // å½“è¿‡æ»¤æ¡ä»¶å˜åŒ–æ—¶ useEffect(() =\u0026gt; { if (filter) { // åœ¨è¿‡æ¸¡ä¸­å¤„ç†è¿‡æ»¤ startTransition(() =\u0026gt; { setFilteredItems(items.filter((item) =\u0026gt; item.name.includes(filter))); }); } else { setFilteredItems(items); } }, [filter, items]); return ( \u0026lt;div\u0026gt; {isPending \u0026amp;\u0026amp; \u0026lt;FilteringIndicator /\u0026gt;} \u0026lt;VirtualizedList items={filteredItems} height={500} itemHeight={50} renderItem={(item) =\u0026gt; \u0026lt;ListItem item={item} /\u0026gt;} /\u0026gt; \u0026lt;/div\u0026gt; ); } 4. ä¼˜é›…é™çº§ è€ƒè™‘åˆ°ä¸æ˜¯æ‰€æœ‰æµè§ˆå™¨éƒ½æ”¯æŒå¹¶å‘ç‰¹æ€§ï¼Œå®ç°ä¼˜é›…é™çº§å¾ˆé‡è¦ï¼š\nfunction App() { // æ£€æµ‹æ˜¯å¦æ”¯æŒå¹¶å‘ç‰¹æ€§ const isConcurrentModeSupported = typeof React.useTransition === \u0026#34;function\u0026#34;; return ( \u0026lt;div\u0026gt; {isConcurrentModeSupported ? ( \u0026lt;OptimizedExperience /\u0026gt; ) : ( \u0026lt;TraditionalExperience /\u0026gt; )} \u0026lt;/div\u0026gt; ); } æœªæ¥å±•æœ› å¹¶å‘æ¸²æŸ“åªæ˜¯ React æœªæ¥æ–¹å‘çš„ä¸€éƒ¨åˆ†ã€‚é€šè¿‡è·Ÿè¸ª React ä»“åº“çš„å¼€å‘åŠ¨å‘ï¼Œå¯ä»¥çœ‹åˆ°æ›´å¤šä»¤äººå…´å¥‹çš„åŠŸèƒ½æ­£åœ¨å¼€å‘ä¸­ï¼š\næœåŠ¡å™¨ç»„ä»¶ï¼šå…è®¸ç»„ä»¶åœ¨æœåŠ¡å™¨ä¸Šæ¸²æŸ“ï¼Œä¸”ä¸éœ€è¦å®¢æˆ·ç«¯ JS Asset Loadingï¼šæ›´é›†æˆçš„èµ„æºåŠ è½½æ–¹æ¡ˆ æ–°çš„ Suspense ç‰¹æ€§ï¼šæ›´å¤šä¸æ•°æ®è·å–ç›¸å…³çš„èƒ½åŠ› å…¶ä¸­ï¼Œæˆ‘æœ€æœŸå¾…çš„æ˜¯æœåŠ¡å™¨ç»„ä»¶ä¸å¹¶å‘æ¸²æŸ“çš„ç»“åˆï¼Œè¿™å°†å¼€åˆ›ä¸€ç§å…¨æ–°çš„åº”ç”¨æ¶æ„æ¨¡å¼ã€‚\nå¹¶å‘æ¸²æŸ“æ¨¡å¼æ˜¯ React å‘å±•ä¸­çš„é‡è¦é‡Œç¨‹ç¢‘ï¼Œå®ƒä¸åªæ˜¯æ€§èƒ½ä¼˜åŒ–é‚£ä¹ˆç®€å•ï¼Œè€Œæ˜¯ä¸€ç§å…¨æ–°çš„ UI æ„å»ºèŒƒå¼ã€‚é€šè¿‡ç†è§£å¹¶å‘æ¸²æŸ“çš„æ ¸å¿ƒåŸç†ï¼Œæˆ‘ä»¬èƒ½æ›´å¥½åœ°æ„å»ºæµç•…ã€å“åº”å¼çš„åº”ç”¨ï¼Œä¸ºç”¨æˆ·å¸¦æ¥å“è¶Šä½“éªŒã€‚\nå‰ç«¯å‘å±•æ—¥æ–°æœˆå¼‚ï¼Œå¹¶å‘æ¸²æŸ“å¯èƒ½åªæ˜¯å¼€å§‹ã€‚éšç€ Web å¹³å°èƒ½åŠ›çš„ä¸æ–­å¢å¼ºï¼Œæˆ‘ç›¸ä¿¡ React è¿˜ä¼šå¸¦æ¥æ›´å¤šåˆ›æ–°ã€‚ä¸è¿‡æ— è®ºæŠ€æœ¯å¦‚ä½•å˜åŒ–ï¼Œç†è§£åº•å±‚åŸç†æ°¸è¿œæ˜¯æå‡èƒ½åŠ›çš„å…³é”®ã€‚\nå®éªŒæ€§åŠŸèƒ½æˆ–è®¸çœ‹èµ·æ¥ç”¨å¤„ä¸å¤§ï¼Œä½†æŒæ¡å¹¶å‘æ¨¡å¼çš„æ€ç»´æ–¹å¼ï¼Œå¯¹ç†è§£æœªæ¥çš„å‰ç«¯æ¶æ„è‡³å…³é‡è¦ã€‚å¦‚æœä½ è¿˜æ²¡å°è¯•è¿‡å¹¶å‘ç‰¹æ€§ï¼Œå¼ºçƒˆå»ºè®®åœ¨ä¸‹ä¸ªé¡¹ç›®ä¸­è¯•è¯•æ°´ï¼Œä½ å¯èƒ½ä¼šå‘ç°ä¸€ä¸ªå…¨æ–°çš„ UI å¼€å‘ä¸–ç•Œã€‚\nä¸‹æ¬¡è®¡åˆ’åˆ†äº« React æœåŠ¡å™¨ç»„ä»¶çš„æ¶æ„ä¸å®æˆ˜ï¼Œæ•¬è¯·æœŸå¾…ï¼\n","permalink":"https://www.yss520.online/zh/posts/react-node/","summary":"\u003ch1 id=\"react-å¹¶å‘æ¨¡å¼æ­ç§˜ä»æºç çœ‹æ¶æ„æ¼”è¿›\"\u003eReact å¹¶å‘æ¨¡å¼æ­ç§˜ï¼šä»æºç çœ‹æ¶æ„æ¼”è¿›\u003c/h1\u003e\n\u003cp\u003eä¸Šå‘¨æ”¶åˆ°ä¸€ä¸ªæ£˜æ‰‹ä»»åŠ¡ï¼šä¼˜åŒ–æˆ‘ä»¬çš„åå°ç³»ç»Ÿåœ¨ä½ç«¯è®¾å¤‡ä¸Šçš„æ€§èƒ½ã€‚è¡¨æ ¼æ¸²æŸ“ã€ç­›é€‰ã€åŠ¨ç”»ï¼Œä¸€ç³»åˆ—æ“ä½œè®©è€æ—§è®¾å¤‡å¡åˆ°å´©æºƒã€‚æ­£å¥½å€Ÿæ­¤æœºä¼šï¼Œæˆ‘æ·±å…¥ç ”ç©¶äº† React 18 çš„å¹¶å‘æ¸²æŸ“æœºåˆ¶ï¼Œå‘ç°è¿™ç¡®å®æ˜¯æŠŠè§£å†³æ€§èƒ½é—®é¢˜çš„åˆ©å™¨ã€‚\u003c/p\u003e\n\u003ch2 id=\"å¹¶å‘æ¨¡å¼react-æ¶æ„çš„é‡å¤§è½¬å˜\"\u003eå¹¶å‘æ¨¡å¼ï¼šReact æ¶æ„çš„é‡å¤§è½¬å˜\u003c/h2\u003e\n\u003cp\u003eReact çš„å¹¶å‘æ¨¡å¼å¯èƒ½æ˜¯è‡ª Hooks ä»¥æ¥æœ€é‡å¤§çš„æ¶æ„å˜é©ã€‚æœ¬è´¨ä¸Šï¼Œè¿™æ˜¯ä¸€ç§æ–°çš„æ¸²æŸ“æ¨¡å¼ï¼Œå…è®¸ React\u003cstrong\u003eä¸­æ–­ã€æš‚åœå’Œæ¢å¤\u003c/strong\u003eæ¸²æŸ“å·¥ä½œã€‚è¿™å¬èµ·æ¥å¾ˆç®€å•ï¼Œä½†å®ç°èµ·æ¥æå…¶å¤æ‚ï¼Œè¿™ä¹Ÿè§£é‡Šäº†ä¸ºä»€ä¹ˆ React å›¢é˜ŸèŠ±äº†è¿‘ 5 å¹´æ—¶é—´æ‰å°†å…¶æ­£å¼å‘å¸ƒã€‚\u003c/p\u003e\n\u003cp\u003eç¿»å¼€æºç ï¼Œç¬¬ä¸€ä¸ªå…³é”®æ¦‚å¿µæ˜¯\u003cstrong\u003eä¼˜å…ˆçº§è°ƒåº¦\u003c/strong\u003eï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-javascript\" data-lang=\"javascript\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e// ç®€åŒ–ç‰ˆçš„ä»»åŠ¡ä¼˜å…ˆçº§å®šä¹‰\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003eexport\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003econst\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eDiscreteEventPriority\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eSyncLane\u003c/span\u003e; \u003cspan style=\"color:#75715e\"\u003e// æœ€é«˜ä¼˜å…ˆçº§ï¼Œå¦‚ç‚¹å‡»\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003eexport\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003econst\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eContinuousEventPriority\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eInputContinuousLane\u003c/span\u003e; \u003cspan style=\"color:#75715e\"\u003e// è¿ç»­äº‹ä»¶ï¼Œå¦‚æ‹–æ‹½\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003eexport\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003econst\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eDefaultEventPriority\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eDefaultLane\u003c/span\u003e; \u003cspan style=\"color:#75715e\"\u003e// é»˜è®¤ä¼˜å…ˆçº§\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003eexport\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003econst\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eIdleEventPriority\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eIdleLane\u003c/span\u003e; \u003cspan style=\"color:#75715e\"\u003e// ç©ºé—²ä¼˜å…ˆçº§\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eè¿™äº›ä¼˜å…ˆçº§å¸¸é‡ä¸ä»…ä»…æ˜¯æ•°å­—ï¼Œå®ƒä»¬åœ¨ React å†…éƒ¨ä½¿ç”¨äº†ä¸€ç§ç§°ä¸º\u0026quot;Lanes\u0026quot;çš„ä½å­—æ®µè¡¨ç¤ºæ³•ï¼Œè¿™ä½¿å¾— React å¯ä»¥é«˜æ•ˆåœ°å¤„ç†å’Œæ¯”è¾ƒå¤šä¸ªä¼˜å…ˆçº§ã€‚\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-javascript\" data-lang=\"javascript\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e// Lanesçš„å®ç°ï¼ˆç®€åŒ–ç‰ˆï¼‰\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003eexport\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003econst\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eTotalLanes\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e31\u003c/span\u003e;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e// å°†å¤šä¸ªlaneåˆå¹¶\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003eexport\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003efunction\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003emergeLanes\u003c/span\u003e(\u003cspan style=\"color:#a6e22e\"\u003ea\u003c/span\u003e, \u003cspan style=\"color:#a6e22e\"\u003eb\u003c/span\u003e) {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#66d9ef\"\u003ereturn\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003ea\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e|\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eb\u003c/span\u003e;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e// æ£€æŸ¥lanesä¸­æ˜¯å¦åŒ…å«ç‰¹å®šlane\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003eexport\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003efunction\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eincludesSomeLane\u003c/span\u003e(\u003cspan style=\"color:#a6e22e\"\u003ea\u003c/span\u003e, \u003cspan style=\"color:#a6e22e\"\u003eb\u003c/span\u003e) {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#66d9ef\"\u003ereturn\u003c/span\u003e (\u003cspan style=\"color:#a6e22e\"\u003ea\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e\u0026amp;\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eb\u003c/span\u003e) \u003cspan style=\"color:#f92672\"\u003e!==\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eNoLanes\u003c/span\u003e;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eè¿™ç§ä½è¿ç®—å®ç°æ—¢é«˜æ•ˆåˆå·§å¦™ï¼Œè®© React èƒ½å¤Ÿç”¨å•ä¸ª 32 ä½æ•´æ•°è¡¨ç¤ºå’Œå¤„ç†å¤šä¸ªä¼˜å…ˆçº§ï¼Œé¿å…äº†å¤æ‚æ•°æ®ç»“æ„å¸¦æ¥çš„æ€§èƒ½å¼€é”€ã€‚\u003c/p\u003e\n\u003ch2 id=\"ä¸­æ–­ä¸æ¢å¤æ¸²æŸ“çš„æ–°èŒƒå¼\"\u003eä¸­æ–­ä¸æ¢å¤ï¼šæ¸²æŸ“çš„æ–°èŒƒå¼\u003c/h2\u003e\n\u003cp\u003eå¹¶å‘æ¨¡å¼æœ€æ ¸å¿ƒçš„èƒ½åŠ›æ˜¯\u0026quot;ä¸­æ–­ä¸æ¢å¤\u0026quot;ã€‚åœ¨æ—§ç‰ˆ React ä¸­ï¼Œä¸€æ—¦å¼€å§‹æ¸²æŸ“å°±å¿…é¡»å®Œæˆï¼Œè¿™åœ¨å¤§å‹åº”ç”¨ä¸­å¯èƒ½å¯¼è‡´æ˜æ˜¾çš„å¡é¡¿ã€‚\u003c/p\u003e\n\u003cp\u003eåœ¨ React 18 ä¸­ï¼Œæ¸²æŸ“é€»è¾‘è¢«é‡æ„ä¸º\u0026quot;workLoop\u0026quot;ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-javascript\" data-lang=\"javascript\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003efunction\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eworkLoopConcurrent\u003c/span\u003e() {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#75715e\"\u003e// æ‰§è¡Œå·¥ä½œï¼Œç›´åˆ°æ²¡æœ‰æ›´å¤šæ—¶é—´æˆ–å·¥ä½œå®Œæˆ\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e  \u003cspan style=\"color:#66d9ef\"\u003ewhile\u003c/span\u003e (\u003cspan style=\"color:#a6e22e\"\u003eworkInProgress\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e!==\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003enull\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e!\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003eshouldYield\u003c/span\u003e()) {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#a6e22e\"\u003eperformUnitOfWork\u003c/span\u003e(\u003cspan style=\"color:#a6e22e\"\u003eworkInProgress\u003c/span\u003e);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  }\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003efunction\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eshouldYield\u003c/span\u003e() {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#75715e\"\u003e// æ£€æŸ¥æ˜¯å¦éœ€è¦è®©å‡ºæ§åˆ¶æƒç»™æµè§ˆå™¨\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e  \u003cspan style=\"color:#66d9ef\"\u003ereturn\u003c/span\u003e (\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#75715e\"\u003e// æ£€æŸ¥æ˜¯å¦æœ‰æ›´é«˜ä¼˜å…ˆçº§çš„å·¥ä½œ\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e    \u003cspan style=\"color:#a6e22e\"\u003ecurrentEventTransitionLane\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e!==\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eNoLane\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#75715e\"\u003e// æ˜¯å¦å·²ç»ç”¨å®Œåˆ†é…çš„æ—¶é—´ç‰‡\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e    \u003cspan style=\"color:#a6e22e\"\u003escheduler\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003eunstable_shouldYield\u003c/span\u003e()\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  );\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eè¿™æ®µä»£ç å±•ç¤ºäº† React æ˜¯å¦‚ä½•å®ç°\u0026quot;å¯ä¸­æ–­æ¸²æŸ“\u0026quot;çš„ï¼šåœ¨\u003ccode\u003eworkLoopConcurrent\u003c/code\u003eä¸­ï¼ŒReact ä¼šä¸æ–­æ£€æŸ¥\u003ccode\u003eshouldYield()\u003c/code\u003eï¼Œå¦‚æœéœ€è¦è®©å‡ºæ§åˆ¶æƒï¼ˆæ¯”å¦‚æœ‰æ›´é«˜ä¼˜å…ˆçº§ä»»åŠ¡æˆ–æ—¶é—´ç‰‡ç”¨å®Œï¼‰ï¼Œå®ƒä¼šæš‚åœå½“å‰å·¥ä½œï¼Œå¹¶åœ¨ç¨åæ¢å¤ã€‚\u003c/p\u003e","title":"React Nodeä¸JSXè½¬æ¢æœºåˆ¶è¯¦è§£"},{"content":"æ­ç§˜ React äº‹ä»¶ç³»ç»Ÿï¼šä»æºç çœ‹åŸç†ä¸ä¼˜åŒ– æœ€è¿‘åœ¨ç ”å‘å›¢é˜Ÿå†…åšäº†ä¸€æ¬¡å…³äº React äº‹ä»¶ç³»ç»Ÿçš„åˆ†äº«ï¼Œåå“ä¸é”™ï¼Œå†³å®šæ•´ç†æˆæ–‡ç« åˆ†äº«å‡ºæ¥ã€‚è¿™æ˜¯æˆ‘è¯» React æºç ç³»åˆ—çš„ç¬¬äºŒç¯‡ï¼Œä¸Šæ¬¡åˆ†æäº†è™šæ‹Ÿ DOM çš„å®ç°ç»†èŠ‚ï¼Œè¿™æ¬¡èšç„¦äº‹ä»¶ç³»ç»Ÿã€‚\näº‹ä»¶ç³»ç»Ÿï¼šè¢«è¯¯è§£çš„ React æ ¸å¿ƒæœºåˆ¶ å¤§å¤šæ•° React å¼€å‘è€…å¯èƒ½çŸ¥é“ React æœ‰è‡ªå·±çš„äº‹ä»¶ç³»ç»Ÿï¼Œä½†å¾ˆå°‘æœ‰äººèƒ½è¯´æ¸…å®ƒåˆ°åº•åšäº†ä»€ä¹ˆã€‚ç¿»å¼€æºç åæ‰å‘ç°ï¼ŒReact çš„äº‹ä»¶ç³»ç»Ÿæ˜¯ä¸ªç²¾å¿ƒè®¾è®¡çš„å¤æ‚æœºåˆ¶ï¼Œè¿œä¸æ­¢æ˜¯ç®€å•çš„\u0026quot;è¯­æ³•ç³–\u0026quot;ã€‚\n// å¸¸è§çš„Reactäº‹ä»¶ç»‘å®š \u0026lt;button onClick={handleClick}\u0026gt;ç‚¹å‡»\u0026lt;/button\u0026gt; è¿™è¡Œçœ‹ä¼¼æ™®é€šçš„ä»£ç èƒŒåï¼Œéšè—ç€ä¸€æ•´å¥—äº‹ä»¶å¤„ç†æœºåˆ¶ã€‚\näº‹ä»¶å§”æ‰˜ï¼šç†è§£ React çš„äº‹ä»¶ç»‘å®š ç¬¬ä¸€ä¸ªå…³é”®å‘ç°ï¼šReact å¹¶ä¸ä¼šæŠŠäº‹ä»¶ç›´æ¥ç»‘å®šåœ¨ DOM å…ƒç´ ä¸Šã€‚\nåœ¨ React 17 ä¹‹å‰ï¼Œæ‰€æœ‰äº‹ä»¶éƒ½è¢«å§”æ‰˜åˆ° document èŠ‚ç‚¹ä¸Šï¼›React 17 ä¹‹åï¼Œæ”¹ä¸ºå§”æ‰˜åˆ° React æ ‘çš„æ ¹ DOM å®¹å™¨ä¸Šï¼š\n// React 17å‰åçš„äº‹ä»¶ç»‘å®šä½ç½®å˜åŒ–ï¼ˆç®€åŒ–çš„æºç ï¼‰ // React 16 document.addEventListener(\u0026#34;click\u0026#34;, dispatchEvent); // React 17+ rootNode.addEventListener(\u0026#34;click\u0026#34;, dispatchEvent); é€šè¿‡æŸ¥çœ‹ Chrome DevTools çš„ Event Listeners é¢æ¿ï¼Œä½ ä¼šå‘ç°çœŸæ­£çš„äº‹ä»¶ç›‘å¬å™¨å¹¶ä¸åœ¨ä½ å†™ JSX çš„å…ƒç´ ä¸Šï¼Œè€Œæ˜¯åœ¨æ ¹èŠ‚ç‚¹ä¸Šã€‚\nè¿™ç§äº‹ä»¶å§”æ‰˜æœ‰å‡ ä¸ªé‡è¦å¥½å¤„ï¼š\nå‡å°‘å†…å­˜å ç”¨ï¼ˆä¸ç”¨ä¸ºæ¯ä¸ªå…ƒç´ éƒ½ç»‘å®šäº‹ä»¶ï¼‰ åŠ¨æ€æ·»åŠ çš„å…ƒç´ ä¹Ÿèƒ½å“åº”äº‹ä»¶ ç®€åŒ–äº† React Fiber æ ‘çš„æ›´æ–°é€»è¾‘ åˆæˆäº‹ä»¶ï¼šä¸åªæ˜¯åŒ…è£…åŸç”Ÿäº‹ä»¶é‚£ä¹ˆç®€å• React çš„SyntheticEventå¯¹è±¡æ˜¯å¯¹åŸç”Ÿ DOM äº‹ä»¶çš„åŒ…è£…ï¼Œä½†å®ƒåšäº†å¾ˆå¤šé¢å¤–å·¥ä½œï¼š\n// React 17ä¸­åˆæˆäº‹ä»¶çš„åˆ›å»ºï¼ˆç®€åŒ–ç‰ˆï¼‰ function createSyntheticEvent( reactName, reactEventType, targetInst, nativeEvent, nativeEventTarget ) { const event = new SyntheticBaseEvent( nativeEvent.type, nativeEventTarget ? nativeEventTarget.ownerDocument : null, nativeEvent, nativeEventTarget ); // æ·»åŠ ç‰¹å®šäº‹ä»¶ç±»å‹çš„å±æ€§ accumulateEventHandleNonManagedNodeListeners( targetInst, dispatchListener, event, true ); return event; } æœ‰è¶£çš„æ˜¯ï¼ŒReact åˆæˆäº‹ä»¶å®ç°äº† W3C æ ‡å‡†ï¼Œè§£å†³äº†å„æµè§ˆå™¨çš„å…¼å®¹æ€§å·®å¼‚ã€‚æ¯”å¦‚ï¼š\nç»Ÿä¸€äº†äº‹ä»¶å±æ€§åå’Œè¡Œä¸º æ ‡å‡†åŒ–äº†äº‹ä»¶å†’æ³¡å’Œæ•è· å¤„ç†äº† IE ç­‰æµè§ˆå™¨çš„å…¼å®¹é—®é¢˜ åœ¨ä¸€ä¸ªè·¨å¢ƒç”µå•†é¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬å‘ç°å›½å†…å¤–ç”¨æˆ·ä½¿ç”¨çš„æµè§ˆå™¨ç‰ˆæœ¬å·®å¼‚å¾ˆå¤§ï¼Œä½† React çš„åˆæˆäº‹ä»¶è®©æˆ‘ä»¬å‡ ä¹ä¸ç”¨æ‹…å¿ƒå…¼å®¹æ€§é—®é¢˜ã€‚\näº‹ä»¶æµä¸æ‰§è¡Œæœºåˆ¶ï¼šä»æ•è·åˆ°å†’æ³¡ æºç ä¸­ï¼ŒReact çš„äº‹ä»¶å¤„ç†åˆ†ä¸ºä¸‰ä¸ªé˜¶æ®µï¼š\næ”¶é›†é˜¶æ®µï¼šæ²¿ç€ DOM æ ‘æ”¶é›†æ‰€æœ‰æ³¨å†Œçš„äº‹ä»¶å¤„ç†å™¨ æ’åºé˜¶æ®µï¼šæ ¹æ®äº‹ä»¶ç±»å‹å’Œé˜¶æ®µï¼ˆæ•è·/å†’æ³¡ï¼‰æ’åº æ‰§è¡Œé˜¶æ®µï¼šæŒ‰é¡ºåºè§¦å‘äº‹ä»¶å¤„ç†å™¨ // æ”¶é›†äº‹ä»¶å¤„ç†å‡½æ•°çš„ç®€åŒ–ä»£ç  function traverseTwoPhase(inst, fn, arg) { const path = []; while (inst) { path.push(inst); inst = getParent(inst); } // æ•è·é˜¶æ®µ - ä»ä¸Šå¾€ä¸‹ for (let i = path.length; i-- \u0026gt; 0; ) { fn(path[i], \u0026#34;captured\u0026#34;, arg); } // å†’æ³¡é˜¶æ®µ - ä»ä¸‹å¾€ä¸Š for (let i = 0; i \u0026lt; path.length; i++) { fn(path[i], \u0026#34;bubbled\u0026#34;, arg); } } è¿™è§£é‡Šäº†ä¸ºä»€ä¹ˆ React æ”¯æŒonClickCaptureè¿™æ ·çš„æ•è·é˜¶æ®µäº‹ä»¶å¤„ç†ã€‚\nåœ¨ä¸€ä¸ªæ‹–æ‹½ç»„ä»¶åº“çš„å¼€å‘ä¸­ï¼Œæˆ‘æ›¾åˆ©ç”¨ React çš„äº‹ä»¶æµæœºåˆ¶åœ¨æ•è·é˜¶æ®µæ‹¦æˆªå’Œå¤„ç†é¼ æ ‡äº‹ä»¶ï¼Œé¿å…äº†æ‹–æ‹½è¿‡ç¨‹ä¸­çš„äº‹ä»¶å†²çªã€‚\näº‹ä»¶æ± çš„å˜åŒ–ï¼šReact 17 çš„é‡å¤§æ”¹è¿› åœ¨ React 16 åŠä¹‹å‰çš„ç‰ˆæœ¬ä¸­ï¼Œæœ‰ä¸€ä¸ªå¸¸è§é™·é˜±æ˜¯å¼‚æ­¥è®¿é—®äº‹ä»¶å¯¹è±¡ï¼š\nfunction handleClick(event) { setTimeout(() =\u0026gt; { console.log(event.target.value); // React 16: null, React 17+: æ­£å¸¸å€¼ }, 100); } æºç ä¸­å¯ä»¥çœ‹åˆ°ï¼ŒReact 16 ä½¿ç”¨äº†äº‹ä»¶æ± æ¥é‡ç”¨äº‹ä»¶å¯¹è±¡ï¼Œè¿™å¯¼è‡´äº‹ä»¶å¤„ç†å‡½æ•°æ‰§è¡Œå®Œæ¯•åï¼Œäº‹ä»¶å¯¹è±¡çš„å±æ€§ä¼šè¢«æ¸…ç©ºï¼š\n// React 16çš„äº‹ä»¶æ± æœºåˆ¶ class SyntheticEvent { constructor(dispatchConfig, targetInst, nativeEvent, nativeEventTarget) { // ...åˆå§‹åŒ–äº‹ä»¶å±æ€§ } // åœ¨äº‹ä»¶å¤„ç†å®Œæˆåè°ƒç”¨ release() { const EventConstructor = this.constructor; if (EventConstructor.eventPool.length \u0026lt; EVENT_POOL_SIZE) { EventConstructor.eventPool.push(this); } // æ¸…ç©ºæ‰€æœ‰å±æ€§ this.destructor(); } } è€Œ React 17 å®Œå…¨ç§»é™¤äº†äº‹ä»¶æ± ï¼Œè§£å†³äº†è¿™ä¸ªå¸¸è§é—®é¢˜ã€‚æºç ä¸­ä¸å†æœ‰release()æ–¹æ³•å’Œå¯¹è±¡å¤ç”¨é€»è¾‘ï¼Œè®©äº‹ä»¶å¯¹è±¡çš„è¡Œä¸ºæ›´ç¬¦åˆç›´è§‰ã€‚\nReact 17 çš„äº‹ä»¶ç³»ç»Ÿé‡æ„ï¼šä¸ºä»€ä¹ˆè¦æ”¹ï¼Ÿ é˜…è¯» React 17 çš„æºç ï¼Œå‘ç°äº‹ä»¶ç³»ç»Ÿè¿›è¡Œäº†é‡å¤§é‡æ„ï¼Œä¸»è¦å˜åŒ–æœ‰ï¼š\nå°†äº‹ä»¶å§”æ‰˜ä» document æ”¹ä¸ºæ ¹å®¹å™¨ å–æ¶ˆäº‹ä»¶æ± æœºåˆ¶ ä¸æµè§ˆå™¨äº‹ä»¶ç³»ç»Ÿå¯¹é½ï¼ˆå¦‚ onFocus å’Œ onBlur çš„å†’æ³¡è¡Œä¸ºï¼‰ ç®€åŒ–å†…éƒ¨å®ç°ï¼Œç§»é™¤äº†é—ç•™ä»£ç  ä¸ºä»€ä¹ˆè¦åšè¿™äº›æ”¹å˜ï¼Ÿå®˜æ–¹åšå®¢æ²¡æœ‰è¯¦ç»†è§£é‡Šï¼Œä½†é€šè¿‡æºç åˆ†æï¼Œæˆ‘è®¤ä¸ºä¸»è¦åŸå› æœ‰ï¼š\næ”¯æŒ React å¤šç‰ˆæœ¬å¹¶å­˜ï¼ˆä¸åŒ React ç‰ˆæœ¬çš„äº‹ä»¶ä¸ä¼šç›¸äº’å¹²æ‰°ï¼‰ å‡å°‘ä¸ç¬¬ä¸‰æ–¹åº“çš„å†²çªï¼ˆæ¯”å¦‚ modal åº“çš„äº‹ä»¶ä¼ æ’­é—®é¢˜ï¼‰ ç®€åŒ–å†…éƒ¨å®ç°ï¼Œä¸ºæœªæ¥çš„ Concurrent Mode é“ºè·¯ åœ¨ä¸€ä¸ªå¤§å‹åº”ç”¨çš„å¾®å‰ç«¯è¿ç§»è¿‡ç¨‹ä¸­ï¼Œè¿™ä¸ªå˜åŒ–å¸®æˆ‘ä»¬è§£å†³äº†å¤šä¸ª React ç‰ˆæœ¬å¹¶å­˜æ—¶çš„äº‹ä»¶å†²çªé—®é¢˜ã€‚\näº‹ä»¶ç³»ç»Ÿçš„æ€§èƒ½é—®é¢˜ä¸ä¼˜åŒ– é€šè¿‡ React DevTools çš„ Profiler åˆ†æï¼Œå‘ç°åœ¨é«˜é¢‘äº‹ä»¶ï¼ˆå¦‚æ»šåŠ¨ã€æ‹–æ‹½ï¼‰ä¸­ï¼ŒReact çš„äº‹ä»¶ç³»ç»Ÿå¯èƒ½æˆä¸ºæ€§èƒ½ç“¶é¢ˆã€‚æºç ä¸­çš„ä¸€äº›æ³¨é‡Šä¹Ÿæåˆ°äº†è¿™ç‚¹ï¼š\n// åœ¨Reactäº‹ä»¶æºç ä¸­çš„æ³¨é‡Š // TODO: This is a \u0026#34;almost-duplicate\u0026#34; of the checkResponderAndRequestId // function in the touch responder system. We should see if we can share // some logic. é’ˆå¯¹è¿™äº›é—®é¢˜ï¼Œæœ‰å‡ ä¸ªå®ç”¨çš„ä¼˜åŒ–æ‰‹æ®µï¼š\nä½¿ç”¨èŠ‚æµ/é˜²æŠ–å¤„ç†é«˜é¢‘äº‹ä»¶ï¼š function useThrottledScroll(callback, delay) { const throttledCallback = useCallback(throttle(callback, delay), [ callback, delay, ]); useEffect(() =\u0026gt; { window.addEventListener(\u0026#34;scroll\u0026#34;, throttledCallback); return () =\u0026gt; window.removeEventListener(\u0026#34;scroll\u0026#34;, throttledCallback); }, [throttledCallback]); } è€ƒè™‘ä½¿ç”¨åŸç”Ÿäº‹ä»¶ç»•è¿‡ React äº‹ä»¶ç³»ç»Ÿï¼ˆè°¨æ…ä½¿ç”¨ï¼‰ï¼š function DirectEventComponent() { const ref = useRef(null); useEffect(() =\u0026gt; { const handleMouseMove = (e) =\u0026gt; { // é«˜æ€§èƒ½å¤„ç†ï¼Œç»•è¿‡Reactäº‹ä»¶ç³»ç»Ÿ }; const element = ref.current; element.addEventListener(\u0026#34;mousemove\u0026#34;, handleMouseMove); return () =\u0026gt; element.removeEventListener(\u0026#34;mousemove\u0026#34;, handleMouseMove); }, []); return \u0026lt;div ref={ref}\u0026gt;é«˜æ€§èƒ½äº¤äº’åŒºåŸŸ\u0026lt;/div\u0026gt;; } åœ¨ä¸€ä¸ªæ•°æ®å¯è§†åŒ–é¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬å‘ç° Canvas ä¸Šçš„é¼ æ ‡äº¤äº’ä½¿ç”¨åŸç”Ÿäº‹ä»¶æ¯” React åˆæˆäº‹ä»¶æœ‰æ˜æ˜¾çš„æ€§èƒ½æå‡ã€‚\nè°ƒè¯• React äº‹ä»¶çš„æŠ€å·§ é¢å¯¹å¤æ‚çš„äº‹ä»¶å¤„ç†é—®é¢˜ï¼Œæˆ‘æ€»ç»“äº†å‡ ä¸ªå®ç”¨è°ƒè¯•æŠ€å·§ï¼š\nä½¿ç”¨ Chrome DevTools çš„ Event Listeners é¢æ¿æŸ¥çœ‹çœŸå®ç»‘å®šæƒ…å†µ åœ¨äº‹ä»¶å¤„ç†å‡½æ•°ä¸­ä½¿ç”¨event.nativeEventæŸ¥çœ‹åŸç”Ÿäº‹ä»¶å¯¹è±¡ æ·»åŠ æ–­ç‚¹è·Ÿè¸ªäº‹ä»¶æµç»è¿‡çš„è·¯å¾„ function debugEvent(event) { console.log(\u0026#34;åˆæˆäº‹ä»¶:\u0026#34;, event); console.log(\u0026#34;åŸç”Ÿäº‹ä»¶:\u0026#34;, event.nativeEvent); console.log(\u0026#34;å½“å‰ç›®æ ‡:\u0026#34;, event.currentTarget); console.log(\u0026#34;äº‹ä»¶ç›®æ ‡:\u0026#34;, event.target); console.log(\u0026#34;äº‹ä»¶ç±»å‹:\u0026#34;, event.type); console.log(\u0026#34;äº‹ä»¶é˜¶æ®µ:\u0026#34;, event.eventPhase); // 0: æ²¡æœ‰äº‹ä»¶æ­£åœ¨è¢«å¤„ç† // 1: æ•è·é˜¶æ®µ // 2: ç›®æ ‡é˜¶æ®µ // 3: å†’æ³¡é˜¶æ®µ } è¿™ä¸ªè°ƒè¯•å‡½æ•°å¸®æˆ‘è§£å†³è¿‡å¾ˆå¤šéš¾ä»¥é‡ç°çš„äº‹ä»¶é—®é¢˜ã€‚\näº‹ä»¶ç³»ç»Ÿä¸æœªæ¥ Concurrent Mode çš„å…³ç³» React äº‹ä»¶ç³»ç»Ÿçš„è®¾è®¡ä¸æœªæ¥çš„ Concurrent Mode ç´§å¯†ç›¸å…³ã€‚é˜…è¯»æºç åå‘ç°ï¼ŒReact 17 çš„äº‹ä»¶ç³»ç»Ÿé‡æ„éƒ¨åˆ†åŸå› æ˜¯ä¸ºäº†æ”¯æŒ React çš„å¹¶å‘æ¸²æŸ“æœºåˆ¶ï¼š\n// ç®€åŒ–çš„Reactäº‹ä»¶å¤„ç†ä¼˜å…ˆçº§ function dispatchEvent( topLevelType, eventSystemFlags, targetContainer, nativeEvent ) { // ... // æ ¹æ®äº‹ä»¶ç±»å‹ç¡®å®šä¼˜å…ˆçº§ const eventPriority = getEventPriority(topLevelType); let schedulerPriority; switch (eventPriority) { case DiscreteEventPriority: schedulerPriority = ImmediateSchedulerPriority; break; case ContinuousEventPriority: schedulerPriority = UserBlockingSchedulerPriority; break; case DefaultEventPriority: schedulerPriority = NormalSchedulerPriority; break; case IdleEventPriority: schedulerPriority = IdleSchedulerPriority; break; default: schedulerPriority = NormalSchedulerPriority; break; } // ä»¥é€‚å½“çš„ä¼˜å…ˆçº§è°ƒåº¦æ›´æ–° runWithPriority(schedulerPriority, () =\u0026gt; { // å¤„ç†äº‹ä»¶... }); } è¿™æ®µä»£ç å±•ç¤ºäº†äº‹ä»¶å¦‚ä½•å½±å“æ›´æ–°çš„ä¼˜å…ˆçº§ï¼Œä¾‹å¦‚é”®ç›˜è¾“å…¥ç­‰ç¦»æ•£äº‹ä»¶ä¼šè·å¾—æ›´é«˜çš„ä¼˜å…ˆçº§ï¼Œè€Œæ»šåŠ¨ç­‰è¿ç»­äº‹ä»¶åˆ™è·å¾—è¾ƒä½ä¼˜å…ˆçº§ã€‚\nåœ¨å¤„ç†å¤æ‚è¡¨å•çš„é¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬åˆ©ç”¨è¿™ç§äº‹ä»¶ä¼˜å…ˆçº§æœºåˆ¶ï¼Œä½¿å¾—ç”¨æˆ·è¾“å…¥ä¿æŒæµç•…ï¼ŒåŒæ—¶åå°è®¡ç®—ä¸ä¼šé˜»å¡ UI å“åº”ã€‚\nå†™åœ¨æœ€å æ·±å…¥ç ”ç©¶ React äº‹ä»¶ç³»ç»Ÿåï¼Œæˆ‘å¯¹ React çš„ç†è§£æ›´ä¸Šä¸€å±‚æ¥¼ã€‚è™½ç„¶å¤§éƒ¨åˆ†æ—¶å€™æˆ‘ä»¬ä¸éœ€è¦è€ƒè™‘äº‹ä»¶ç³»ç»Ÿçš„å†…éƒ¨å®ç°ï¼Œä½†äº†è§£å…¶åŸç†å¯¹è§£å†³å¤æ‚é—®é¢˜ã€æ€§èƒ½ä¼˜åŒ–å’Œå¤„ç†è¾¹ç¼˜æƒ…å†µéå¸¸æœ‰ä»·å€¼ã€‚\næˆ‘å‘ç°é˜…è¯»æ¡†æ¶æºç çš„æœ€å¤§æ”¶è·ä¸ä»…æ˜¯äº†è§£\u0026quot;å®ƒæ˜¯å¦‚ä½•å®ç°çš„\u0026quot;ï¼Œæ›´é‡è¦çš„æ˜¯ç†è§£\u0026quot;ä¸ºä»€ä¹ˆè¦è¿™æ ·å®ç°\u0026quot;ã€‚React äº‹ä»¶ç³»ç»Ÿçš„è®¾è®¡å……åˆ†ä½“ç°äº† React å›¢é˜Ÿå¯¹å¼€å‘ä½“éªŒã€è·¨å¹³å°å…¼å®¹æ€§å’Œæ€§èƒ½çš„å¹³è¡¡è€ƒè™‘ã€‚\nä¸‹æ¬¡è®¡åˆ’åˆ†äº« React Hook çš„å®ç°åŸç†ï¼Œæ•¬è¯·æœŸå¾…ã€‚\n","permalink":"https://www.yss520.online/zh/posts/react-event-system/","summary":"\u003ch1 id=\"æ­ç§˜-react-äº‹ä»¶ç³»ç»Ÿä»æºç çœ‹åŸç†ä¸ä¼˜åŒ–\"\u003eæ­ç§˜ React äº‹ä»¶ç³»ç»Ÿï¼šä»æºç çœ‹åŸç†ä¸ä¼˜åŒ–\u003c/h1\u003e\n\u003cp\u003eæœ€è¿‘åœ¨ç ”å‘å›¢é˜Ÿå†…åšäº†ä¸€æ¬¡å…³äº React äº‹ä»¶ç³»ç»Ÿçš„åˆ†äº«ï¼Œåå“ä¸é”™ï¼Œå†³å®šæ•´ç†æˆæ–‡ç« åˆ†äº«å‡ºæ¥ã€‚è¿™æ˜¯æˆ‘è¯» React æºç ç³»åˆ—çš„ç¬¬äºŒç¯‡ï¼Œä¸Šæ¬¡åˆ†æäº†è™šæ‹Ÿ DOM çš„å®ç°ç»†èŠ‚ï¼Œè¿™æ¬¡èšç„¦äº‹ä»¶ç³»ç»Ÿã€‚\u003c/p\u003e\n\u003ch2 id=\"äº‹ä»¶ç³»ç»Ÿè¢«è¯¯è§£çš„-react-æ ¸å¿ƒæœºåˆ¶\"\u003eäº‹ä»¶ç³»ç»Ÿï¼šè¢«è¯¯è§£çš„ React æ ¸å¿ƒæœºåˆ¶\u003c/h2\u003e\n\u003cp\u003eå¤§å¤šæ•° React å¼€å‘è€…å¯èƒ½çŸ¥é“ React æœ‰è‡ªå·±çš„äº‹ä»¶ç³»ç»Ÿï¼Œä½†å¾ˆå°‘æœ‰äººèƒ½è¯´æ¸…å®ƒåˆ°åº•åšäº†ä»€ä¹ˆã€‚ç¿»å¼€æºç åæ‰å‘ç°ï¼ŒReact çš„äº‹ä»¶ç³»ç»Ÿæ˜¯ä¸ªç²¾å¿ƒè®¾è®¡çš„å¤æ‚æœºåˆ¶ï¼Œè¿œä¸æ­¢æ˜¯ç®€å•çš„\u0026quot;è¯­æ³•ç³–\u0026quot;ã€‚\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-jsx\" data-lang=\"jsx\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e// å¸¸è§çš„Reactäº‹ä»¶ç»‘å®š\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e\u0026lt;\u003cspan style=\"color:#f92672\"\u003ebutton\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eonClick\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e{\u003cspan style=\"color:#a6e22e\"\u003ehandleClick\u003c/span\u003e}\u0026gt;\u003cspan style=\"color:#a6e22e\"\u003eç‚¹å‡»\u003c/span\u003e\u0026lt;/\u003cspan style=\"color:#f92672\"\u003ebutton\u003c/span\u003e\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eè¿™è¡Œçœ‹ä¼¼æ™®é€šçš„ä»£ç èƒŒåï¼Œéšè—ç€ä¸€æ•´å¥—äº‹ä»¶å¤„ç†æœºåˆ¶ã€‚\u003c/p\u003e\n\u003ch2 id=\"äº‹ä»¶å§”æ‰˜ç†è§£-react-çš„äº‹ä»¶ç»‘å®š\"\u003eäº‹ä»¶å§”æ‰˜ï¼šç†è§£ React çš„äº‹ä»¶ç»‘å®š\u003c/h2\u003e\n\u003cp\u003eç¬¬ä¸€ä¸ªå…³é”®å‘ç°ï¼š\u003cstrong\u003eReact å¹¶ä¸ä¼šæŠŠäº‹ä»¶ç›´æ¥ç»‘å®šåœ¨ DOM å…ƒç´ ä¸Š\u003c/strong\u003eã€‚\u003c/p\u003e\n\u003cp\u003eåœ¨ React 17 ä¹‹å‰ï¼Œæ‰€æœ‰äº‹ä»¶éƒ½è¢«å§”æ‰˜åˆ° document èŠ‚ç‚¹ä¸Šï¼›React 17 ä¹‹åï¼Œæ”¹ä¸ºå§”æ‰˜åˆ° React æ ‘çš„æ ¹ DOM å®¹å™¨ä¸Šï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-javascript\" data-lang=\"javascript\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e// React 17å‰åçš„äº‹ä»¶ç»‘å®šä½ç½®å˜åŒ–ï¼ˆç®€åŒ–çš„æºç ï¼‰\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e// React 16\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003edocument.\u003cspan style=\"color:#a6e22e\"\u003eaddEventListener\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;click\u0026#34;\u003c/span\u003e, \u003cspan style=\"color:#a6e22e\"\u003edispatchEvent\u003c/span\u003e);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e// React 17+\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003erootNode\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003eaddEventListener\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;click\u0026#34;\u003c/span\u003e, \u003cspan style=\"color:#a6e22e\"\u003edispatchEvent\u003c/span\u003e);\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eé€šè¿‡æŸ¥çœ‹ Chrome DevTools çš„ Event Listeners é¢æ¿ï¼Œä½ ä¼šå‘ç°çœŸæ­£çš„äº‹ä»¶ç›‘å¬å™¨å¹¶ä¸åœ¨ä½ å†™ JSX çš„å…ƒç´ ä¸Šï¼Œè€Œæ˜¯åœ¨æ ¹èŠ‚ç‚¹ä¸Šã€‚\u003c/p\u003e\n\u003cp\u003eè¿™ç§äº‹ä»¶å§”æ‰˜æœ‰å‡ ä¸ªé‡è¦å¥½å¤„ï¼š\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eå‡å°‘å†…å­˜å ç”¨ï¼ˆä¸ç”¨ä¸ºæ¯ä¸ªå…ƒç´ éƒ½ç»‘å®šäº‹ä»¶ï¼‰\u003c/li\u003e\n\u003cli\u003eåŠ¨æ€æ·»åŠ çš„å…ƒç´ ä¹Ÿèƒ½å“åº”äº‹ä»¶\u003c/li\u003e\n\u003cli\u003eç®€åŒ–äº† React Fiber æ ‘çš„æ›´æ–°é€»è¾‘\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"åˆæˆäº‹ä»¶ä¸åªæ˜¯åŒ…è£…åŸç”Ÿäº‹ä»¶é‚£ä¹ˆç®€å•\"\u003eåˆæˆäº‹ä»¶ï¼šä¸åªæ˜¯åŒ…è£…åŸç”Ÿäº‹ä»¶é‚£ä¹ˆç®€å•\u003c/h2\u003e\n\u003cp\u003eReact çš„\u003ccode\u003eSyntheticEvent\u003c/code\u003eå¯¹è±¡æ˜¯å¯¹åŸç”Ÿ DOM äº‹ä»¶çš„åŒ…è£…ï¼Œä½†å®ƒåšäº†å¾ˆå¤šé¢å¤–å·¥ä½œï¼š\u003c/p\u003e","title":"Reactäº‹ä»¶ç³»ç»ŸåŸç†ä¸å®è·µ"},{"content":"Hooks çš„æœ¬è´¨ï¼šé“¾è¡¨è€Œéé­”æ³• åˆšå¼€å§‹ä½¿ç”¨ Hooks æ—¶ï¼ŒuseStateçœ‹èµ·æ¥åƒæ˜¯æŸç§\u0026quot;é­”æ³•\u0026quot;â€”â€”ä¸€ä¸ªæ™®é€šå‡½æ•°ç«Ÿç„¶èƒ½è®°ä½ä¸Šæ¬¡æ¸²æŸ“çš„çŠ¶æ€ã€‚ä½†ç¿»å¼€æºç ï¼Œå‘ç°å…¶å®ç°åŸç†å‡ºå¥‡ç®€å•ï¼šå°±æ˜¯ä¸€ä¸ªé“¾è¡¨ã€‚\n// å½“å‰æ­£åœ¨æ¸²æŸ“çš„ç»„ä»¶ let currentlyRenderingFiber = null; // å½“å‰å¤„ç†çš„Hook let currentHook = null; // å·¥ä½œä¸­çš„Hooké“¾è¡¨ let workInProgressHook = null; // useStateçš„ç®€åŒ–å®ç° function useState(initialState) { // è·å–æˆ–åˆ›å»ºå½“å‰Hook const hook = mountWorkInProgressHook(); // åˆå§‹åŒ–state if (hook.memoizedState === undefined) { if (typeof initialState === \u0026#34;function\u0026#34;) { initialState = initialState(); } hook.memoizedState = initialState; } // åˆ›å»ºæ›´æ–°å‡½æ•° const dispatch = dispatchAction.bind(null, currentlyRenderingFiber, hook); return [hook.memoizedState, dispatch]; } // åˆ›å»ºæ–°Hookå¹¶æ·»åŠ åˆ°é“¾è¡¨ function mountWorkInProgressHook() { const hook = { memoizedState: undefined, baseState: undefined, baseQueue: null, queue: null, next: null, }; if (workInProgressHook === null) { // è¿™æ˜¯é“¾è¡¨ä¸­çš„ç¬¬ä¸€ä¸ªHook currentlyRenderingFiber.memoizedState = workInProgressHook = hook; } else { // æ·»åŠ åˆ°é“¾è¡¨æœ«å°¾ workInProgressHook = workInProgressHook.next = hook; } return workInProgressHook; } çœ‹åˆ°è¿™æ®µä»£ç ï¼Œæˆ‘æç„¶å¤§æ‚Ÿã€‚React ä¸ºæ¯ä¸ªå‡½æ•°ç»„ä»¶åˆ›å»ºäº†ä¸€ä¸ª Fiber èŠ‚ç‚¹ï¼Œåœ¨è¿™ä¸ªèŠ‚ç‚¹ä¸ŠæŒ‚è½½äº†ä¸€ä¸ª Hook é“¾è¡¨ã€‚æ¯æ¬¡è°ƒç”¨useStateã€useEffectç­‰ Hook æ—¶ï¼Œéƒ½ä¼šåœ¨è¿™ä¸ªé“¾è¡¨ä¸Šæ·»åŠ ä¸€ä¸ªæ–°èŠ‚ç‚¹ã€‚åœ¨åç»­æ¸²æŸ“æ—¶ï¼ŒReact ä¼šæ²¿ç€è¿™ä¸ªé“¾è¡¨éå†ï¼Œæ‹¿åˆ°å¯¹åº”ä½ç½®çš„ Hook æ•°æ®ã€‚\nè¿™ä¹Ÿè§£é‡Šäº†ä¸ºä»€ä¹ˆ Hook å¿…é¡»æŒ‰å›ºå®šé¡ºåºè°ƒç”¨â€”â€”å› ä¸º React æ˜¯é è°ƒç”¨é¡ºåºæ¥ç¡®å®š Hook å¯¹åº”å…³ç³»çš„ï¼\nuseState ä¸çŠ¶æ€æ›´æ–°æœºåˆ¶ useStateæ˜¯æœ€å¸¸ç”¨çš„ Hookï¼Œæ·±å…¥æºç å¯ä»¥çœ‹åˆ°å®ƒçš„æ›´æ–°æœºåˆ¶ï¼š\n// çŠ¶æ€æ›´æ–°å‡½æ•°çš„ç®€åŒ–å®ç° function dispatchAction(fiber, hook, action) { // åˆ›å»ºæ›´æ–°å¯¹è±¡ const update = { action, next: null, }; // å°†æ›´æ–°æ·»åŠ åˆ°é˜Ÿåˆ— const pending = hook.queue.pending; if (pending === null) { // åˆ›å»ºå¾ªç¯é“¾è¡¨ update.next = update; } else { update.next = pending.next; pending.next = update; } hook.queue.pending = update; // è°ƒåº¦æ›´æ–° scheduleUpdateOnFiber(fiber); } æœ‰è¶£çš„æ˜¯ï¼ŒReact å°†çŠ¶æ€æ›´æ–°è®¾è®¡ä¸ºä¸€ä¸ªå¾ªç¯é“¾è¡¨ï¼Œè¿™æ ·å¯ä»¥é«˜æ•ˆåœ°æ·»åŠ å’Œå¤„ç†å¤šä¸ªè¿ç»­æ›´æ–°ã€‚\nåœ¨æˆ‘ä»¬çš„ä¸€ä¸ªå®æ—¶æ•°æ®ä»ªè¡¨ç›˜é¡¹ç›®ä¸­ï¼Œæ˜ç™½è¿™ä¸ªåŸç†åï¼Œæˆ‘ä»¬ä¼˜åŒ–äº†çŠ¶æ€æ›´æ–°é€»è¾‘ï¼Œå‡å°‘äº† 50%ä»¥ä¸Šçš„ä¸å¿…è¦æ¸²æŸ“ï¼š\n// ä¼˜åŒ–å‰ function Counter() { const [count, setCount] = useState(0); function handleClick() { // è¿™ä¼šè§¦å‘ä¸¤æ¬¡æ¸²æŸ“ setCount(count + 1); setCount(count + 1); // å®é™…ä¸Šç¬¬äºŒæ¬¡åŸºäºç›¸åŒçš„countï¼Œç»“æœè¿˜æ˜¯1 } return \u0026lt;button onClick={handleClick}\u0026gt;{count}\u0026lt;/button\u0026gt;; } // ä¼˜åŒ–å function Counter() { const [count, setCount] = useState(0); function handleClick() { // åªè§¦å‘ä¸€æ¬¡æ¸²æŸ“ï¼Œç»“æœä¸º1 setCount((c) =\u0026gt; c + 1); } return \u0026lt;button onClick={handleClick}\u0026gt;{count}\u0026lt;/button\u0026gt;; } useEffect çš„å†…éƒ¨å®ç°ä¸æ¸…ç†æœºåˆ¶ useEffectçš„å®ç°æ¯”useStateå¤æ‚å¾—å¤šï¼Œå®ƒéœ€è¦å¤„ç†ä¾èµ–è¿½è¸ªã€å‰¯ä½œç”¨æ‰§è¡Œå’Œæ¸…ç†ç­‰é—®é¢˜ï¼š\n// useEffectçš„ç®€åŒ–å®ç° function useEffect(create, deps) { const hook = mountWorkInProgressHook(); // æ£€æŸ¥ä¾èµ–æ˜¯å¦å˜åŒ– const nextDeps = deps === undefined ? null : deps; hook.memoizedState = { tag: HookEffectTag, create, // å‰¯ä½œç”¨å‡½æ•° destroy: undefined, // æ¸…ç†å‡½æ•° deps: nextDeps, next: null, }; // å°†effectæ·»åŠ åˆ°fiberçš„å‰¯ä½œç”¨é“¾è¡¨ pushEffect(HookEffectTag, create, undefined, nextDeps); } // æäº¤é˜¶æ®µæ‰§è¡Œeffect function commitHookEffectList(tag, fiber) { let effect = fiber.updateQueue.firstEffect; while (effect !== null) { // æ‰§è¡Œä¸Šä¸€æ¬¡æ¸²æŸ“çš„æ¸…ç†å‡½æ•° if (effect.destroy !== undefined) { effect.destroy(); } // æ‰§è¡Œè¿™æ¬¡æ¸²æŸ“çš„å‰¯ä½œç”¨å‡½æ•°ï¼Œå¹¶ä¿å­˜æ¸…ç†å‡½æ•° const create = effect.create; effect.destroy = create(); effect = effect.next; } } åœ¨æºç ä¸­ï¼ŒuseEffectçš„æ‰§è¡Œæ˜¯åœ¨æäº¤é˜¶æ®µçš„å¸ƒå±€é˜¶æ®µä¹‹åã€‚è¿™æ˜¯ä¸ªé‡è¦å‘ç°ï¼Œå› ä¸ºå®ƒè§£é‡Šäº†ä¸ºä»€ä¹ˆuseEffectæ€»æ˜¯åœ¨æµè§ˆå™¨ç»˜åˆ¶ä¹‹åæ‰§è¡Œï¼Œé€‚åˆè¿›è¡Œç½‘ç»œè¯·æ±‚ç­‰å‰¯ä½œç”¨æ“ä½œã€‚\nç›¸æ¯”ä¹‹ä¸‹ï¼ŒuseLayoutEffectåˆ™åœ¨å¸ƒå±€é˜¶æ®µæ‰§è¡Œï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆå®ƒå¯ä»¥ç”¨æ¥æµ‹é‡ DOM å¹¶åŒæ­¥æ›´æ–°æ ·å¼ï¼Œé¿å…é—ªçƒã€‚\næˆ‘ä»¬åœ¨ä¸€ä¸ªæ‹–æ‹½ç»„ä»¶ä¸­åˆ©ç”¨è¿™ä¸ªç‰¹æ€§ï¼š\nfunction DraggableElement() { const [position, setPosition] = useState({ x: 0, y: 0 }); const elementRef = useRef(null); // ä½¿ç”¨useLayoutEffectç¡®ä¿DOMæ›´æ–°å’Œæµ‹é‡åŒæ­¥è¿›è¡Œï¼Œé¿å…é—ªçƒ useLayoutEffect(() =\u0026gt; { if (elementRef.current) { const { width, height } = elementRef.current.getBoundingClientRect(); // ç¡®ä¿å…ƒç´ ä¸è¶…å‡ºå®¹å™¨è¾¹ç•Œ if (position.x + width \u0026gt; window.innerWidth) { setPosition((prev) =\u0026gt; ({ ...prev, x: window.innerWidth - width })); } } }, [position.x]); // ...æ‹–æ‹½é€»è¾‘ return ( \u0026lt;div ref={elementRef} style={{ transform: `translate(${position.x}px, ${position.y}px)` }} \u0026gt; æ‹–æˆ‘ \u0026lt;/div\u0026gt; ); } ä»æºç ç†è§£é—­åŒ…é™·é˜± Hook æœ€å¸¸è§çš„å‘è«è¿‡äº\u0026quot;é—­åŒ…é™·é˜±\u0026quot;ã€‚æ ¹æ®æºç ï¼Œè¿™ä¸ªé—®é¢˜å‘ç”Ÿçš„åŸå› å¾ˆæ¸…æ™°ï¼šå‡½æ•°ç»„ä»¶æ¯æ¬¡æ¸²æŸ“éƒ½ä¼šåˆ›å»ºæ–°çš„å‡½æ•°å®ä¾‹ï¼Œæ•è·å½“æ—¶çš„çŠ¶æ€å€¼ã€‚\nfunction Timer() { const [count, setCount] = useState(0); useEffect(() =\u0026gt; { const timer = setInterval(() =\u0026gt; { setCount(count + 1); // é—­åŒ…!æ•è·çš„æ˜¯ç»„ä»¶é¦–æ¬¡æ¸²æŸ“æ—¶çš„count(0) }, 1000); return () =\u0026gt; clearInterval(timer); }, []); // ç©ºä¾èµ–æ•°ç»„,åªè¿è¡Œä¸€æ¬¡ return \u0026lt;div\u0026gt;{count}\u0026lt;/div\u0026gt;; } ä¸Šé¢çš„ä»£ç ä¸­ï¼Œcountåªä¼šå¢åŠ åˆ° 1 ç„¶ååœæ­¢ã€‚æºç å±‚é¢çš„è§£é‡Šæ˜¯ï¼šeffect åˆ›å»ºæ—¶æ•è·äº† count=0 çš„é—­åŒ…ç¯å¢ƒï¼Œä¹‹åå®šæ—¶å™¨ä¸­çš„å›è°ƒå§‹ç»ˆå¼•ç”¨è¿™ä¸ªé—­åŒ…ã€‚\nä¿®å¤æ–¹æ³•æ˜¯åˆ©ç”¨å‡½æ•°å¼æ›´æ–°æˆ–æ·»åŠ ä¾èµ–ï¼š\n// æ–¹æ¡ˆ1ï¼šå‡½æ•°å¼æ›´æ–° useEffect(() =\u0026gt; { const timer = setInterval(() =\u0026gt; { setCount((c) =\u0026gt; c + 1); // ä½¿ç”¨å‡½æ•°å¼æ›´æ–°,ä¸ä¾èµ–é—­åŒ…ä¸­çš„count }, 1000); return () =\u0026gt; clearInterval(timer); }, []); // æ–¹æ¡ˆ2ï¼šæ·»åŠ ä¾èµ– useEffect(() =\u0026gt; { const timer = setInterval(() =\u0026gt; { setCount(count + 1); // æ¯æ¬¡countå˜åŒ–éƒ½ä¼šé‡æ–°åˆ›å»ºeffect }, 1000); return () =\u0026gt; clearInterval(timer); }, [count]); // æ·»åŠ countä½œä¸ºä¾èµ– åœ¨ä¸€ä¸ªå®æ—¶åä½œç¼–è¾‘å™¨é¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬å°±è¸©è¿‡è¿™ä¸ªå‘ã€‚åæ¥åˆ›å»ºäº†ä¸€ä¸ªå·¥å…·é’©å­ï¼Œè‡ªåŠ¨å¤„ç†è¿™ç±»é—®é¢˜ï¼š\nfunction useLatestValue(value) { const ref = useRef(value); // æ›´æ–°refä»¥æŒ‡å‘æœ€æ–°å€¼ useEffect(() =\u0026gt; { ref.current = value; }); return ref; } // ä½¿ç”¨ function Component() { const [value, setValue] = useState(\u0026#34;\u0026#34;); const latestValue = useLatestValue(value); useEffect(() =\u0026gt; { const handler = () =\u0026gt; { // æ€»æ˜¯è®¿é—®æœ€æ–°å€¼ï¼Œä¸å—é—­åŒ…é™åˆ¶ console.log(latestValue.current); }; document.addEventListener(\u0026#34;click\u0026#34;, handler); return () =\u0026gt; document.removeEventListener(\u0026#34;click\u0026#34;, handler); }, []); // ç©ºä¾èµ–æ•°ç»„ä¹Ÿä¸ä¼šæœ‰é—®é¢˜ return \u0026lt;input value={value} onChange={(e) =\u0026gt; setValue(e.target.value)} /\u0026gt;; } ä¾èµ–æ•°ç»„çš„å·¥ä½œåŸç† Hook çš„ä¾èµ–æ•°ç»„çœ‹ä¼¼ç®€å•ï¼Œä½†æºç å®ç°å¾ˆæœ‰æ„æ€ï¼š\n// ç®€åŒ–ç‰ˆä¾èµ–å¯¹æ¯”å‡½æ•° function areHookInputsEqual(nextDeps, prevDeps) { if (prevDeps === null) { return false; } for (let i = 0; i \u0026lt; prevDeps.length \u0026amp;\u0026amp; i \u0026lt; nextDeps.length; i++) { if (Object.is(nextDeps[i], prevDeps[i])) { continue; } return false; } return true; } æ³¨æ„ React ä½¿ç”¨Object.isè¿›è¡Œä¾èµ–æ¯”è¾ƒï¼Œè¿™ä¸===æ“ä½œç¬¦æœ‰ç»†å¾®å·®åˆ«ï¼Œæ¯”å¦‚Object.is(NaN, NaN)ä¸ºtrueï¼Œè€ŒNaN === NaNä¸ºfalseã€‚\næ›´é‡è¦çš„æ˜¯ï¼Œä¾èµ–æ¯”è¾ƒæ˜¯æµ…æ¯”è¾ƒã€‚è¿™åœ¨å¤„ç†å¯¹è±¡å’Œæ•°ç»„æ—¶ç»å¸¸å¼•èµ·å›°æƒ‘ï¼š\nfunction SearchComponent() { const [filters, setFilters] = useState({ category: \u0026#34;all\u0026#34;, minPrice: 0 }); // ğŸ”´ è¿™ä¸ªeffectä¼šåœ¨æ¯æ¬¡æ¸²æŸ“æ—¶æ‰§è¡Œ,å³ä½¿filtersæ²¡æœ‰å®é™…å˜åŒ– useEffect(() =\u0026gt; { fetchResults(filters); }, [filters]); // filtersæ˜¯æ¯æ¬¡æ¸²æŸ“åˆ›å»ºçš„æ–°å¯¹è±¡ return ( \u0026lt;button onClick={() =\u0026gt; setFilters({ ...filters })}\u0026gt;åˆ·æ–°(å…¶å®æ²¡å˜)\u0026lt;/button\u0026gt; ); } ç†è§£è¿™ä¸€ç‚¹åï¼Œæˆ‘ä»¬åœ¨å›¢é˜Ÿä¸­æ¨å¹¿äº†å‡ ç§æœ€ä½³å®è·µï¼š\næ‹†åˆ†å¯¹è±¡çŠ¶æ€ function BetterSearchComponent() { const [category, setCategory] = useState(\u0026#34;all\u0026#34;); const [minPrice, setMinPrice] = useState(0); // âœ… åªæœ‰å½“ç¡®å®éœ€è¦æ›´æ–°æ—¶æ‰ä¼šæ‰§è¡Œ useEffect(() =\u0026gt; { fetchResults({ category, minPrice }); }, [category, minPrice]); return ( \u0026lt;\u0026gt; \u0026lt;button onClick={() =\u0026gt; setCategory(\u0026#34;electronics\u0026#34;)}\u0026gt;ç”µå­äº§å“\u0026lt;/button\u0026gt; \u0026lt;button onClick={() =\u0026gt; setMinPrice(100)}\u0026gt;100å…ƒä»¥ä¸Š\u0026lt;/button\u0026gt; \u0026lt;/\u0026gt; ); } ä½¿ç”¨useMemoç¼“å­˜å¯¹è±¡ function MemoizedSearchComponent() { const [category, setCategory] = useState(\u0026#34;all\u0026#34;); const [minPrice, setMinPrice] = useState(0); // åªæœ‰ä¾èµ–å˜åŒ–æ—¶æ‰åˆ›å»ºæ–°å¯¹è±¡ const filters = useMemo(() =\u0026gt; { return { category, minPrice }; }, [category, minPrice]); useEffect(() =\u0026gt; { fetchResults(filters); }, [filters]); // filtersç°åœ¨æ˜¯ç¨³å®šçš„å¼•ç”¨ return (...); } è‡ªå®šä¹‰ Hook çš„åŸç†ä¸è®¾è®¡æ¨¡å¼ è‡ªå®šä¹‰ Hook çœ‹ä¼¼æ˜¯ä¸ªæ–°æ¦‚å¿µï¼Œä½†æºç è¡¨æ˜å®ƒä»…ä»…æ˜¯å‡½æ•°å¤ç”¨çš„æ¨¡å¼ï¼Œæ²¡æœ‰ä»»ä½•ç‰¹æ®Šå®ç°ï¼š\n// è¿™ä¸æ˜¯Reactå†…éƒ¨ä»£ç ,è€Œæ˜¯å±•ç¤ºè‡ªå®šä¹‰Hookçš„åŸç† function useCustomHook(param) { // è°ƒç”¨å†…ç½®Hook const [state, setState] = useState(initialState); // å¯èƒ½çš„å‰¯ä½œç”¨ useEffect(() =\u0026gt; { // å¤„ç†é€»è¾‘ }, [param]); // è¿”å›éœ€è¦çš„æ•°æ®å’Œæ–¹æ³• return { state, update: setState, // å…¶ä»–é€»è¾‘... }; } è‡ªå®šä¹‰ Hook çš„é­”åŠ›åœ¨äºå®ƒéµå¾ªäº† Hook çš„è°ƒç”¨è§„åˆ™ï¼Œå¯ä»¥åœ¨å†…éƒ¨ä½¿ç”¨å…¶ä»– Hookã€‚è¿™åˆ›é€ äº†å¼ºå¤§çš„ç»„åˆèƒ½åŠ›ã€‚\nåœ¨ä¸€ä¸ªç®¡ç†ç³»ç»Ÿé‡æ„ä¸­ï¼Œæˆ‘ä»¬æå–äº†å‡ åä¸ªè‡ªå®šä¹‰ Hookï¼Œå¤§å¹…å‡å°‘äº†ä»£ç é‡å¤ã€‚æ¯”å¦‚è¿™ä¸ªå¤„ç† API è¯·æ±‚çš„ Hookï¼š\nfunction useApi(endpoint, options = {}) { const [data, setData] = useState(null); const [loading, setLoading] = useState(false); const [error, setError] = useState(null); const optionsRef = useRef(options); // ä»…å½“optionsçš„stringifiedç‰ˆæœ¬å˜åŒ–æ—¶æ›´æ–°ref useEffect(() =\u0026gt; { optionsRef.current = options; }, [JSON.stringify(options)]); const fetchData = useCallback(async () =\u0026gt; { setLoading(true); setError(null); try { const response = await fetch(endpoint, optionsRef.current); if (!response.ok) throw new Error(`API error: ${response.status}`); const result = await response.json(); setData(result); } catch (err) { setError(err.message || \u0026#34;Unknown error\u0026#34;); console.error(\u0026#34;API request failed:\u0026#34;, err); } finally { setLoading(false); } }, [endpoint]); // åªä¾èµ–endpointï¼Œä¸ä¾èµ–optionså¯¹è±¡ useEffect(() =\u0026gt; { fetchData(); }, [fetchData]); return { data, loading, error, refetch: fetchData }; } è¿™ä¸ª Hook è§£å†³äº†å‡ ä¸ªå¸¸è§é—®é¢˜ï¼š\nå¤„ç†åŠ è½½å’Œé”™è¯¯çŠ¶æ€ è§£å†³å¯¹è±¡ä¾èµ–é—®é¢˜ æä¾›é‡æ–°è·å–æ•°æ®çš„èƒ½åŠ› åœ¨ç»„ä»¶å¸è½½åé¿å…è®¾ç½®çŠ¶æ€ Hook ä¸ Fiber æ¶æ„çš„å…³ç³» æ·±å…¥æºç åï¼Œå‘ç° Hook ä¸ React çš„ Fiber æ¶æ„ç´§å¯†ç›¸è¿ã€‚æ¯ä¸ªå‡½æ•°ç»„ä»¶å®ä¾‹å…³è”ä¸€ä¸ª Fiber èŠ‚ç‚¹ï¼Œè¿™ä¸ªèŠ‚ç‚¹çš„memoizedStateå±æ€§ä¿å­˜äº†è¯¥ç»„ä»¶çš„ Hook é“¾è¡¨ã€‚\n// FiberèŠ‚ç‚¹ç»“æ„(ç®€åŒ–) const fiber = { tag: FunctionComponent, type: YourComponent, memoizedState: { // ç¬¬ä¸€ä¸ªHook memoizedState: \u0026#39;hookçŠ¶æ€\u0026#39;, baseState: \u0026#39;hookåŸºç¡€çŠ¶æ€\u0026#39;, queue: {/*æ›´æ–°é˜Ÿåˆ—*/}, baseQueue: null, next: { // ä¸‹ä¸€ä¸ªHook memoizedState: /*...*/, /*...*/ next: /*...*/ } }, // ...å…¶ä»–Fiberå±æ€§ }; é€šè¿‡è·Ÿè¸ªæºç ä¸­çš„å‡½æ•°è°ƒç”¨é“¾ï¼Œå¯ä»¥çœ‹åˆ° Hook æ˜¯å¦‚ä½•åœ¨æ¸²æŸ“è¿‡ç¨‹ä¸­è¢«å¤„ç†çš„ï¼š\nrenderWithHooks â†“ ç»„ä»¶å‡½æ•°æ‰§è¡Œ(è°ƒç”¨å„ç§hook) â†“ å„hookå†…éƒ¨(useState, useEffectç­‰) â†“ mountWorkInProgressHook / updateWorkInProgressHook â†“ å°†hookæ·»åŠ åˆ°fiber.memoizedStateé“¾è¡¨ äº†è§£è¿™ä¸€ç‚¹å¯¹è°ƒè¯•å¤æ‚çš„ Hook é—®é¢˜éå¸¸æœ‰å¸®åŠ©ã€‚åœ¨ React DevTools ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥æ‰¾åˆ°ç»„ä»¶å¯¹åº”çš„ Fiberï¼Œç„¶ååœ¨æ§åˆ¶å°ä¸­æ£€æŸ¥å…¶ memoizedState æ¥æ·±å…¥äº†è§£ Hook çš„çŠ¶æ€ã€‚\nHooks ä¸­çš„å¸¸è§æ€§èƒ½é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ 1. è¿‡åº¦ä¾èµ– useEffect æºç æ˜¾ç¤ºï¼Œæ¯æ¬¡æ‰§è¡ŒuseEffectéƒ½æœ‰ä¸€å®šå¼€é”€ï¼Œå°¤å…¶æ˜¯åœ¨æ¸…ç†å’Œé‡æ–°æ‰§è¡Œå‰¯ä½œç”¨æ—¶ã€‚\n// ğŸ”´ ä½æ•ˆæ¨¡å¼ function SearchResults({ query }) { const [results, setResults] = useState([]); // æ¯æ¬¡æ¸²æŸ“åéƒ½ä¼šæ‰§è¡Œ useEffect(() =\u0026gt; { // è¿‡æ»¤æœ¬åœ°æ•°æ® const filteredResults = filterData(query); setResults(filteredResults); }); return \u0026lt;ResultsList data={results} /\u0026gt;; } // âœ… ä¼˜åŒ–æ¨¡å¼ function SearchResults({ query }) { // ç›´æ¥åœ¨æ¸²æŸ“æœŸé—´è®¡ç®—,æ— éœ€effect const results = useMemo(() =\u0026gt; { return filterData(query); }, [query]); return \u0026lt;ResultsList data={results} /\u0026gt;; } 2. å¤æ‚çŠ¶æ€ç®¡ç† å½“çŠ¶æ€é€»è¾‘å˜å¾—å¤æ‚æ—¶ï¼Œå¤šä¸ªuseStateè°ƒç”¨ä¼šå˜å¾—éš¾ä»¥ç®¡ç†ã€‚useReduceræ˜¯æºç ä¸­ä¸“ä¸ºæ­¤è®¾è®¡çš„è§£å†³æ–¹æ¡ˆï¼š\nfunction complexFormReducer(state, action) { switch (action.type) { case \u0026#34;field_change\u0026#34;: return { ...state, [action.field]: action.value }; case \u0026#34;submit_start\u0026#34;: return { ...state, isSubmitting: true, error: null }; case \u0026#34;submit_success\u0026#34;: return { ...state, isSubmitting: false, isSuccess: true }; case \u0026#34;submit_error\u0026#34;: return { ...state, isSubmitting: false, error: action.error }; default: return state; } } function ComplexForm() { const [state, dispatch] = useReducer(complexFormReducer, { username: \u0026#34;\u0026#34;, password: \u0026#34;\u0026#34;, isSubmitting: false, error: null, isSuccess: false, }); // è¡¨å•æäº¤å¤„ç† async function handleSubmit(e) { e.preventDefault(); dispatch({ type: \u0026#34;submit_start\u0026#34; }); try { await submitForm(state.username, state.password); dispatch({ type: \u0026#34;submit_success\u0026#34; }); } catch (error) { dispatch({ type: \u0026#34;submit_error\u0026#34;, error: error.message }); } } return \u0026lt;form onSubmit={handleSubmit}\u0026gt;{/* è¡¨å•å­—æ®µ */}\u0026lt;/form\u0026gt;; } 3. é¿å…è¿‡åº¦ä½¿ç”¨ useMemo å’Œ useCallback é˜…è¯»æºç åå‘ç°ï¼Œè¿™äº› Hook æœ¬èº«ä¹Ÿæœ‰å¼€é”€ã€‚ç›²ç›®ä½¿ç”¨å¯èƒ½é€‚å¾—å…¶åï¼š\nfunction Component(props) { // ğŸ”´ å¯¹äºç®€å•è®¡ç®—,è¿™æ ·åšæ˜¯è¿‡åº¦ä¼˜åŒ– const value = useMemo(() =\u0026gt; props.a + props.b, [props.a, props.b]); // ğŸ”´ å¦‚æœè¿™ä¸ªå‡½æ•°æ²¡æœ‰è¢«ä¼ é€’ç»™å­ç»„ä»¶æˆ–å…¶ä»–Hook,è¿™æ˜¯ä¸å¿…è¦çš„ const handleClick = useCallback(() =\u0026gt; { console.log(props.name); }, [props.name]); } æˆ‘ä»¬å»ºç«‹äº†ä¸€ä¸ªç®€å•çš„å‡†åˆ™ï¼š\nåªæœ‰å½“è®¡ç®—å¼€é”€å¤§æˆ–ä¾èµ–æ•°ç»„ç¨³å®šæ—¶ï¼Œæ‰ä½¿ç”¨useMemo åªæœ‰å½“å‡½æ•°ä¼ é€’ç»™å­ç»„ä»¶æˆ–å…¶ä»– Hook ä¾èµ–å®ƒæ—¶ï¼Œæ‰ä½¿ç”¨useCallback ä¸€äº›ä¸ä¸ºäººçŸ¥çš„ Hook æŠ€å·§ é€šè¿‡é˜…è¯»æºç ï¼Œæˆ‘å‘ç°äº†ä¸€äº›é²œä¸ºäººçŸ¥ä½†å¾ˆæœ‰ç”¨çš„æŠ€å·§ï¼š\n1. æƒ°æ€§åˆå§‹åŒ– useStateå’ŒuseReduceræ”¯æŒæƒ°æ€§åˆå§‹åŒ–ï¼Œé¿å…æ¯æ¬¡æ¸²æŸ“éƒ½æ‰§è¡Œæ˜‚è´µçš„åˆå§‹åŒ–ï¼š\n// æ™®é€šåˆå§‹åŒ– const [state, setState] = useState(createExpensiveInitialState()); // æƒ°æ€§åˆå§‹åŒ– - åªåœ¨é¦–æ¬¡æ¸²æŸ“æ‰§è¡ŒcreateExpensiveInitialState const [state, setState] = useState(() =\u0026gt; createExpensiveInitialState()); 2. åˆ©ç”¨ useRef çš„ç¨³å®šæ€§ useRefè¿”å›çš„å¯¹è±¡åœ¨ç»„ä»¶ç”Ÿå‘½å‘¨æœŸå†…ä¿æŒç¨³å®šå¼•ç”¨ï¼Œå¯ä»¥ç”¨æ¥å­˜å‚¨ä»»ä½•å¯å˜å€¼ï¼š\nfunction usePrevious(value) { const ref = useRef(); // åœ¨æ¸²æŸ“å®Œæˆåæ›´æ–°ref useEffect(() =\u0026gt; { ref.current = value; }); // è¿”å›ä¹‹å‰çš„å€¼ return ref.current; } 3. å·§ç”¨ useLayoutEffect é¿å…é—ªçƒ å½“éœ€è¦åœ¨ DOM æ›´æ–°åç«‹å³æµ‹é‡å’Œä¿®æ”¹ DOM æ—¶ï¼ŒuseLayoutEffectæ¯”useEffectæ›´é€‚åˆï¼š\nfunction AutoResizeTextarea() { const textareaRef = useRef(null); // åœ¨æµè§ˆå™¨é‡ç»˜å‰åŒæ­¥æ‰§è¡Œ useLayoutEffect(() =\u0026gt; { if (textareaRef.current) { const textarea = textareaRef.current; // é‡ç½®é«˜åº¦ textarea.style.height = \u0026#34;auto\u0026#34;; // è®¾ç½®ä¸ºå†…å®¹é«˜åº¦ textarea.style.height = `${textarea.scrollHeight}px`; } }, [textareaRef.current?.value]); return \u0026lt;textarea ref={textareaRef} /\u0026gt;; } ä» Hook åˆ°æœªæ¥ éšç€ React çš„å‘å±•ï¼ŒHook API çš„å®ç°ä¹Ÿåœ¨ä¸æ–­æ”¹è¿›ã€‚æºç ä¸­çš„ä¸€äº›æ³¨é‡Šæš—ç¤ºäº†æœªæ¥çš„å‘å±•æ–¹å‘ï¼š\n// æºç ä¸­çš„æ³¨é‡Š // TODO: Warn if no deps are provided // TODO: In some cases, we could optimize by comparing to the previous deps array // TODO: Consider warning when hooks are used inside a conditional React 18 ä¸­ï¼ŒHook çš„å®ç°å·²ä¸ Concurrent Mode æ·±åº¦æ•´åˆã€‚ä¾‹å¦‚ï¼ŒuseDeferredValueå’ŒuseTransitionå…è®¸æˆ‘ä»¬æ ‡è®°ä½ä¼˜å…ˆçº§æ›´æ–°ï¼Œè¿™äº› API çš„å®ç°ä¾èµ–äºæ–°çš„è°ƒåº¦å™¨ã€‚\né€šè¿‡ Hookï¼ŒReact å›¢é˜Ÿæ­£é€æ­¥å®ç°å£°æ˜å¼è°ƒåº¦çš„æ„¿æ™¯ï¼Œè®©å¼€å‘è€…èƒ½ä»¥ç®€å•çš„ API æ§åˆ¶å¤æ‚çš„æ›´æ–°è°ƒåº¦ã€‚æˆ‘é¢„è®¡åœ¨æœªæ¥çš„ç‰ˆæœ¬ä¸­ï¼Œæˆ‘ä»¬ä¼šçœ‹åˆ°æ›´å¤šä¸æ€§èƒ½ä¼˜åŒ–å’Œå¹¶å‘æ¸²æŸ“ç›¸å…³çš„ Hookã€‚\næ€»ç»“ React Hooks çš„è®¾è®¡å®ç°äº†å‡½æ•°ç»„ä»¶ä¸ç±»ç»„ä»¶åŒç­‰çš„èƒ½åŠ›ï¼Œç”šè‡³åœ¨æŸäº›åœºæ™¯ä¸‹å…·æœ‰æ›´å¥½çš„è¡¨ç°ã€‚ç†è§£å…¶é“¾è¡¨å®ç°åŸç†ï¼Œèƒ½å¸®åŠ©æˆ‘ä»¬å†™å‡ºæ›´ç¬¦åˆå…¶è®¾è®¡ç†å¿µçš„ä»£ç ï¼Œé¿å…å¸¸è§é”™è¯¯ï¼Œå……åˆ†å‘æŒ¥ Hooks çš„å¨åŠ›ã€‚\næ­£å¦‚ Dan Abramov æ‰€è¯´ï¼š\u0026ldquo;Hooks ä¸ä»…æ˜¯ API çš„æ”¹å˜ï¼Œæ›´æ˜¯æ€ç»´æ¨¡å¼çš„è½¬å˜ã€‚\u0026ldquo;æŒæ¡é’©å­ï¼Œæ„å‘³ç€æŒæ¡äº† React æœªæ¥çš„æ–¹å‘ã€‚\nç›¸å…³é˜…è¯» React è™šæ‹Ÿ DOM æ·±åº¦å‰–æ - ç†è§£ React æ¸²æŸ“çš„æ ¸å¿ƒæœºåˆ¶ React Node ä¸ JSX è½¬æ¢æœºåˆ¶è¯¦è§£ - äº†è§£ React å…ƒç´ çš„åˆ›å»ºè¿‡ç¨‹ React äº‹ä»¶ç³»ç»ŸåŸç†ä¸å®è·µ - æ¢ç´¢ React çš„äº‹ä»¶å¤„ç†æœºåˆ¶ ","permalink":"https://www.yss520.online/zh/posts/react-hook/","summary":"\u003ch2 id=\"hooks-çš„æœ¬è´¨é“¾è¡¨è€Œéé­”æ³•\"\u003eHooks çš„æœ¬è´¨ï¼šé“¾è¡¨è€Œéé­”æ³•\u003c/h2\u003e\n\u003cp\u003eåˆšå¼€å§‹ä½¿ç”¨ Hooks æ—¶ï¼Œ\u003ccode\u003euseState\u003c/code\u003eçœ‹èµ·æ¥åƒæ˜¯æŸç§\u0026quot;é­”æ³•\u0026quot;â€”â€”ä¸€ä¸ªæ™®é€šå‡½æ•°ç«Ÿç„¶èƒ½è®°ä½ä¸Šæ¬¡æ¸²æŸ“çš„çŠ¶æ€ã€‚ä½†ç¿»å¼€æºç ï¼Œå‘ç°å…¶å®ç°åŸç†å‡ºå¥‡ç®€å•ï¼š\u003cstrong\u003eå°±æ˜¯ä¸€ä¸ªé“¾è¡¨\u003c/strong\u003eã€‚\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-javascript\" data-lang=\"javascript\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e// å½“å‰æ­£åœ¨æ¸²æŸ“çš„ç»„ä»¶\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003elet\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003ecurrentlyRenderingFiber\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003enull\u003c/span\u003e;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e// å½“å‰å¤„ç†çš„Hook\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003elet\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003ecurrentHook\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003enull\u003c/span\u003e;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e// å·¥ä½œä¸­çš„Hooké“¾è¡¨\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003elet\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eworkInProgressHook\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003enull\u003c/span\u003e;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e// useStateçš„ç®€åŒ–å®ç°\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003efunction\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003euseState\u003c/span\u003e(\u003cspan style=\"color:#a6e22e\"\u003einitialState\u003c/span\u003e) {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#75715e\"\u003e// è·å–æˆ–åˆ›å»ºå½“å‰Hook\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e  \u003cspan style=\"color:#66d9ef\"\u003econst\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003ehook\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003emountWorkInProgressHook\u003c/span\u003e();\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#75715e\"\u003e// åˆå§‹åŒ–state\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e  \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e (\u003cspan style=\"color:#a6e22e\"\u003ehook\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003ememoizedState\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e===\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003eundefined\u003c/span\u003e) {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e (\u003cspan style=\"color:#66d9ef\"\u003etypeof\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003einitialState\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e===\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;function\u0026#34;\u003c/span\u003e) {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#a6e22e\"\u003einitialState\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003einitialState\u003c/span\u003e();\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    }\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#a6e22e\"\u003ehook\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003ememoizedState\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003einitialState\u003c/span\u003e;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  }\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#75715e\"\u003e// åˆ›å»ºæ›´æ–°å‡½æ•°\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e  \u003cspan style=\"color:#66d9ef\"\u003econst\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003edispatch\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003edispatchAction\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003ebind\u003c/span\u003e(\u003cspan style=\"color:#66d9ef\"\u003enull\u003c/span\u003e, \u003cspan style=\"color:#a6e22e\"\u003ecurrentlyRenderingFiber\u003c/span\u003e, \u003cspan style=\"color:#a6e22e\"\u003ehook\u003c/span\u003e);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#66d9ef\"\u003ereturn\u003c/span\u003e [\u003cspan style=\"color:#a6e22e\"\u003ehook\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003ememoizedState\u003c/span\u003e, \u003cspan style=\"color:#a6e22e\"\u003edispatch\u003c/span\u003e];\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e// åˆ›å»ºæ–°Hookå¹¶æ·»åŠ åˆ°é“¾è¡¨\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003efunction\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003emountWorkInProgressHook\u003c/span\u003e() {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#66d9ef\"\u003econst\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003ehook\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#a6e22e\"\u003ememoizedState\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e:\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003eundefined\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#a6e22e\"\u003ebaseState\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e:\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003eundefined\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#a6e22e\"\u003ebaseQueue\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e:\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003enull\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#a6e22e\"\u003equeue\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e:\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003enull\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#a6e22e\"\u003enext\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e:\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003enull\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  };\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e (\u003cspan style=\"color:#a6e22e\"\u003eworkInProgressHook\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e===\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003enull\u003c/span\u003e) {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#75715e\"\u003e// è¿™æ˜¯é“¾è¡¨ä¸­çš„ç¬¬ä¸€ä¸ªHook\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e    \u003cspan style=\"color:#a6e22e\"\u003ecurrentlyRenderingFiber\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003ememoizedState\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eworkInProgressHook\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003ehook\u003c/span\u003e;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  } \u003cspan style=\"color:#66d9ef\"\u003eelse\u003c/span\u003e {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#75715e\"\u003e// æ·»åŠ åˆ°é“¾è¡¨æœ«å°¾\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e    \u003cspan style=\"color:#a6e22e\"\u003eworkInProgressHook\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eworkInProgressHook\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003enext\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003ehook\u003c/span\u003e;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  }\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#66d9ef\"\u003ereturn\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eworkInProgressHook\u003c/span\u003e;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eçœ‹åˆ°è¿™æ®µä»£ç ï¼Œæˆ‘æç„¶å¤§æ‚Ÿã€‚React ä¸ºæ¯ä¸ªå‡½æ•°ç»„ä»¶åˆ›å»ºäº†ä¸€ä¸ª Fiber èŠ‚ç‚¹ï¼Œåœ¨è¿™ä¸ªèŠ‚ç‚¹ä¸ŠæŒ‚è½½äº†ä¸€ä¸ª Hook é“¾è¡¨ã€‚æ¯æ¬¡è°ƒç”¨\u003ccode\u003euseState\u003c/code\u003eã€\u003ccode\u003euseEffect\u003c/code\u003eç­‰ Hook æ—¶ï¼Œéƒ½ä¼šåœ¨è¿™ä¸ªé“¾è¡¨ä¸Šæ·»åŠ ä¸€ä¸ªæ–°èŠ‚ç‚¹ã€‚åœ¨åç»­æ¸²æŸ“æ—¶ï¼ŒReact ä¼šæ²¿ç€è¿™ä¸ªé“¾è¡¨éå†ï¼Œæ‹¿åˆ°å¯¹åº”ä½ç½®çš„ Hook æ•°æ®ã€‚\u003c/p\u003e","title":"æ·±å…¥ç†è§£React Hookså®ç°åŸç†"},{"content":"æ‹†è§£ React è™šæ‹Ÿ DOMï¼šæºç åˆ†æä¸å®æˆ˜æ€è€ƒ æœ€è¿‘å‡ å‘¨åœ¨é‡æ„å…¬å¸çš„ä¸€ä¸ªæ ¸å¿ƒé¡¹ç›®ï¼Œå€Ÿæ­¤æœºä¼šæ·±å…¥ç ”è¯»äº† React æºç ï¼Œå°¤å…¶æ˜¯è™šæ‹Ÿ DOM ç›¸å…³çš„å®ç°ã€‚è™½ç„¶ç½‘ä¸Šå…³äºè™šæ‹Ÿ DOM çš„æ–‡ç« ä¸å°‘ï¼Œä½†å¾ˆå¤šåœç•™åœ¨è¡¨é¢æ¦‚å¿µä¸Šï¼Œæ²¡æœ‰çœŸæ­£æ·±å…¥åˆ°æºç ç»†èŠ‚ã€‚è¿™ç¯‡æ–‡ç« æˆ‘æƒ³ä»æºç è§’åº¦åˆ†äº«ä¸€äº›å‘ç°å’Œæ€è€ƒã€‚\nè™šæ‹Ÿ DOM çš„æœ¬è´¨ï¼šä¸åªæ˜¯æ€§èƒ½ä¼˜åŒ– æˆ‘ä»¬å¸¸å¬è¯´è™šæ‹Ÿ DOM æ˜¯ä¸ºäº†æé«˜æ€§èƒ½ï¼Œä½†è¯»æºç åå‘ç°ï¼Œæ€§èƒ½ä¼˜åŒ–å…¶å®åªæ˜¯å®ƒçš„é™„åŠ æ•ˆæœä¹‹ä¸€ã€‚è™šæ‹Ÿ DOM æ›´æœ¬è´¨çš„ä»·å€¼åœ¨äºæä¾›äº†ä¸€ä¸ªä¸­é—´æŠ½è±¡å±‚ï¼Œç®€åŒ–äº† UI ç¼–ç¨‹æ¨¡å‹ã€‚\nReact ä¸­çš„è™šæ‹Ÿ DOM å®é™…ä¸Šæ˜¯ä¸€ä¸ªæ™®é€šçš„ JavaScript å¯¹è±¡ï¼Œå¤§è‡´ç»“æ„å¦‚ä¸‹:\n// Reactå…ƒç´ çš„ç®€åŒ–ç»“æ„ { $$typeof: Symbol(react.element), type: \u0026#39;div\u0026#39;, key: null, props: { className: \u0026#39;container\u0026#39;, children: [ { $$typeof: Symbol(react.element), type: \u0026#39;h1\u0026#39;, props: { children: \u0026#39;Hello\u0026#39; }, // ...å…¶ä»–å±æ€§ } ] }, ref: null, // ...å…¶ä»–å†…éƒ¨å±æ€§ } $$typeofæ˜¯é˜²æ­¢ XSS æ”»å‡»çš„å®‰å…¨æªæ–½ï¼Œå®ƒæ˜¯ä¸€ä¸ª Symbolï¼Œä¸èƒ½åœ¨ JSON ä¸­è¢«è¡¨ç¤ºã€‚\nFiber æ¶æ„ä¸­çš„è™šæ‹Ÿ DOM åœ¨ React 16 å¼•å…¥ Fiber æ¶æ„åï¼Œè™šæ‹Ÿ DOM çš„å®ç°å˜å¾—æ›´åŠ å¤æ‚ã€‚Fiber èŠ‚ç‚¹ä¸ä»…åŒ…å«äº†è™šæ‹Ÿ DOM çš„ä¿¡æ¯ï¼Œè¿˜åŒ…å«äº†è°ƒåº¦å’Œæ¸²æŸ“ç›¸å…³çš„é¢å¤–å­—æ®µ:\n// FiberèŠ‚ç‚¹ç®€åŒ–ç»“æ„ { // é™æ€æ•°æ®ç»“æ„ tag: WorkTag, key: null | string, elementType: any, type: any, stateNode: any, // Fiberé“¾è¡¨ç»“æ„ return: Fiber | null, child: Fiber | null, sibling: Fiber | null, index: number, // å·¥ä½œç›¸å…³ pendingProps: any, memoizedProps: any, memoizedState: any, updateQueue: UpdateQueue\u0026lt;any\u0026gt; | null, // å‰¯ä½œç”¨ç›¸å…³ flags: Flags, subtreeFlags: Flags, deletions: Array\u0026lt;Fiber\u0026gt; | null, // ä¼˜å…ˆçº§ç›¸å…³ lanes: Lanes, childLanes: Lanes, // äº¤æ›¿Fiberï¼ˆåŒç¼“å†²ï¼‰ alternate: Fiber | null, } ä»è¿™ä¸ªç»“æ„å¯ä»¥çœ‹å‡ºï¼ŒFiber èŠ‚ç‚¹è¿œæ¯”è™šæ‹Ÿ DOM å¤æ‚ï¼Œå®ƒä¸ä»…ä»£è¡¨ UIï¼Œè¿˜æ‰¿è½½äº†æ•´ä¸ªæ¸²æŸ“å’Œè°ƒåº¦çš„å®ç°ç»†èŠ‚ã€‚\nDiff ç®—æ³•ï¼šä¸æ˜¯æƒ³è±¡ä¸­é‚£ä¹ˆå¤æ‚ é€šè¿‡é˜…è¯»æºç ï¼Œæˆ‘å‘ç° React çš„ diff ç®—æ³•æ¯”æƒ³è±¡ä¸­ç®€å•ï¼Œå®ƒåŸºäºä¸‰ä¸ªå‡è®¾:\nä¸åŒç±»å‹çš„å…ƒç´ ä¼šäº§ç”Ÿä¸åŒçš„æ ‘ å¼€å‘è€…å¯ä»¥é€šè¿‡ key å±æ€§æš—ç¤ºå“ªäº›å­å…ƒç´ åœ¨ä¸åŒæ¸²æŸ“ä¸­ä¿æŒç¨³å®š åŒçº§æ¯”è¾ƒï¼Œä¸è·¨å±‚çº§ å®é™…çš„ diff å®ç°ä¸»è¦åœ¨reconcileChildFiberså‡½æ•°ä¸­:\nfunction reconcileChildFibers( returnFiber: Fiber, currentFirstChild: Fiber | null, newChild: any, lanes: Lanes ): Fiber | null { // å¤„ç†å•ä¸ªå…ƒç´  if (typeof newChild === \u0026#34;object\u0026#34; \u0026amp;\u0026amp; newChild !== null) { switch (newChild.$$typeof) { case REACT_ELEMENT_TYPE: return placeSingleChild( reconcileSingleElement( returnFiber, currentFirstChild, newChild, lanes ) ); // ... å…¶ä»–ç±»å‹å¤„ç† } } // å¤„ç†æ–‡æœ¬èŠ‚ç‚¹ if (typeof newChild === \u0026#34;string\u0026#34; || typeof newChild === \u0026#34;number\u0026#34;) { return placeSingleChild( reconcileSingleTextNode( returnFiber, currentFirstChild, \u0026#34;\u0026#34; + newChild, lanes ) ); } // å¤„ç†æ•°ç»„/åˆ—è¡¨ if (Array.isArray(newChild)) { return reconcileChildrenArray( returnFiber, currentFirstChild, newChild, lanes ); } // å…¶ä»–æƒ…å†µå¤„ç†... // å¦‚æœéƒ½ä¸åŒ¹é…ï¼Œåˆ é™¤æ‰€æœ‰æ—§å­èŠ‚ç‚¹ return deleteRemainingChildren(returnFiber, currentFirstChild); } æ ¸å¿ƒç®—æ³•å¾ˆç›´è§‚ï¼šæ ¹æ®æ–°å­èŠ‚ç‚¹çš„ç±»å‹é€‰æ‹©ä¸åŒçš„åè°ƒç­–ç•¥ã€‚\næ¸²æŸ“æ—¶æœºä¸æ‰¹é‡æ›´æ–° åœ¨å®é™…é¡¹ç›®ä¸­ç»å¸¸é‡åˆ°çš„ä¸€ä¸ªé—®é¢˜æ˜¯ï¼šReact ä½•æ—¶çœŸæ­£æ›´æ–° DOMï¼Ÿæºç åˆ†æå‘ç°ï¼Œæ¸²æŸ“æµç¨‹åˆ†ä¸ºä¸¤å¤§é˜¶æ®µ:\næ¸²æŸ“é˜¶æ®µ(Render Phase): æ‰§è¡Œ diffï¼Œè¿™ä¸ªè¿‡ç¨‹æ˜¯å¯ä¸­æ–­çš„ æäº¤é˜¶æ®µ(Commit Phase): å°† diff ç»“æœå®é™…åº”ç”¨åˆ° DOMï¼Œè¿™ä¸ªè¿‡ç¨‹ä¸å¯ä¸­æ–­ React 18 å¼•å…¥äº†è‡ªåŠ¨æ‰¹å¤„ç†(Automatic Batching)ï¼Œè¿™åœ¨æºç ä¸­é€šè¿‡ensureRootIsScheduledå‡½æ•°å®ç°:\nfunction ensureRootIsScheduled(root: FiberRoot, currentTime: number) { const existingCallbackNode = root.callbackNode; // ... // æ ¹æ®ä¼˜å…ˆçº§ç¡®å®šè°ƒåº¦ç­–ç•¥ let schedulerPriorityLevel; switch (lanesToEventPriority(nextLanes)) { case DiscreteEventPriority: schedulerPriorityLevel = ImmediateSchedulerPriority; break; case ContinuousEventPriority: schedulerPriorityLevel = UserBlockingSchedulerPriority; break; case DefaultEventPriority: schedulerPriorityLevel = NormalSchedulerPriority; break; case IdleEventPriority: schedulerPriorityLevel = IdleSchedulerPriority; break; default: schedulerPriorityLevel = NormalSchedulerPriority; break; } // è°ƒåº¦æ–°çš„æ¸²æŸ“å·¥ä½œ newCallbackNode = scheduleCallback( schedulerPriorityLevel, performConcurrentWorkOnRoot.bind(null, root) ); // ... } è¿™æ®µä»£ç å±•ç¤ºäº† React å¦‚ä½•æ ¹æ®ä»»åŠ¡ä¼˜å…ˆçº§æ¥è°ƒåº¦æ¸²æŸ“å·¥ä½œï¼Œè¿™æ˜¯æ‰¹å¤„ç†å’Œå¹¶å‘æ¸²æŸ“çš„æ ¸å¿ƒã€‚\nçœŸå®é¡¹ç›®ä¸­çš„ä¼˜åŒ–æŠ€å·§ åœ¨å‰æ®µæ—¶é—´çš„æ€§èƒ½ä¼˜åŒ–é¡¹ç›®ä¸­ï¼Œå‘ç°äº†ä¸€äº›ä¸è™šæ‹Ÿ DOM ç›¸å…³çš„å®æˆ˜ç»éªŒ:\n1. key çš„æ­£ç¡®ä½¿ç”¨æå…¶é‡è¦ å¾ˆå¤šäººçŸ¥é“è¦ç”¨ keyï¼Œä½†ä¸çŸ¥é“ä¸ºä»€ä¹ˆã€‚æºç ä¸­ï¼ŒreconcileChildrenArrayå‡½æ•°ä¼šåˆ©ç”¨ key è¿›è¡Œé«˜æ•ˆçš„èŠ‚ç‚¹å¤ç”¨:\n// ç®€åŒ–åçš„æ•°ç»„diffé€»è¾‘ function reconcileChildrenArray( returnFiber, currentFirstChild, newChildren, lanes ) { // ... // ç¬¬ä¸€è½®: åŒæ—¶éå†æ–°æ—§æ•°ç»„ï¼Œæ¯”è¾ƒç›¸åŒä½ç½®èŠ‚ç‚¹ for (; oldFiber !== null \u0026amp;\u0026amp; newIdx \u0026lt; newChildren.length; newIdx++) { // ... if ( oldFiber.key === newChild.key \u0026amp;\u0026amp; oldFiber.elementType === newChild.type ) { // å¯ä»¥å¤ç”¨èŠ‚ç‚¹ // ... } else { // ä¸èƒ½å¤ç”¨ï¼Œè·³å‡ºç¬¬ä¸€è½®å¾ªç¯ break; } } // ç¬¬äºŒè½®: æ ¹æ®keyå»ºç«‹æ˜ å°„ï¼Œå°è¯•å¤ç”¨å‰©ä½™æ—§èŠ‚ç‚¹ if (oldFiber === null) { // æ—§èŠ‚ç‚¹ç”¨å®Œï¼Œå‰©ä¸‹çš„æ–°èŠ‚ç‚¹å…¨éƒ¨åˆ›å»º // ... } else { // å°†å‰©ä½™æ—§èŠ‚ç‚¹æ”¾å…¥mapä¸­ const existingChildren = mapRemainingChildren(returnFiber, oldFiber); // éå†å‰©ä½™æ–°èŠ‚ç‚¹ï¼Œå°è¯•ä»mapä¸­å¤ç”¨ for (; newIdx \u0026lt; newChildren.length; newIdx++) { const newFiber = updateFromMap( existingChildren, returnFiber, newIdx, newChildren[newIdx], lanes ); // ... } // åˆ é™¤æœªè¢«å¤ç”¨çš„æ—§èŠ‚ç‚¹ // ... } return resultingFirstChild; } è¿™é‡Œæ¸…æ™°åœ°å±•ç¤ºäº† React å¦‚ä½•åˆ©ç”¨ key æé«˜ diff æ•ˆç‡ - å®ƒé¦–å…ˆå°è¯•åŒä½ç½®åŒ¹é…ï¼Œç„¶ååˆ©ç”¨ key æ„å»ºæ˜ å°„è¿›è¡Œå¤ç”¨ã€‚åœ¨å®é™…é¡¹ç›®ä¸­ï¼Œå¯¹äºé¢‘ç¹å˜åŒ–çš„åˆ—è¡¨ï¼Œæ­£ç¡®ä½¿ç”¨ key å¯ä»¥æ˜¾è‘—æå‡æ€§èƒ½ã€‚\n2. å‡å°‘ä¸å¿…è¦çš„åµŒå¥— æˆ‘ä»¬å‘ç°ï¼Œè¿‡åº¦åµŒå¥—çš„ç»„ä»¶ç»“æ„ä¼šå¯¼è‡´æ›´å¤šçš„è™šæ‹Ÿ DOM èŠ‚ç‚¹ï¼Œå¢åŠ  diff å¼€é”€ã€‚åœ¨ä¸€ä¸ªåå°ç³»ç»Ÿé‡æ„ä¸­ï¼Œé€šè¿‡å‡å°‘ä¸å¿…è¦çš„ç»„ä»¶åµŒå¥—ï¼Œæ¸²æŸ“æ€§èƒ½æå‡äº†çº¦ 15%ã€‚\n3. åˆç†æ‹†åˆ†ç»„ä»¶è¾¹ç•Œ è¿™æ˜¯ä¸ªæœ‰è¶£çš„ç»éªŒ - è¿‡åº¦æ‹†åˆ†ç»„ä»¶å¹¶ä¸æ€»æ˜¯å¥½äº‹ã€‚æœ‰æ—¶å€™ï¼Œå°†ç´§å¯†å…³è”çš„ UI é€»è¾‘ä¿æŒåœ¨ä¸€ä¸ªç»„ä»¶å†…å¯ä»¥å‡å°‘è™šæ‹Ÿ DOM çš„å¤„ç†å¼€é”€ã€‚æ¯”å¦‚ï¼Œä¸€ä¸ªé«˜é¢‘æ›´æ–°çš„æ•°æ®é¢æ¿ï¼Œå¦‚æœæ‹†åˆ†æˆè¿‡å¤šå°ç»„ä»¶ï¼Œåè€Œå¯èƒ½å¢åŠ åè°ƒå¼€é”€ã€‚\nè¿›é˜¶æŠ€å·§ä¸é™·é˜± shouldComponentUpdate ä¸ React.memo çš„å†…éƒ¨å®ç° ç¿»é˜…æºç ï¼Œå‘ç°shouldComponentUpdateå’ŒReact.memoåœ¨å†…éƒ¨å®é™…ä¸Šæ˜¯é€šè¿‡è·³è¿‡æ•´ä¸ªå­æ ‘çš„åè°ƒæ¥ä¼˜åŒ–æ€§èƒ½çš„:\n// Classç»„ä»¶çš„ç®€åŒ–åˆ¤æ–­æµç¨‹ if (oldProps === newProps \u0026amp;\u0026amp; oldState === newState \u0026amp;\u0026amp; !hasContextChanged() \u0026amp;\u0026amp; !updateFiberHasScheduledUpdateOrContext) { // æ²¡æœ‰å˜åŒ–ï¼Œè·³è¿‡æ­¤ç»„ä»¶åŠå…¶å­ç»„ä»¶çš„æ›´æ–° return false; } // memoç»„ä»¶çš„ç®€åŒ–åˆ¤æ–­ function updateMemoComponent(...) { // ... if ( current !== null \u0026amp;\u0026amp; !didReceiveUpdate \u0026amp;\u0026amp; shallowEqual(prevProps, nextProps) ) { // propsç›¸ç­‰ï¼Œç›´æ¥å¤ç”¨æ—§Fiber return bailoutOnAlreadyFinishedWork(current, workInProgress, renderLanes); } // ... } è¿™è§£é‡Šäº†ä¸ºä»€ä¹ˆè¿™äº›ä¼˜åŒ–åœ¨å¤§å‹åº”ç”¨ä¸­å¦‚æ­¤æœ‰æ•ˆ - å®ƒä»¬å¯ä»¥æ•´ä½“å‰ªé™¤å¤§å—çš„è™šæ‹Ÿ DOM æ¯”è¾ƒå·¥ä½œã€‚\né¿å…è¿‡åº¦ä¼˜åŒ– æºç é˜…è¯»è®©æˆ‘æ„è¯†åˆ°ï¼ŒReact å†…éƒ¨å·²ç»åšäº†å¤§é‡ä¼˜åŒ–å·¥ä½œã€‚è¿‡æ—©çš„æ€§èƒ½ä¼˜åŒ–å¯èƒ½æ˜¯æœ‰å®³çš„ã€‚æ¯”å¦‚ï¼Œæˆ‘ä»¬æ›¾é‡åˆ°ä¸€ä¸ªæ¡ˆä¾‹ï¼Œå¼€å‘è€…è¿‡åº¦ä½¿ç”¨useMemoå’ŒReact.memoï¼Œå¯¼è‡´ä»£ç å¤æ‚åº¦ä¸Šå‡ï¼Œè€Œæ€§èƒ½æå‡å´ä¸æ˜æ˜¾ã€‚\nReact æºç ä¸­æœ‰ä¸ªæœ‰è¶£çš„æ³¨é‡Š:\n// åœ¨Reactæºç ä¸­ç¡®å®å­˜åœ¨è¿™æ ·çš„æ³¨é‡Š // Profiling indicates this function is a wasteful hot path. // But the majority of its runtime are caused by instances where we won\u0026#39;t // be able to memoize anyway, due to direct mutation. // TODO: Make sure this function gets optimized. è¿™æé†’æˆ‘ä»¬ï¼Œè¦åŸºäºæµ‹é‡è€ŒéçŒœæµ‹æ¥ä¼˜åŒ–ï¼Œä¹Ÿè¦ç•™æ„ React å›¢é˜Ÿæ­£åœ¨è§£å†³çš„çƒ­ç‚¹é—®é¢˜ã€‚\næœªæ¥å‘å±•è¶‹åŠ¿ React çš„ä¼˜åŒ–æ–¹å‘ ç ”ç©¶ React çš„ Fiber æ¶æ„å’Œæœ€æ–°çš„ concurrent mode å®ç°ï¼Œå‘ç° React å›¢é˜Ÿçš„ä¼˜åŒ–æ€è·¯å·²ç»ä»\u0026quot;å‡å°‘ DOM æ“ä½œ\u0026quot;è½¬å‘\u0026quot;æé«˜ç”¨æˆ·ä½“éªŒçš„æµç•…åº¦\u0026quot;ã€‚è¿™æ˜¯ä¸€ä¸ªé‡è¦çš„èŒƒå¼è½¬æ¢ã€‚\næ–°çš„ concurrent features å…è®¸ React:\nä¸­æ–­æ¸²æŸ“ä»¥å“åº”é«˜ä¼˜å…ˆçº§æ›´æ–° åœ¨åå°å‡†å¤‡æ–° UI è€Œä¸é˜»å¡ä¸»çº¿ç¨‹ æœ‰é€‰æ‹©æ€§åœ° hydrate æœåŠ¡ç«¯æ¸²æŸ“å†…å®¹ è¿™äº›èƒ½åŠ›è¿œè¶…ä¼ ç»Ÿè™šæ‹Ÿ DOM çš„è®¾è®¡ç›®æ ‡ã€‚\nåæ€è™šæ‹Ÿ DOM æœ‰è¶£çš„æ˜¯ï¼ŒReact å›¢é˜Ÿçš„ Dan Abramov æ›¾è¡¨ç¤º:\n\u0026ldquo;Virtual DOM è¿™ä¸ªæœ¯è¯­å¯èƒ½è¢«è¿‡åº¦ç‚’ä½œäº†ã€‚å®ƒåªæ˜¯ä¸€ç§å®ç°ç»†èŠ‚ï¼Œè€Œä¸æ˜¯ React çš„æ ¸å¿ƒç‰¹æ€§ã€‚\u0026rdquo;\nè¿™ä¸€ç‚¹åœ¨æºç ä¸­ä¹Ÿèƒ½å¾—åˆ°å°è¯ - è™šæ‹Ÿ DOM æ›´å¤šæ˜¯ä¸€ç§å®ç°æ‰‹æ®µï¼Œè€Œ React çš„æ ¸å¿ƒä»·å€¼åœ¨äºå®ƒçš„ç¼–ç¨‹æ¨¡å‹å’Œç»„ä»¶æŠ½è±¡ã€‚\nå†™åœ¨æœ€å é€šè¿‡æ·±å…¥æºç ï¼Œæˆ‘å¯¹è™šæ‹Ÿ DOM æœ‰äº†æ›´æ¸…æ™°çš„è®¤è¯†ã€‚å®ƒä¸ä»…ä»…æ˜¯ä¸€ç§ä¼˜åŒ–æŠ€æœ¯ï¼Œæ›´æ˜¯ä¸€ç§å¼ºå¤§çš„æŠ½è±¡ï¼Œè®©æˆ‘ä»¬èƒ½å¤Ÿç”¨å£°æ˜å¼çš„æ–¹å¼æ„å»ºå¤æ‚ UIã€‚\nåœ¨æ—¥å¸¸å¼€å‘ä¸­ï¼Œä¸å…¶è¿‡åº¦å…³æ³¨è™šæ‹Ÿ DOM æœ¬èº«ï¼Œä¸å¦‚ä¸“æ³¨äºç¼–å†™ç¬¦åˆ React è®¾è®¡ç†å¿µçš„ç»„ä»¶ - ä¿æŒå•å‘æ•°æ®æµã€é€‚å½“æ‹†åˆ†ç»„ä»¶ã€æ˜ç¡®çŠ¶æ€ç®¡ç†è¾¹ç•Œã€‚è¿™äº›æ‰æ˜¯çœŸæ­£å½±å“åº”ç”¨è´¨é‡çš„å…³é”®å› ç´ ã€‚\næºç æ˜¯æœ€å¥½çš„è€å¸ˆã€‚æ¯å½“æˆ‘é‡åˆ° React ç›¸å…³çš„ç–‘éš¾é—®é¢˜ï¼Œæ€»æ˜¯ä¼šå›åˆ°æºç å¯»æ‰¾ç­”æ¡ˆï¼Œæ¯æ¬¡éƒ½æœ‰æ–°çš„æ”¶è·ã€‚æ¨èæ¯ä½ React å¼€å‘è€…éƒ½å°è¯•é˜…è¯»æºç ï¼Œè¿™ä¼šè®©ä½ å¯¹æ¡†æ¶æœ‰æ›´æœ¬è´¨çš„ç†è§£ã€‚\nä¸‹æ¬¡åˆ†äº«è®¡åˆ’æ·±å…¥ React çš„äº‹ä»¶ç³»ç»Ÿï¼Œæ¬¢è¿å…³æ³¨ã€‚\n","permalink":"https://www.yss520.online/zh/posts/react-virtual-dom/","summary":"\u003ch1 id=\"æ‹†è§£-react-è™šæ‹Ÿ-domæºç åˆ†æä¸å®æˆ˜æ€è€ƒ\"\u003eæ‹†è§£ React è™šæ‹Ÿ DOMï¼šæºç åˆ†æä¸å®æˆ˜æ€è€ƒ\u003c/h1\u003e\n\u003cp\u003eæœ€è¿‘å‡ å‘¨åœ¨é‡æ„å…¬å¸çš„ä¸€ä¸ªæ ¸å¿ƒé¡¹ç›®ï¼Œå€Ÿæ­¤æœºä¼šæ·±å…¥ç ”è¯»äº† React æºç ï¼Œå°¤å…¶æ˜¯è™šæ‹Ÿ DOM ç›¸å…³çš„å®ç°ã€‚è™½ç„¶ç½‘ä¸Šå…³äºè™šæ‹Ÿ DOM çš„æ–‡ç« ä¸å°‘ï¼Œä½†å¾ˆå¤šåœç•™åœ¨è¡¨é¢æ¦‚å¿µä¸Šï¼Œæ²¡æœ‰çœŸæ­£æ·±å…¥åˆ°æºç ç»†èŠ‚ã€‚è¿™ç¯‡æ–‡ç« æˆ‘æƒ³ä»æºç è§’åº¦åˆ†äº«ä¸€äº›å‘ç°å’Œæ€è€ƒã€‚\u003c/p\u003e\n\u003ch2 id=\"è™šæ‹Ÿ-dom-çš„æœ¬è´¨ä¸åªæ˜¯æ€§èƒ½ä¼˜åŒ–\"\u003eè™šæ‹Ÿ DOM çš„æœ¬è´¨ï¼šä¸åªæ˜¯æ€§èƒ½ä¼˜åŒ–\u003c/h2\u003e\n\u003cp\u003eæˆ‘ä»¬å¸¸å¬è¯´è™šæ‹Ÿ DOM æ˜¯ä¸ºäº†æé«˜æ€§èƒ½ï¼Œä½†è¯»æºç åå‘ç°ï¼Œæ€§èƒ½ä¼˜åŒ–å…¶å®åªæ˜¯å®ƒçš„é™„åŠ æ•ˆæœä¹‹ä¸€ã€‚è™šæ‹Ÿ DOM æ›´æœ¬è´¨çš„ä»·å€¼åœ¨äºæä¾›äº†ä¸€ä¸ªä¸­é—´æŠ½è±¡å±‚ï¼Œç®€åŒ–äº† UI ç¼–ç¨‹æ¨¡å‹ã€‚\u003c/p\u003e\n\u003cp\u003eReact ä¸­çš„è™šæ‹Ÿ DOM å®é™…ä¸Šæ˜¯ä¸€ä¸ªæ™®é€šçš„ JavaScript å¯¹è±¡ï¼Œå¤§è‡´ç»“æ„å¦‚ä¸‹:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-javascript\" data-lang=\"javascript\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e// Reactå…ƒç´ çš„ç®€åŒ–ç»“æ„\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e{\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#a6e22e\"\u003e$$typeof\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e:\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eSymbol\u003c/span\u003e(\u003cspan style=\"color:#a6e22e\"\u003ereact\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003eelement\u003c/span\u003e),\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#a6e22e\"\u003etype\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e:\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;div\u0026#39;\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#a6e22e\"\u003ekey\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e:\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003enull\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#a6e22e\"\u003eprops\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e:\u003c/span\u003e {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#a6e22e\"\u003eclassName\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e:\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;container\u0026#39;\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#a6e22e\"\u003echildren\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e:\u003c/span\u003e [\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#a6e22e\"\u003e$$typeof\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e:\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eSymbol\u003c/span\u003e(\u003cspan style=\"color:#a6e22e\"\u003ereact\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003eelement\u003c/span\u003e),\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#a6e22e\"\u003etype\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e:\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;h1\u0026#39;\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#a6e22e\"\u003eprops\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e:\u003c/span\u003e { \u003cspan style=\"color:#a6e22e\"\u003echildren\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e:\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;Hello\u0026#39;\u003c/span\u003e },\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#75715e\"\u003e// ...å…¶ä»–å±æ€§\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e      }\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    ]\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  },\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#a6e22e\"\u003eref\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e:\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003enull\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#75715e\"\u003e// ...å…¶ä»–å†…éƒ¨å±æ€§\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e\u003ccode\u003e$$typeof\u003c/code\u003eæ˜¯é˜²æ­¢ XSS æ”»å‡»çš„å®‰å…¨æªæ–½ï¼Œå®ƒæ˜¯ä¸€ä¸ª Symbolï¼Œä¸èƒ½åœ¨ JSON ä¸­è¢«è¡¨ç¤ºã€‚\u003c/p\u003e\n\u003ch2 id=\"fiber-æ¶æ„ä¸­çš„è™šæ‹Ÿ-dom\"\u003eFiber æ¶æ„ä¸­çš„è™šæ‹Ÿ DOM\u003c/h2\u003e\n\u003cp\u003eåœ¨ React 16 å¼•å…¥ Fiber æ¶æ„åï¼Œè™šæ‹Ÿ DOM çš„å®ç°å˜å¾—æ›´åŠ å¤æ‚ã€‚Fiber èŠ‚ç‚¹ä¸ä»…åŒ…å«äº†è™šæ‹Ÿ DOM çš„ä¿¡æ¯ï¼Œè¿˜åŒ…å«äº†è°ƒåº¦å’Œæ¸²æŸ“ç›¸å…³çš„é¢å¤–å­—æ®µ:\u003c/p\u003e","title":"Reactè™šæ‹ŸDOMæ·±åº¦å‰–æ"},{"content":"é¡¹ç›®èƒŒæ™¯ è´Ÿè´£ä¼˜åŒ–ä¸€ä¸ªå¤§å‹ React ä¼ä¸šåº”ç”¨çš„æ„å»ºè¿‡ç¨‹ã€‚è¯¥åº”ç”¨æœ‰è¶…è¿‡ 200 ä¸ªé¡µé¢ã€300+ç»„ä»¶ï¼Œéšç€ä¸šåŠ¡çš„å¿«é€Ÿå¢é•¿ï¼Œå¼€å‘å›¢é˜Ÿé¢ä¸´ä¸¥å³»çš„æ€§èƒ½æŒ‘æˆ˜ï¼š\næœ¬åœ°å¼€å‘æœåŠ¡å™¨å¯åŠ¨æ—¶é—´è¶…è¿‡ 25 ç§’ çƒ­æ›´æ–°å»¶è¿Ÿ 3-5 ç§’ ç”Ÿäº§ç¯å¢ƒæ„å»ºè€—æ—¶è¶…è¿‡ 2 åˆ†é’Ÿ æ„å»ºäº§ç‰©è¶…è¿‡ 8MB (gzip å 2.8MB) è¿™äº›é—®é¢˜ä¸¥é‡å½±å“äº†å›¢é˜Ÿçš„å¼€å‘æ•ˆç‡å’Œäº§å“è¿­ä»£é€Ÿåº¦ã€‚\nä¼˜åŒ–è¿‡ç¨‹ 1. é—®é¢˜è¯Šæ–­ é¦–å…ˆä½¿ç”¨å„ç§å·¥å…·å¯¹æ„å»ºè¿‡ç¨‹è¿›è¡Œå…¨æ–¹ä½åˆ†æï¼š\n# ä½¿ç”¨Viteå†…ç½®æ€§èƒ½åˆ†æ npm run build -- --profile # ä½¿ç”¨speed-measure-webpack-pluginåˆ†æWebpackéƒ¨åˆ† # ä½¿ç”¨bundle-analyzeråˆ†ææ‰“åŒ…ç»“æœ é€šè¿‡åˆ†ææ‰¾å‡ºäº†ä»¥ä¸‹å…³é”®ç“¶é¢ˆï¼š\nå¤§é‡æœªä¼˜åŒ–çš„ä¾èµ–åŒ… è¿‡åº¦ä½¿ç”¨åŠ¨æ€å¯¼å…¥ ä½æ•ˆçš„ä»£ç åˆ†å‰²ç­–ç•¥ æœªå……åˆ†åˆ©ç”¨ç¼“å­˜ å¤§é‡æœªä¼˜åŒ–çš„å›¾ç‰‡èµ„æº 2. ä¾èµ–ä¼˜åŒ– ä¾èµ–åŒ…ä¼˜åŒ–æ˜¯æœ€æ˜¾è‘—çš„æ”¹è¿›ç‚¹ï¼š\n// vite.config.js export default defineConfig({ optimizeDeps: { include: [ // é¢„æ„å»ºé¢‘ç¹ä½¿ç”¨çš„ä¾èµ– \u0026#34;react\u0026#34;, \u0026#34;react-dom\u0026#34;, \u0026#34;react-router-dom\u0026#34;, \u0026#34;lodash-es\u0026#34;, \u0026#34;@mui/material\u0026#34;, // ... å…¶ä»–å…³é”®ä¾èµ– ], // æ’é™¤ä¸éœ€è¦é¢„æ„å»ºçš„ä¾èµ– exclude: [\u0026#34;large-rarely-used-dependency\u0026#34;], // å¼ºåˆ¶è¿›è¡Œä¾èµ–é¢„æ„å»º force: process.env.NODE_ENV === \u0026#34;production\u0026#34;, }, }); 3. ä»£ç åˆ†å‰²ç­–ç•¥ é‡æ–°è®¾è®¡äº†æ›´æ™ºèƒ½çš„ä»£ç åˆ†å‰²ç­–ç•¥ï¼š\n// vite.config.js export default defineConfig({ build: { rollupOptions: { output: { manualChunks: { \u0026#34;vendor-react\u0026#34;: [\u0026#34;react\u0026#34;, \u0026#34;react-dom\u0026#34;, \u0026#34;react-router-dom\u0026#34;], \u0026#34;vendor-ui\u0026#34;: [\u0026#34;@mui/material\u0026#34;, \u0026#34;@mui/icons-material\u0026#34;], \u0026#34;vendor-utils\u0026#34;: [\u0026#34;lodash-es\u0026#34;, \u0026#34;date-fns\u0026#34;], // åŸºäºæ¨¡å—ä½¿ç”¨é¢‘ç‡çš„åŠ¨æ€åˆ†ç»„ ...autoChunks(), }, }, }, }, }); // è‡ªå®šä¹‰åˆ†ç»„å‡½æ•° function autoChunks() { // åˆ†ææ¨¡å—ä½¿ç”¨æƒ…å†µå¹¶ç”Ÿæˆæœ€ä½³åˆ†ç»„ // ...å®ç°ä»£ç ... } 4. æ„å»ºç¼“å­˜ä¼˜åŒ– å……åˆ†åˆ©ç”¨å„çº§ç¼“å­˜æœºåˆ¶ï¼š\n// vite.config.js export default defineConfig({ // æŒä¹…åŒ–ç¼“å­˜ cacheDir: \u0026#34;.vite-cache\u0026#34;, // è‡ªå®šä¹‰æ’ä»¶ï¼šé«˜çº§ç¼“å­˜ç®¡ç† plugins: [ advancedCachePlugin({ // ç¼“å­˜ç›®å½• cacheDir: \u0026#34;.build-cache\u0026#34;, // ç¼“å­˜æ ¡éªŒç­–ç•¥ validation: { dependencies: true, sources: true, config: true, }, // ç¼“å­˜æ¸…ç†ç­–ç•¥ cleanup: { maxSize: \u0026#34;1GB\u0026#34;, maxAge: \u0026#34;30d\u0026#34;, }, }), ], }); 5. èµ„æºå¤„ç†ä¼˜åŒ– ä¼˜åŒ–å›¾ç‰‡å’Œå…¶ä»–é™æ€èµ„æºçš„å¤„ç†æµç¨‹ï¼š\nimport imagemin from \u0026#34;imagemin\u0026#34;; import imageminWebp from \u0026#34;imagemin-webp\u0026#34;; // vite.config.js export default defineConfig({ plugins: [ // å›¾ç‰‡ä¼˜åŒ–æ’ä»¶ { name: \u0026#34;optimize-images\u0026#34;, async transform(src, id) { if (/\\.(png|jpg|jpeg)$/.test(id)) { // åªåœ¨ç”Ÿäº§ç¯å¢ƒä¼˜åŒ– if (process.env.NODE_ENV === \u0026#34;production\u0026#34;) { // æ ¹æ®ä½¿ç”¨åœºæ™¯ç”Ÿæˆä¸åŒå°ºå¯¸ return await optimizeImage(src, id); } } }, }, ], }); ä¼˜åŒ–æˆæœ é€šè¿‡ä¸€ç³»åˆ—æœ‰é’ˆå¯¹æ€§çš„ä¼˜åŒ–æªæ–½ï¼Œæˆ‘ä»¬å–å¾—äº†æ˜¾è‘—çš„æ€§èƒ½æå‡ï¼š\nå¼€å‘æœåŠ¡å™¨å¯åŠ¨æ—¶é—´: ä» 25 ç§’å‡å°‘åˆ° 3 ç§’ (æå‡ 88%) çƒ­æ›´æ–°æ—¶é—´: ä» 3-5 ç§’å‡å°‘åˆ°çº¦ 300ms (æå‡ 90%) ç”Ÿäº§æ„å»ºæ—¶é—´: ä» 2 åˆ†é’Ÿå‡å°‘åˆ° 8 ç§’ (æå‡ 93%) æ„å»ºäº§ç‰©å¤§å°: ä» 8MB å‡å°‘åˆ° 3.5MB, gzip åä» 2.8MB å‡å°‘åˆ° 1.2MB (æå‡ 57%) é¦–å±åŠ è½½æ—¶é—´: ä» 5 ç§’å‡å°‘åˆ° 1.7 ç§’ (æå‡ 66%) å­¦åˆ°çš„ç»éªŒ åˆ†æå…ˆè¡Œ: ä½¿ç”¨æ­£ç¡®çš„å·¥å…·æ‰¾å‡ºçœŸæ­£çš„ç“¶é¢ˆï¼Œé¿å…ç›²ç›®ä¼˜åŒ– ä¾èµ–ç®¡ç†: åœ¨å¤§å‹é¡¹ç›®ä¸­ï¼Œä¾èµ–ç®¡ç†å¯¹æ€§èƒ½å½±å“å·¨å¤§ è‡ªå®šä¹‰æ’ä»¶: é’ˆå¯¹é¡¹ç›®ç‰¹ç‚¹å¼€å‘è‡ªå®šä¹‰æ’ä»¶å¸¸å¸¸æ¯”é€šç”¨è§£å†³æ–¹æ¡ˆæ›´æœ‰æ•ˆ æ¸è¿›å¼ä¼˜åŒ–: ä¸€æ¬¡å®ç°ä¸€ä¸ªä¼˜åŒ–ï¼ŒéªŒè¯æ•ˆæœåå†è¿›è¡Œä¸‹ä¸€æ­¥ è‡ªåŠ¨åŒ–: å°†ä¼˜åŒ–æªæ–½èå…¥ CI/CD æµç¨‹ï¼Œç¡®ä¿é•¿æœŸç»´æŒæ€§èƒ½ ç›¸å…³æŠ€æœ¯æ–‡ç«  Vite æ„å»º React é¡¹ç›®çš„æè‡´ä¼˜åŒ– ç°ä»£å‰ç«¯å·¥ç¨‹åŒ–å®è·µæŒ‡å— ç°ä»£å‰ç«¯æ¶æ„è®¾è®¡ä¸æ€§èƒ½ä¼˜åŒ– ","permalink":"https://www.yss520.online/zh/projects/vite-optimization/","summary":"\u003ch2 id=\"é¡¹ç›®èƒŒæ™¯\"\u003eé¡¹ç›®èƒŒæ™¯\u003c/h2\u003e\n\u003cp\u003eè´Ÿè´£ä¼˜åŒ–ä¸€ä¸ªå¤§å‹ React ä¼ä¸šåº”ç”¨çš„æ„å»ºè¿‡ç¨‹ã€‚è¯¥åº”ç”¨æœ‰è¶…è¿‡ 200 ä¸ªé¡µé¢ã€300+ç»„ä»¶ï¼Œéšç€ä¸šåŠ¡çš„å¿«é€Ÿå¢é•¿ï¼Œå¼€å‘å›¢é˜Ÿé¢ä¸´ä¸¥å³»çš„æ€§èƒ½æŒ‘æˆ˜ï¼š\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eæœ¬åœ°å¼€å‘æœåŠ¡å™¨å¯åŠ¨æ—¶é—´è¶…è¿‡ 25 ç§’\u003c/li\u003e\n\u003cli\u003eçƒ­æ›´æ–°å»¶è¿Ÿ 3-5 ç§’\u003c/li\u003e\n\u003cli\u003eç”Ÿäº§ç¯å¢ƒæ„å»ºè€—æ—¶è¶…è¿‡ 2 åˆ†é’Ÿ\u003c/li\u003e\n\u003cli\u003eæ„å»ºäº§ç‰©è¶…è¿‡ 8MB (gzip å 2.8MB)\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eè¿™äº›é—®é¢˜ä¸¥é‡å½±å“äº†å›¢é˜Ÿçš„å¼€å‘æ•ˆç‡å’Œäº§å“è¿­ä»£é€Ÿåº¦ã€‚\u003c/p\u003e\n\u003ch2 id=\"ä¼˜åŒ–è¿‡ç¨‹\"\u003eä¼˜åŒ–è¿‡ç¨‹\u003c/h2\u003e\n\u003ch3 id=\"1-é—®é¢˜è¯Šæ–­\"\u003e1. é—®é¢˜è¯Šæ–­\u003c/h3\u003e\n\u003cp\u003eé¦–å…ˆä½¿ç”¨å„ç§å·¥å…·å¯¹æ„å»ºè¿‡ç¨‹è¿›è¡Œå…¨æ–¹ä½åˆ†æï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# ä½¿ç”¨Viteå†…ç½®æ€§èƒ½åˆ†æ\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003enpm run build -- --profile\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# ä½¿ç”¨speed-measure-webpack-pluginåˆ†æWebpackéƒ¨åˆ†\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# ä½¿ç”¨bundle-analyzeråˆ†ææ‰“åŒ…ç»“æœ\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eé€šè¿‡åˆ†ææ‰¾å‡ºäº†ä»¥ä¸‹å…³é”®ç“¶é¢ˆï¼š\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eå¤§é‡æœªä¼˜åŒ–çš„ä¾èµ–åŒ…\u003c/li\u003e\n\u003cli\u003eè¿‡åº¦ä½¿ç”¨åŠ¨æ€å¯¼å…¥\u003c/li\u003e\n\u003cli\u003eä½æ•ˆçš„ä»£ç åˆ†å‰²ç­–ç•¥\u003c/li\u003e\n\u003cli\u003eæœªå……åˆ†åˆ©ç”¨ç¼“å­˜\u003c/li\u003e\n\u003cli\u003eå¤§é‡æœªä¼˜åŒ–çš„å›¾ç‰‡èµ„æº\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"2-ä¾èµ–ä¼˜åŒ–\"\u003e2. ä¾èµ–ä¼˜åŒ–\u003c/h3\u003e\n\u003cp\u003eä¾èµ–åŒ…ä¼˜åŒ–æ˜¯æœ€æ˜¾è‘—çš„æ”¹è¿›ç‚¹ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-javascript\" data-lang=\"javascript\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e// vite.config.js\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003eexport\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003edefault\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003edefineConfig\u003c/span\u003e({\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#a6e22e\"\u003eoptimizeDeps\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e:\u003c/span\u003e {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#a6e22e\"\u003einclude\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e:\u003c/span\u003e [\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#75715e\"\u003e// é¢„æ„å»ºé¢‘ç¹ä½¿ç”¨çš„ä¾èµ–\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e      \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;react\u0026#34;\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;react-dom\u0026#34;\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;react-router-dom\u0026#34;\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;lodash-es\u0026#34;\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;@mui/material\u0026#34;\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#75715e\"\u003e// ... å…¶ä»–å…³é”®ä¾èµ–\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e    ],\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#75715e\"\u003e// æ’é™¤ä¸éœ€è¦é¢„æ„å»ºçš„ä¾èµ–\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e    \u003cspan style=\"color:#a6e22e\"\u003eexclude\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e:\u003c/span\u003e [\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;large-rarely-used-dependency\u0026#34;\u003c/span\u003e],\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#75715e\"\u003e// å¼ºåˆ¶è¿›è¡Œä¾èµ–é¢„æ„å»º\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e    \u003cspan style=\"color:#a6e22e\"\u003eforce\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e:\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eprocess\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003eenv\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003eNODE_ENV\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e===\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;production\u0026#34;\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  },\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e});\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch3 id=\"3-ä»£ç åˆ†å‰²ç­–ç•¥\"\u003e3. ä»£ç åˆ†å‰²ç­–ç•¥\u003c/h3\u003e\n\u003cp\u003eé‡æ–°è®¾è®¡äº†æ›´æ™ºèƒ½çš„ä»£ç åˆ†å‰²ç­–ç•¥ï¼š\u003c/p\u003e","title":"å¤§å‹Reactåº”ç”¨çš„Viteæ„å»ºä¼˜åŒ–"},{"content":"ä¸ªäººç®€ä»‹ å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯ Bruce Liï¼Œä¸€åæ‹¥æœ‰è¶…è¿‡ 8 å¹´ç»éªŒçš„èµ„æ·±å‰ç«¯å·¥ç¨‹å¸ˆï¼Œä¸“æ³¨äºæ„å»ºé«˜æ€§èƒ½ã€ç”¨æˆ·å‹å¥½çš„ Web åº”ç”¨ã€‚\næˆ‘çƒ­è¡·äºå‰æ²¿æŠ€æœ¯ï¼Œå°¤å…¶æ˜¯ React ç”Ÿæ€ç³»ç»Ÿã€æ€§èƒ½ä¼˜åŒ–å’Œå‰ç«¯æ¶æ„è®¾è®¡ã€‚ä½œä¸ºä¸€åæŠ€æœ¯åšä¸»ï¼Œæˆ‘å–œæ¬¢æ·±å…¥ç ”ç©¶æºç ï¼Œåˆ†äº«æˆ‘çš„å‘ç°å’Œç»éªŒï¼Œå¸®åŠ©ä»–äººæå‡æŠ€æœ¯èƒ½åŠ›ã€‚\nåœ¨æˆ‘çš„èŒä¸šç”Ÿæ¶¯ä¸­ï¼Œæˆ‘æ›¾å‚ä¸å¤šä¸ªå¤§å‹é¡¹ç›®çš„å¼€å‘å’Œé‡æ„ï¼Œä»ç”µå•†å¹³å°åˆ°ä¼ä¸šç®¡ç†ç³»ç»Ÿï¼Œä¸æ–­æŒ‘æˆ˜è‡ªæˆ‘ï¼Œè§£å†³å¤æ‚é—®é¢˜ã€‚æˆ‘ç›¸ä¿¡ä¼˜é›…çš„ä»£ç å’Œè‰¯å¥½çš„æ¶æ„æ˜¯æ„å»ºå¯ç»´æŠ¤è½¯ä»¶çš„åŸºç¡€ã€‚\næŠ€æœ¯æ ˆ å‰ç«¯æŠ€æœ¯ æ¡†æ¶: React, Vue.js, Next.js çŠ¶æ€ç®¡ç†: Redux, Zustand æ ·å¼è§£å†³æ–¹æ¡ˆ: Tailwind CSS, Styled Components, SCSS æ„å»ºå·¥å…·: Vite, Webpack, Rollup æµ‹è¯•: Jest, React Testing Library, Cypress èŒä¸šç»å† é«˜çº§å‰ç«¯å·¥ç¨‹å¸ˆ | XXX ç§‘æŠ€æœ‰é™å…¬å¸ 2021 å¹´è‡³ä»Š\nè´Ÿè´£å…¬å¸æ ¸å¿ƒäº§å“çš„å‰ç«¯æ¶æ„å’Œå¼€å‘ å°†é—ç•™å•ä½“åº”ç”¨é‡æ„ä¸ºå¾®å‰ç«¯æ¶æ„ï¼Œæé«˜äº†å›¢é˜Ÿå¼€å‘æ•ˆç‡ 300% å®ç°äº†å¤æ‚æ•°æ®å¯è§†åŒ–ä»ªè¡¨ç›˜ï¼Œæ”¯æŒå®æ—¶æ•°æ®ç›‘æ§å’Œåˆ†æ å»ºç«‹äº†å®Œæ•´çš„å‰ç«¯å·¥ç¨‹åŒ–æµç¨‹ï¼ŒåŒ…æ‹¬è‡ªåŠ¨åŒ–æµ‹è¯•ã€CI/CD å’Œæ€§èƒ½ç›‘æ§ å‰ç«¯å¼€å‘å·¥ç¨‹å¸ˆ | XXX è‚¡ä»½æœ‰é™å…¬å¸ 2019 å¹´ - 2021 å¹´\nå‚ä¸å¼€å‘é«˜æµé‡ç”µå•†å¹³å°ï¼Œæ—¥æ´»ç”¨æˆ·è¶…è¿‡ 100 ä¸‡ ä¼˜åŒ–é¦–å±åŠ è½½æ—¶é—´ï¼Œä» 8.6 ç§’å‡å°‘åˆ° 1.2 ç§’ï¼Œå¤§å¹…æå‡ç”¨æˆ·ç•™å­˜ç‡ è®¾è®¡å¹¶å®ç°äº†ç»„ä»¶åº“ï¼Œç»Ÿä¸€äº§å“è®¾è®¡è¯­è¨€ï¼Œæé«˜å¼€å‘æ•ˆç‡ æ¨åŠ¨å‰ç«¯æŠ€æœ¯æ ˆå‡çº§ï¼Œä» jQuery è¿ç§»åˆ°ç°ä»£åŒ–çš„ React æŠ€æœ¯æ ˆ å‰ç«¯å¼€å‘ | åˆ›æ–°åˆ›ä¸šå…¬å¸ 2017 å¹´ - 2019 å¹´\nè´Ÿè´£å…¬å¸å®˜ç½‘å’Œç®¡ç†åå°çš„å‰ç«¯å¼€å‘å’Œç»´æŠ¤ ä½¿ç”¨å“åº”å¼è®¾è®¡æŠ€æœ¯ï¼Œç¡®ä¿äº§å“åœ¨å„ç§è®¾å¤‡ä¸Šçš„è‰¯å¥½ä½“éªŒ å‚ä¸ç”¨æˆ·ç•Œé¢å’Œäº¤äº’è®¾è®¡ï¼Œæå‡äº§å“æ˜“ç”¨æ€§ é¡¹ç›®ç²¾é€‰ è¯·è®¿é—®æˆ‘çš„é¡¹ç›®é¡µé¢æŸ¥çœ‹æˆ‘å‚ä¸æˆ–ä¸»å¯¼çš„ç²¾é€‰é¡¹ç›®ã€‚\næŠ€æœ¯åšå®¢ æˆ‘å®šæœŸåœ¨æœ¬åšå®¢åˆ†äº«å‰ç«¯æŠ€æœ¯è§è§£å’Œå®è·µç»éªŒï¼Œä¸»è¦å…³æ³¨ï¼š\nReact æºç åˆ†æä¸æœ€ä½³å®è·µ å‰ç«¯æ€§èƒ½ä¼˜åŒ–ç­–ç•¥ æ¶æ„è®¾è®¡ä¸å·¥ç¨‹åŒ– æ–°æŠ€æœ¯æ¢ç´¢ä¸å®éªŒ è”ç³»æ–¹å¼ é‚®ç®±: bruce@example.com GitHub: github.com/phongm Twitter: @reyli å¦‚æœæ‚¨å¯¹æŠ€æœ¯åˆä½œã€å†…å®¹åˆ›ä½œæˆ–èŒä¸šæœºä¼šæ„Ÿå…´è¶£ï¼Œæ¬¢è¿éšæ—¶è”ç³»æˆ‘ï¼\n","permalink":"https://www.yss520.online/zh/about/","summary":"\u003ch2 id=\"ä¸ªäººç®€ä»‹\"\u003eä¸ªäººç®€ä»‹\u003c/h2\u003e\n\u003cp\u003eå¤§å®¶å¥½ï¼Œæˆ‘æ˜¯ Bruce Liï¼Œä¸€åæ‹¥æœ‰è¶…è¿‡ 8 å¹´ç»éªŒçš„èµ„æ·±å‰ç«¯å·¥ç¨‹å¸ˆï¼Œä¸“æ³¨äºæ„å»ºé«˜æ€§èƒ½ã€ç”¨æˆ·å‹å¥½çš„ Web åº”ç”¨ã€‚\u003c/p\u003e\n\u003cp\u003eæˆ‘çƒ­è¡·äºå‰æ²¿æŠ€æœ¯ï¼Œå°¤å…¶æ˜¯ React ç”Ÿæ€ç³»ç»Ÿã€æ€§èƒ½ä¼˜åŒ–å’Œå‰ç«¯æ¶æ„è®¾è®¡ã€‚ä½œä¸ºä¸€åæŠ€æœ¯åšä¸»ï¼Œæˆ‘å–œæ¬¢æ·±å…¥ç ”ç©¶æºç ï¼Œåˆ†äº«æˆ‘çš„å‘ç°å’Œç»éªŒï¼Œå¸®åŠ©ä»–äººæå‡æŠ€æœ¯èƒ½åŠ›ã€‚\u003c/p\u003e\n\u003cp\u003eåœ¨æˆ‘çš„èŒä¸šç”Ÿæ¶¯ä¸­ï¼Œæˆ‘æ›¾å‚ä¸å¤šä¸ªå¤§å‹é¡¹ç›®çš„å¼€å‘å’Œé‡æ„ï¼Œä»ç”µå•†å¹³å°åˆ°ä¼ä¸šç®¡ç†ç³»ç»Ÿï¼Œä¸æ–­æŒ‘æˆ˜è‡ªæˆ‘ï¼Œè§£å†³å¤æ‚é—®é¢˜ã€‚æˆ‘ç›¸ä¿¡ä¼˜é›…çš„ä»£ç å’Œè‰¯å¥½çš„æ¶æ„æ˜¯æ„å»ºå¯ç»´æŠ¤è½¯ä»¶çš„åŸºç¡€ã€‚\u003c/p\u003e\n\u003ch2 id=\"æŠ€æœ¯æ ˆ\"\u003eæŠ€æœ¯æ ˆ\u003c/h2\u003e\n\u003ch3 id=\"å‰ç«¯æŠ€æœ¯\"\u003eå‰ç«¯æŠ€æœ¯\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003eæ¡†æ¶\u003c/strong\u003e: React, Vue.js, Next.js\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eçŠ¶æ€ç®¡ç†\u003c/strong\u003e: Redux, Zustand\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eæ ·å¼è§£å†³æ–¹æ¡ˆ\u003c/strong\u003e: Tailwind CSS, Styled Components, SCSS\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eæ„å»ºå·¥å…·\u003c/strong\u003e: Vite, Webpack, Rollup\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eæµ‹è¯•\u003c/strong\u003e: Jest, React Testing Library, Cypress\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"èŒä¸šç»å†\"\u003eèŒä¸šç»å†\u003c/h2\u003e\n\u003ch3 id=\"é«˜çº§å‰ç«¯å·¥ç¨‹å¸ˆ--xxx-ç§‘æŠ€æœ‰é™å…¬å¸\"\u003eé«˜çº§å‰ç«¯å·¥ç¨‹å¸ˆ | XXX ç§‘æŠ€æœ‰é™å…¬å¸\u003c/h3\u003e\n\u003cp\u003e\u003cem\u003e2021 å¹´è‡³ä»Š\u003c/em\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eè´Ÿè´£å…¬å¸æ ¸å¿ƒäº§å“çš„å‰ç«¯æ¶æ„å’Œå¼€å‘\u003c/li\u003e\n\u003cli\u003eå°†é—ç•™å•ä½“åº”ç”¨é‡æ„ä¸ºå¾®å‰ç«¯æ¶æ„ï¼Œæé«˜äº†å›¢é˜Ÿå¼€å‘æ•ˆç‡ 300%\u003c/li\u003e\n\u003cli\u003eå®ç°äº†å¤æ‚æ•°æ®å¯è§†åŒ–ä»ªè¡¨ç›˜ï¼Œæ”¯æŒå®æ—¶æ•°æ®ç›‘æ§å’Œåˆ†æ\u003c/li\u003e\n\u003cli\u003eå»ºç«‹äº†å®Œæ•´çš„å‰ç«¯å·¥ç¨‹åŒ–æµç¨‹ï¼ŒåŒ…æ‹¬è‡ªåŠ¨åŒ–æµ‹è¯•ã€CI/CD å’Œæ€§èƒ½ç›‘æ§\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"å‰ç«¯å¼€å‘å·¥ç¨‹å¸ˆ--xxx-è‚¡ä»½æœ‰é™å…¬å¸\"\u003eå‰ç«¯å¼€å‘å·¥ç¨‹å¸ˆ | XXX è‚¡ä»½æœ‰é™å…¬å¸\u003c/h3\u003e\n\u003cp\u003e\u003cem\u003e2019 å¹´ - 2021 å¹´\u003c/em\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eå‚ä¸å¼€å‘é«˜æµé‡ç”µå•†å¹³å°ï¼Œæ—¥æ´»ç”¨æˆ·è¶…è¿‡ 100 ä¸‡\u003c/li\u003e\n\u003cli\u003eä¼˜åŒ–é¦–å±åŠ è½½æ—¶é—´ï¼Œä» 8.6 ç§’å‡å°‘åˆ° 1.2 ç§’ï¼Œå¤§å¹…æå‡ç”¨æˆ·ç•™å­˜ç‡\u003c/li\u003e\n\u003cli\u003eè®¾è®¡å¹¶å®ç°äº†ç»„ä»¶åº“ï¼Œç»Ÿä¸€äº§å“è®¾è®¡è¯­è¨€ï¼Œæé«˜å¼€å‘æ•ˆç‡\u003c/li\u003e\n\u003cli\u003eæ¨åŠ¨å‰ç«¯æŠ€æœ¯æ ˆå‡çº§ï¼Œä» jQuery è¿ç§»åˆ°ç°ä»£åŒ–çš„ React æŠ€æœ¯æ ˆ\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"å‰ç«¯å¼€å‘--åˆ›æ–°åˆ›ä¸šå…¬å¸\"\u003eå‰ç«¯å¼€å‘ | åˆ›æ–°åˆ›ä¸šå…¬å¸\u003c/h3\u003e\n\u003cp\u003e\u003cem\u003e2017 å¹´ - 2019 å¹´\u003c/em\u003e\u003c/p\u003e","title":"å…³äºæˆ‘"},{"content":"é¡¹ç›®æ¦‚è¿° ä¸ºæŸè·¨å›½ä¼ä¸šè®¾è®¡å¹¶å¼€å‘çš„æ•°æ®å¯è§†åŒ–ä»ªè¡¨ç›˜ç³»ç»Ÿï¼Œç”¨äºå®æ—¶ç›‘æ§å’Œåˆ†æä¸šåŠ¡å…³é”®æŒ‡æ ‡ã€‚è¯¥ç³»ç»Ÿå¤„ç†æµ·é‡æ•°æ®ï¼Œæ”¯æŒå¤æ‚çš„äº¤äº’å¼å›¾è¡¨å’Œè‡ªå®šä¹‰åˆ†æè§†å›¾ï¼Œå¸®åŠ©ç®¡ç†å±‚åšå‡ºæ•°æ®é©±åŠ¨çš„å†³ç­–ã€‚\næŠ€æœ¯æŒ‘æˆ˜ éœ€è¦å¤„ç†æ¯ç§’æ•°åƒæ¡çš„å®æ—¶æ•°æ®æ›´æ–° å¤æ‚çš„æ•°æ®å¯è§†åŒ–è¦æ±‚ï¼ŒåŒ…æ‹¬å¤šç»´åº¦äº¤å‰åˆ†æ åœ¨ä½ç«¯è®¾å¤‡ä¸Šä¿æŒæµç•…çš„ç”¨æˆ·ä½“éªŒ æ”¯æŒå¤§è§„æ¨¡ç”¨æˆ·çš„å¹¶å‘è®¿é—® è§£å†³æ–¹æ¡ˆ æ¶æ„è®¾è®¡ é‡‡ç”¨äº†å¾®å‰ç«¯æ¶æ„ï¼Œå°†ç³»ç»Ÿåˆ†è§£ä¸ºå¤šä¸ªç‹¬ç«‹éƒ¨ç½²çš„åŠŸèƒ½æ¨¡å—ï¼š\ndashboard-system/ â”œâ”€â”€ shell-app/ # ä¸»åº”ç”¨å£³ â”œâ”€â”€ micro-apps/ â”‚ â”œâ”€â”€ real-time-monitor/ # å®æ—¶ç›‘æ§æ¨¡å— â”‚ â”œâ”€â”€ historical-analysis/ # å†å²æ•°æ®åˆ†æ â”‚ â””â”€â”€ report-generator/ # æŠ¥è¡¨ç”Ÿæˆå™¨ â””â”€â”€ shared-libraries/ # å…±äº«åº“ å‰ç«¯æŠ€æœ¯æ ˆ æ¡†æ¶: React 18 + TypeScript çŠ¶æ€ç®¡ç†: Redux Toolkit + React Query å¯è§†åŒ–: D3.js + react-vis + custom components æ ·å¼: Tailwind CSS + CSS Modules æ„å»ºå·¥å…·: Vite + Module Federation æ€§èƒ½ä¼˜åŒ– React 18 å¹¶å‘æ¨¡å¼ï¼šä½¿ç”¨useTransitionå’ŒuseDeferredValueä¼˜åŒ–é‡é‡çº§æ•°æ®å¤„ç† æ•°æ®å¤„ç†ç­–ç•¥ï¼š å®¢æˆ·ç«¯æ•°æ®èšåˆå’Œé‡‡æ · åˆ†å±‚æ¸²æŸ“ç­–ç•¥ WebWorker è¿›è¡Œç¹é‡è®¡ç®— æ¸²æŸ“ä¼˜åŒ–ï¼š è™šæ‹ŸåŒ–é•¿åˆ—è¡¨ å›¾è¡¨æ‡’åŠ è½½å’ŒæŒ‰éœ€æ¸²æŸ“ ç²¾ç»†åŒ–çš„é‡æ¸²æŸ“æ§åˆ¶ å®æ—¶æ•°æ®å¤„ç† ä½¿ç”¨ WebSocket å’Œè‡ªå®šä¹‰çš„æ•°æ®ç¼“å†²ç­–ç•¥å®ç°é«˜æ•ˆçš„å®æ—¶æ•°æ®æ›´æ–°ï¼š\n// ç®€åŒ–çš„å®æ—¶æ•°æ®ç®¡ç†å™¨ class RealTimeDataManager { constructor(options) { this.buffer = []; this.flushInterval = options.flushInterval || 100; this.batchSize = options.batchSize || 50; this.subscribers = new Map(); setInterval(() =\u0026gt; this.flushBuffer(), this.flushInterval); } addData(data) { this.buffer.push(data); if (this.buffer.length \u0026gt;= this.batchSize) { this.flushBuffer(); } } flushBuffer() { if (this.buffer.length === 0) return; const batch = this.buffer.slice(); this.buffer = []; // é€šçŸ¥æ‰€æœ‰è®¢é˜…è€… this.subscribers.forEach((callback) =\u0026gt; { try { callback(batch); } catch (error) { console.error(\u0026#34;Error in subscriber:\u0026#34;, error); } }); } subscribe(id, callback) { this.subscribers.set(id, callback); return () =\u0026gt; this.subscribers.delete(id); } } æˆæœ é¦–å±åŠ è½½æ—¶é—´ä»åŸç³»ç»Ÿçš„ 5 ç§’å‡å°‘åˆ° 1.2 ç§’ å›¾è¡¨æ¸²æŸ“æ€§èƒ½æå‡ 300%ï¼Œå³ä½¿å¤„ç† 10 ä¸‡+æ•°æ®ç‚¹ä¹Ÿä¿æŒæµç•… ç”¨æˆ·å¯å¹¶å‘æ”¯æŒä» 200 å¢åŠ åˆ° 2000+ æ•°æ®æ›´æ–°å»¶è¿Ÿä»å¹³å‡ 2 ç§’é™ä½åˆ°å°äº 100ms é¡¹ç›®æˆªå›¾ ç›¸å…³æŠ€æœ¯æ–‡ç«  ç°ä»£å‰ç«¯æ¶æ„è®¾è®¡ä¸æ€§èƒ½ä¼˜åŒ– React è™šæ‹Ÿ DOM æ·±åº¦å‰–æ æµè§ˆå™¨æ¸²æŸ“æœºåˆ¶æ·±åº¦å‰–æ ","permalink":"https://www.yss520.online/zh/projects/enterprise-dashboard/","summary":"\u003ch2 id=\"é¡¹ç›®æ¦‚è¿°\"\u003eé¡¹ç›®æ¦‚è¿°\u003c/h2\u003e\n\u003cp\u003eä¸ºæŸè·¨å›½ä¼ä¸šè®¾è®¡å¹¶å¼€å‘çš„æ•°æ®å¯è§†åŒ–ä»ªè¡¨ç›˜ç³»ç»Ÿï¼Œç”¨äºå®æ—¶ç›‘æ§å’Œåˆ†æä¸šåŠ¡å…³é”®æŒ‡æ ‡ã€‚è¯¥ç³»ç»Ÿå¤„ç†æµ·é‡æ•°æ®ï¼Œæ”¯æŒå¤æ‚çš„äº¤äº’å¼å›¾è¡¨å’Œè‡ªå®šä¹‰åˆ†æè§†å›¾ï¼Œå¸®åŠ©ç®¡ç†å±‚åšå‡ºæ•°æ®é©±åŠ¨çš„å†³ç­–ã€‚\u003c/p\u003e\n\u003ch2 id=\"æŠ€æœ¯æŒ‘æˆ˜\"\u003eæŠ€æœ¯æŒ‘æˆ˜\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003eéœ€è¦å¤„ç†æ¯ç§’æ•°åƒæ¡çš„å®æ—¶æ•°æ®æ›´æ–°\u003c/li\u003e\n\u003cli\u003eå¤æ‚çš„æ•°æ®å¯è§†åŒ–è¦æ±‚ï¼ŒåŒ…æ‹¬å¤šç»´åº¦äº¤å‰åˆ†æ\u003c/li\u003e\n\u003cli\u003eåœ¨ä½ç«¯è®¾å¤‡ä¸Šä¿æŒæµç•…çš„ç”¨æˆ·ä½“éªŒ\u003c/li\u003e\n\u003cli\u003eæ”¯æŒå¤§è§„æ¨¡ç”¨æˆ·çš„å¹¶å‘è®¿é—®\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"è§£å†³æ–¹æ¡ˆ\"\u003eè§£å†³æ–¹æ¡ˆ\u003c/h2\u003e\n\u003ch3 id=\"æ¶æ„è®¾è®¡\"\u003eæ¶æ„è®¾è®¡\u003c/h3\u003e\n\u003cp\u003eé‡‡ç”¨äº†å¾®å‰ç«¯æ¶æ„ï¼Œå°†ç³»ç»Ÿåˆ†è§£ä¸ºå¤šä¸ªç‹¬ç«‹éƒ¨ç½²çš„åŠŸèƒ½æ¨¡å—ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-fallback\" data-lang=\"fallback\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003edashboard-system/\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eâ”œâ”€â”€ shell-app/               # ä¸»åº”ç”¨å£³\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eâ”œâ”€â”€ micro-apps/\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eâ”‚   â”œâ”€â”€ real-time-monitor/   # å®æ—¶ç›‘æ§æ¨¡å—\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eâ”‚   â”œâ”€â”€ historical-analysis/ # å†å²æ•°æ®åˆ†æ\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eâ”‚   â””â”€â”€ report-generator/    # æŠ¥è¡¨ç”Ÿæˆå™¨\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eâ””â”€â”€ shared-libraries/        # å…±äº«åº“\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch3 id=\"å‰ç«¯æŠ€æœ¯æ ˆ\"\u003eå‰ç«¯æŠ€æœ¯æ ˆ\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003eæ¡†æ¶\u003c/strong\u003e: React 18 + TypeScript\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eçŠ¶æ€ç®¡ç†\u003c/strong\u003e: Redux Toolkit + React Query\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eå¯è§†åŒ–\u003c/strong\u003e: D3.js + react-vis + custom components\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eæ ·å¼\u003c/strong\u003e: Tailwind CSS + CSS Modules\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eæ„å»ºå·¥å…·\u003c/strong\u003e: Vite + Module Federation\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"æ€§èƒ½ä¼˜åŒ–\"\u003eæ€§èƒ½ä¼˜åŒ–\u003c/h3\u003e\n\u003col\u003e\n\u003cli\u003e\u003cstrong\u003eReact 18 å¹¶å‘æ¨¡å¼\u003c/strong\u003eï¼šä½¿ç”¨\u003ccode\u003euseTransition\u003c/code\u003eå’Œ\u003ccode\u003euseDeferredValue\u003c/code\u003eä¼˜åŒ–é‡é‡çº§æ•°æ®å¤„ç†\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eæ•°æ®å¤„ç†ç­–ç•¥\u003c/strong\u003eï¼š\n\u003cul\u003e\n\u003cli\u003eå®¢æˆ·ç«¯æ•°æ®èšåˆå’Œé‡‡æ ·\u003c/li\u003e\n\u003cli\u003eåˆ†å±‚æ¸²æŸ“ç­–ç•¥\u003c/li\u003e\n\u003cli\u003eWebWorker è¿›è¡Œç¹é‡è®¡ç®—\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eæ¸²æŸ“ä¼˜åŒ–\u003c/strong\u003eï¼š\n\u003cul\u003e\n\u003cli\u003eè™šæ‹ŸåŒ–é•¿åˆ—è¡¨\u003c/li\u003e\n\u003cli\u003eå›¾è¡¨æ‡’åŠ è½½å’ŒæŒ‰éœ€æ¸²æŸ“\u003c/li\u003e\n\u003cli\u003eç²¾ç»†åŒ–çš„é‡æ¸²æŸ“æ§åˆ¶\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch3 id=\"å®æ—¶æ•°æ®å¤„ç†\"\u003eå®æ—¶æ•°æ®å¤„ç†\u003c/h3\u003e\n\u003cp\u003eä½¿ç”¨ WebSocket å’Œè‡ªå®šä¹‰çš„æ•°æ®ç¼“å†²ç­–ç•¥å®ç°é«˜æ•ˆçš„å®æ—¶æ•°æ®æ›´æ–°ï¼š\u003c/p\u003e","title":"ä¼ä¸šçº§æ•°æ®å¯è§†åŒ–ä»ªè¡¨ç›˜"},{"content":"å“å‘€ï¼é¡µé¢æœªæ‰¾åˆ° æŠ±æ­‰ï¼Œæ‚¨è¦æŸ¥æ‰¾çš„é¡µé¢ä¸å­˜åœ¨æˆ–å·²è¢«ç§»åŠ¨ã€‚\nè¿”å›é¦–é¡µ\n","permalink":"https://www.yss520.online/zh/404/","summary":"\u003ch1 id=\"å“å‘€é¡µé¢æœªæ‰¾åˆ°\"\u003eå“å‘€ï¼é¡µé¢æœªæ‰¾åˆ°\u003c/h1\u003e\n\u003cp\u003eæŠ±æ­‰ï¼Œæ‚¨è¦æŸ¥æ‰¾çš„é¡µé¢ä¸å­˜åœ¨æˆ–å·²è¢«ç§»åŠ¨ã€‚\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"/zh/\"\u003eè¿”å›é¦–é¡µ\u003c/a\u003e\u003c/p\u003e","title":"404 - é¡µé¢æœªæ‰¾åˆ°"},{"content":"è”ç³»æˆ‘ è¯·éšæ—¶é€šè¿‡ä¸‹é¢çš„è¡¨å•æˆ–ç¤¾äº¤åª’ä½“ä¸æˆ‘è”ç³»ã€‚\n","permalink":"https://www.yss520.online/zh/contact/","summary":"\u003ch1 id=\"è”ç³»æˆ‘\"\u003eè”ç³»æˆ‘\u003c/h1\u003e\n\u003cp\u003eè¯·éšæ—¶é€šè¿‡ä¸‹é¢çš„è¡¨å•æˆ–ç¤¾äº¤åª’ä½“ä¸æˆ‘è”ç³»ã€‚\u003c/p\u003e","title":"è”ç³»æˆ‘"},{"content":"æˆ‘çš„ç…§ç‰‡åº“ è¿™é‡Œå±•ç¤ºäº†æˆ‘æ”¶é›†çš„ä¸€äº›ç²¾ç¾ç…§ç‰‡ã€‚è¿™äº›ç…§ç‰‡å±•ç¤ºäº†è‡ªç„¶é£å…‰ã€åŸå¸‚æ™¯è§‚ã€å»ºç­‘è‰ºæœ¯ã€ç¾é£Ÿå’Œæ—…è¡Œä¸­çš„ç¾å¥½ç¬é—´ã€‚\næ¯å¼ ç…§ç‰‡éƒ½æœ‰å…¶ç‹¬ç‰¹çš„æ•…äº‹å’Œæƒ…æ„Ÿã€‚å°†é¼ æ ‡æ‚¬åœåœ¨ç…§ç‰‡ä¸Šå¯ä»¥çœ‹åˆ°æ ‡é¢˜ï¼Œç‚¹å‡»ç…§ç‰‡å¯ä»¥æŸ¥çœ‹å¤§å›¾ã€‚å¸Œæœ›è¿™äº›ç…§ç‰‡èƒ½ç»™æ‚¨å¸¦æ¥è§†è§‰ä¸Šçš„äº«å—å’Œå¿ƒçµçš„å¹³é™ã€‚\nç…§ç‰‡é›† ä¸‹é¢æ˜¯æˆ‘ç²¾å¿ƒæŒ‘é€‰çš„ç…§ç‰‡é›†ï¼ŒåŒ…æ‹¬äº†è‡ªç„¶é£æ™¯ã€åŸå¸‚é£å…‰ã€å»ºç­‘è‰ºæœ¯ã€æ—…è¡Œè®°å¿†å’Œç¾é£Ÿä½³è‚´ã€‚è¿™äº›ç…§ç‰‡æ¥è‡ªä¸–ç•Œå„åœ°ï¼Œè®°å½•äº†ä¸åŒæ–‡åŒ–å’Œé£æ™¯çš„ç‹¬ç‰¹é­…åŠ›ã€‚\n","permalink":"https://www.yss520.online/zh/gallery/","summary":"\u003ch1 id=\"æˆ‘çš„ç…§ç‰‡åº“\"\u003eæˆ‘çš„ç…§ç‰‡åº“\u003c/h1\u003e\n\u003cp\u003eè¿™é‡Œå±•ç¤ºäº†æˆ‘æ”¶é›†çš„ä¸€äº›ç²¾ç¾ç…§ç‰‡ã€‚è¿™äº›ç…§ç‰‡å±•ç¤ºäº†è‡ªç„¶é£å…‰ã€åŸå¸‚æ™¯è§‚ã€å»ºç­‘è‰ºæœ¯ã€ç¾é£Ÿå’Œæ—…è¡Œä¸­çš„ç¾å¥½ç¬é—´ã€‚\u003c/p\u003e\n\u003cp\u003eæ¯å¼ ç…§ç‰‡éƒ½æœ‰å…¶ç‹¬ç‰¹çš„æ•…äº‹å’Œæƒ…æ„Ÿã€‚å°†é¼ æ ‡æ‚¬åœåœ¨ç…§ç‰‡ä¸Šå¯ä»¥çœ‹åˆ°æ ‡é¢˜ï¼Œç‚¹å‡»ç…§ç‰‡å¯ä»¥æŸ¥çœ‹å¤§å›¾ã€‚å¸Œæœ›è¿™äº›ç…§ç‰‡èƒ½ç»™æ‚¨å¸¦æ¥è§†è§‰ä¸Šçš„äº«å—å’Œå¿ƒçµçš„å¹³é™ã€‚\u003c/p\u003e\n\u003ch2 id=\"ç…§ç‰‡é›†\"\u003eç…§ç‰‡é›†\u003c/h2\u003e\n\u003cp\u003eä¸‹é¢æ˜¯æˆ‘ç²¾å¿ƒæŒ‘é€‰çš„ç…§ç‰‡é›†ï¼ŒåŒ…æ‹¬äº†è‡ªç„¶é£æ™¯ã€åŸå¸‚é£å…‰ã€å»ºç­‘è‰ºæœ¯ã€æ—…è¡Œè®°å¿†å’Œç¾é£Ÿä½³è‚´ã€‚è¿™äº›ç…§ç‰‡æ¥è‡ªä¸–ç•Œå„åœ°ï¼Œè®°å½•äº†ä¸åŒæ–‡åŒ–å’Œé£æ™¯çš„ç‹¬ç‰¹é­…åŠ›ã€‚\u003c/p\u003e","title":"ç…§ç‰‡åº“"}]